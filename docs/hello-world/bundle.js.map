{"version":3,"file":"bundle.js","mappings":"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","sources":["webpack:///webpack/runtime/chunk loaded","webpack:///../../node_modules/tslib/tslib.es6.js","webpack:///../../../../npm-modules/game-inputs/src/inputs.js","webpack:///../../../noa/src/lib/inputs.js","webpack:///../../../noa/node_modules/micro-game-shell/src/micro-game-shell.js","webpack:///../../../noa/src/lib/container.js","webpack:///../../../noa/src/lib/camera.js","webpack:///../../../noa/src/components/position.js","webpack:///../../../noa/src/components/physics.js","webpack:///../../../noa/src/components/collideEntities.js","webpack:///../../../noa/src/components/collideTerrain.js","webpack:///../../../noa/src/components/fadeOnZoom.js","webpack:///../../../noa/src/components/followsEntity.js","webpack:///../../../noa/src/components/mesh.js","webpack:///../../../noa/src/components/movement.js","webpack:///../../../noa/src/components/receivesInputs.js","webpack:///../../../noa/src/components/shadow.js","webpack:///../../../noa/src/components/smoothCamera.js","webpack:///../../../noa/src/lib/entities.js","webpack:///../../../noa/src/lib/objectMesher.js","webpack:///../../../noa/src/lib/terrainMaterials.js","webpack:///../../../noa/src/lib/terrainMesher.js","webpack:///../../../noa/src/lib/registry.js","webpack:///../../../noa/src/lib/sceneOctreeManager.js","webpack:///../../../noa/src/lib/rendering.js","webpack:///../../../noa/node_modules/voxel-physics-engine/src/rigidBody.js","webpack:///../../../noa/node_modules/voxel-physics-engine/src/index.js","webpack:///../../../noa/src/lib/physics.js","webpack:///../../../noa/src/lib/chunk.js","webpack:///../../../noa/src/lib/world.js","webpack:///../../../noa/src/index.js","webpack:///./index.js","webpack:///../../../noa/node_modules/@jpweeks/typedarray-pool/pool.js","webpack:///../../../noa/node_modules/aabb-3d/index.js","webpack:///../../../noa/node_modules/bit-twiddle/twiddle.js","webpack:///../../../noa/node_modules/box-intersect/index.js","webpack:///../../../noa/node_modules/box-intersect/lib/brute.js","webpack:///../../../noa/node_modules/box-intersect/lib/intersect.js","webpack:///../../../noa/node_modules/box-intersect/lib/median.js","webpack:///../../../noa/node_modules/box-intersect/lib/partition.js","webpack:///../../../noa/node_modules/box-intersect/lib/sort.js","webpack:///../../../noa/node_modules/box-intersect/lib/sweep.js","webpack:///../../../noa/node_modules/dup/dup.js","webpack:///../../../noa/node_modules/ent-comp/src/ECS.js","webpack:///../../../noa/node_modules/ent-comp/src/dataStore.js","webpack:///../../../noa/node_modules/events/events.js","webpack:///../../../noa/node_modules/fast-voxel-raycast/index.js","webpack:///../../../noa/node_modules/gl-vec3/add.js","webpack:///../../../noa/node_modules/gl-vec3/angle.js","webpack:///../../../noa/node_modules/gl-vec3/ceil.js","webpack:///../../../noa/node_modules/gl-vec3/clone.js","webpack:///../../../noa/node_modules/gl-vec3/copy.js","webpack:///../../../noa/node_modules/gl-vec3/create.js","webpack:///../../../noa/node_modules/gl-vec3/cross.js","webpack:///../../../noa/node_modules/gl-vec3/dist.js","webpack:///../../../noa/node_modules/gl-vec3/distance.js","webpack:///../../../noa/node_modules/gl-vec3/div.js","webpack:///../../../noa/node_modules/gl-vec3/divide.js","webpack:///../../../noa/node_modules/gl-vec3/dot.js","webpack:///../../../noa/node_modules/gl-vec3/epsilon.js","webpack:///../../../noa/node_modules/gl-vec3/equals.js","webpack:///../../../noa/node_modules/gl-vec3/exactEquals.js","webpack:///../../../noa/node_modules/gl-vec3/floor.js","webpack:///../../../noa/node_modules/gl-vec3/forEach.js","webpack:///../../../noa/node_modules/gl-vec3/fromValues.js","webpack:///../../../noa/node_modules/gl-vec3/index.js","webpack:///../../../noa/node_modules/gl-vec3/inverse.js","webpack:///../../../noa/node_modules/gl-vec3/len.js","webpack:///../../../noa/node_modules/gl-vec3/length.js","webpack:///../../../noa/node_modules/gl-vec3/lerp.js","webpack:///../../../noa/node_modules/gl-vec3/max.js","webpack:///../../../noa/node_modules/gl-vec3/min.js","webpack:///../../../noa/node_modules/gl-vec3/mul.js","webpack:///../../../noa/node_modules/gl-vec3/multiply.js","webpack:///../../../noa/node_modules/gl-vec3/negate.js","webpack:///../../../noa/node_modules/gl-vec3/normalize.js","webpack:///../../../noa/node_modules/gl-vec3/random.js","webpack:///../../../noa/node_modules/gl-vec3/rotateX.js","webpack:///../../../noa/node_modules/gl-vec3/rotateY.js","webpack:///../../../noa/node_modules/gl-vec3/rotateZ.js","webpack:///../../../noa/node_modules/gl-vec3/round.js","webpack:///../../../noa/node_modules/gl-vec3/scale.js","webpack:///../../../noa/node_modules/gl-vec3/scaleAndAdd.js","webpack:///../../../noa/node_modules/gl-vec3/set.js","webpack:///../../../noa/node_modules/gl-vec3/sqrDist.js","webpack:///../../../noa/node_modules/gl-vec3/sqrLen.js","webpack:///../../../noa/node_modules/gl-vec3/squaredDistance.js","webpack:///../../../noa/node_modules/gl-vec3/squaredLength.js","webpack:///../../../noa/node_modules/gl-vec3/sub.js","webpack:///../../../noa/node_modules/gl-vec3/subtract.js","webpack:///../../../noa/node_modules/gl-vec3/transformMat3.js","webpack:///../../../noa/node_modules/gl-vec3/transformMat4.js","webpack:///../../../noa/node_modules/gl-vec3/transformQuat.js","webpack:///../../../noa/node_modules/iota-array/iota.js","webpack:///../../../noa/node_modules/is-buffer/index.js","webpack:///../../../noa/node_modules/ndarray/ndarray.js","webpack:///../../../noa/node_modules/ndarray/node_modules/is-buffer/index.js","webpack:///../../../noa/node_modules/voxel-aabb-sweep/index.js","webpack:///../../../noa/src/lib/util.js","webpack:///../../../../npm-modules/game-inputs/node_modules/events/events.js","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/global","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/jsonp chunk loading","webpack:///webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n","\nimport { EventEmitter } from 'events'\n\nimport packageJSON from '../package.json'\nvar version = packageJSON.version\n\n\nfunction DefaultOptions() {\n    this.preventDefaults = false\n    this.stopPropagation = false\n    this.allowContextMenu = false\n    this.disabled = false\n}\n\n\nexport class GameInputs {\n\n    /**\n     *   Simple inputs manager to abstract key/mouse inputs.\n     * \n     * @param {HTMLElement} domElement\n     * @param {DefaultOptions} options\n    */\n\n    constructor(domElement, options) {\n        this.version = version\n        var opts = Object.assign({}, new DefaultOptions(), options || {})\n\n        // settings\n        /** The HTMLElement that `inputs` is bound to. */\n        this.element = domElement || document\n        /** When true, all key events with bindings will call `preventDefaults`. */\n        this.preventDefaults = !!opts.preventDefaults\n        /** When true, all key events with bindings will call `stopPropagation`. */\n        this.stopPropagation = !!opts.stopPropagation\n        /** When this is false, the context menu will be prevented from opening if there is a binding to the right mouse button. */\n        this.allowContextMenu = !!opts.allowContextMenu\n        /** When disabled, no binding events will fire. */\n        this.disabled = !!opts.disabled\n\n        /** \n         * Optional filter function. Useful if you want to, e.g., \n         * ignore a key binding if ctrl/alt are pressed, but allow that\n         * same binding if it originated from a mouse event.\n         * @param {KeyboardEvent & MouseEvent} ev\n         * @param {string} bindingName\n        */\n        this.filterEvents = (ev, bindingName) => true\n\n        // emitters\n        /** \n         * Event emitter for binding **press** events.  \n         * The original mouse or key event will be passed as an argument.\n        */\n        this.down = new EventEmitter()\n        /** \n         * Event emitter for binding **release** events.  \n         * The original mouse or key event will be passed as an argument.\n         */\n        this.up = new EventEmitter()\n\n        /** \n         * The boolean state of whether each binding is currently pressed.\n         * \n         * `inputs.state['move-left'] // true if a bound key is pressed`\n         * @type {{ [key:string]: boolean }} \n        */\n        this.state = {}\n\n        /** \n         * Numeric counters representing accumulated pointer/scroll inputs \n         * since the last time `tick` was called.\n        */\n        this.pointerState = {\n            dx: 0,\n            dy: 0,\n            scrollx: 0,\n            scrolly: 0,\n            scrollz: 0,\n        }\n\n        /** \n         * How many times each binding has been **pressed** \n         * since the last time `tick` was called.\n         * @type {{ [key:string]: number }} \n        */\n        this.pressCount = {}\n\n        /** \n         * How many times each binding has been **released** \n         * since the last time `tick` was called.\n         * @type {{ [key:string]: number }} \n        */\n        this.releaseCount = {}\n\n\n\n        // internal state\n        /** @private @type {{ [key:string]: string[] }}   code -> [...binding names] */\n        this._keyBindmap = {}\n        /** @private @type {{ [key:string]: boolean }} code -> isDown */\n        this._keyStates = {}\n        /** @private @type {{ [key:string]: number }}  bindingName -> currCt */\n        this._bindPressCount = {}\n        /** @private */\n        this._touches = { lastX: 0, lastY: 0, currID: null }\n\n\n        // register for ALL THE dom events\n        if (document.readyState !== 'loading') {\n            initEvents(this)\n        } else {\n            document.addEventListener('DOMContentLoaded', ev => {\n                initEvents(this)\n            }, { once: true })\n        }\n    }\n\n\n    /**\n     * Binds one or more physical keys to an arbitrary binding name.\n     * Key strings should align to `KeyboardEvent.code` strings - \n     * e.g. `KeyA`, `ArrowDown`, etc.\n     * \n     * `inputs.bind('move-player-left', 'KeyW', 'ArrowLeft')\n     * \n     * @param {string} bindingName \n     * @param {...string} keys \n     */\n    bind(bindingName, ...keys) {\n        keys.forEach(code => {\n            var bindings = this._keyBindmap[code] || []\n            if (bindings.includes(bindingName)) return\n            bindings.push(bindingName)\n            this._keyBindmap[code] = bindings\n        })\n        this.state[bindingName] = !!this.state[bindingName]\n        this.pressCount[bindingName] = this.pressCount[bindingName] || 0\n        this.releaseCount[bindingName] = this.releaseCount[bindingName] || 0\n    }\n\n\n    /**\n     * Removes all key bindings for a given binding name.\n     * \n     * `inputs.unbind('move-player-left')\n     */\n    unbind(bindingName) {\n        for (var code in this._keyBindmap) {\n            var bindings = this._keyBindmap[code]\n            var i = bindings.indexOf(bindingName)\n            if (i > -1) { bindings.splice(i, 1) }\n        }\n    }\n\n    /**\n     * Returns a copy of all existing bindings, in the format:\n     * ```js\n     *   {\n     *      bindingName: [ keyCode1, keyCode2, ... ]\n     *      ...\n     *   }\n     * ```\n     */\n    getBindings() {\n        var res = {}\n        for (var code in this._keyBindmap) {\n            var bindings = this._keyBindmap[code]\n            bindings.forEach(bindingName => {\n                res[bindingName] = res[bindingName] || []\n                res[bindingName].push(code)\n            })\n        }\n        return res\n    }\n\n\n    /**\n     * Tick function - clears out all cumulative counters\n    */\n    tick() {\n        zeroAllProperties(this.pointerState)\n        zeroAllProperties(this.pressCount)\n        zeroAllProperties(this.releaseCount)\n    }\n}\n\nfunction zeroAllProperties(obj) {\n    for (var key in obj) obj[key] = 0\n}\n\n\n\n\n\n\n/*\n *\n *   PRIVATE FUNCTIONS\n *\n*/\n\n/** @param {GameInputs} inputs */\nfunction initEvents(inputs) {\n    // keys\n    window.addEventListener('keydown', onKeyEvent.bind(null, inputs, true), false)\n    window.addEventListener('keyup', onKeyEvent.bind(null, inputs, false), false)\n\n    // pointer/mouse events\n    var pointerOpts = { passive: true }\n    if (window.PointerEvent) {\n        inputs.element.addEventListener(\"pointerdown\", onPointerEvent.bind(null, inputs, true), pointerOpts)\n        window.document.addEventListener(\"pointerup\", onPointerEvent.bind(null, inputs, false), pointerOpts)\n        inputs.element.addEventListener(\"pointermove\", onPointerMove.bind(null, inputs), pointerOpts)\n    } else {\n        inputs.element.addEventListener(\"mousedown\", onPointerEvent.bind(null, inputs, true), pointerOpts)\n        window.document.addEventListener(\"mouseup\", onPointerEvent.bind(null, inputs, false), pointerOpts)\n        inputs.element.addEventListener(\"mousemove\", onPointerMove.bind(null, inputs), pointerOpts)\n    }\n    inputs.element.addEventListener(\"wheel\", onWheelEvent.bind(null, inputs), pointerOpts)\n    inputs.element.addEventListener(\"contextmenu\", onContextMenu.bind(null, inputs), false)\n\n    // doc-level blur event for edge cases\n    window.addEventListener(\"blur\", onWindowBlur.bind(null, inputs), false)\n}\n\n\n\n\n\n/*\n *\n *\n *      INTERNALS - DOM EVENT HANDLERS\n *\n *\n*/\n\nfunction onKeyEvent(inputs, nowDown, ev) {\n    handleKeyEvent(ev.code, nowDown, inputs, ev)\n}\n\nfunction onPointerEvent(inputs, nowDown, ev) {\n    // if pointer events supported, only track the first\n    if ('pointerId' in ev) {\n        if (nowDown) {\n            if (inputs._touches.currID !== null) return\n            inputs._touches.currID = ev.pointerId\n        } else {\n            if (inputs._touches.currID !== ev.pointerId) return\n            inputs._touches.currID = null\n        }\n    }\n    var button = ('button' in ev) ? (ev.button + 1) : 1\n    handleKeyEvent('Mouse' + button, nowDown, inputs, ev)\n    return false\n}\n\nfunction onPointerMove(inputs, ev) {\n    // if a touch exists, ignore movement of other touches\n    if ('pointerId' in ev && inputs._touches.currID !== null) {\n        if (inputs._touches.currID !== ev.pointerId) return\n    }\n    // fire no events, just expose the state data\n    var dx = ev.movementX || ev.mozMovementX || 0,\n        dy = ev.movementY || ev.mozMovementY || 0\n    inputs.pointerState.dx += dx\n    inputs.pointerState.dy += dy\n}\n\n\n\n\n/*\n * \n *      mousewheel / scroll handling...\n * \n */\n\nfunction onWheelEvent(inputs, ev) {\n    var scale = 1\n    switch (ev.deltaMode) {\n        case 0: scale = 1; break  // Pixel\n        case 1: scale = 12; break  // Line\n        case 2:  // page\n            // TODO: investigate when this happens, what correct handling is\n            scale = inputs.element.clientHeight || window.innerHeight\n            break\n    }\n    // accumulate state\n    inputs.pointerState.scrollx += (ev.deltaX || 0) * scale\n    inputs.pointerState.scrolly += (ev.deltaY || 0) * scale\n    inputs.pointerState.scrollz += (ev.deltaZ || 0) * scale\n}\n\n\n/*\n *\n *          Edge cases...\n *\n*/\n\nfunction onContextMenu(inputs, ev) {\n    if (!inputs.allowContextMenu) {\n        ev.preventDefault()\n        return false\n    }\n}\n\nfunction onWindowBlur(inputs) {\n    // at least some browsers handle mouse events correctly here\n    // but not keys, so on window blur simulate a keyUp for all pressed keys\n    // there may be a better way to handle this someday..\n    for (var code in inputs._keyStates) {\n        if (!inputs._keyStates[code]) continue\n        if (/^Mouse\\d/.test(code)) continue\n        handleKeyEvent(code, false, inputs, {\n            code: code,\n            note: `This is a mocked KeyboardEvent made by the 'game-inputs' module`,\n            preventDefault: () => { },\n            stopPropagation: () => { },\n        })\n    }\n}\n\n\n\n\n/*\n *\n *\n *          FINAL KEY BIND HANDLING\n *\n *\n*/\n\n// tracks the state/counts of individual physical keys\nfunction handleKeyEvent(code, nowDown, inputs, ev) {\n    var bindings = inputs._keyBindmap[code]\n    if (!bindings) return\n\n    // if the key state has changed, handle the event for all bindings\n    var prevState = inputs._keyStates[code]\n    if (XOR(prevState, nowDown)) {\n        inputs._keyStates[code] = nowDown\n        bindings.forEach(bindingName => {\n            // allow client to filter events if applicable\n            var allow = (inputs.filterEvents) ?\n                inputs.filterEvents(ev, bindingName) : true\n            if (!allow) return\n            // finally emit the event\n            handleBindingEvent(bindingName, nowDown, inputs, ev)\n        })\n    }\n\n    // prevent/stop only for non-mouse events\n    if (!('button' in ev)) {\n        if (inputs.preventDefaults && !ev.defaultPrevented) {\n            ev.preventDefault()\n        }\n        if (inputs.stopPropagation) ev.stopPropagation()\n    }\n\n}\n\n\n// tracks the state/counts of virtual bindings\nfunction handleBindingEvent(bindingName, pressed, inputs, ev) {\n    // externally, track *cumulative* press/release counts\n    var counter = (pressed) ? inputs.pressCount : inputs.releaseCount\n    counter[bindingName] = (counter[bindingName] || 0) + 1\n    // internally, track *current* press count (to handle overlapping keybinds)\n    var ct = inputs._bindPressCount[bindingName] || 0\n    ct += pressed ? 1 : -1\n    if (ct < 0) { ct = 0 } // shouldn't happen\n    inputs._bindPressCount[bindingName] = ct\n\n    // emit event if binding's state has changed\n    var currstate = inputs.state[bindingName]\n    if (XOR(currstate, ct)) {\n        inputs.state[bindingName] = (ct > 0)\n        var emitter = pressed ? inputs.down : inputs.up\n        if (!inputs.disabled) emitter.emit(bindingName, ev)\n    }\n}\n\n\n\n\n/*\n *\n *\n *    HELPERS\n *\n *\n*/\n\n\n// how is this not part of Javascript?\nfunction XOR(a, b) {\n    return a ? !b : b\n}\n\n\n\n\n","/** \n * The Inputs class is found at [[Inputs | `noa.inputs`]].\n * @module noa.inputs\n */\n\n\nimport { GameInputs } from 'game-inputs'\n\nvar defaultOptions = {\n    preventDefaults: false,\n    stopPropagation: false,\n    allowContextMenu: false,\n}\n\nvar defaultBindings = {\n    \"forward\": [\"KeyW\", \"ArrowUp\"],\n    \"backward\": [\"KeyS\", \"ArrowDown\"],\n    \"left\": [\"KeyA\", \"ArrowLeft\"],\n    \"right\": [\"KeyD\", \"ArrowRight\"],\n    \"fire\": \"Mouse1\",\n    \"mid-fire\": [\"Mouse2\", \"KeyQ\"],\n    \"alt-fire\": [\"Mouse3\", \"KeyE\"],\n    \"jump\": \"Space\",\n}\n\n/**\n * `noa.inputs` - Handles key and mouse input bindings.\n * \n * This module extends \n * [game-inputs](https://github.com/fenomas/game-inputs),\n * so turn on \"Inherited\" to see its APIs here, or view the base module \n * for full docs.\n * \n * This module uses the following default options (from the options\n * object passed to the [[Engine]]):\n * \n * ```js\n *   defaultBindings: {\n *     \"forward\":  [\"KeyW\", \"ArrowUp\"],\n *     \"backward\": [\"KeyS\", \"ArrowDown\"],\n *     \"left\":     [\"KeyA\", \"ArrowLeft\"],\n *     \"right\":    [\"KeyD\", \"ArrowRight\"],\n *     \"fire\":     \"Mouse1\",\n *     \"mid-fire\": [\"Mouse2\", \"KeyQ\"],\n *     \"alt-fire\": [\"Mouse3\", \"KeyE\"],\n *     \"jump\":     \"Space\",\n *   }\n * ```\n */\n\nexport class Inputs extends GameInputs {\n\n    /** @internal */\n    constructor(noa, opts, element) {\n        opts = Object.assign({}, defaultOptions, opts)\n        super(element, opts)\n\n        var b = opts.bindings || defaultBindings\n        for (var name in b) {\n            var keys = Array.isArray(b[name]) ? b[name] : [b[name]]\n            this.bind(name, ...keys)\n        }\n    }\n}\n\n","\n\n\n/*\n * \n * \n *      base class and API\n * \n * \n*/\n\nexport class MicroGameShell {\n\n    constructor(domElement = null, pollTime = 10, skipFramesAfter = 100) {\n        // settings\n        this.stickyPointerLock = false\n        this.stickyFullscreen = false\n\n        this.tickRate = 30\n        this.maxRenderRate = 0\n\n        // API\n        this.pointerLock = false\n        this.fullscreen = false\n\n        // for client to override\n        this.onTick = function (dt) { }\n        this.onRender = function () { }\n\n        this.onInit = function () { }\n        this.onResize = function () { }\n        this.onPointerLockChanged = function (hasPL) { }\n        this.onFullscreenChanged = function (hasFS) { }\n        this.onPointerLockerror = function (err) { }\n\n        // init\n        domReady(() => {\n            setupTimers(this, pollTime, skipFramesAfter)\n            setupDomElement(this, domElement)\n            this.onInit()\n        })\n    }\n}\n\n\n\n\n\n/*\n * \n *      tick- and render events\n * \n*/\n\nfunction setupTimers(shell, pollTime, skipFramesAfter) {\n    shell._nowObject = performance || Date\n    shell._skipFramesAfter = skipFramesAfter\n    shell._renderAccum = 0\n    // these are when the last tick/render _started_\n    var now = shell._nowObject.now()\n    shell._lastTick = now\n    shell._lastRender = now\n\n    shell._frameCB = frameHandler.bind(null, shell)\n    requestAnimationFrame(shell._frameCB)\n    if (pollTime > 0) {\n        shell._intervalCB = intervalHandler.bind(null, shell)\n        shell._interval = setInterval(shell._intervalCB, pollTime)\n    }\n}\n\n\nfunction intervalHandler(shell) {\n    var now = shell._nowObject.now()\n    var cutoffTime = now + shell._skipFramesAfter\n    var tickDur = 1000 / shell.tickRate\n    // tick until we're up to date\n    while (shell._lastTick + tickDur < now) {\n        shell.onTick(tickDur)\n        shell._lastTick += tickDur\n        now = shell._nowObject.now()\n        // skip frames if we've exceeded max processing time\n        if (now > cutoffTime) {\n            shell._lastTick = now\n            return\n        }\n    }\n}\n\nfunction frameHandler(shell) {\n    requestAnimationFrame(shell._frameCB)\n    intervalHandler(shell)\n    var now = shell._nowObject.now()\n    var dt = now - shell._lastRender\n    shell._lastRender = now\n    if (shell.maxRenderRate > 0) {\n        shell._renderAccum += dt\n        var frameDur = 1000 / shell.maxRenderRate\n        if (shell._renderAccum < frameDur) return\n        shell._renderAccum = Math.min(shell._renderAccum - frameDur, frameDur)\n    }\n    var tickDur = 1000 / shell.tickRate\n    var framePart = (now - shell._lastTick) / tickDur\n    shell.onRender(dt, framePart, tickDur)\n}\n\n\n\n\n\n\n/*\n * \n *      DOM element and sticky fullscreen/pointerlock\n * \n*/\n\nfunction setupDomElement(shell, el) {\n    if (!el) return\n\n    var hasPL = false\n    var hasFS = false\n    var setPL = (want) => {\n        if (!el.requestPointerLock) return\n        if (!!want === hasPL) return\n        if (want) {\n            var prom = el.requestPointerLock()\n            if (prom.catch) prom.catch(err => {\n                if (shell.onPointerLockerror) shell.onPointerLockerror(err)\n            })\n        }\n        else { document.exitPointerLock() }\n    }\n    var setFS = (want) => {\n        if (!el.requestFullscreen) return\n        if (!!want === hasFS) return\n        if (want) { el.requestFullscreen() }\n        else { document.exitFullscreen() }\n    }\n\n    // track whether we actually have PL/FS, and send events\n    document.addEventListener('pointerlockchange', ev => {\n        hasPL = (document.pointerLockElement === el)\n        shell.onPointerLockChanged(hasPL)\n    })\n    document.addEventListener('fullscreenchange', ev => {\n        hasFS = (document.fullscreenElement === el)\n        shell.onFullscreenChanged(hasFS)\n    })\n\n\n    // decorate shell with getter/setters that request FS/PL\n    Object.defineProperty(shell, 'pointerLock', {\n        get: () => hasPL,\n        set: setPL,\n    })\n    Object.defineProperty(shell, 'fullscreen', {\n        get: () => hasFS,\n        set: setFS,\n    })\n\n\n    // stickiness via click handler\n    el.addEventListener('click', ev => {\n        if (shell.stickyPointerLock && !hasPL) setPL(true)\n        if (shell.stickyFullscreen && !hasFS) setFS(true)\n    })\n\n\n    // resize events via ResizeObserver\n    var resizeHandler = () => shell.onResize()\n    if (window.ResizeObserver) {\n        var observer = new ResizeObserver(resizeHandler)\n        observer.observe(el)\n    } else {\n        window.addEventListener('resize', resizeHandler)\n    }\n}\n\n\n\n\n\n/*\n * \n *      util \n * \n*/\n\nvar domReady = (fn) => {\n    if (document.readyState === 'loading') {\n        var handler = () => {\n            document.removeEventListener('readystatechange', handler)\n            fn()\n        }\n        document.addEventListener('readystatechange', handler)\n    } else {\n        setTimeout(fn, 1)\n    }\n}\n","/** \n * The Container class is found at [[Container | `noa.container`]].\n * @module noa.container\n */\n\nimport { EventEmitter } from 'events'\nimport { MicroGameShell } from 'micro-game-shell'\n\n\n\n\n\n/**\n * `noa.container` - manages the game's HTML container element, canvas, \n * fullscreen, pointerLock, and so on.\n * \n * This module wraps `micro-game-shell`, which does most of the implementation.\n * \n * @emits DOMready\n * @emits gainedPointerLock\n * @emits lostPointerLock\n */\n\nexport class Container extends EventEmitter {\n\n    /** @internal */\n    constructor(noa, opts) {\n        super()\n        opts = opts || {}\n\n        /** \n         * @internal\n         * @type {import('../index').Engine}\n        */\n        this.noa = noa\n\n        /** The game's DOM element container */\n        this.element = opts.domElement || createContainerDiv()\n\n        /** The `canvas` element that the game will draw into */\n        this.canvas = getOrCreateCanvas(this.element)\n\n        /** Whether the browser supports pointerLock. @readonly */\n        this.supportsPointerLock = false\n\n        /** Whether the user's pointer is within the game area. @readonly */\n        this.pointerInGame = false\n\n        /** Whether the game is focused. @readonly */\n        this.isFocused = !!document.hasFocus()\n\n        /** Gets the current state of pointerLock. @readonly */\n        this.hasPointerLock = false\n\n\n\n        // shell manages tick/render rates, and pointerlock/fullscreen\n        var pollTime = 10\n        /** @internal */\n        this._shell = new MicroGameShell(this.element, pollTime)\n        this._shell.tickRate = opts.tickRate\n        this._shell.maxRenderRate = opts.maxRenderRate\n        this._shell.stickyPointerLock = opts.stickyPointerLock\n        this._shell.stickyFullscreen = opts.stickyFullscreen\n\n\n\n        // core timing events\n        this._shell.onTick = noa.tick.bind(noa)\n        this._shell.onRender = noa.render.bind(noa)\n\n        // shell listeners\n        this._shell.onPointerLockChanged = (hasPL) => {\n            this.hasPointerLock = hasPL\n            this.emit((hasPL) ? 'gainedPointerLock' : 'lostPointerLock')\n            // this works around a Firefox bug where no mouse-in event \n            // gets issued after starting pointerlock\n            if (hasPL) this.pointerInGame = true\n        }\n\n        // catch and relay domReady event\n        this._shell.onInit = () => {\n            this._shell.onResize = noa.rendering.resize.bind(noa.rendering)\n            // listeners to track when game has focus / pointer\n            detectPointerLock(this)\n            this.element.addEventListener('mouseenter', () => { this.pointerInGame = true })\n            this.element.addEventListener('mouseleave', () => { this.pointerInGame = false })\n            window.addEventListener('focus', () => { this.isFocused = true })\n            window.addEventListener('blur', () => { this.isFocused = false })\n            // catch edge cases for initial states\n            var onFirstMousedown = () => {\n                this.pointerInGame = true\n                this.isFocused = true\n                this.element.removeEventListener('mousedown', onFirstMousedown)\n            }\n            this.element.addEventListener('mousedown', onFirstMousedown)\n            // emit for engine core\n            this.emit('DOMready')\n            // done and remove listener\n            this._shell.onInit = null\n        }\n    }\n\n\n    /*\n     *\n     *\n     *              PUBLIC API \n     *\n     *\n    */\n\n    /** @internal */\n    appendTo(htmlElement) {\n        this.element.appendChild(htmlElement)\n    }\n\n    /** \n     * Sets whether `noa` should try to acquire or release pointerLock\n    */\n    setPointerLock(lock = false) {\n        // not sure if this will work robustly\n        this._shell.pointerLock = !!lock\n    }\n}\n\n\n\n/*\n *\n *\n *              INTERNALS\n *\n *\n*/\n\n\nfunction createContainerDiv() {\n    // based on github.com/mikolalysenko/game-shell - makeDefaultContainer()\n    var container = document.createElement(\"div\")\n    container.tabIndex = 1\n    container.style.position = \"fixed\"\n    container.style.left = \"0px\"\n    container.style.right = \"0px\"\n    container.style.top = \"0px\"\n    container.style.bottom = \"0px\"\n    container.style.height = \"100%\"\n    container.style.overflow = \"hidden\"\n    document.body.appendChild(container)\n    document.body.style.overflow = \"hidden\" //Prevent bounce\n    document.body.style.height = \"100%\"\n    container.id = 'noa-container'\n    return container\n}\n\n\nfunction getOrCreateCanvas(el) {\n    // based on github.com/stackgl/gl-now - default canvas\n    var canvas = el.querySelector('canvas')\n    if (!canvas) {\n        canvas = document.createElement('canvas')\n        canvas.style.position = \"absolute\"\n        canvas.style.left = \"0px\"\n        canvas.style.top = \"0px\"\n        canvas.style.height = \"100%\"\n        canvas.style.width = \"100%\"\n        canvas.id = 'noa-canvas'\n        el.insertBefore(canvas, el.firstChild)\n    }\n    return canvas\n}\n\n\n// set up stuff to detect pointer lock support.\n// Needlessly complex because Chrome/Android claims to support but doesn't.\n// For now, just feature detect, but assume no support if a touch event occurs\n// TODO: see if this makes sense on hybrid touch/mouse devices\nfunction detectPointerLock(self) {\n    var lockElementExists =\n        ('pointerLockElement' in document) ||\n        ('mozPointerLockElement' in document) ||\n        ('webkitPointerLockElement' in document)\n    if (lockElementExists) {\n        self.supportsPointerLock = true\n        var listener = function (e) {\n            self.supportsPointerLock = false\n            document.removeEventListener(e.type, listener)\n        }\n        document.addEventListener('touchmove', listener)\n    }\n}\n","/** \n * The Camera class is found at [[Camera | `noa.camera`]].\n * @module noa.camera\n */\n\nimport vec3 from 'gl-vec3'\nimport aabb from 'aabb-3d'\nimport sweep from 'voxel-aabb-sweep'\n\n\n\n// default options\nvar defaults = {\n    inverseX: false,\n    inverseY: false,\n    sensitivityX: 10,\n    sensitivityY: 10,\n    initialZoom: 0,\n    zoomSpeed: 0.2,\n}\n\n\n// locals\nvar tempVectors = [\n    vec3.create(),\n    vec3.create(),\n    vec3.create(),\n]\nvar originVector = vec3.create()\n\n\n/**\n * `noa.camera` - manages the camera, its position and direction, \n * mouse sensitivity, and so on.\n * \n * This module uses the following default options (from the options\n * object passed to the [[Engine]]):\n * ```js\n * var defaults = {\n *     inverseX: false,\n *     inverseY: false,\n *     sensitivityX: 10,\n *     sensitivityY: 10,\n *     initialZoom: 0,\n *     zoomSpeed: 0.2,\n * }\n * ```\n*/\n\nexport class Camera {\n\n    /** @internal */\n    constructor(noa, opts) {\n        opts = Object.assign({}, defaults, opts)\n\n        /** \n         * @internal\n         * @type {import('../index').Engine}\n        */\n        this.noa = noa\n\n        /** Horizontal mouse sensitivity. Same scale as Overwatch (typical values around `5..10`) */\n        this.sensitivityX = +opts.sensitivityX\n\n        /** Vertical mouse sensitivity. Same scale as Overwatch (typical values around `5..10`) */\n        this.sensitivityY = +opts.sensitivityY\n\n        /** Mouse look inverse (horizontal) */\n        this.inverseX = !!opts.inverseX\n\n        /** Mouse look inverse (vertical) */\n        this.inverseY = !!opts.inverseY\n\n        /** \n         * Camera yaw angle. \n         * Returns the camera's rotation angle around the vertical axis. \n         * Range: `0..2`  \n         * This value is writeable, but it's managed by the engine and \n         * will be overwritten each frame.\n        */\n        this.heading = 0\n\n        /** Camera pitch angle. \n         * Returns the camera's up/down rotation angle. The pitch angle is \n         * clamped by a small epsilon, such that the camera never quite \n         * points perfectly up or down.  \n         * Range: `-/2../2`.  \n         * This value is writeable, but it's managed by the engine and \n         * will be overwritten each frame.\n        */\n        this.pitch = 0\n\n        /** \n         * Entity ID of a special entity that exists for the camera to point at.\n         * \n         * By default this entity follows the player entity, so you can \n         * change the player's eye height by changing the `follow` component's offset:\n         * ```js\n         * var followState = noa.ents.getState(noa.camera.cameraTarget, 'followsEntity')\n         * followState.offset[1] = 0.9 * myPlayerHeight\n         * ```\n         * \n         * For customized camera controls you can change the follow \n         * target to some other entity, or override the behavior entirely:\n         * ```js\n         * // make cameraTarget stop following the player\n         * noa.ents.removeComponent(noa.camera.cameraTarget, 'followsEntity')\n         * // control cameraTarget position directly (or whatever..)\n         * noa.ents.setPosition(noa.camera.cameraTarget, [x,y,z])\n         * ```\n        */\n        this.cameraTarget = this.noa.ents.createEntity(['position'])\n\n        // make the camera follow the cameraTarget entity\n        var eyeOffset = 0.9 * noa.ents.getPositionData(noa.playerEntity).height\n        noa.ents.addComponent(this.cameraTarget, 'followsEntity', {\n            entity: noa.playerEntity,\n            offset: [0, eyeOffset, 0],\n        })\n\n        /** How far back the camera should be from the player's eye position */\n        this.zoomDistance = opts.initialZoom\n\n        /** How quickly the camera moves to its `zoomDistance` (0..1) */\n        this.zoomSpeed = opts.zoomSpeed\n\n        /** Current actual zoom distance. This differs from `zoomDistance` when\n         * the camera is in the process of moving towards the desired distance, \n         * or when it's obstructed by solid terrain behind the player.\n         * @readonly\n        */\n        this.currentZoom = opts.initialZoom\n        /** @internal */\n        this._currentZoom = this.currentZoom\n        Object.defineProperty(this, 'currentZoom', { get: () => this._currentZoom })\n\n        /** @internal */\n        this._dirVector = vec3.fromValues(0, 0, 1)\n    }\n\n\n\n\n    /*\n     * \n     * \n     *          API\n     * \n     * \n    */\n\n\n    /*\n     *      Local position functions for high precision\n    */\n    /** @internal */\n    _localGetTargetPosition() {\n        var pdat = this.noa.ents.getPositionData(this.cameraTarget)\n        var pos = tempVectors[0]\n        return vec3.copy(pos, pdat._renderPosition)\n    }\n    /** @internal */\n    _localGetPosition() {\n        var loc = this._localGetTargetPosition()\n        if (this._currentZoom === 0) return loc\n        return vec3.scaleAndAdd(loc, loc, this._dirVector, -this._currentZoom)\n    }\n\n\n\n    /**\n     * Returns the camera's current target position - i.e. the player's \n     * eye position. When the camera is zoomed all the way in, \n     * this returns the same location as `camera.getPosition()`.\n    */\n    getTargetPosition() {\n        var loc = this._localGetTargetPosition()\n        var globalCamPos = tempVectors[1]\n        return this.noa.localToGlobal(loc, globalCamPos)\n    }\n\n\n    /**\n     * Returns the current camera position (read only)\n    */\n    getPosition() {\n        var loc = this._localGetPosition()\n        var globalCamPos = tempVectors[2]\n        return this.noa.localToGlobal(loc, globalCamPos)\n    }\n\n\n    /**\n     * Returns the camera direction vector (read only)\n    */\n    getDirection() {\n        return this._dirVector\n    }\n\n\n\n\n    /*\n     * \n     * \n     * \n     *          internals below\n     * \n     * \n     * \n    */\n\n\n\n    /**\n     * Called before render, if mouseLock etc. is applicable.\n     * Consumes input mouse events x/y, updates camera angle and zoom\n     * @internal\n    */\n\n    applyInputsToCamera() {\n        // dx/dy from input state\n        var pointerState = this.noa.inputs.pointerState\n        bugFix(pointerState) // TODO: REMOVE EVENTUALLY    \n\n        // convert to rads, using (sens * 0.0066 deg/pixel), like Overwatch\n        var conv = 0.0066 * Math.PI / 180\n        var dy = pointerState.dy * this.sensitivityY * conv\n        var dx = pointerState.dx * this.sensitivityX * conv\n        if (this.inverseY) dy = -dy\n        if (this.inverseX) dx = -dx\n\n        // normalize/clamp angles, update direction vector\n        var twopi = 2 * Math.PI\n        this.heading += (dx < 0) ? dx + twopi : dx\n        if (this.heading > twopi) this.heading -= twopi\n        var maxPitch = Math.PI / 2 - 0.001\n        this.pitch = Math.max(-maxPitch, Math.min(maxPitch, this.pitch + dy))\n\n        vec3.set(this._dirVector, 0, 0, 1)\n        var dir = this._dirVector\n        var origin = originVector\n        vec3.rotateX(dir, dir, origin, this.pitch)\n        vec3.rotateY(dir, dir, origin, this.heading)\n    }\n\n\n\n    /**\n     *  Called before all renders, pre- and post- entity render systems\n     * @internal\n    */\n    updateBeforeEntityRenderSystems() {\n        // zoom update\n        this._currentZoom += (this.zoomDistance - this._currentZoom) * this.zoomSpeed\n    }\n\n    /** @internal */\n    updateAfterEntityRenderSystems() {\n        // clamp camera zoom not to clip into solid terrain\n        var maxZoom = cameraObstructionDistance(this)\n        if (this._currentZoom > maxZoom) this._currentZoom = maxZoom\n    }\n\n}\n\n\n\n\n/*\n *  check for obstructions behind camera by sweeping back an AABB\n*/\n\nfunction cameraObstructionDistance(self) {\n    if (!self._sweepBox) {\n        self._sweepBox = new aabb([0, 0, 0], [0.2, 0.2, 0.2])\n        self._sweepGetVoxel = self.noa.world.getBlockSolidity.bind(self.noa.world)\n        self._sweepVec = vec3.create()\n        self._sweepHit = () => true\n    }\n    var pos = vec3.copy(self._sweepVec, self._localGetTargetPosition())\n    vec3.add(pos, pos, self.noa.worldOriginOffset)\n    for (var i = 0; i < 3; i++) pos[i] -= 0.1\n    self._sweepBox.setPosition(pos)\n    var dist = Math.max(self.zoomDistance, self.currentZoom) + 0.1\n    vec3.scale(self._sweepVec, self.getDirection(), -dist)\n    return sweep(self._sweepGetVoxel, self._sweepBox, self._sweepVec, self._sweepHit, true)\n}\n\n\n\n\n\n\n// workaround for this Chrome 63 + Win10 bug\n// https://bugs.chromium.org/p/chromium/issues/detail?id=781182\n// later updated to also address: https://github.com/fenomas/noa/issues/153\nfunction bugFix(pointerState) {\n    var dx = pointerState.dx\n    var dy = pointerState.dy\n    var badx = (Math.abs(dx) > 400 && Math.abs(dx / lastx) > 4)\n    var bady = (Math.abs(dy) > 400 && Math.abs(dy / lasty) > 4)\n    if (badx || bady) {\n        pointerState.dx = lastx\n        pointerState.dy = lasty\n        lastx = (lastx + dx) / 2\n        lasty = (lasty + dy) / 2\n    } else {\n        lastx = dx || 1\n        lasty = dy || 1\n    }\n}\n\nvar lastx = 0\nvar lasty = 0\n","/** \n * @module \n * @internal \n */\n\nimport vec3 from 'gl-vec3'\n\n\n\n// definition for this component's state object\nexport class PositionState {\n    constructor() {\n        /** Position in global coords (may be low precision) \n         * @type {null | number[]} */\n        this.position = null\n        this.width = 0.8\n        this.height = 0.8\n\n        /** Precise position in local coords\n         * @type {null | number[]} */\n        this._localPosition = null\n\n        /** [x,y,z] in LOCAL COORDS\n         * @type {null | number[]} */\n        this._renderPosition = null\n\n        /** [lo,lo,lo, hi,hi,hi] in LOCAL COORDS\n         * @type {null | number[]} */\n        this._extents = null\n    }\n}\n\n\n\n\n/**\n * \tComponent holding entity's position, width, and height.\n *  By convention, entity's \"position\" is the bottom center of its AABB\n * \n *  Of the various properties, _localPosition is the \"real\", \n *  single-source-of-truth position. Others are derived.\n *  Local coords are relative to `noa.worldOriginOffset`.\n * @param {import('..').Engine} noa\n*/\n\nexport default function (noa) {\n\n    return {\n\n        name: 'position',\n\n        order: 60,\n\n        state: new PositionState,\n\n        onAdd: function (eid, state) {\n            // copy position into a plain array\n            var pos = [0, 0, 0]\n            if (state.position) vec3.copy(pos, state.position)\n            state.position = pos\n\n            state._localPosition = vec3.create()\n            state._renderPosition = vec3.create()\n            state._extents = new Float32Array(6)\n\n            // on init only, set local from global\n            noa.globalToLocal(state.position, null, state._localPosition)\n            vec3.copy(state._renderPosition, state._localPosition)\n            updatePositionExtents(state)\n        },\n\n        onRemove: null,\n\n\n\n        system: function (dt, states) {\n            var off = noa.worldOriginOffset\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                vec3.add(state.position, state._localPosition, off)\n                updatePositionExtents(state)\n            }\n        },\n\n\n    }\n}\n\n\n\n// update an entity's position state `_extents` \nexport function updatePositionExtents(state) {\n    var hw = state.width / 2\n    var lpos = state._localPosition\n    var ext = state._extents\n    ext[0] = lpos[0] - hw\n    ext[1] = lpos[1]\n    ext[2] = lpos[2] - hw\n    ext[3] = lpos[0] + hw\n    ext[4] = lpos[1] + state.height\n    ext[5] = lpos[2] + hw\n}\n","/** \n * @module\n * @internal\n */\n\nimport vec3 from 'gl-vec3'\n\n\nexport class PhysicsState {\n    constructor() {\n        /** @type {import('voxel-physics-engine').RigidBody} */\n        this.body = null\n    }\n}\n\n\n/**\n * Physics component, stores an entity's physics engbody.\n * @param {import('..').Engine} noa\n*/\n\nexport default function (noa) {\n\n    return {\n\n        name: 'physics',\n\n        order: 40,\n\n        state: new PhysicsState,\n\n        onAdd: function (entID, state) {\n            state.body = noa.physics.addBody()\n            // implicitly assume body has a position component, to get size\n            var posDat = noa.ents.getPositionData(state.__id)\n            setPhysicsFromPosition(state, posDat)\n        },\n\n\n        onRemove: function (entID, state) {\n            // update position before removing\n            // this lets entity wind up at e.g. the result of a collision\n            // even if physics component is removed in collision handler\n            if (noa.ents.hasPosition(state.__id)) {\n                var pdat = noa.ents.getPositionData(state.__id)\n                setPositionFromPhysics(state, pdat)\n                backtrackRenderPos(state, pdat, 0, false)\n            }\n            noa.physics.removeBody(state.body)\n        },\n\n\n        system: function (dt, states) {\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var pdat = noa.ents.getPositionData(state.__id)\n                setPositionFromPhysics(state, pdat)\n            }\n        },\n\n\n        renderSystem: function (dt, states) {\n\n            var tickPos = noa.positionInCurrentTick\n            var tickTime = 1000 / noa.container._shell.tickRate\n            tickTime *= noa.timeScale\n            var tickMS = tickPos * tickTime\n\n            // tickMS is time since last physics engine tick\n            // to avoid temporal aliasing, render the state as if lerping between\n            // the last position and the next one \n            // since the entity data is the \"next\" position this amounts to \n            // offsetting each entity into the past by tickRate - dt\n            // http://gafferongames.com/game-physics/fix-your-timestep/\n\n            var backtrackAmt = (tickMS - tickTime) / 1000\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var id = state.__id\n                var pdat = noa.ents.getPositionData(id)\n                var smoothed = noa.ents.cameraSmoothed(id)\n                backtrackRenderPos(state, pdat, backtrackAmt, smoothed)\n            }\n        }\n\n    }\n\n}\n\n\n\n// var offset = vec3.create()\nvar local = vec3.create()\n\nexport function setPhysicsFromPosition(physState, posState) {\n    var box = physState.body.aabb\n    var ext = posState._extents\n    vec3.copy(box.base, ext)\n    vec3.set(box.vec, posState.width, posState.height, posState.width)\n    vec3.add(box.max, box.base, box.vec)\n}\n\n\nfunction setPositionFromPhysics(physState, posState) {\n    var base = physState.body.aabb.base\n    var hw = posState.width / 2\n    vec3.set(posState._localPosition, base[0] + hw, base[1], base[2] + hw)\n}\n\n\nfunction backtrackRenderPos(physState, posState, backtrackAmt, smoothed) {\n    // pos = pos + backtrack * body.velocity\n    var vel = physState.body.velocity\n    vec3.scaleAndAdd(local, posState._localPosition, vel, backtrackAmt)\n\n    // smooth out update if component is present\n    // (this is set after sudden movements like auto-stepping)\n    if (smoothed) vec3.lerp(local, posState._renderPosition, local, 0.3)\n\n    // copy values over to renderPosition, \n    vec3.copy(posState._renderPosition, local)\n}\n","\nvar boxIntersect = require('box-intersect')\n\n\n\n/*\n * \tEvery frame, entities with this component will get mutually checked for colliions\n * \n *   * cylinder: flag for checking collisions as a vertical cylindar (rather than AABB)\n *   * collideBits: category for this entity\n *   * collideMask: categories this entity collides with\n *   * callback: function(other_id) - called when `own.collideBits & other.collideMask` is true\n * \n * \n * \t\tNotes:\n * \tSet collideBits=0 for entities like bullets, which can collide with things \n * \t\tbut are never the target of a collision.\n * \tSet collideMask=0 for things with no callback - things that get collided with,\n * \t\tbut don't themselves instigate collisions.\n * \n */\n\n\n\nexport default function (noa) {\n\n    var intervals = []\n\n    return {\n\n        name: 'collideEntities',\n\n        order: 70,\n\n        state: {\n            cylinder: false,\n            collideBits: 1 | 0,\n            collideMask: 1 | 0,\n            callback: null,\n        },\n\n        onAdd: null,\n\n        onRemove: null,\n\n\n        system: function entityCollider(dt, states) {\n            var ents = noa.ents\n\n            // data struct that boxIntersect looks for\n            // - array of [lo, lo, lo, hi, hi, hi] extents\n            for (var i = 0; i < states.length; i++) {\n                var id = states[i].__id\n                var dat = ents.getPositionData(id)\n                intervals[i] = dat._extents\n            }\n            intervals.length = states.length\n\n            // run the intersect library\n            boxIntersect(intervals, function (a, b) {\n                var stateA = states[a]\n                var stateB = states[b]\n                if (!stateA || !stateB) return\n                var intervalA = intervals[a]\n                var intervalB = intervals[b]\n                if (cylindricalHitTest(stateA, stateB, intervalA, intervalB)) {\n                    handleCollision(noa, stateA, stateB)\n                }\n            })\n\n        }\n    }\n\n\n\n    /*\n     * \n     * \t\tIMPLEMENTATION\n     * \n     */\n\n\n    function handleCollision(noa, stateA, stateB) {\n        var idA = stateA.__id\n        var idB = stateB.__id\n\n        // entities really do overlap, so check masks and call event handlers\n        if (stateA.collideMask & stateB.collideBits) {\n            if (stateA.callback) stateA.callback(idB)\n        }\n        if (stateB.collideMask & stateA.collideBits) {\n            if (stateB.callback) stateB.callback(idA)\n        }\n\n        // general pairwise handler\n        noa.ents.onPairwiseEntityCollision(idA, idB)\n    }\n\n\n\n    // For entities whose extents overlap, \n    // test if collision still happens when taking cylinder flags into account\n\n    function cylindricalHitTest(stateA, stateB, intervalA, intervalB) {\n        if (stateA.cylinder) {\n            if (stateB.cylinder) {\n                return cylinderCylinderTest(intervalA, intervalB)\n            } else {\n                return cylinderBoxTest(intervalA, intervalB)\n            }\n        } else if (stateB.cylinder) {\n            return cylinderBoxTest(intervalB, intervalA)\n        }\n        return true\n    }\n\n\n\n\n    // Cylinder-cylinder hit test (AABBs are known to overlap)\n    // given their extent arrays [lo, lo, lo, hi, hi, hi]\n\n    function cylinderCylinderTest(a, b) {\n        // distance between cylinder centers\n        var rada = (a[3] - a[0]) / 2\n        var radb = (b[3] - b[0]) / 2\n        var dx = a[0] + rada - (b[0] + radb)\n        var dz = a[2] + rada - (b[2] + radb)\n        // collide if dist <= sum of radii\n        var distsq = dx * dx + dz * dz\n        var radsum = rada + radb\n        return (distsq <= radsum * radsum)\n    }\n\n\n\n\n    // Cylinder-Box hit test (AABBs are known to overlap)\n    // given their extent arrays [lo, lo, lo, hi, hi, hi]\n\n    function cylinderBoxTest(cyl, cube) {\n        // X-z center of cylinder\n        var rad = (cyl[3] - cyl[0]) / 2\n        var cx = cyl[0] + rad\n        var cz = cyl[2] + rad\n        // point in X-Z square closest to cylinder\n        var px = clamp(cx, cube[0], cube[3])\n        var pz = clamp(cz, cube[2], cube[5])\n        // collision if distance from that point to circle <= cylinder radius\n        var dx = px - cx\n        var dz = pz - cz\n        var distsq = dx * dx + dz * dz\n        return (distsq <= rad * rad)\n    }\n\n    function clamp(val, lo, hi) {\n        return (val < lo) ? lo : (val > hi) ? hi : val\n    }\n\n\n\n\n}\n","\n\nexport default function (noa) {\n    return {\n\n        name: 'collideTerrain',\n\n        order: 0,\n\n        state: {\n            callback: null\n        },\n\n        onAdd: function (eid, state) {\n            // add collide handler for physics engine to call\n            var ents = noa.entities\n            if (ents.hasPhysics(eid)) {\n                var body = ents.getPhysics(eid).body\n                body.onCollide = function bodyOnCollide(impulse) {\n                    var cb = noa.ents.getCollideTerrain(eid).callback\n                    if (cb) cb(impulse, eid)\n                }\n            }\n        },\n\n        onRemove: function (eid, state) {\n            var ents = noa.entities\n            if (ents.hasPhysics(eid)) {\n                ents.getPhysics(eid).body.onCollide = null\n            }\n        },\n\n\n\n    }\n}\n","\n/**\n * Component for the player entity, when active hides the player's mesh \n * when camera zoom is less than a certain amount\n */\n\nexport default function (noa) {\n    return {\n\n        name: 'fadeOnZoom',\n\n        order: 99,\n\n        state: {\n            cutoff: 1.5,\n            _showing: null,\n        },\n\n        onAdd: null,\n\n        onRemove: null,\n\n        system: function fadeOnZoomProc(dt, states) {\n            var zoom = noa.camera.currentZoom\n            var ents = noa.entities\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                checkZoom(state, zoom, ents)\n            }\n        }\n    }\n}\n\n\nfunction checkZoom(state, zoom, ents) {\n    if (!ents.hasMesh(state.__id)) return\n\n    var shouldShow = (zoom > state.cutoff)\n    if (state._showing !== shouldShow) {\n        ents.getMeshData(state.__id).mesh.visibility = shouldShow\n        state._showing = shouldShow\n    }\n}\n","\nimport vec3 from 'gl-vec3'\n\n\n/*\n * Indicates that an entity should be moved to another entity's position each tick,\n * possibly by a fixed offset, and the same for renderPositions each render\n */\n\nexport default function (noa) {\n\n    return {\n\n        name: 'followsEntity',\n\n        order: 50,\n\n        state: {\n            entity: 0 | 0,\n            offset: null,\n            onTargetMissing: null,\n        },\n\n        onAdd: function (eid, state) {\n            var off = vec3.create()\n            state.offset = (state.offset) ? vec3.copy(off, state.offset) : off\n            updatePosition(state)\n            updateRenderPosition(state)\n        },\n\n        onRemove: null,\n\n\n        // on tick, copy over regular positions\n        system: function followEntity(dt, states) {\n            for (var i = 0; i < states.length; i++) {\n                updatePosition(states[i])\n            }\n        },\n\n\n        // on render, copy over render positions\n        renderSystem: function followEntityMesh(dt, states) {\n            for (var i = 0; i < states.length; i++) {\n                updateRenderPosition(states[i])\n            }\n        }\n    }\n\n\n\n    function updatePosition(state) {\n        var id = state.__id\n        var self = noa.ents.getPositionData(id)\n        var other = noa.ents.getPositionData(state.entity)\n        if (!other) {\n            if (state.onTargetMissing) state.onTargetMissing(id)\n            noa.ents.removeComponent(id, noa.ents.names.followsEntity)\n        } else {\n            vec3.add(self._localPosition, other._localPosition, state.offset)\n        }\n    }\n\n    function updateRenderPosition(state) {\n        var id = state.__id\n        var self = noa.ents.getPositionData(id)\n        var other = noa.ents.getPositionData(state.entity)\n        if (other) {\n            vec3.add(self._renderPosition, other._renderPosition, state.offset)\n        }\n    }\n\n}\n","\nimport vec3 from 'gl-vec3'\n\n\nexport default function (noa) {\n    return {\n\n        name: 'mesh',\n\n        order: 100,\n\n        state: {\n            mesh: null,\n            offset: null\n        },\n\n\n        onAdd: function (eid, state) {\n            // implicitly assume there's already a position component\n            var posDat = noa.ents.getPositionData(eid)\n            if (state.mesh) {\n                noa.rendering.addMeshToScene(state.mesh, false, posDat.position)\n            } else {\n                throw new Error('Mesh component added without a mesh - probably a bug!')\n            }\n            if (!state.offset) state.offset = vec3.create()\n\n            // set mesh to correct position\n            var rpos = posDat._renderPosition\n            state.mesh.position.copyFromFloats(\n                rpos[0] + state.offset[0],\n                rpos[1] + state.offset[1],\n                rpos[2] + state.offset[2])\n        },\n\n\n        onRemove: function (eid, state) {\n            state.mesh.dispose()\n        },\n\n\n\n        renderSystem: function (dt, states) {\n            // before render move each mesh to its render position, \n            // set by the physics engine or driving logic\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var id = state.__id\n\n                var rpos = noa.ents.getPositionData(id)._renderPosition\n                state.mesh.position.copyFromFloats(\n                    rpos[0] + state.offset[0],\n                    rpos[1] + state.offset[1],\n                    rpos[2] + state.offset[2])\n            }\n        }\n\n\n    }\n}\n","/** \n * @module\n * @internal\n */\n\nimport vec3 from 'gl-vec3'\n\n\n\n\n\n/** \n * \n * State object of the `movement` component\n * \n*/\nexport function MovementState() {\n    this.heading = 0 // radians\n    this.running = false\n    this.jumping = false\n\n    // options\n    this.maxSpeed = 10\n    this.moveForce = 30\n    this.responsiveness = 15\n    this.runningFriction = 0\n    this.standingFriction = 2\n\n    // jumps\n    this.airMoveMult = 0.5\n    this.jumpImpulse = 10\n    this.jumpForce = 12\n    this.jumpTime = 500 // ms\n    this.airJumps = 1\n\n    // internal state\n    this._jumpCount = 0\n    this._currjumptime = 0\n    this._isJumping = false\n}\n\n\n\n\n\n/**\n * Movement component. State stores settings like jump height, etc.,\n * as well as current state (running, jumping, heading angle).\n * Processor checks state and applies movement/friction/jump forces\n * to the entity's physics body. \n * @param {import('..').Engine} noa\n*/\n\nexport default function (noa) {\n    return {\n\n        name: 'movement',\n\n        order: 30,\n\n        state: new MovementState(),\n\n        onAdd: null,\n\n        onRemove: null,\n\n\n        system: function movementProcessor(dt, states) {\n            var ents = noa.entities\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var phys = ents.getPhysics(state.__id)\n                if (phys) applyMovementPhysics(dt, state, phys.body)\n            }\n        }\n\n\n    }\n}\n\n\nvar tempvec = vec3.create()\nvar tempvec2 = vec3.create()\nvar zeroVec = vec3.create()\n\n\n/**\n * @param {number} dt \n * @param {MovementState} state \n * @param {*} body \n*/\n\nfunction applyMovementPhysics(dt, state, body) {\n    // move implementation originally written as external module\n    //   see https://github.com/fenomas/voxel-fps-controller\n    //   for original code\n\n    // jumping\n    var onGround = (body.atRestY() < 0)\n    var canjump = (onGround || state._jumpCount < state.airJumps)\n    if (onGround) {\n        state._isJumping = false\n        state._jumpCount = 0\n    }\n\n    // process jump input\n    if (state.jumping) {\n        if (state._isJumping) { // continue previous jump\n            if (state._currjumptime > 0) {\n                var jf = state.jumpForce\n                if (state._currjumptime < dt) jf *= state._currjumptime / dt\n                body.applyForce([0, jf, 0])\n                state._currjumptime -= dt\n            }\n        } else if (canjump) { // start new jump\n            state._isJumping = true\n            if (!onGround) state._jumpCount++\n            state._currjumptime = state.jumpTime\n            body.applyImpulse([0, state.jumpImpulse, 0])\n            // clear downward velocity on airjump\n            if (!onGround && body.velocity[1] < 0) body.velocity[1] = 0\n        }\n    } else {\n        state._isJumping = false\n    }\n\n    // apply movement forces if entity is moving, otherwise just friction\n    var m = tempvec\n    var push = tempvec2\n    if (state.running) {\n\n        var speed = state.maxSpeed\n        // todo: add crouch/sprint modifiers if needed\n        // if (state.sprint) speed *= state.sprintMoveMult\n        // if (state.crouch) speed *= state.crouchMoveMult\n        vec3.set(m, 0, 0, speed)\n\n        // rotate move vector to entity's heading\n        vec3.rotateY(m, m, zeroVec, state.heading)\n\n        // push vector to achieve desired speed & dir\n        // following code to adjust 2D velocity to desired amount is patterned on Quake: \n        // https://github.com/id-Software/Quake-III-Arena/blob/master/code/game/bg_pmove.c#L275\n        vec3.subtract(push, m, body.velocity)\n        push[1] = 0\n        var pushLen = vec3.length(push)\n        vec3.normalize(push, push)\n\n        if (pushLen > 0) {\n            // pushing force vector\n            var canPush = state.moveForce\n            if (!onGround) canPush *= state.airMoveMult\n\n            // apply final force\n            var pushAmt = state.responsiveness * pushLen\n            if (canPush > pushAmt) canPush = pushAmt\n\n            vec3.scale(push, push, canPush)\n            body.applyForce(push)\n        }\n\n        // different friction when not moving\n        // idea from Sonic: http://info.sonicretro.org/SPG:Running\n        body.friction = state.runningFriction\n    } else {\n        body.friction = state.standingFriction\n    }\n}\n","\n/**\n * \n * Input processing component - gets (key) input state and  \n * applies it to receiving entities by updating their movement \n * component state (heading, movespeed, jumping, etc.)\n * \n */\n\nexport default function (noa) {\n    return {\n\n        name: 'receivesInputs',\n\n        order: 20,\n\n        state: {},\n\n        onAdd: null,\n\n        onRemove: null,\n\n        system: function inputProcessor(dt, states) {\n            var ents = noa.entities\n            var inputState = noa.inputs.state\n            var camHeading = noa.camera.heading\n\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var moveState = ents.getMovement(state.__id)\n                setMovementState(moveState, inputState, camHeading)\n            }\n        }\n\n    }\n}\n\n\n\n/**\n * @param {import('../components/movement').MovementState} state \n * @param {Object<string, boolean>} inputs \n * @param {number} camHeading \n*/\n\nfunction setMovementState(state, inputs, camHeading) {\n    state.jumping = !!inputs.jump\n\n    var fb = inputs.forward ? (inputs.backward ? 0 : 1) : (inputs.backward ? -1 : 0)\n    var rl = inputs.right ? (inputs.left ? 0 : 1) : (inputs.left ? -1 : 0)\n\n    if ((fb | rl) === 0) {\n        state.running = false\n    } else {\n        state.running = true\n        if (fb) {\n            if (fb == -1) camHeading += Math.PI\n            if (rl) {\n                camHeading += Math.PI / 4 * fb * rl // didn't plan this but it works!\n            }\n        } else {\n            camHeading += rl * Math.PI / 2\n        }\n        state.heading = camHeading\n    }\n\n}\n","\nimport vec3 from 'gl-vec3'\n\nimport { Color3 } from '@babylonjs/core/Maths/math.color'\nimport { Mesh } from '@babylonjs/core/Meshes/mesh'\nimport { CreateDisc } from '@babylonjs/core/Meshes/Builders/discBuilder'\nimport '@babylonjs/core/Meshes/instancedMesh'\n\n\nexport default function (noa, dist) {\n\n    var shadowDist = dist\n\n    // create a mesh to re-use for shadows\n    var scene = noa.rendering.getScene()\n    var disc = CreateDisc('shadow', { radius: 0.75, tessellation: 30 }, scene)\n    disc.rotation.x = Math.PI / 2\n    var mat = noa.rendering.makeStandardMaterial('shadowMat')\n    mat.diffuseColor = Color3.Black()\n    mat.ambientColor = Color3.Black()\n    mat.alpha = 0.5\n    disc.material = mat\n    disc.setEnabled(false)\n    mat.freeze()\n\n    // source mesh needn't be in the scene graph\n    scene.removeMesh(disc)\n\n\n    return {\n\n        name: 'shadow',\n\n        order: 80,\n\n        state: {\n            size: 0.5,\n            _mesh: null,\n        },\n\n\n        onAdd: function (eid, state) {\n            var mesh = disc.createInstance('shadow_instance')\n            noa.rendering.addMeshToScene(mesh)\n            mesh.setEnabled(false)\n            state._mesh = mesh\n        },\n\n\n        onRemove: function (eid, state) {\n            state._mesh.dispose()\n        },\n\n\n        system: function shadowSystem(dt, states) {\n            var cpos = noa.camera._localGetPosition()\n            var dist = shadowDist\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var posState = noa.ents.getPositionData(state.__id)\n                var physState = noa.ents.getPhysics(state.__id)\n                updateShadowHeight(noa, posState, physState, state._mesh, state.size, dist, cpos)\n            }\n        },\n\n\n        renderSystem: function (dt, states) {\n            // before render adjust shadow x/z to render positions\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var rpos = noa.ents.getPositionData(state.__id)._renderPosition\n                var spos = state._mesh.position\n                spos.x = rpos[0]\n                spos.z = rpos[2]\n            }\n        }\n\n\n\n\n    }\n}\n\nvar shadowPos = vec3.fromValues(0, 0, 0)\nvar down = vec3.fromValues(0, -1, 0)\n\nfunction updateShadowHeight(noa, posDat, physDat, mesh, size, shadowDist, camPos) {\n\n    // local Y ground position - from physics or raycast\n    var localY\n    if (physDat && physDat.body.resting[1] < 0) {\n        localY = posDat._localPosition[1]\n    } else {\n        var res = noa._localPick(posDat._localPosition, down, shadowDist)\n        if (!res) {\n            mesh.setEnabled(false)\n            return\n        }\n        localY = res.position[1] - noa.worldOriginOffset[1]\n    }\n\n    // round Y pos and offset upwards slightly to avoid z-fighting\n    localY = Math.round(localY)\n    vec3.copy(shadowPos, posDat._localPosition)\n    shadowPos[1] = localY\n    var sqdist = vec3.squaredDistance(camPos, shadowPos)\n    // offset ~ 0.01 for nearby shadows, up to 0.1 at distance of ~40\n    var offset = 0.01 + 0.1 * (sqdist / 1600)\n    if (offset > 0.1) offset = 0.1\n    mesh.position.y = localY + offset\n    // set shadow scale\n    var dist = posDat._localPosition[1] - localY\n    var scale = size * 0.7 * (1 - dist / shadowDist)\n    mesh.scaling.copyFromFloats(scale, scale, scale)\n    mesh.setEnabled(true)\n}\n","\n\nexport default function (noa) {\n\n    var compName = 'smoothCamera'\n\n    return {\n\n        name: compName,\n\n        order: 99,\n\n        state: {\n            time: 100.1\n        },\n\n        onAdd: null,\n\n        onRemove: null,\n\n        system: function (dt, states) {\n            // remove self after time elapses\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                state.time -= dt\n                if (state.time < 0) noa.ents.removeComponent(state.__id, compName)\n            }\n        },\n\n    }\n}\n","/** \n * The ECS manager, found at [[Entities | `noa.entities`]] or [[Entities | `noa.ents`]].\n * @module noa.entities\n */\n\nimport ECS from 'ent-comp'\nimport vec3 from 'gl-vec3'\nimport { updatePositionExtents } from '../components/position'\nimport { setPhysicsFromPosition } from '../components/physics'\n\n\n// Component definitions\nimport collideEntitiesComp from \"../components/collideEntities.js\"\nimport collideTerrainComp from \"../components/collideTerrain.js\"\nimport fadeOnZoomComp from \"../components/fadeOnZoom.js\"\nimport followsEntityComp from \"../components/followsEntity.js\"\nimport meshComp from \"../components/mesh.js\"\nimport movementComp from \"../components/movement.js\"\nimport physicsComp from \"../components/physics.js\"\nimport positionComp from \"../components/position.js\"\nimport receivesInputsComp from \"../components/receivesInputs.js\"\nimport shadowComp from \"../components/shadow.js\"\nimport smoothCameraComp from \"../components/smoothCamera.js\"\n\n\n\nvar defaultOptions = {\n    shadowDistance: 10,\n}\n\n\n/**\n * `noa.entities` - manages entities and components.\n * \n * This class extends [ent-comp](https://github.com/fenomas/ent-comp), \n * a general-purpose ECS. It's also decorated with noa-specific helpers and \n * accessor functions for querying entity positions, etc.\n * \n * Expects entity definitions in a specific format - see source `components` \n * folder for examples.\n * \n * This module uses the following default options (from the options\n * object passed to the [[Engine]]):\n * \n * ```js\n * var defaults = {\n *     shadowDistance: 10,\n * }\n * ```\n*/\n\nexport class Entities extends ECS {\n\n\n    /** @internal */\n    constructor(noa, opts) {\n        super()\n        opts = Object.assign({}, defaultOptions, opts)\n        // optional arguments to supply to component creation functions\n        var componentArgs = {\n            'shadow': opts.shadowDistance,\n        }\n\n        /** \n         * @internal\n         * @type {import('../index').Engine}\n        */\n        this.noa = noa\n\n        /** Hash containing the component names of built-in components.\n         * @type {{ [key:string]: string }} \n        */\n        this.names = {}\n\n\n        // call `createComponent` on all component definitions, and\n        // store their names in ents.names\n        var compDefs = {\n            collideEntities: collideEntitiesComp,\n            collideTerrain: collideTerrainComp,\n            fadeOnZoom: fadeOnZoomComp,\n            followsEntity: followsEntityComp,\n            mesh: meshComp,\n            movement: movementComp,\n            physics: physicsComp,\n            position: positionComp,\n            receivesInputs: receivesInputsComp,\n            shadow: shadowComp,\n            smoothCamera: smoothCameraComp,\n        }\n\n        Object.keys(compDefs).forEach(bareName => {\n            var arg = componentArgs[bareName] || undefined\n            var compFn = compDefs[bareName]\n            var compDef = compFn(noa, arg)\n            this.names[bareName] = this.createComponent(compDef)\n        })\n\n\n\n        /*\n         *\n         *\n         * \n         *          ENTITY ACCESSORS\n         *\n         * A whole bunch of getters and such for accessing component state.\n         * These are moderately faster than `ents.getState(whatever)`.\n         * \n         * \n         * \n        */\n\n        /** @internal */\n        this.cameraSmoothed = this.getComponentAccessor(this.names.smoothCamera)\n\n\n        /**\n         * Returns whether the entity has a physics body\n         * @type {(id:number) => boolean}\n        */\n        this.hasPhysics = this.getComponentAccessor(this.names.physics)\n\n        /**\n         * Returns whether the entity has a position\n         * @type {(id:number) => boolean}\n        */\n        this.hasPosition = this.getComponentAccessor(this.names.position)\n\n        /**\n         * Returns the entity's position component state\n         * @type {(id:number) => null | import(\"../components/position\").PositionState} \n        */\n        this.getPositionData = this.getStateAccessor(this.names.position)\n\n        /**\n         * Returns the entity's position vector.\n         * @type {(id:number) => number[]}\n        */\n        this.getPosition = (id) => {\n            var state = this.getPositionData(id)\n            return (state) ? state.position : null\n        }\n\n        /**\n         * Get the entity's `physics` component state.\n         * @type {(id:number) => null | import(\"../components/physics\").PhysicsState} \n        */\n        this.getPhysics = this.getStateAccessor(this.names.physics)\n\n        /**\n         * Returns the entity's physics body\n         * Note, will throw if the entity doesn't have the position component!\n         * @type {(id:number) => null | import(\"voxel-physics-engine\").RigidBody} \n        */\n        this.getPhysicsBody = (id) => {\n            var state = this.getPhysics(id)\n            return (state) ? state.body : null\n        }\n\n        /**\n         * Returns whether the entity has a mesh\n         * @type {(id:number) => boolean}\n        */\n        this.hasMesh = this.getComponentAccessor(this.names.mesh)\n\n        /**\n         * Returns the entity's `mesh` component state\n         * @type {(id:number) => {mesh:any, offset:number[]}}\n        */\n        this.getMeshData = this.getStateAccessor(this.names.mesh)\n\n        /**\n         * Returns the entity's `movement` component state\n         * @type {(id:number) => import('../components/movement').MovementState}\n        */\n        this.getMovement = this.getStateAccessor(this.names.movement)\n\n        /**\n         * Returns the entity's `collideTerrain` component state\n         * @type {(id:number) => {callback: function}}\n        */\n        this.getCollideTerrain = this.getStateAccessor(this.names.collideTerrain)\n\n        /**\n         * Returns the entity's `collideEntities` component state\n         * @type {(id:number) => {\n         *      cylinder:boolean, collideBits:number, \n         *      collideMask:number, callback: function}}\n        */\n        this.getCollideEntities = this.getStateAccessor(this.names.collideEntities)\n\n\n        /**\n         * Pairwise collideEntities event - assign your own function to this \n         * property if you want to handle entity-entity overlap events.\n         * @type {(id1:number, id2:number) => void}\n         */\n        this.onPairwiseEntityCollision = function (id1, id2) { }\n    }\n\n\n\n\n    /*\n     * \n     * \n     *      PUBLIC ENTITY STATE ACCESSORS\n     * \n     * \n    */\n\n\n    /** Set an entity's position, and update all derived state.\n     * \n     * In general, always use this to set an entity's position unless\n     * you're familiar with engine internals.\n     * \n     * ```js\n     * noa.ents.setPosition(playerEntity, [5, 6, 7])\n     * noa.ents.setPosition(playerEntity, 5, 6, 7)  // also works\n     * ```\n     * \n     * @param {number} id\n     */\n    setPosition(id, pos, y = 0, z = 0) {\n        if (typeof pos === 'number') pos = [pos, y, z]\n        // convert to local and defer impl\n        var loc = this.noa.globalToLocal(pos, null, [])\n        this._localSetPosition(id, loc)\n    }\n\n    /** Set an entity's size \n     * @param {number} xs\n     * @param {number} ys\n     * @param {number} zs\n    */\n    setEntitySize(id, xs, ys, zs) {\n        var posDat = this.getPositionData(id)\n        posDat.width = (xs + zs) / 2\n        posDat.height = ys\n        this._updateDerivedPositionData(id, posDat)\n    }\n\n\n\n\n    /**\n     * called when engine rebases its local coords\n     * @internal\n     */\n    _rebaseOrigin(delta) {\n        for (var state of this.getStatesList(this.names.position)) {\n            var locPos = state._localPosition\n            var hw = state.width / 2\n            nudgePosition(locPos, 0, -hw, hw, state.__id)\n            nudgePosition(locPos, 1, 0, state.height, state.__id)\n            nudgePosition(locPos, 2, -hw, hw, state.__id)\n            vec3.subtract(locPos, locPos, delta)\n            this._updateDerivedPositionData(state.__id, state)\n        }\n    }\n\n    /** @internal */\n    _localGetPosition(id) {\n        return this.getPositionData(id)._localPosition\n    }\n\n    /** @internal */\n    _localSetPosition(id, pos) {\n        var posDat = this.getPositionData(id)\n        vec3.copy(posDat._localPosition, pos)\n        this._updateDerivedPositionData(id, posDat)\n    }\n\n\n    /** \n     * helper to update everything derived from `_localPosition`\n     * @internal \n    */\n    _updateDerivedPositionData(id, posDat) {\n        vec3.copy(posDat._renderPosition, posDat._localPosition)\n        var offset = this.noa.worldOriginOffset\n        vec3.add(posDat.position, posDat._localPosition, offset)\n        updatePositionExtents(posDat)\n        var physDat = this.getPhysics(id)\n        if (physDat) setPhysicsFromPosition(physDat, posDat)\n    }\n\n\n\n\n\n    /*\n     *\n     *\n     *      OTHER ENTITY MANAGEMENT APIs\n     * \n     *      note most APIs are on the original ECS module (ent-comp)\n     *      these are some overlaid extras for noa\n     *\n     *\n    */\n\n\n    /** \n     * Safely add a component - if the entity already had the \n     * component, this will remove and re-add it.\n    */\n    addComponentAgain(id, name, state) {\n        // removes component first if necessary\n        if (this.hasComponent(id, name)) this.removeComponent(id, name)\n        this.addComponent(id, name, state)\n    }\n\n\n    /** \n     * Checks whether a voxel is obstructed by any entity (with the \n     * `collidesTerrain` component)\n    */\n    isTerrainBlocked(x, y, z) {\n        // checks if terrain location is blocked by entities\n        var off = this.noa.worldOriginOffset\n        var xlocal = Math.floor(x - off[0])\n        var ylocal = Math.floor(y - off[1])\n        var zlocal = Math.floor(z - off[2])\n        var blockExt = [\n            xlocal + 0.001, ylocal + 0.001, zlocal + 0.001,\n            xlocal + 0.999, ylocal + 0.999, zlocal + 0.999,\n        ]\n        var list = this.getStatesList(this.names.collideTerrain)\n        for (var i = 0; i < list.length; i++) {\n            var id = list[i].__id\n            var ext = this.getPositionData(id)._extents\n            if (extentsOverlap(blockExt, ext)) return true\n        }\n        return false\n    }\n\n\n\n    /** \n     * Gets an array of all entities overlapping the given AABB\n    */\n    getEntitiesInAABB(box, withComponent) {\n        // extents to test against\n        var off = this.noa.worldOriginOffset\n        var testExtents = [\n            box.base[0] - off[0], box.base[1] - off[1], box.base[2] - off[2],\n            box.max[0] - off[0], box.max[1] - off[1], box.max[2] - off[2],\n        ]\n        // entity position state list\n        var entStates\n        if (withComponent) {\n            entStates = []\n            for (var compState of this.getStatesList(withComponent)) {\n                var pdat = this.getPositionData(compState.__id)\n                if (pdat) entStates.push(pdat)\n            }\n        } else {\n            entStates = this.getStatesList(this.names.position)\n        }\n\n        // run each test\n        var hits = []\n        for (var i = 0; i < entStates.length; i++) {\n            var state = entStates[i]\n            if (extentsOverlap(testExtents, state._extents)) {\n                hits.push(state.__id)\n            }\n        }\n        return hits\n    }\n\n\n\n    /** \n     * Helper to set up a general entity, and populate with some common components depending on arguments.\n    */\n    add(position = null, width = 1, height = 1,\n        mesh = null, meshOffset = null, doPhysics = false, shadow = false) {\n\n        var self = this\n\n        // new entity\n        var eid = this.createEntity()\n\n        // position component\n        this.addComponent(eid, this.names.position, {\n            position: position || vec3.create(),\n            width: width,\n            height: height,\n        })\n\n        // rigid body in physics simulator\n        if (doPhysics) {\n            // body = this.noa.physics.addBody(box)\n            this.addComponent(eid, this.names.physics)\n            var body = this.getPhysics(eid).body\n\n            // handler for physics engine to call on auto-step\n            var smoothName = this.names.smoothCamera\n            body.onStep = function () {\n                self.addComponentAgain(eid, smoothName)\n            }\n        }\n\n        // mesh for the entity\n        if (mesh) {\n            if (!meshOffset) meshOffset = vec3.create()\n            this.addComponent(eid, this.names.mesh, {\n                mesh: mesh,\n                offset: meshOffset\n            })\n        }\n\n        // add shadow-drawing component\n        if (shadow) {\n            this.addComponent(eid, this.names.shadow, { size: width })\n        }\n\n        return eid\n    }\n}\n\n\n/*\n * \n * \n * \n *          HELPERS\n * \n * \n * \n*/\n\n// safety helper - when rebasing, nudge extent away from \n// voxel boudaries, so floating point error doesn't carry us accross\nfunction nudgePosition(pos, index, dmin, dmax, id) {\n    var min = pos[index] + dmin\n    var max = pos[index] + dmax\n    if (Math.abs(min - Math.round(min)) < 0.002) pos[index] += 0.002\n    if (Math.abs(max - Math.round(max)) < 0.001) pos[index] -= 0.001\n}\n\n// compare extent arrays\nfunction extentsOverlap(extA, extB) {\n    if (extA[0] > extB[3]) return false\n    if (extA[1] > extB[4]) return false\n    if (extA[2] > extB[5]) return false\n    if (extA[3] < extB[0]) return false\n    if (extA[4] < extB[1]) return false\n    if (extA[5] < extB[2]) return false\n    return true\n}\n\n","/** \n * @module \n * @internal exclude this file from API docs \n*/\n\nimport { locationHasher } from './util'\nimport { TransformNode } from '@babylonjs/core/Meshes/transformNode'\nimport '@babylonjs/core/Meshes/thinInstanceMesh'\n\nexport default ObjectMesher\n\nvar PROFILE = 0\n\n\n\n\n\n/*\n *\n *          Object meshing\n * \n *      Per-chunk handling of the creation/disposal of static meshes\n *      associated with particular voxel IDs\n * \n * \n*/\n\n\n/** @param {import('../index').Engine} noa*/\nfunction ObjectMesher(noa) {\n\n    // transform node for all instance meshes to be parented to\n    this.rootNode = new TransformNode('objectMeshRoot', noa.rendering._scene)\n\n    // tracking rebase amount inside matrix data\n    var rebaseOffset = [0, 0, 0]\n\n    // flag to trigger a rebuild after a chunk is disposed\n    var rebuildNextTick = false\n\n    // mock object to pass to customMesh handler, to get transforms\n    var transformObj = new TransformNode('')\n\n    // internal storage of instance managers, keyed by ID\n    // has check to dedupe by mesh, since babylon chokes on\n    // separate sets of instances for the same mesh/clone/geometry\n    var managers = {}\n    var getManager = (id) => {\n        if (managers[id]) return managers[id]\n        var mesh = noa.registry._blockMeshLookup[id]\n        for (var id2 in managers) {\n            var prev = managers[id2].mesh\n            if (prev === mesh || (prev.geometry === mesh.geometry)) {\n                return managers[id] = managers[id2]\n            }\n        }\n        return managers[id] = new InstanceManager(noa, mesh)\n    }\n\n\n\n\n    /*\n     * \n     *      public API\n     * \n    */\n\n\n    // add any properties that will get used for meshing\n    this.initChunk = function (chunk) {\n        chunk._objectBlocks = {}\n    }\n\n\n    // called by world when an object block is set or cleared\n    this.setObjectBlock = function (chunk, blockID, i, j, k) {\n        var x = chunk.x + i\n        var y = chunk.y + j\n        var z = chunk.z + k\n        var key = locationHasher(x, y, z)\n\n        var oldID = chunk._objectBlocks[key] || 0\n        if (oldID === blockID) return // should be impossible\n        if (oldID > 0) {\n            var oldMgr = getManager(oldID)\n            oldMgr.removeInstance(chunk, key)\n        }\n\n        if (blockID > 0) {\n            // if there's a block event handler, call it with\n            // a mock object so client can add transforms\n            var handlers = noa.registry._blockHandlerLookup[blockID]\n            var onCreate = handlers && handlers.onCustomMeshCreate\n            if (onCreate) {\n                transformObj.position.copyFromFloats(0.5, 0, 0.5)\n                transformObj.scaling.setAll(1)\n                transformObj.rotation.setAll(0)\n                onCreate(transformObj, x, y, z)\n            }\n            var mgr = getManager(blockID)\n            var xform = (onCreate) ? transformObj : null\n            mgr.addInstance(chunk, key, i, j, k, xform, rebaseOffset)\n        }\n\n        if (oldID > 0 && !blockID) delete chunk._objectBlocks[key]\n        if (blockID > 0) chunk._objectBlocks[key] = blockID\n    }\n\n\n\n    // called by world when it knows that objects have been updated\n    this.buildObjectMeshes = function () {\n        profile_hook('start')\n\n        for (var id in managers) {\n            var mgr = managers[id]\n            mgr.updateMatrix()\n            if (mgr.count === 0) mgr.dispose()\n            if (mgr.disposed) delete managers[id]\n        }\n\n        profile_hook('rebuilt')\n        profile_hook('end')\n    }\n\n\n\n    // called by world at end of chunk lifecycle\n    this.disposeChunk = function (chunk) {\n        for (var key in chunk._objectBlocks) {\n            var id = chunk._objectBlocks[key]\n            if (id > 0) {\n                var mgr = getManager(id)\n                mgr.removeInstance(chunk, key)\n            }\n        }\n        chunk._objectBlocks = null\n\n        // since some instance managers will have been updated\n        rebuildNextTick = true\n    }\n\n\n\n    // tick handler catches case where objects are dirty due to disposal\n    this.tick = function () {\n        if (rebuildNextTick) {\n            this.buildObjectMeshes()\n            rebuildNextTick = false\n        }\n    }\n\n\n\n    // world rebase handler\n    this._rebaseOrigin = function (delta) {\n        rebaseOffset[0] += delta[0]\n        rebaseOffset[1] += delta[1]\n        rebaseOffset[2] += delta[2]\n\n        for (var id1 in managers) managers[id1].rebased = false\n        for (var id2 in managers) {\n            var mgr = managers[id2]\n            if (mgr.rebased) continue\n            for (var i = 0; i < mgr.count; i++) {\n                var ix = i << 4\n                mgr.buffer[ix + 12] -= delta[0]\n                mgr.buffer[ix + 13] -= delta[1]\n                mgr.buffer[ix + 14] -= delta[2]\n            }\n            mgr.rebased = true\n            mgr.dirty = true\n        }\n        rebuildNextTick = true\n    }\n\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/*\n * \n * \n *      manager class for thin instances of a given object block ID \n * \n * \n*/\n\nfunction InstanceManager(noa, mesh) {\n    this.mesh = mesh\n    this.buffer = null\n    this.capacity = 0\n    this.count = 0\n    this.dirty = false\n    this.rebased = true\n    this.disposed = false\n    // dual struct to map keys (locations) to buffer locations, and back\n    this.keyToIndex = {}\n    this.locToKey = []\n    // prepare mesh for rendering\n    this.mesh.position.setAll(0)\n    this.mesh.parent = noa._objectMesher.rootNode\n    this.mesh.isVisible = true\n    noa.rendering.addMeshToScene(this.mesh, false)\n    this.mesh.doNotSyncBoundingInfo = true\n    this.mesh.alwaysSelectAsActiveMesh = true\n}\n\n\n\nInstanceManager.prototype.dispose = function () {\n    if (this.disposed) return\n    this.mesh.thinInstanceCount = 0\n    this.setCapacity(0)\n    this.mesh.isVisible = false\n    this.mesh = null\n    this.keyToIndex = null\n    this.locToKey = null\n    this.disposed = true\n}\n\n\nInstanceManager.prototype.addInstance = function (chunk, key, i, j, k, transform, rebaseVec) {\n    maybeExpandBuffer(this)\n    var ix = this.count << 4\n    this.locToKey[this.count] = key\n    this.keyToIndex[key] = ix\n    if (transform) {\n        transform.position.x += (chunk.x - rebaseVec[0]) + i\n        transform.position.y += (chunk.y - rebaseVec[1]) + j\n        transform.position.z += (chunk.z - rebaseVec[2]) + k\n        transform.computeWorldMatrix(true)\n        var xformArr = transform._localMatrix._m\n        copyMatrixData(xformArr, 0, this.buffer, ix)\n    } else {\n        var matArray = tempMatrixArray\n        matArray[12] = (chunk.x - rebaseVec[0]) + i + 0.5\n        matArray[13] = (chunk.y - rebaseVec[1]) + j\n        matArray[14] = (chunk.z - rebaseVec[2]) + k + 0.5\n        copyMatrixData(matArray, 0, this.buffer, ix)\n    }\n    this.count++\n    this.dirty = true\n}\n\n\nInstanceManager.prototype.removeInstance = function (chunk, key) {\n    var remIndex = this.keyToIndex[key]\n    if (!(remIndex >= 0)) throw 'tried to remove object instance not in storage'\n    delete this.keyToIndex[key]\n    var remLoc = remIndex >> 4\n    // copy tail instance's data to location of one we're removing\n    var tailLoc = this.count - 1\n    if (remLoc !== tailLoc) {\n        var tailIndex = tailLoc << 4\n        copyMatrixData(this.buffer, tailIndex, this.buffer, remIndex)\n        // update key/location structs\n        var tailKey = this.locToKey[tailLoc]\n        this.keyToIndex[tailKey] = remIndex\n        this.locToKey[remLoc] = tailKey\n    }\n    this.count--\n    this.dirty = true\n    maybeContractBuffer(this)\n}\n\n\nInstanceManager.prototype.updateMatrix = function () {\n    if (!this.dirty) return\n    this.mesh.thinInstanceCount = this.count\n    this.mesh.thinInstanceBufferUpdated('matrix')\n    this.mesh.isVisible = (this.count > 0)\n    this.dirty = false\n}\n\n\n\nInstanceManager.prototype.setCapacity = function (size = 4) {\n    this.capacity = size\n    if (size === 0) {\n        this.buffer = null\n    } else {\n        var newBuff = new Float32Array(this.capacity * 16)\n        if (this.buffer) {\n            var len = Math.min(this.buffer.length, newBuff.length)\n            for (var i = 0; i < len; i++) newBuff[i] = this.buffer[i]\n        }\n        this.buffer = newBuff\n    }\n    this.mesh.thinInstanceSetBuffer('matrix', this.buffer)\n    this.mesh.thinInstanceCount = this.count\n    this.dirty = false\n}\n\n\nfunction maybeExpandBuffer(mgr) {\n    if (mgr.count < mgr.capacity) return\n    var size = Math.max(8, mgr.capacity * 2)\n    mgr.setCapacity(size)\n}\n\nfunction maybeContractBuffer(mgr) {\n    if (mgr.count > mgr.capacity * 0.4) return\n    if (mgr.capacity < 100) return\n    mgr.setCapacity(Math.round(mgr.capacity / 2))\n    mgr.locToKey.length = Math.min(mgr.locToKey.length, mgr.capacity)\n}\n\n\n\n// helpers\n\nvar tempMatrixArray = [\n    1.0, 0.0, 0.0, 0.0,\n    0.0, 1.0, 0.0, 0.0,\n    0.0, 0.0, 1.0, 0.0,\n    0.0, 0.0, 0.0, 1.0,\n]\n\nfunction copyMatrixData(src, srcOff, dest, destOff) {\n    for (var i = 0; i < 16; i++) dest[destOff + i] = src[srcOff + i]\n}\n\n\n\n\n\n\n\n\n\n\n\n\nimport { makeProfileHook } from './util'\nvar profile_hook = (PROFILE) ?\n    makeProfileHook(PROFILE, 'Object meshing') : () => { }\n","\nimport { Engine } from '@babylonjs/core/Engines/engine'\nimport { MaterialPluginBase, RawTexture2DArray, Texture } from '@babylonjs/core/Materials'\n\n/**\n * @module \n * @internal exclude this file from API docs \n * \n * \n *      This module creates and manages Materials for terrain meshes. \n *      It tells the terrain mesher which block face materials can share\n *      the same material (and should thus be joined into a single mesh),\n *      and also creates the materials when needed.\n * \n*/\n\nexport class TerrainMatManager {\n\n    /** @param {import('../index').Engine} noa  */\n    constructor(noa) {\n\n        // internals\n        this.noa = noa\n        this._idCounter = 1000\n        this._blockMatIDtoTerrainID = {}\n        this._terrainIDtoMatObject = {}\n        this._texURLtoTerrainID = {}\n        this._renderMatToTerrainID = new Map()\n    }\n\n\n\n    /** \n     * Maps a given `matID` (from noa.registry) to a unique ID of which \n     * terrain material can be used for that block material.\n     * This lets the terrain mesher map which blocks can be merged into\n     * the same meshes.\n     * Internally, this accessor also creates the material for each \n     * terrainMatID as they are first encountered.\n     */\n\n    getTerrainMatId(blockMatID) {\n        // fast case where matID has been seen before\n        if (blockMatID in this._blockMatIDtoTerrainID) {\n            return this._blockMatIDtoTerrainID[blockMatID]\n        }\n        // decide a unique terrainID for this block material\n        var terrID = decideTerrainMatID(this, blockMatID)\n        // create a mat object for it, if needed\n        if (!(terrID in this._terrainIDtoMatObject)) {\n            var mat = createTerrainMat(this, blockMatID)\n            this._terrainIDtoMatObject[terrID] = mat\n        }\n        // cache results and done\n        this._blockMatIDtoTerrainID[blockMatID] = terrID\n        return terrID\n    }\n\n\n    /**\n     * Get a Babylon Material object, given a terrainMatID (gotten from this module)\n     */\n    getMaterial(terrainMatID = 1) {\n        return this._terrainIDtoMatObject[terrainMatID]\n    }\n\n\n\n\n\n}\n\n\n\n\n/**\n * \n * \n *      Implementations of creating/disambiguating terrain Materials\n * \n * \n*/\n\n/** \n * Decide a unique terrainID, based on block material ID properties\n * @param {TerrainMatManager} self \n*/\nfunction decideTerrainMatID(self, blockMatID = 0) {\n    var matInfo = self.noa.registry.getMaterialData(blockMatID)\n\n    // custom render materials get one unique terrainID per material\n    if (matInfo.renderMat) {\n        var mat = matInfo.renderMat\n        if (!self._renderMatToTerrainID.has(mat)) {\n            self._renderMatToTerrainID.set(mat, self._idCounter++)\n        }\n        return self._renderMatToTerrainID.get(mat)\n    }\n\n    // ditto for textures, unique URL\n    if (matInfo.texture) {\n        var url = matInfo.texture\n        if (!(url in self._texURLtoTerrainID)) {\n            self._texURLtoTerrainID[url] = self._idCounter++\n        }\n        return self._texURLtoTerrainID[url]\n    }\n\n    // plain color materials with an alpha value are unique by alpha\n    var alpha = matInfo.alpha\n    if (alpha > 0 && alpha < 1) return 10 + Math.round(alpha * 100)\n\n    // the only remaining case is the baseline, which always reuses one fixed ID\n    return 1\n}\n\n\n/** \n * Create (choose) a material for a given set of block material properties\n * @param {TerrainMatManager} self \n*/\nfunction createTerrainMat(self, blockMatID = 0) {\n    var matInfo = self.noa.registry.getMaterialData(blockMatID)\n\n    // custom render mats are just reused\n    if (matInfo.renderMat) return matInfo.renderMat\n\n    // if no texture: use a basic flat material, possibly with alpha\n    if (!matInfo.texture) {\n        var needsAlpha = (matInfo.alpha > 0 && matInfo.alpha < 1)\n        var matName = 'terrain-base-' + blockMatID\n        if (needsAlpha) matName += '-alpha'\n        var plainMat = self.noa.rendering.makeStandardMaterial(matName)\n        if (needsAlpha) plainMat.alpha = matInfo.alpha\n        plainMat.freeze()\n        return plainMat\n    }\n\n    // remaining case is a new material with a diffuse texture\n    var scene = self.noa.rendering.getScene()\n    var mat = self.noa.rendering.makeStandardMaterial('terrain-textured-' + blockMatID)\n    var url = matInfo.texture\n    var sampling = Texture.NEAREST_SAMPLINGMODE\n    var tex = new Texture(url, scene, true, false, sampling)\n    if (matInfo.texHasAlpha) tex.hasAlpha = true\n    mat.diffuseTexture = tex\n\n    // it texture is an atlas, apply material plugin\n    if (matInfo.atlasIndex >= 0) new TerrainMaterialPlugin(mat, tex)\n    mat.freeze()\n\n    return mat\n}\n\n\n\n\n\n\n\n\n\n\n\n/**\n * \n *      Babylon material plugin - twiddles the defines/shaders/etc so that\n *      a standard material can use textures from a 2D texture atlas.\n * \n*/\n\nclass TerrainMaterialPlugin extends MaterialPluginBase {\n    constructor(material, texture) {\n        var priority = 200\n        var defines = { 'NOA_TWOD_ARRAY_TEXTURE': false }\n        super(material, 'TestPlugin', priority, defines)\n        this._enable(true)\n        this._atlasTextureArray = null\n\n        texture.onLoadObservable.add((tex) => {\n            this.setTextureArrayData(tex)\n        })\n    }\n\n    setTextureArrayData(texture) {\n        var { width, height } = texture.getSize()\n        var numLayers = Math.round(height / width)\n        height = width\n        var data = texture._readPixelsSync()\n\n        var format = Engine.TEXTUREFORMAT_RGBA\n        var genMipMaps = true\n        var invertY = false\n        var mode = Texture.NEAREST_SAMPLINGMODE\n        var scene = texture.getScene()\n\n        this._atlasTextureArray = new RawTexture2DArray(\n            data, width, height, numLayers,\n            format, scene, genMipMaps, invertY, mode,\n        )\n    }\n\n    prepareDefines(defines, scene, mesh) {\n        defines['NOA_TWOD_ARRAY_TEXTURE'] = true\n    }\n\n    getClassName() {\n        return 'TerrainMaterialPluginName'\n    }\n\n    getSamplers(samplers) {\n        samplers.push('atlasTexture')\n    }\n\n    getAttributes(attributes) {\n        attributes.push('texAtlasIndices')\n    }\n\n    getUniforms() {\n        return { ubo: [] }\n    }\n\n    bindForSubMesh(uniformBuffer, scene, engine, subMesh) {\n        if (this._atlasTextureArray) {\n            uniformBuffer.setTexture('atlasTexture', this._atlasTextureArray)\n        }\n    }\n\n    getCustomCode(shaderType) {\n        if (shaderType === 'vertex') return {\n            'CUSTOM_VERTEX_MAIN_BEGIN': `\n                texAtlasIndex = texAtlasIndices;\n            `,\n            'CUSTOM_VERTEX_DEFINITIONS': `\n                uniform highp sampler2DArray atlasTexture;\n                attribute float texAtlasIndices;\n                varying float texAtlasIndex;\n            `,\n        }\n        if (shaderType === 'fragment') return {\n            '!baseColor\\\\=texture2D\\\\(diffuseSampler,vDiffuseUV\\\\+uvOffset\\\\);':\n                `baseColor = texture(atlasTexture, vec3(vDiffuseUV, texAtlasIndex));`,\n            'CUSTOM_FRAGMENT_DEFINITIONS': `\n                uniform highp sampler2DArray atlasTexture;\n                varying float texAtlasIndex;\n            `,\n        }\n        return null\n    }\n}\n","/** \n * @module \n * @internal exclude this file from API docs \n*/\n\nimport ndarray from 'ndarray'\nimport { Mesh } from '@babylonjs/core/Meshes/mesh'\nimport { VertexData } from '@babylonjs/core/Meshes/mesh.vertexData'\nimport { TerrainMatManager } from './terrainMaterials'\nimport { copyNdarrayContents } from './util'\n\nexport default TerrainMesher\n\n\n\n\n// enable for profiling..\nvar PROFILE_EVERY = 0\n\n\n\n\n/*\n * \n *          TERRAIN MESHER!!\n * \n*/\n\n\n/** @param {import('../index').Engine} noa  */\nfunction TerrainMesher(noa) {\n\n    var terrainMatManager = new TerrainMatManager(noa)\n    var greedyMesher = new GreedyMesher(noa, terrainMatManager)\n    var meshBuilder = new MeshBuilder(noa, terrainMatManager)\n\n    /*\n     * \n     *      public API\n     * \n    */\n\n\n    // add any properties that will get used for meshing\n    this.initChunk = function (chunk) {\n        chunk._terrainMeshes.length = 0\n    }\n\n\n    /**\n     * meshing entry point and high-level flow\n     * @param {import('./chunk').default} chunk \n     */\n    this.meshChunk = function (chunk, matGetter, colGetter, ignoreMaterials, useAO, aoVals, revAoVal) {\n        profile_hook('start')\n\n        // dispose any previously existing mesh\n        chunk._terrainMeshes.forEach(m => m.dispose())\n        chunk._terrainMeshes.length = 0\n        profile_hook('cleanup')\n\n        // args\n        var mats = matGetter || noa.registry.getBlockFaceMaterial\n        var cols = colGetter || noa.registry._getMaterialVertexColor\n        var ao = (useAO === undefined) ? noa.rendering.useAO : useAO\n        var vals = aoVals || noa.rendering.aoVals\n        var rev = isNaN(revAoVal) ? noa.rendering.revAoVal : revAoVal\n\n        // copy voxel data into array padded with neighbor values\n        var voxels = buildPaddedVoxelArray(chunk)\n        profile_hook('copy')\n\n        // greedy mesher creates big arrays of geometry data\n        var edgesOnly = chunk._isFull || chunk._isEmpty\n        var geomDataSet = greedyMesher.mesh(voxels, mats, cols, ao, vals, rev, edgesOnly)\n        profile_hook('geom')\n\n        // build the babylon meshes that will be added to the scene\n        var meshes = meshBuilder.build(chunk, geomDataSet, ignoreMaterials)\n        profile_hook('build')\n\n        profile_hook('end')\n\n        // add to scene and finish\n        meshes.forEach((mesh) => {\n            noa.rendering.addMeshToScene(mesh, true, chunk.pos, this)\n            mesh.cullingStrategy = Mesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY\n            chunk._terrainMeshes.push(mesh)\n        })\n    }\n\n\n    // nothing to do on dispose except remove the previous mesh\n    this.disposeChunk = function (chunk) {\n        chunk._terrainMeshes.forEach(m => m.dispose())\n        chunk._terrainMeshes.length = 0\n    }\n\n\n\n}\n\n\n\n\n\n\n\n\n\n/*\n * \n *      Padded voxel data assembler\n * \n * Takes the chunk of size n, and copies its data into center of an (n+2) ndarray\n * Then copies in edge data from neighbors, or if not available zeroes it out\n * Actual mesher will then run on the padded ndarray\n * \n*/\n\n/** @param {import('./chunk').default} chunk    */\nfunction buildPaddedVoxelArray(chunk) {\n    var src = chunk.voxels\n    var cs = src.shape[0]\n    var tgt = cachedPadded\n\n    // embiggen cached target array\n    if (cs + 2 !== tgt.shape[0]) {\n        var s2 = cs + 2\n        tgt = new ndarray(new Uint16Array(s2 * s2 * s2), [s2, s2, s2])\n        cachedPadded = tgt\n    }\n\n    // loop through neighbors (neighbor(0,0,0) is the chunk itself)\n    // copying or zeroing voxel body/edge data into padded target array\n    var loc = _vecs[0]\n    var pos = _vecs[1]\n    var size = _vecs[2]\n    var tgtPos = _vecs[3]\n    var posValues = _vecs[4]\n    var sizeValues = _vecs[5]\n    var tgtPosValues = _vecs[6]\n    if (cs !== _cachedVecSize) {\n        _cachedVecSize = cs\n        allocateVectors(cs, posValues, sizeValues, tgtPosValues)\n    }\n\n    for (var i = 0; i < 3; i++) {\n        loc[0] = i\n        for (var j = 0; j < 3; j++) {\n            loc[1] = j\n            for (var k = 0; k < 3; k++) {\n                loc[2] = k\n                for (var n = 0; n < 3; n++) {\n                    var coord = loc[n]\n                    pos[n] = posValues[coord]\n                    size[n] = sizeValues[coord]\n                    tgtPos[n] = tgtPosValues[coord]\n                }\n                var nab = chunk._neighbors.get(i - 1, j - 1, k - 1)\n                var nsrc = 0\n                if (nab) nsrc = (nab._filledWithVoxel >= 0) ?\n                    nab._filledWithVoxel : nab.voxels\n                copyNdarrayContents(nsrc, tgt, pos, size, tgtPos)\n            }\n        }\n    }\n    return tgt\n}\nvar cachedPadded = new ndarray(new Uint16Array(27), [3, 3, 3])\nvar _vecs = Array.from(Array(10), () => [0, 0, 0])\nvar _cachedVecSize\nfunction allocateVectors(size, posValues, sizeValues, tgtPosValues) {\n    for (var i = 0; i < 3; i++) {\n        posValues[i] = [size - 1, 0, 0][i]\n        sizeValues[i] = [1, size, 1][i]\n        tgtPosValues[i] = [0, 1, size + 1][i]\n    }\n}\n\n\n\n\n\n\n\n\n/*\n * \n *  A single reusable struct to hold all geometry data for the chunk \n *  currently being meshed.\n * \n *  Basically, the greedy mesher builds this and the mesh builder consumes it\n * \n*/\n\nfunction GeometryData(terrainID) {\n    this.terrainID = terrainID\n    this.numQuads = 0                // how many quads meshed so far\n    this.quadMaterials = [1]         // list of which matID each quad used\n    this.positions = [0.5]           // raw data, 12 positions per quad\n    this.indices = [1]               // raw data, 6 indexes per quad\n    this.normals = [0.5]             // raw data, 12 normals per quad\n    this.colors = [0.5]              // raw data, 16 colors per quad\n    this.uvs = [0.5]                 // raw data, 8 uvs per quad\n    this.atlasIndices = [0]          // indices into vertical strip texture atlas\n}\nGeometryData.prototype.dispose = function () {\n    this.quadMaterials = null\n    this.positions = null\n    this.indices = null\n    this.normals = null\n    this.colors = null\n    this.uvs = null\n    this.atlasIndices = null\n}\n\n\n\n\n\n\n\n\n/**\n * \n * \n * \n * \n *       Mesh Builder - consumes all the raw data in geomData to build\n *          Babylon.js mesh/submeshes, ready to be added to the scene\n * \n * \n * \n * \n * \n */\n\n/** @param {import('../index').Engine} noa  */\nfunction MeshBuilder(noa, terrainMatManager) {\n\n    // core\n    this.build = function (chunk, geomDataSet, ignoreMaterials) {\n        var scene = noa.rendering.getScene()\n\n        // geometry data is already keyed by terrain type, so build\n        // one mesh per geomData object in the hash\n        var meshes = []\n        for (var key in geomDataSet) {\n            /** @type {GeometryData} */\n            var geomData = geomDataSet[key]\n\n            if (geomData.numQuads === 0) throw '?'\n\n            // the mesh and vertexData object\n            var name = `chunk_${chunk.requestID}_${geomData.terrainID}`\n            var mesh = new Mesh(name, scene)\n            var vdat = new VertexData()\n            vdat.positions = geomData.positions\n            vdat.indices = geomData.indices\n            vdat.normals = geomData.normals\n            vdat.colors = geomData.colors\n            vdat.uvs = geomData.uvs\n            vdat.applyToMesh(mesh)\n\n            // meshes using a texture atlas need atlasIndices\n            if (geomData.atlasIndices.length > 1) {\n                mesh.setVerticesData('texAtlasIndices', geomData.atlasIndices, false, 1)\n            }\n\n            // materials wrangled by external module\n            mesh.material = terrainMatManager.getMaterial(geomData.terrainID)\n\n            // done\n            geomData.dispose()\n            meshes.push(mesh)\n        }\n\n        return meshes\n    }\n\n}\n\n\n\n\n\n\n\n\n/*\n * \n * \n * \n *    Greedy voxel meshing algorithm\n *        based initially on algo by Mikola Lysenko:\n *          http://0fps.net/2012/07/07/meshing-minecraft-part-2/\n *          but evolved quite a bit since then\n *        AO handling by me, stitched together out of cobwebs and dreams\n *    \n *    Arguments:\n *        arr: 3D ndarray of dimensions X,Y,Z\n *             packed with solidity/opacity booleans in higher bits\n *        getMaterial: function( blockID, dir )\n *             returns a material ID based on block id and which cube face it is\n *             (assume for now that each mat ID should get its own mesh)\n *        getColor: function( materialID )\n *             looks up a color (3-array) by material ID\n *             TODO: replace this with a lookup array?\n *        doAO: whether or not to bake ambient occlusion into vertex colors\n *        aoValues: array[3] of color multipliers for AO (least to most occluded)\n *        revAoVal: \"reverse ao\" - color multiplier for unoccluded exposed edges\n *\n *    Return object: array of mesh objects keyed by material ID\n *        arr[id] = {\n *          id:       material id for mesh\n *          vertices: ints, range 0 .. X/Y/Z\n *          indices:  ints\n *          normals:  ints,   -1 .. 1\n *          colors:   floats,  0 .. 1\n *          uvs:      floats,  0 .. X/Y/Z\n *        }\n * \n * \n */\n\n/** @param {import('../index').Engine} noa  */\nfunction GreedyMesher(noa, terrainMatManager) {\n\n    var maskCache = new Int16Array(16)\n    var aomaskCache = new Uint16Array(16)\n\n    var solidLookup = noa.registry._solidityLookup\n    var opacityLookup = noa.registry._opacityLookup\n    var matIDtoTerrainID = (matID) => terrainMatManager.getTerrainMatId(matID)\n    var matIDtoAtlasIndex = (matID) => noa.registry.getMaterialData(matID).atlasIndex\n\n\n    this.mesh = function (voxels, getMaterial, getColor, doAO, aoValues, revAoVal, edgesOnly) {\n        solidLookup = noa.registry._solidityLookup\n        opacityLookup = noa.registry._opacityLookup\n\n        // collecion of GeomertryData objects, keyed by terrain ID\n        var geomDataSet = {}\n\n        // how to apply AO packing in first masking function\n        var skipReverseAO = (revAoVal === aoValues[0])\n\n        //Sweep over each axis, mapping axes to [d,u,v]\n        for (var d = 0; d < 3; ++d) {\n            var u = (d + 1) % 3\n            var v = (d + 2) % 3\n\n            // make transposed ndarray so index i is the axis we're sweeping\n            var shape = voxels.shape\n            var arrT = voxels.transpose(d, u, v).lo(1, 1, 1).hi(shape[d] - 2, shape[u] - 2, shape[v] - 2)\n\n            // shorten len0 by 1 so faces at edges don't get drawn in both chunks\n            var len0 = arrT.shape[0] - 1\n            var len1 = arrT.shape[1]\n            var len2 = arrT.shape[2]\n\n            // embiggen mask arrays as needed\n            if (maskCache.length < len1 * len2) {\n                maskCache = new Int16Array(len1 * len2)\n                aomaskCache = new Uint16Array(len1 * len2)\n            }\n\n            // iterate along current major axis..\n            for (var i = 0; i <= len0; ++i) {\n\n                // fills mask and aomask arrays with values\n                constructMeshMasks(i, d, arrT, getMaterial, doAO, skipReverseAO)\n\n                // parses the masks to do greedy meshing\n                constructGeometryFromMasks(i, d, u, v, len1, len2,\n                    doAO, geomDataSet, getColor, aoValues, revAoVal)\n\n                // process edges only by jumping to other edge\n                if (edgesOnly) i += (len0 - 1)\n\n            }\n        }\n\n        // done!\n        return geomDataSet\n    }\n\n\n\n\n\n\n\n    //      Greedy meshing inner loop one\n    //\n    // iterating across ith 2d plane, with n being index into masks\n\n    function constructMeshMasks(i, d, arrT, getMaterial, doAO, skipRevAO) {\n        var len = arrT.shape[1]\n        var mask = maskCache\n        var aomask = aomaskCache\n        // set up for quick array traversals\n        var n = 0\n        var materialDir = d * 2\n        var data = arrT.data\n        var dbase = arrT.index(i - 1, 0, 0)\n        var istride = arrT.stride[0]\n        var jstride = arrT.stride[1]\n        var kstride = arrT.stride[2]\n\n        for (var k = 0; k < len; ++k) {\n            var d0 = dbase\n            dbase += kstride\n            for (var j = 0; j < len; j++, n++, d0 += jstride) {\n\n                // mask[n] will represent the face needed between i-1,j,k and i,j,k\n                // for now, assume we never have two faces in both directions\n\n                // note that mesher zeroes out the mask as it goes, so there's \n                // no need to zero it here when no face is needed\n\n                // IDs at i-1,j,k  and  i,j,k\n                var id0 = data[d0]\n                var id1 = data[d0 + istride]\n\n                // most common case: never a face between same voxel IDs, \n                // so skip out early\n                if (id0 === id1) continue\n\n                var faceDir = getFaceDir(id0, id1, getMaterial, materialDir)\n                if (faceDir) {\n                    // set regular mask value to material ID, sign indicating direction\n                    mask[n] = (faceDir > 0) ?\n                        getMaterial(id0, materialDir) :\n                        -getMaterial(id1, materialDir + 1)\n\n                    // if doing AO, precalculate AO level for each face into second mask\n                    if (doAO) {\n                        // i values in direction face is/isn't pointing{\n                        aomask[n] = (faceDir > 0) ?\n                            packAOMask(arrT, i, i - 1, j, k, skipRevAO) :\n                            packAOMask(arrT, i - 1, i, j, k, skipRevAO)\n                    }\n                }\n            }\n        }\n    }\n\n\n\n    function getFaceDir(id0, id1, getMaterial, materialDir) {\n        // no face if both blocks are opaque\n        var op0 = opacityLookup[id0]\n        var op1 = opacityLookup[id1]\n        if (op0 && op1) return 0\n        // if either block is opaque draw a face for it\n        if (op0) return 1\n        if (op1) return -1\n        // can't tell from block IDs, so compare block materials of each face\n        var m0 = getMaterial(id0, materialDir)\n        var m1 = getMaterial(id1, materialDir + 1)\n        // if same material, draw no face. If one is missing, draw the other\n        if (m0 === m1) { return 0 }\n        else if (m0 === 0) { return -1 }\n        else if (m1 === 0) { return 1 }\n        // remaining case is two different non-opaque block materials\n        // facing each other. for now, draw neither..\n        return 0\n    }\n\n\n\n\n\n\n    // \n    //      Greedy meshing inner loop two\n    //\n    // construct geometry data from the masks\n\n    function constructGeometryFromMasks(i, d, u, v, len1, len2,\n        doAO, geomDataSet, getColor, aoValues, revAoVal) {\n        var n = 0\n        var mask = maskCache\n        var aomask = aomaskCache\n\n        var x = [0, 0, 0]\n        var du = [0, 0, 0]\n        var dv = [0, 0, 0]\n        x[d] = i\n        var norms = [0, 0, 0]\n\n        // some logic is broken into helper functions for AO and non-AO\n        // this fixes deopts in Chrome (for reasons unknown)\n        var maskCompareFcn = (doAO) ? maskCompare : maskCompare_noAO\n        var meshColorFcn = (doAO) ? pushMeshColors : pushMeshColors_noAO\n\n        for (var k = 0; k < len2; ++k) {\n            var w = 1\n            var h = 1\n            for (var j = 0; j < len1; j += w, n += w) {\n\n                var maskVal = mask[n] | 0\n                if (!maskVal) {\n                    w = 1\n                    continue\n                }\n                var ao = aomask[n] | 0\n\n                // Compute width and height of area with same mask/aomask values\n                for (w = 1; w < len1 - j; ++w) {\n                    if (!maskCompareFcn(n + w, mask, maskVal, aomask, ao)) break\n                }\n\n                OUTER:\n                for (h = 1; h < len2 - k; ++h) {\n                    for (var m = 0; m < w; ++m) {\n                        var ix = n + m + h * len1\n                        if (!maskCompareFcn(ix, mask, maskVal, aomask, ao)) break OUTER\n                    }\n                }\n\n                // for testing: doing the following will disable greediness\n                //w=h=1\n\n                // terrain ID type, and geometry data for this face\n                var matID = Math.abs(maskVal)\n                var terrainID = matIDtoTerrainID(matID)\n                if (!(terrainID in geomDataSet)) {\n                    geomDataSet[terrainID] = new GeometryData(terrainID)\n                }\n                /** @type {GeometryData} */\n                var geomData = geomDataSet[terrainID]\n\n                // we're now ready to push a quad worth of geometry data\n                var nq = geomData.numQuads\n\n                // if block material is a texture atlas, add indices to it\n                var atlasIndex = matIDtoAtlasIndex(matID)\n                if (atlasIndex >= 0) {\n                    addAtlasIndices(geomData.atlasIndices, nq * 4, atlasIndex)\n                }\n\n                // add colors into geomData\n                // tridir is boolean for which way to split the quad into triangles\n                var colorsArr = geomData.colors\n                var colorsIndex = nq * 16\n                var triDir = meshColorFcn(colorsArr, colorsIndex,\n                    getColor(matID), ao, aoValues, revAoVal)\n\n                //Add quad positions - vertices = x -> x+du -> x+du+dv -> x+dv\n                x[u] = j\n                x[v] = k\n                du[u] = w\n                dv[v] = h\n                addPositionValues(geomData.positions, nq * 12, x, du, dv)\n\n                // add uv values, with the order and sign depending on \n                // axis and direction so as to avoid mirror-image textures\n                var dir = sign(maskVal)\n                addUVs(geomData.uvs, nq * 8, d, w, h, dir)\n\n                // add same normals for all vertices, depending on\n                // which direction the mask was solid in..\n                norms[d] = dir\n                addNormalValues(geomData.normals, nq * 12, norms)\n\n                // Add indexes, ordered clockwise for the facing direction;\n                var inds = geomData.indices\n                var ioff = nq * 6\n                var voff = nq * 4\n                addIndexValues(inds, ioff, voff, maskVal, triDir)\n\n                // finished adding  quad geometry data\n                geomData.numQuads++\n\n                //Zero-out mask\n                for (var hx = 0; hx < h; ++hx) {\n                    for (var wx = 0; wx < w; ++wx) {\n                        mask[n + wx + hx * len1] = 0\n                    }\n                }\n\n            }\n        }\n    }\n\n\n    // small helpers to add values to raw data geometry arrays:\n\n    function addPositionValues(posArr, offset, x, du, dv) {\n        for (var i = 0; i < 3; i++) {\n            posArr[offset + i] = x[i]\n            posArr[offset + 3 + i] = x[i] + du[i]\n            posArr[offset + 6 + i] = x[i] + du[i] + dv[i]\n            posArr[offset + 9 + i] = x[i] + dv[i]\n        }\n    }\n\n    function addUVs(uvArr, offset, d, w, h, dir) {\n        for (var i = 0; i < 8; i++) uvArr[offset + i] = 0\n        if (d === 2) {\n            uvArr[offset + 1] = uvArr[offset + 3] = h\n            uvArr[offset + 2] = uvArr[offset + 4] = -dir * w\n        } else {\n            uvArr[offset + 1] = uvArr[offset + 7] = w\n            uvArr[offset + 4] = uvArr[offset + 6] = dir * h\n        }\n    }\n\n    function addNormalValues(normArr, offset, norms) {\n        for (var i = 0; i < 12; i++) {\n            normArr[offset + i] = norms[i % 3]\n        }\n    }\n\n    function addIndexValues(indArr, offset, baseIndex, maskVal, triDir) {\n        var indexVals = (maskVal < 0) ?\n            (triDir ? indexLists.A : indexLists.B) :\n            (triDir ? indexLists.C : indexLists.D)\n        for (var i = 0; i < 6; i++) {\n            indArr[offset + i] = baseIndex + indexVals[i]\n        }\n    }\n    var indexLists = {\n        A: [0, 1, 2, 0, 2, 3],\n        B: [1, 2, 3, 0, 1, 3],\n        C: [0, 2, 1, 0, 3, 2],\n        D: [3, 1, 0, 3, 2, 1],\n    }\n\n    function addAtlasIndices(indArr, offset, atlasIndex) {\n        for (var i = 0; i < 4; i++) {\n            indArr[offset + i] = atlasIndex\n        }\n    }\n\n\n\n\n    // Helper functions with AO and non-AO implementations:\n\n    function maskCompare(index, mask, maskVal, aomask, aoVal) {\n        if (maskVal !== mask[index]) return false\n        if (aoVal !== aomask[index]) return false\n        return true\n    }\n\n    function maskCompare_noAO(index, mask, maskVal, aomask, aoVal) {\n        if (maskVal !== mask[index]) return false\n        return true\n    }\n\n    function pushMeshColors_noAO(colors, ix, c, ao, aoValues, revAoVal) {\n        for (var off = 0; off < 16; off += 4) {\n            colors[ix + off] = c[0]\n            colors[ix + off + 1] = c[1]\n            colors[ix + off + 2] = c[2]\n            colors[ix + off + 3] = 1\n        }\n        return true // triangle direction doesn't matter for non-AO\n    }\n\n    function pushMeshColors(colors, ix, c, ao, aoValues, revAoVal) {\n        var ao00 = unpackAOMask(ao, 0, 0)\n        var ao10 = unpackAOMask(ao, 1, 0)\n        var ao11 = unpackAOMask(ao, 1, 1)\n        var ao01 = unpackAOMask(ao, 0, 1)\n        pushAOColor(colors, ix, c, ao00, aoValues, revAoVal)\n        pushAOColor(colors, ix + 4, c, ao10, aoValues, revAoVal)\n        pushAOColor(colors, ix + 8, c, ao11, aoValues, revAoVal)\n        pushAOColor(colors, ix + 12, c, ao01, aoValues, revAoVal)\n\n        // this bit is pretty magical..\n        var triDir = true\n        if (ao00 === ao11) {\n            triDir = (ao01 === ao10) ? (ao01 === 2) : true\n        } else {\n            triDir = (ao01 === ao10) ? false : (ao00 + ao11 > ao01 + ao10)\n        }\n        return triDir\n    }\n\n    function sign(num) {\n        return (num > 0) ? 1 : -1\n    }\n\n\n\n\n    /* \n     *  packAOMask:\n     *\n     *    For a given face, find occlusion levels for each vertex, then\n     *    pack 4 such (2-bit) values into one Uint8 value\n     * \n     *  Occlusion levels:\n     *    1 is flat ground, 2 is partial occlusion, 3 is max (corners)\n     *    0 is \"reverse occlusion\" - an unoccluded exposed edge \n     *  Packing order var(bit offset):\n     *      a01(2)  -   a11(6)   ^  K\n     *        -     -            +> J\n     *      a00(0)  -   a10(4)\n     */\n\n    function packAOMask(data, ipos, ineg, j, k, skipReverse) {\n        var a00 = 1\n        var a01 = 1\n        var a10 = 1\n        var a11 = 1\n\n        // inc occlusion of vertex next to obstructed side\n        if (solidLookup[data.get(ipos, j + 1, k)]) { ++a10; ++a11 }\n        if (solidLookup[data.get(ipos, j - 1, k)]) { ++a00; ++a01 }\n        if (solidLookup[data.get(ipos, j, k + 1)]) { ++a01; ++a11 }\n        if (solidLookup[data.get(ipos, j, k - 1)]) { ++a00; ++a10 }\n\n        // facing into a solid (non-opaque) block?\n        var facingSolid = solidLookup[data.get(ipos, j, k)]\n        if (facingSolid) {\n            // always 2, or 3 in corners\n            a11 = (a11 === 3 || solidLookup[data.get(ipos, j + 1, k + 1)]) ? 3 : 2\n            a01 = (a01 === 3 || solidLookup[data.get(ipos, j - 1, k + 1)]) ? 3 : 2\n            a10 = (a10 === 3 || solidLookup[data.get(ipos, j + 1, k - 1)]) ? 3 : 2\n            a00 = (a00 === 3 || solidLookup[data.get(ipos, j - 1, k - 1)]) ? 3 : 2\n            return a11 << 6 | a10 << 4 | a01 << 2 | a00\n        }\n\n        // simpler logic if skipping reverse AO?\n        if (skipReverse) {\n            // treat corner as occlusion 3 only if not occluded already\n            if (a11 === 1 && (solidLookup[data.get(ipos, j + 1, k + 1)])) { a11 = 2 }\n            if (a01 === 1 && (solidLookup[data.get(ipos, j - 1, k + 1)])) { a01 = 2 }\n            if (a10 === 1 && (solidLookup[data.get(ipos, j + 1, k - 1)])) { a10 = 2 }\n            if (a00 === 1 && (solidLookup[data.get(ipos, j - 1, k - 1)])) { a00 = 2 }\n            return a11 << 6 | a10 << 4 | a01 << 2 | a00\n        }\n\n        // check each corner, and if not present do reverse AO\n        if (a11 === 1) {\n            if (solidLookup[data.get(ipos, j + 1, k + 1)]) {\n                a11 = 2\n            } else if (!(solidLookup[data.get(ineg, j, k + 1)]) ||\n                !(solidLookup[data.get(ineg, j + 1, k)]) ||\n                !(solidLookup[data.get(ineg, j + 1, k + 1)])) {\n                a11 = 0\n            }\n        }\n\n        if (a10 === 1) {\n            if (solidLookup[data.get(ipos, j + 1, k - 1)]) {\n                a10 = 2\n            } else if (!(solidLookup[data.get(ineg, j, k - 1)]) ||\n                !(solidLookup[data.get(ineg, j + 1, k)]) ||\n                !(solidLookup[data.get(ineg, j + 1, k - 1)])) {\n                a10 = 0\n            }\n        }\n\n        if (a01 === 1) {\n            if (solidLookup[data.get(ipos, j - 1, k + 1)]) {\n                a01 = 2\n            } else if (!(solidLookup[data.get(ineg, j, k + 1)]) ||\n                !(solidLookup[data.get(ineg, j - 1, k)]) ||\n                !(solidLookup[data.get(ineg, j - 1, k + 1)])) {\n                a01 = 0\n            }\n        }\n\n        if (a00 === 1) {\n            if (solidLookup[data.get(ipos, j - 1, k - 1)]) {\n                a00 = 2\n            } else if (!(solidLookup[data.get(ineg, j, k - 1)]) ||\n                !(solidLookup[data.get(ineg, j - 1, k)]) ||\n                !(solidLookup[data.get(ineg, j - 1, k - 1)])) {\n                a00 = 0\n            }\n        }\n\n        return a11 << 6 | a10 << 4 | a01 << 2 | a00\n    }\n\n\n\n    // unpack (2 bit) ao value from ao mask\n    // see above for details\n    function unpackAOMask(aomask, jpos, kpos) {\n        var offset = jpos ? (kpos ? 6 : 4) : (kpos ? 2 : 0)\n        return aomask >> offset & 3\n    }\n\n\n    // premultiply vertex colors by value depending on AO level\n    // then push them into color array\n    function pushAOColor(colors, ix, baseCol, ao, aoVals, revAoVal) {\n        var mult = (ao === 0) ? revAoVal : aoVals[ao - 1]\n        colors[ix] = baseCol[0] * mult\n        colors[ix + 1] = baseCol[1] * mult\n        colors[ix + 2] = baseCol[2] * mult\n        colors[ix + 3] = 1\n    }\n\n}\n\n\n\n\n\n\n\nimport { makeProfileHook } from './util'\nvar profile_hook = (PROFILE_EVERY) ?\n    makeProfileHook(PROFILE_EVERY, 'Terrain meshing') : () => { }\n","/** \n * The Registry class is found at [[Registry | `noa.registry`]].\n * @module noa.registry\n */\n\n\nvar defaults = {\n    texturePath: ''\n}\n\n// voxel ID now uses the whole Uint16Array element\nvar MAX_BLOCK_ID = (1 << 16) - 1\n\n\n\n\n\n/**\n * `noa.registry` - Where you register your voxel types, \n * materials, properties, and events.\n * \n * This module uses the following default options (from the options\n * object passed to the [[Engine]]):\n * \n * ```js\n * var defaults = {\n *     texturePath: ''\n * }\n * ```\n*/\n\nexport class Registry {\n\n\n    /** \n     * @internal \n     * @param {import('../index').Engine} noa\n    */\n    constructor(noa, opts) {\n        opts = Object.assign({}, defaults, opts)\n        /** @internal */\n        this.noa = noa\n\n        /** @internal */\n        this._texturePath = opts.texturePath\n\n        /** Maps block face material names to matIDs\n         * @type {Object.<string, number>} */\n        var matIDs = {}\n\n        // lookup arrays for block props and flags - all keyed by blockID\n        // fill in first value for the air block with id=0\n        var blockSolidity = [false]\n        var blockOpacity = [false]\n        var blockIsFluid = [false]\n        var blockIsObject = [false]\n        var blockProps = [null]     // less-often accessed properties\n        var blockMeshes = [null]    // custom mesh objects\n        var blockHandlers = [null]  // block event handlers\n        var blockIsPlain = [false]  // true if voxel is \"boring\" - solid/opaque, no special props\n\n        // this one is keyed by `blockID*6 + faceNumber`\n        var blockMats = [0, 0, 0, 0, 0, 0]\n\n        /** \n         * Lookup array of block face material properties - keyed by matID (not blockID)\n         * @typedef MatDef\n         * @prop {number[]} color\n         * @prop {number} alpha\n         * @prop {string} texture\n         * @prop {boolean} texHasAlpha\n         * @prop {number} atlasIndex\n         * @prop {*} renderMat\n         */\n        /** @type {MatDef[]} */\n        var matDefs = []\n\n\n        /* \n         * \n         *      Block registration methods\n         * \n        */\n\n\n\n        /**\n         * Register (by integer ID) a block type and its parameters.\n         *  `id` param: integer, currently 1..65535. Generally you should \n         * specify sequential values for blocks, without gaps, but this \n         * isn't technically required.\n         * \n         * @param {number} id - sequential integer ID (from 1)\n         * @param {Partial<BlockOptions>} [options] \n         * @returns the `id` value specified\n         */\n        this.registerBlock = function (id = 1, options = null) {\n            var defaults = new BlockOptions(options && options.fluid)\n            var opts = Object.assign({}, defaults, options || {})\n\n            // console.log('register block: ', id, opts)\n            if (id < 1 || id > MAX_BLOCK_ID) throw 'Block id out of range: ' + id\n\n            // if block ID is greater than current highest ID, \n            // register fake blocks to avoid holes in lookup arrays\n            while (id > blockSolidity.length) {\n                this.registerBlock(blockSolidity.length, {})\n            }\n\n            // flags default to solid, opaque, nonfluid\n            blockSolidity[id] = !!opts.solid\n            blockOpacity[id] = !!opts.opaque\n            blockIsFluid[id] = !!opts.fluid\n\n            // store any custom mesh\n            blockIsObject[id] = !!opts.blockMesh\n            blockMeshes[id] = opts.blockMesh || null\n\n            // parse out material parameter\n            // always store 6 material IDs per blockID, so material lookup is monomorphic\n            var mat = opts.material || null\n            var mats\n            if (!mat) {\n                mats = [null, null, null, null, null, null]\n            } else if (typeof mat == 'string') {\n                mats = [mat, mat, mat, mat, mat, mat]\n            } else if (mat.length && mat.length == 2) {\n                // interpret as [top/bottom, sides]\n                mats = [mat[1], mat[1], mat[0], mat[0], mat[1], mat[1]]\n            } else if (mat.length && mat.length == 3) {\n                // interpret as [top, bottom, sides]\n                mats = [mat[2], mat[2], mat[0], mat[1], mat[2], mat[2]]\n            } else if (mat.length && mat.length == 6) {\n                // interpret as [-x, +x, -y, +y, -z, +z]\n                mats = mat\n            } else throw 'Invalid material parameter: ' + mat\n\n            // argument is material name, but store as material id, allocating one if needed\n            for (var i = 0; i < 6; ++i) {\n                blockMats[id * 6 + i] = getMaterialId(this, matIDs, mats[i], true)\n            }\n\n            // props data object - currently only used for fluid properties\n            blockProps[id] = {}\n\n            // if block is fluid, initialize properties if needed\n            if (blockIsFluid[id]) {\n                blockProps[id].fluidDensity = opts.fluidDensity\n                blockProps[id].viscosity = opts.viscosity\n            }\n\n            // event callbacks\n            var hasHandler = opts.onLoad || opts.onUnload || opts.onSet || opts.onUnset || opts.onCustomMeshCreate\n            blockHandlers[id] = (hasHandler) ? new BlockCallbackHolder(opts) : null\n\n            // special lookup for \"plain\"-ness\n            // plain means solid, opaque, not fluid, no mesh or events\n            var isPlain = blockSolidity[id] && blockOpacity[id]\n                && !hasHandler && !blockIsFluid[id] && !blockIsObject[id]\n            blockIsPlain[id] = isPlain\n\n            return id\n        }\n\n\n\n\n        /**\n         * Register (by name) a material and its parameters.\n         * \n         * @param {string} name of this material\n         * @param {Partial<MaterialOptions>} [options]\n         */\n\n        this.registerMaterial = function (name = '?', options = null) {\n            // catch calls to earlier signature\n            if (Array.isArray(options) || arguments[2]) {\n                throw 'This API changed signatures in v0.33, please use: `noa.registry.registerMaterial(\"name\", optionsObj)`'\n            }\n\n            var opts = Object.assign(new MaterialOptions(), options || {})\n            var matID = matIDs[name] || matDefs.length\n            matIDs[name] = matID\n\n            var alpha = 1.0\n            var color = opts.color || [1.0, 1.0, 1.0]\n            if (color.length === 4) alpha = color.pop()\n\n            matDefs[matID] = {\n                color,\n                alpha,\n                texture: opts.textureURL ? this._texturePath + opts.textureURL : '',\n                texHasAlpha: !!opts.texHasAlpha,\n                atlasIndex: opts.atlasIndex,\n                renderMat: opts.renderMaterial,\n            }\n            return matID\n        }\n\n\n\n        /*\n         *      quick accessors for querying block ID stuff\n         */\n\n        /** \n         * block solidity (as in physics) \n         * @param id\n         */\n        this.getBlockSolidity = function (id) {\n            return blockSolidity[id]\n        }\n\n        /**\n         * block opacity - whether it obscures the whole voxel (dirt) or \n         * can be partially seen through (like a fencepost, etc)\n         * @param id\n         */\n        this.getBlockOpacity = function (id) {\n            return blockOpacity[id]\n        }\n\n        /** \n         * block is fluid or not\n         * @param id\n         */\n        this.getBlockFluidity = function (id) {\n            return blockIsFluid[id]\n        }\n\n        /** \n         * Get block property object passed in at registration\n         * @param id\n         */\n        this.getBlockProps = function (id) {\n            return blockProps[id]\n        }\n\n        // look up a block ID's face material\n        // dir is a value 0..5: [ +x, -x, +y, -y, +z, -z ]\n        this.getBlockFaceMaterial = function (blockId, dir) {\n            return blockMats[blockId * 6 + dir]\n        }\n\n\n\n\n\n        // look up material color given ID\n        this.getMaterialColor = function (matID) {\n            return matDefs[matID].color\n        }\n\n        // look up material texture given ID\n        this.getMaterialTexture = function (matID) {\n            return matDefs[matID].texture\n        }\n\n        // look up material's properties: color, alpha, texture, textureAlpha\n        this.getMaterialData = function (matID) {\n            return matDefs[matID]\n        }\n\n\n\n\n\n        /*\n         * \n         *   Meant for internal use within the engine\n         * \n         */\n\n\n        // internal access to lookup arrays\n        /** @internal */\n        this._solidityLookup = blockSolidity\n        /** @internal */\n        this._opacityLookup = blockOpacity\n        /** @internal */\n        this._fluidityLookup = blockIsFluid\n        /** @internal */\n        this._objectLookup = blockIsObject\n        /** @internal */\n        this._blockMeshLookup = blockMeshes\n        /** @internal */\n        this._blockHandlerLookup = blockHandlers\n        /** @internal */\n        this._blockIsPlainLookup = blockIsPlain\n\n\n\n\n\n\n        // look up color used for vertices of blocks of given material\n        // - i.e. white if it has a texture, color otherwise\n        /** @internal */\n        this._getMaterialVertexColor = (matID) => {\n            if (matDefs[matID].texture) return white\n            return matDefs[matID].color\n        }\n        var white = [1, 1, 1]\n\n\n\n\n\n        /*\n         * \n         *      default initialization\n         * \n         */\n\n        // add a default material and set ID=1 to it\n        // this is safe since registering new block data overwrites the old\n        this.registerMaterial('dirt', { color: [0.4, 0.3, 0] })\n        this.registerBlock(1, { material: 'dirt' })\n\n\n\n    }\n\n}\n\n/*\n * \n *          helpers\n * \n*/\n\n\n\n// look up material ID given its name\n// if lazy is set, pre-register the name and return an ID\nfunction getMaterialId(reg, matIDs, name, lazyInit) {\n    if (!name) return 0\n    var id = matIDs[name]\n    if (id === undefined && lazyInit) id = reg.registerMaterial(name)\n    return id\n}\n\n\n\n// data class for holding block callback references\nfunction BlockCallbackHolder(opts) {\n    this.onLoad = opts.onLoad || null\n    this.onUnload = opts.onUnload || null\n    this.onSet = opts.onSet || null\n    this.onUnset = opts.onUnset || null\n    this.onCustomMeshCreate = opts.onCustomMeshCreate || null\n}\n\n\n\n\n/**\n * Default options when registering a block type\n */\nfunction BlockOptions(isFluid = false) {\n    /** Solidity for physics purposes */\n    this.solid = (isFluid) ? false : true\n    /** Whether the block fully obscures neighboring blocks */\n    this.opaque = (isFluid) ? false : true\n    /** whether a nonsolid block is a fluid (buoyant, viscous..) */\n    this.fluid = false\n    /** The block material(s) for this voxel's faces. May be:\n     *   * one (String) material name\n     *   * array of 2 names: [top/bottom, sides]\n     *   * array of 3 names: [top, bottom, sides]\n     *   * array of 6 names: [-x, +x, -y, +y, -z, +z]\n     * @type {string|string[]}\n    */\n    this.material = null\n    /** Specifies a custom mesh for this voxel, instead of terrain  */\n    this.blockMesh = null\n    /** Fluid parameter for fluid blocks */\n    this.fluidDensity = 1.0\n    /** Fluid parameter for fluid blocks */\n    this.viscosity = 0.5\n    /** @type {(x:number, y:number, z:number) => void} */\n    this.onLoad = null\n    /** @type {(x:number, y:number, z:number) => void} */\n    this.onUnload = null\n    /** @type {(x:number, y:number, z:number) => void} */\n    this.onSet = null\n    /** @type {(x:number, y:number, z:number) => void} */\n    this.onUnset = null\n    /** @type {(mesh:TransformNode, x:number, y:number, z:number) => void} */\n    this.onCustomMeshCreate = null\n}\n\n/** @typedef {import('@babylonjs/core/Meshes').TransformNode} TransformNode */\n\n\n/**\n * Default options when registering a Block Material\n */\nfunction MaterialOptions() {\n    /** An array of 0..1 floats, either [R,G,B] or [R,G,B,A]\n     * @type {number[]}\n     */\n    this.color = null\n    /** Filename of texture image, if any\n     * @type {string}\n     */\n    this.textureURL = null\n    /** Whether the texture image has alpha */\n    this.texHasAlpha = false\n    /** Index into a (vertical strip) texture atlas, if applicable */\n    this.atlasIndex = -1\n    /**\n     * An optional Babylon.js `Material`. If specified, terrain for this voxel\n     * will be rendered with the supplied material (this can impact performance).\n     */\n    this.renderMaterial = null\n}\n","/** \n * @module \n * @internal exclude this file from API docs \n*/\n\nimport { Vector3 } from '@babylonjs/core/Maths/math.vector'\nimport { Octree } from '@babylonjs/core/Culling/Octrees/octree'\nimport { OctreeBlock } from '@babylonjs/core/Culling/Octrees/octreeBlock'\nimport { OctreeSceneComponent } from '@babylonjs/core/Culling/Octrees/'\n\nimport { locationHasher, removeUnorderedListItem } from './util'\n\n\n/*\n * \n * \n * \n *          simple class to manage scene octree and octreeBlocks\n * \n * \n * \n*/\n\nexport class SceneOctreeManager {\n\n    constructor(rendering, blockSize) {\n        var scene = rendering._scene\n        scene._addComponent(new OctreeSceneComponent(scene))\n\n        // the root octree object\n        var octree = new Octree(NOP)\n        scene._selectionOctree = octree\n        octree.blocks = []\n        var octBlocksHash = {}\n\n\n        /*\n         * \n         *          public API\n         * \n        */\n\n        this.rebase = (offset) => { recurseRebaseBlocks(octree, offset) }\n        this.includesMesh = (mesh) => {\n            return (mesh._noaContainingBlock || mesh._noaIsDynamicContent)\n        }\n\n        this.addMesh = (mesh, isStatic, pos, chunk) => {\n            if (!isStatic) {\n                mesh._noaIsDynamicContent = true\n                octree.dynamicContent.push(mesh)\n                return\n            }\n            // octreeBlock-space integer coords of mesh position, and hashed key\n            var ci = Math.floor(pos[0] / bs)\n            var cj = Math.floor(pos[1] / bs)\n            var ck = Math.floor(pos[2] / bs)\n            var mapKey = locationHasher(ci, cj, ck)\n\n            // get or create octreeBlock\n            var block = octBlocksHash[mapKey]\n            if (!block) {\n                // lower corner of new octree block position, in global/local\n                var gloc = [ci * bs, cj * bs, ck * bs]\n                var loc = [0, 0, 0]\n                rendering.noa.globalToLocal(gloc, null, loc)\n                // make the new octree block and store it\n                block = makeOctreeBlock(loc, bs)\n                octree.blocks.push(block)\n                octBlocksHash[mapKey] = block\n                block._noaMapKey = mapKey\n            }\n\n            // do the actual adding logic\n            block.entries.push(mesh)\n            mesh._noaContainingBlock = block\n\n            // rely on octrees for selection, skipping bounds checks\n            mesh.alwaysSelectAsActiveMesh = true\n        }\n\n        this.removeMesh = (mesh) => {\n            if (mesh._noaIsDynamicContent) {\n                mesh._noaIsDynamicContent = null\n                removeUnorderedListItem(octree.dynamicContent, mesh)\n            }\n            if (mesh._noaContainingBlock) {\n                mesh._noaContainingChunk = null\n                var block = mesh._noaContainingBlock\n                removeUnorderedListItem(block.entries, mesh)\n                if (block.entries.length === 0) {\n                    delete octBlocksHash[block._noaMapKey]\n                    removeUnorderedListItem(octree.blocks, block)\n                }\n            }\n        }\n\n        /*\n         * \n         *          internals\n         * \n        */\n\n        var NOP = () => { }\n        var bs = blockSize * rendering.noa.world._chunkSize\n\n        var recurseRebaseBlocks = (parent, offset) => {\n            parent.blocks.forEach(child => {\n                child.minPoint.subtractInPlace(offset)\n                child.maxPoint.subtractInPlace(offset)\n                child._boundingVectors.forEach(v => v.subtractInPlace(offset))\n                if (child.blocks) recurseRebaseBlocks(child, offset)\n            })\n        }\n\n        var makeOctreeBlock = (minPt, size) => {\n            var min = new Vector3(minPt[0], minPt[1], minPt[2])\n            var max = new Vector3(minPt[0] + size, minPt[1] + size, minPt[2] + size)\n            return new OctreeBlock(min, max, undefined, undefined, undefined, NOP)\n        }\n\n    }\n\n}\n","/** \n * The Rendering class is found at [[Rendering | `noa.rendering`]].\n * @module noa.rendering\n */\n\n\nvar glvec3 = require('gl-vec3')\n\nimport { SceneOctreeManager } from './sceneOctreeManager'\n\nimport { Scene } from '@babylonjs/core/scene'\nimport { FreeCamera } from '@babylonjs/core/Cameras/freeCamera'\nimport { Engine } from '@babylonjs/core/Engines/engine'\nimport { HemisphericLight } from '@babylonjs/core/Lights/hemisphericLight'\nimport { StandardMaterial } from '@babylonjs/core/Materials/standardMaterial'\nimport { Color3, Color4 } from '@babylonjs/core/Maths/math.color'\nimport { Vector3 } from '@babylonjs/core/Maths/math.vector'\nimport { TransformNode } from '@babylonjs/core/Meshes/transformNode'\nimport { CreateLines } from '@babylonjs/core/Meshes/Builders/linesBuilder'\nimport { CreatePlane } from '@babylonjs/core/Meshes/Builders/planeBuilder'\n\n\n\n\n// profiling flag\nvar PROFILE = 0\n\n\n\nvar defaults = {\n    showFPS: false,\n    antiAlias: true,\n    clearColor: [0.8, 0.9, 1],\n    ambientColor: [1, 1, 1],\n    lightDiffuse: [1, 1, 1],\n    lightSpecular: [1, 1, 1],\n    groundLightColor: [0.5, 0.5, 0.5],\n    useAO: true,\n    AOmultipliers: [0.93, 0.8, 0.5],\n    reverseAOmultiplier: 1.0,\n    preserveDrawingBuffer: true,\n    octreeBlockSize: 2,\n    renderOnResize: true,\n}\n\n\n\n/**\n * `noa.rendering` - \n * Manages all rendering, and the BABYLON scene, materials, etc.\n * \n * This module uses the following default options (from the options\n * object passed to the [[Engine]]):\n * ```js\n * {\n *     showFPS: false,\n *     antiAlias: true,\n *     clearColor: [0.8, 0.9, 1],\n *     ambientColor: [1, 1, 1],\n *     lightDiffuse: [1, 1, 1],\n *     lightSpecular: [1, 1, 1],\n *     groundLightColor: [0.5, 0.5, 0.5],\n *     useAO: true,\n *     AOmultipliers: [0.93, 0.8, 0.5],\n *     reverseAOmultiplier: 1.0,\n *     preserveDrawingBuffer: true,\n *     octreeBlockSize: 2,\n *     renderOnResize: true,\n * }\n * ```\n*/\n\nexport class Rendering {\n\n    /** \n     * @internal \n     * @param {import('../index').Engine} noa  \n    */\n    constructor(noa, opts, canvas) {\n        opts = Object.assign({}, defaults, opts)\n        /** @internal */\n        this.noa = noa\n\n        // settings\n        /** Whether to redraw the screen when the game is resized while paused */\n        this.renderOnResize = !!opts.renderOnResize\n\n        // internals\n        /** @internal */\n        this.useAO = !!opts.useAO\n        /** @internal */\n        this.aoVals = opts.AOmultipliers\n        /** @internal */\n        this.revAoVal = opts.reverseAOmultiplier\n        /** @internal */\n        this.meshingCutoffTime = 6 // ms\n\n        // set up babylon scene\n        /** @internal */\n        this._scene = null\n        /** @internal */\n        this._engine = null\n        /** @internal */\n        this._octreeManager = null\n        this.initScene(canvas, opts)\n\n        // for debugging\n        if (opts.showFPS) setUpFPS()\n    }\n\n\n\n\n    // Constructor helper - set up the Babylon.js scene and basic components\n    initScene(canvas, opts) {\n\n        // init internal properties\n        this._engine = new Engine(canvas, opts.antiAlias, {\n            preserveDrawingBuffer: opts.preserveDrawingBuffer,\n        })\n        this._scene = new Scene(this._engine)\n        var scene = this._scene\n        // remove built-in listeners\n        scene.detachControl()\n\n        // octree manager class\n        var blockSize = Math.round(opts.octreeBlockSize)\n        this._octreeManager = new SceneOctreeManager(this, blockSize)\n\n        // camera, and a node to hold it and accumulate rotations\n        this._cameraHolder = new TransformNode('camHolder', scene)\n        this._camera = new FreeCamera('camera', new Vector3(0, 0, 0), scene)\n        this._camera.parent = this._cameraHolder\n        this._camera.minZ = .01\n\n        // plane obscuring the camera - for overlaying an effect on the whole view\n        this._camScreen = CreatePlane('camScreen', { size: 10 }, scene)\n        this.addMeshToScene(this._camScreen)\n        this._camScreen.position.z = .1\n        this._camScreen.parent = this._camera\n        this._camScreenMat = this.makeStandardMaterial('camscreenmat')\n        this._camScreen.material = this._camScreenMat\n        this._camScreen.setEnabled(false)\n        this._camScreenMat.freeze()\n        this._camLocBlock = 0\n\n        // apply some defaults\n        var lightVec = new Vector3(0.1, 1, 0.3)\n        this._light = new HemisphericLight('light', lightVec, scene)\n\n        function arrToColor(a) { return new Color3(a[0], a[1], a[2]) }\n        scene.clearColor = Color4.FromColor3(arrToColor(opts.clearColor))\n        scene.ambientColor = arrToColor(opts.ambientColor)\n        this._light.diffuse = arrToColor(opts.lightDiffuse)\n        this._light.specular = arrToColor(opts.lightSpecular)\n        this._light.groundColor = arrToColor(opts.groundLightColor)\n\n        // scene options\n        scene.skipPointerMovePicking = true\n    }\n}\n\n\n\n/*\n *   PUBLIC API \n */\n\n\n/** The Babylon `scene` object representing the game world. */\nRendering.prototype.getScene = function () {\n    return this._scene\n}\n\n// per-tick listener for rendering-related stuff\n/** @internal */\nRendering.prototype.tick = function (dt) {\n    // nothing here at the moment\n}\n\n\n\n\n/** @internal */\nRendering.prototype.render = function () {\n    profile_hook('start')\n    updateCameraForRender(this)\n    profile_hook('updateCamera')\n    this._engine.beginFrame()\n    profile_hook('beginFrame')\n    this._scene.render()\n    profile_hook('render')\n    fps_hook()\n    this._engine.endFrame()\n    profile_hook('endFrame')\n    profile_hook('end')\n}\n\n\n/** @internal */\nRendering.prototype.postRender = function () {\n    // nothing currently\n}\n\n\n/** @internal */\nRendering.prototype.resize = function () {\n    this._engine.resize()\n    if (this.noa._paused && this.renderOnResize) {\n        this._scene.render()\n    }\n}\n\n\n/** @internal */\nRendering.prototype.highlightBlockFace = function (show, posArr, normArr) {\n    var m = getHighlightMesh(this)\n    if (show) {\n        // floored local coords for highlight mesh\n        this.noa.globalToLocal(posArr, null, hlpos)\n        // offset to avoid z-fighting, bigger when camera is far away\n        var dist = glvec3.dist(this.noa.camera._localGetPosition(), hlpos)\n        var slop = 0.001 + 0.001 * dist\n        for (var i = 0; i < 3; i++) {\n            if (normArr[i] === 0) {\n                hlpos[i] += 0.5\n            } else {\n                hlpos[i] += (normArr[i] > 0) ? 1 + slop : -slop\n            }\n        }\n        m.position.copyFromFloats(hlpos[0], hlpos[1], hlpos[2])\n        m.rotation.x = (normArr[1]) ? Math.PI / 2 : 0\n        m.rotation.y = (normArr[0]) ? Math.PI / 2 : 0\n    }\n    m.setEnabled(show)\n}\nvar hlpos = []\n\n\n\n\n/**\n * Add a mesh to the scene's octree setup so that it renders. \n * \n * @param mesh the mesh to add to the scene\n * @param isStatic pass in true if mesh never moves (i.e. change octree blocks)\n * @param pos (optional) global position where the mesh should be\n * @param containingChunk (optional) chunk to which the mesh is statically bound\n */\nRendering.prototype.addMeshToScene = function (mesh, isStatic = false, pos = null, containingChunk = null) {\n    // exit silently if mesh has already been added and not removed\n    if (this._octreeManager.includesMesh(mesh)) return\n\n    // find local position for mesh and move it there (unless it's parented)\n    if (!mesh.parent) {\n        if (!pos) pos = [mesh.position.x, mesh.position.y, mesh.position.z]\n        var lpos = []\n        this.noa.globalToLocal(pos, null, lpos)\n        mesh.position.copyFromFloats(lpos[0], lpos[1], lpos[2])\n    }\n\n    // save CPU by freezing terrain meshes\n    if (isStatic) {\n        mesh.freezeWorldMatrix()\n        if (mesh.freezeNormals) mesh.freezeNormals()\n        mesh.doNotSyncBoundingInfo = true\n    }\n\n    // add to the octree, and add dispose handler to remove it\n    this._octreeManager.addMesh(mesh, isStatic, pos, containingChunk)\n    mesh.onDisposeObservable.add(() => {\n        this._octreeManager.removeMesh(mesh)\n    })\n}\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Create a default standardMaterial:      \n * flat, nonspecular, fully reflects diffuse and ambient light\n */\nRendering.prototype.makeStandardMaterial = function (name) {\n    var mat = new StandardMaterial(name, this._scene)\n    mat.specularColor.copyFromFloats(0, 0, 0)\n    mat.ambientColor.copyFromFloats(1, 1, 1)\n    mat.diffuseColor.copyFromFloats(1, 1, 1)\n    this.postMaterialCreationHook(mat)\n    return mat\n}\n\n/** Exposed hook for if the client wants to do something to newly created materials */\nRendering.prototype.postMaterialCreationHook = function (mat) { }\n\n\n\n\n\n\n/*\n *\n *   INTERNALS\n *\n */\n\n\n\n\n\n/*\n *\n * \n *   ACCESSORS FOR CHUNK ADD/REMOVAL/MESHING\n *\n * \n */\n/** @internal */\nRendering.prototype.prepareChunkForRendering = function (chunk) {\n    // currently no logic needed here, but I may need it again...\n}\n\n/** @internal */\nRendering.prototype.disposeChunkForRendering = function (chunk) {\n    // nothing currently\n}\n\n\n\n\n\n\n// change world origin offset, and rebase everything with a position\n/** @internal */\nRendering.prototype._rebaseOrigin = function (delta) {\n    var dvec = new Vector3(delta[0], delta[1], delta[2])\n\n    this._scene.meshes.forEach(mesh => {\n        // parented meshes don't live in the world coord system\n        if (mesh.parent) return\n\n        // move each mesh by delta (even though most are managed by components)\n        mesh.position.subtractInPlace(dvec)\n\n        if (mesh.isWorldMatrixFrozen) {\n            // paradoxically this unfreezes, then re-freezes the matrix\n            mesh.freezeWorldMatrix()\n        }\n    })\n\n    // updates position of all octree blocks\n    this._octreeManager.rebase(dvec)\n}\n\n\n\n\n\n// updates camera position/rotation to match settings from noa.camera\n\nfunction updateCameraForRender(self) {\n    var cam = self.noa.camera\n    var tgtLoc = cam._localGetTargetPosition()\n    self._cameraHolder.position.copyFromFloats(tgtLoc[0], tgtLoc[1], tgtLoc[2])\n    self._cameraHolder.rotation.x = cam.pitch\n    self._cameraHolder.rotation.y = cam.heading\n    self._camera.position.z = -cam.currentZoom\n\n    // applies screen effect when camera is inside a transparent voxel\n    var cloc = cam._localGetPosition()\n    var off = self.noa.worldOriginOffset\n    var cx = Math.floor(cloc[0] + off[0])\n    var cy = Math.floor(cloc[1] + off[1])\n    var cz = Math.floor(cloc[2] + off[2])\n    var id = self.noa.getBlock(cx, cy, cz)\n    checkCameraEffect(self, id)\n}\n\n\n\n//  If camera's current location block id has alpha color (e.g. water), apply/remove an effect\n\nfunction checkCameraEffect(self, id) {\n    if (id === self._camLocBlock) return\n    if (id === 0) {\n        self._camScreen.setEnabled(false)\n    } else {\n        var matId = self.noa.registry.getBlockFaceMaterial(id, 0)\n        if (matId) {\n            var matData = self.noa.registry.getMaterialData(matId)\n            var col = matData.color\n            var alpha = matData.alpha\n            if (col && alpha && alpha < 1) {\n                self._camScreenMat.diffuseColor.set(0, 0, 0)\n                self._camScreenMat.ambientColor.set(col[0], col[1], col[2])\n                self._camScreenMat.alpha = alpha\n                self._camScreen.setEnabled(true)\n            }\n        }\n    }\n    self._camLocBlock = id\n}\n\n\n\n\n\n\n// make or get a mesh for highlighting active voxel\nfunction getHighlightMesh(rendering) {\n    var mesh = rendering._highlightMesh\n    if (!mesh) {\n        mesh = CreatePlane(\"highlight\", { size: 1.0 }, rendering._scene)\n        var hlm = rendering.makeStandardMaterial('highlightMat')\n        hlm.backFaceCulling = false\n        hlm.emissiveColor = new Color3(1, 1, 1)\n        hlm.alpha = 0.2\n        hlm.freeze()\n        mesh.material = hlm\n\n        // outline\n        var s = 0.5\n        var lines = CreateLines(\"hightlightLines\", {\n            points: [\n                new Vector3(s, s, 0),\n                new Vector3(s, -s, 0),\n                new Vector3(-s, -s, 0),\n                new Vector3(-s, s, 0),\n                new Vector3(s, s, 0)\n            ]\n        }, rendering._scene)\n        lines.color = new Color3(1, 1, 1)\n        lines.parent = mesh\n\n        rendering.addMeshToScene(mesh)\n        rendering.addMeshToScene(lines)\n        rendering._highlightMesh = mesh\n    }\n    return mesh\n}\n\n\n\n\n\n\n\n\n\n\n/*\n * \n *      sanity checks:\n * \n */\n/** @internal */\nRendering.prototype.debug_SceneCheck = function () {\n    var meshes = this._scene.meshes\n    var octree = this._scene._selectionOctree\n    var dyns = octree.dynamicContent\n    var octs = []\n    var numOcts = 0\n    var numSubs = 0\n    var mats = this._scene.materials\n    var allmats = []\n    mats.forEach(mat => {\n        // @ts-ignore\n        if (mat.subMaterials) mat.subMaterials.forEach(mat => allmats.push(mat))\n        else allmats.push(mat)\n    })\n    octree.blocks.forEach(function (block) {\n        numOcts++\n        block.entries.forEach(m => octs.push(m))\n    })\n    meshes.forEach(function (m) {\n        if (m.isDisposed) warn(m, 'disposed mesh in scene')\n        if (empty(m)) return\n        if (missing(m, dyns, octs)) warn(m, 'non-empty mesh missing from octree')\n        if (!m.material) { warn(m, 'non-empty scene mesh with no material'); return }\n        numSubs += (m.subMeshes) ? m.subMeshes.length : 1\n        // @ts-ignore\n        var mats = m.material.subMaterials || [m.material]\n        mats.forEach(function (mat) {\n            if (missing(mat, mats)) warn(mat, 'mesh material not in scene')\n        })\n    })\n    var unusedMats = []\n    allmats.forEach(mat => {\n        var used = false\n        meshes.forEach(mesh => {\n            if (mesh.material === mat) used = true\n            if (!mesh.material) return\n            // @ts-ignore\n            var mats = mesh.material.subMaterials || [mesh.material]\n            if (mats.includes(mat)) used = true\n        })\n        if (!used) unusedMats.push(mat.name)\n    })\n    if (unusedMats.length) {\n        console.warn('Materials unused by any mesh: ', unusedMats.join(', '))\n    }\n    dyns.forEach(function (m) {\n        if (missing(m, meshes)) warn(m, 'octree/dynamic mesh not in scene')\n    })\n    octs.forEach(function (m) {\n        if (missing(m, meshes)) warn(m, 'octree block mesh not in scene')\n    })\n    var avgPerOct = Math.round(10 * octs.length / numOcts) / 10\n    console.log('meshes - octree:', octs.length, '  dynamic:', dyns.length,\n        '   subMeshes:', numSubs,\n        '   avg meshes/octreeBlock:', avgPerOct)\n\n    function warn(obj, msg) { console.warn(obj.name + ' --- ' + msg) }\n\n    function empty(mesh) { return (mesh.getIndices().length === 0) }\n\n    function missing(obj, list1, list2) {\n        if (!obj) return false\n        if (list1.includes(obj)) return false\n        if (list2 && list2.includes(obj)) return false\n        return true\n    }\n    return 'done.'\n}\n\n\n/** @internal */\nRendering.prototype.debug_MeshCount = function () {\n    var ct = {}\n    this._scene.meshes.forEach(m => {\n        var n = m.name || ''\n        n = n.replace(/-\\d+.*/, '#')\n        n = n.replace(/\\d+.*/, '#')\n        n = n.replace(/(rotHolder|camHolder|camScreen)/, 'rendering use')\n        n = n.replace(/atlas sprite .*/, 'atlas sprites')\n        ct[n] = ct[n] || 0\n        ct[n]++\n    })\n    for (var s in ct) console.log('   ' + (ct[s] + '       ').substr(0, 7) + s)\n}\n\n\n\n\n\n\n\nimport { makeProfileHook } from './util'\nvar profile_hook = (PROFILE) ?\n    makeProfileHook(200, 'render internals') : () => { }\n\n\n\nvar fps_hook = function () { }\n\nfunction setUpFPS() {\n    var div = document.createElement('div')\n    div.id = 'noa_fps'\n    div.style.position = 'absolute'\n    div.style.top = '0'\n    div.style.right = '0'\n    div.style.zIndex = '0'\n    div.style.color = 'white'\n    div.style.backgroundColor = 'rgba(0,0,0,0.5)'\n    div.style.font = '14px monospace'\n    div.style.textAlign = 'center'\n    div.style.minWidth = '2em'\n    div.style.margin = '4px'\n    document.body.appendChild(div)\n    var every = 1000\n    var ct = 0\n    var longest = 0\n    var start = performance.now()\n    var last = start\n    fps_hook = function () {\n        ct++\n        var nt = performance.now()\n        if (nt - last > longest) longest = nt - last\n        last = nt\n        if (nt - start < every) return\n        var fps = Math.round(ct / (nt - start) * 1000)\n        var min = Math.round(1 / longest * 1000)\n        div.innerHTML = fps + '<br>' + min\n        ct = 0\n        longest = 0\n        start = nt\n    }\n}\n","\nvar aabb = require('aabb-3d')\nvar vec3 = require('gl-vec3')\n\nvar DEBUG = 0\n\n\n\n/*\n *    RIGID BODY - internal data structure\n *  Only AABB bodies right now. Someday will likely need spheres?\n*/\n\nexport class RigidBody {\n    constructor(_aabb, mass, friction, restitution, gravMult, onCollide, autoStep) {\n        this.aabb = new aabb(_aabb.base, _aabb.vec) // clone\n        this.mass = mass\n        this.friction = friction\n        this.restitution = restitution\n        this.gravityMultiplier = gravMult\n        this.onCollide = onCollide\n        this.autoStep = !!autoStep\n        this.airDrag = -1   // overrides global airDrag when >= 0\n        this.fluidDrag = -1 // overrides global fluidDrag when >= 0\n        this.onStep = null\n\n        // internal state\n        this.velocity = vec3.create()\n        this.resting = [0, 0, 0]\n        this.inFluid = false\n\n        // internals\n        /** @internal */\n        this._ratioInFluid = 0\n        /** @internal */\n        this._forces = vec3.create()\n        /** @internal */\n        this._impulses = vec3.create()\n        /** @internal */\n        this._sleepFrameCount = 10 | 0\n    }\n\n    setPosition(p) {\n        sanityCheck(p)\n        vec3.subtract(p, p, this.aabb.base)\n        this.aabb.translate(p)\n        this._markActive()\n    }\n    getPosition() {\n        return vec3.clone(this.aabb.base)\n    }\n    applyForce(f) {\n        sanityCheck(f)\n        vec3.add(this._forces, this._forces, f)\n        this._markActive()\n    }\n    applyImpulse(i) {\n        sanityCheck(i)\n        vec3.add(this._impulses, this._impulses, i)\n        this._markActive()\n    }\n\n    /** @internal */\n    _markActive() {\n        this._sleepFrameCount = 10 | 0\n    }\n\n\n\n    // temp\n    atRestX() { return this.resting[0] }\n    atRestY() { return this.resting[1] }\n    atRestZ() { return this.resting[2] }\n}\n\n\n\n\nvar sanityCheck = (v) => { }\nif (DEBUG) sanityCheck = (v) => {\n    if (isNaN(vec3.length(v))) throw 'Vector with NAN: ' + v\n}\n","\nvar aabb = require('aabb-3d')\nvar vec3 = require('gl-vec3')\nvar sweep = require('voxel-aabb-sweep')\n\nimport { RigidBody } from './rigidBody'\nexport { RigidBody }\n\n\nvar DEBUG = 0\n\n\nexport function DefaultOptions() {\n    this.airDrag = 0.1\n    this.fluidDrag = 0.4\n    this.fluidDensity = 2.0\n    this.gravity = [0, -10, 0]\n    this.minBounceImpulse = .5 // lowest collision impulse that bounces\n}\n\n\n\n\n/**\n *          Voxel Physics Engine\n * \n * Models a world of rigid bodies, to be integrated against\n * solid or liquid voxel terrain.\n * \n * Takes `testSolid(x,y,z)` function to query block solidity\n * Takes `testFluid(x,y,z)` function to query if a block is a fluid\n *  \n * The `options` argument can take the following params:\n * \n * ```js\n * {\n *     airDrag: 0.1,\n *     fluidDrag: 0.4,\n *     fluidDensity: 2.0,\n *     gravity: [0, -10, 0],\n *     minBounceImpulse: .5, // lowest collision impulse that bounces\n * }\n * ```\n * \n * @param {(x:number, y:number, z:number) => boolean} testSolid\n * @param {(x:number, y:number, z:number) => boolean} testFluid\n * \n*/\nexport function Physics(opts, testSolid, testFluid) {\n    opts = Object.assign(new DefaultOptions(), opts)\n\n    this.gravity = opts.gravity || [0, -10, 0]\n    this.airDrag = opts.airDrag || 0.1\n    this.fluidDensity = opts.fluidDensity || 2.0\n    this.fluidDrag = opts.fluidDrag || 0.4\n    this.minBounceImpulse = opts.minBounceImpulse\n    this.bodies = []\n\n    // collision function - TODO: abstract this into a setter?\n    this.testSolid = testSolid\n    this.testFluid = testFluid\n}\n\n\n/** \n * Adds a physics body to the simulation\n * @returns {RigidBody}\n*/\nPhysics.prototype.addBody = function (_aabb, mass, friction,\n    restitution, gravMult, onCollide) {\n    _aabb = _aabb || new aabb([0, 0, 0], [1, 1, 1])\n    if (typeof mass == 'undefined') mass = 1\n    if (typeof friction == 'undefined') friction = 1\n    if (typeof restitution == 'undefined') restitution = 0\n    if (typeof gravMult == 'undefined') gravMult = 1\n    var b = new RigidBody(_aabb, mass, friction, restitution, gravMult, onCollide)\n    this.bodies.push(b)\n    return b\n}\n\n/** Removes a body, by direct reference */\nPhysics.prototype.removeBody = function (b) {\n    var i = this.bodies.indexOf(b)\n    if (i < 0) return undefined\n    this.bodies.splice(i, 1)\n    b.aabb = b.onCollide = null\n}\n\n\n\n\n/*\n *    PHYSICS AND COLLISIONS\n*/\n\nvar a = vec3.create()\nvar dv = vec3.create()\nvar dx = vec3.create()\nvar impacts = vec3.create()\nvar oldResting = vec3.create()\n\n\n/* Ticks the simulation forwards in time. */\nPhysics.prototype.tick = function (dt) {\n    // convert dt to seconds\n    dt = dt / 1000\n    var noGravity = equals(0, vec3.squaredLength(this.gravity))\n    this.bodies.forEach(b => iterateBody(this, b, dt, noGravity))\n}\n\n\n\n/*\n *    PER-BODY MAIN PHYSICS ROUTINE\n*/\n\nfunction iterateBody(self, b, dt, noGravity) {\n    vec3.copy(oldResting, b.resting)\n\n    // treat bodies with <= mass as static\n    if (b.mass <= 0) {\n        vec3.set(b.velocity, 0, 0, 0)\n        vec3.set(b._forces, 0, 0, 0)\n        vec3.set(b._impulses, 0, 0, 0)\n        return\n    }\n\n    // skip bodies if static or no velocity/forces/impulses\n    var localNoGrav = noGravity || (b.gravityMultiplier === 0)\n    if (bodyAsleep(self, b, dt, localNoGrav)) return\n    b._sleepFrameCount--\n\n    // check if under water, if so apply buoyancy and drag forces\n    applyFluidForces(self, b)\n\n    // debug hooks\n    sanityCheck(b._forces)\n    sanityCheck(b._impulses)\n    sanityCheck(b.velocity)\n    sanityCheck(b.resting)\n\n    // semi-implicit Euler integration\n\n    // a = f/m + gravity*gravityMultiplier\n    vec3.scale(a, b._forces, 1 / b.mass)\n    vec3.scaleAndAdd(a, a, self.gravity, b.gravityMultiplier)\n\n    // dv = i/m + a*dt\n    // v1 = v0 + dv\n    vec3.scale(dv, b._impulses, 1 / b.mass)\n    vec3.scaleAndAdd(dv, dv, a, dt)\n    vec3.add(b.velocity, b.velocity, dv)\n\n    // apply friction based on change in velocity this frame\n    if (b.friction) {\n        applyFrictionByAxis(0, b, dv)\n        applyFrictionByAxis(1, b, dv)\n        applyFrictionByAxis(2, b, dv)\n    }\n\n    // linear air or fluid friction - effectively v *= drag\n    // body settings override global settings\n    var drag = (b.airDrag >= 0) ? b.airDrag : self.airDrag\n    if (b.inFluid) {\n        drag = (b.fluidDrag >= 0) ? b.fluidDrag : self.fluidDrag\n        drag *= 1 - (1 - b.ratioInFluid) ** 2\n    }\n    var mult = Math.max(1 - drag * dt / b.mass, 0)\n    vec3.scale(b.velocity, b.velocity, mult)\n\n    // x1-x0 = v1*dt\n    vec3.scale(dx, b.velocity, dt)\n\n    // clear forces and impulses for next timestep\n    vec3.set(b._forces, 0, 0, 0)\n    vec3.set(b._impulses, 0, 0, 0)\n\n    // cache old position for use in autostepping\n    if (b.autoStep) {\n        cloneAABB(tmpBox, b.aabb)\n    }\n\n    // sweeps aabb along dx and accounts for collisions\n    processCollisions(self, b.aabb, dx, b.resting)\n\n    // if autostep, and on ground, run collisions again with stepped up aabb\n    if (b.autoStep) {\n        tryAutoStepping(self, b, tmpBox, dx)\n    }\n\n    // Collision impacts. b.resting shows which axes had collisions:\n    for (var i = 0; i < 3; ++i) {\n        impacts[i] = 0\n        if (b.resting[i]) {\n            // count impact only if wasn't collided last frame\n            if (!oldResting[i]) impacts[i] = -b.velocity[i]\n            b.velocity[i] = 0\n        }\n    }\n    var mag = vec3.length(impacts)\n    if (mag > .001) { // epsilon\n        // send collision event - allows client to optionally change\n        // body's restitution depending on what terrain it hit\n        // event argument is impulse J = m * dv\n        vec3.scale(impacts, impacts, b.mass)\n        if (b.onCollide) b.onCollide(impacts)\n\n        // bounce depending on restitution and minBounceImpulse\n        if (b.restitution > 0 && mag > self.minBounceImpulse) {\n            vec3.scale(impacts, impacts, b.restitution)\n            b.applyImpulse(impacts)\n        }\n    }\n\n\n    // sleep check\n    var vsq = vec3.squaredLength(b.velocity)\n    if (vsq > 1e-5) b._markActive()\n}\n\n\n\n\n\n\n\n\n/*\n *    FLUIDS\n*/\n\nfunction applyFluidForces(self, body) {\n    // First pass at handling fluids. Assumes fluids are settled\n    //   thus, only check at corner of body, and only from bottom up\n    var box = body.aabb\n    var cx = Math.floor(box.base[0])\n    var cz = Math.floor(box.base[2])\n    var y0 = Math.floor(box.base[1])\n    var y1 = Math.floor(box.max[1])\n\n    if (!self.testFluid(cx, y0, cz)) {\n        body.inFluid = false\n        body.ratioInFluid = 0\n        return\n    }\n\n    // body is in a fluid - find out how much of body is submerged\n    var submerged = 1\n    var cy = y0 + 1\n    while (cy <= y1 && self.testFluid(cx, cy, cz)) {\n        submerged++\n        cy++\n    }\n    var fluidLevel = y0 + submerged\n    var heightInFluid = fluidLevel - box.base[1]\n    var ratioInFluid = heightInFluid / box.vec[1]\n    if (ratioInFluid > 1) ratioInFluid = 1\n    var vol = box.vec[0] * box.vec[1] * box.vec[2]\n    var displaced = vol * ratioInFluid\n    // bouyant force = -gravity * fluidDensity * volumeDisplaced\n    var f = _fluidVec\n    vec3.scale(f, self.gravity, -self.fluidDensity * displaced)\n    body.applyForce(f)\n\n    body.inFluid = true\n    body.ratioInFluid = ratioInFluid\n}\n\nvar _fluidVec = vec3.create()\n\n\n\n\n\n/*\n *    FRICTION\n*/\n\n\nfunction applyFrictionByAxis(axis, body, dvel) {\n    // friction applies only if moving into a touched surface\n    var restDir = body.resting[axis]\n    var vNormal = dvel[axis]\n    if (restDir === 0) return\n    if (restDir * vNormal <= 0) return\n\n    // current vel lateral to friction axis\n    vec3.copy(lateralVel, body.velocity)\n    lateralVel[axis] = 0\n    var vCurr = vec3.length(lateralVel)\n    if (equals(vCurr, 0)) return\n\n    // treat current change in velocity as the result of a pseudoforce\n    //        Fpseudo = m*dv/dt\n    // Base friction force on normal component of the pseudoforce\n    //        Ff = u * Fnormal\n    //        Ff = u * m * dvnormal / dt\n    // change in velocity due to friction force\n    //        dvF = dt * Ff / m\n    //            = dt * (u * m * dvnormal / dt) / m\n    //            = u * dvnormal\n    var dvMax = Math.abs(body.friction * vNormal)\n\n    // decrease lateral vel by dvMax (or clamp to zero)\n    var scaler = (vCurr > dvMax) ? (vCurr - dvMax) / vCurr : 0\n    body.velocity[(axis + 1) % 3] *= scaler\n    body.velocity[(axis + 2) % 3] *= scaler\n}\nvar lateralVel = vec3.create()\n\n\n\n\n\n\n/*\n *    COLLISION HANDLER\n*/\n\n// sweep aabb along velocity vector and set resting vector\nfunction processCollisions(self, box, velocity, resting) {\n    vec3.set(resting, 0, 0, 0)\n    return sweep(self.testSolid, box, velocity, function (dist, axis, dir, vec) {\n        resting[axis] = dir\n        vec[axis] = 0\n    })\n}\n\n\n\n\n\n/*\n *    AUTO-STEPPING\n*/\n\nvar tmpBox = new aabb([], [])\nvar tmpResting = vec3.create()\nvar targetPos = vec3.create()\nvar upvec = vec3.create()\nvar leftover = vec3.create()\n\nfunction tryAutoStepping(self, b, oldBox, dx) {\n    if (b.resting[1] >= 0 && !b.inFluid) return\n\n    // // direction movement was blocked before trying a step\n    var xBlocked = (b.resting[0] !== 0)\n    var zBlocked = (b.resting[2] !== 0)\n    if (!(xBlocked || zBlocked)) return\n\n    // continue autostepping only if headed sufficiently into obstruction\n    var ratio = Math.abs(dx[0] / dx[2])\n    var cutoff = 4\n    if (!xBlocked && ratio > cutoff) return\n    if (!zBlocked && ratio < 1 / cutoff) return\n\n    // original target position before being obstructed\n    vec3.add(targetPos, oldBox.base, dx)\n\n    // move towards the target until the first X/Z collision\n    var getVoxels = self.testSolid\n    sweep(getVoxels, oldBox, dx, function (dist, axis, dir, vec) {\n        if (axis === 1) vec[axis] = 0\n        else return true\n    })\n\n    var y = b.aabb.base[1]\n    var ydist = Math.floor(y + 1.001) - y\n    vec3.set(upvec, 0, ydist, 0)\n    var collided = false\n    // sweep up, bailing on any obstruction\n    sweep(getVoxels, oldBox, upvec, function (dist, axis, dir, vec) {\n        collided = true\n        return true\n    })\n    if (collided) return // could't move upwards\n\n    // now move in X/Z however far was left over before hitting the obstruction\n    vec3.subtract(leftover, targetPos, oldBox.base)\n    leftover[1] = 0\n    processCollisions(self, oldBox, leftover, tmpResting)\n\n    // bail if no movement happened in the originally blocked direction\n    if (xBlocked && !equals(oldBox.base[0], targetPos[0])) return\n    if (zBlocked && !equals(oldBox.base[2], targetPos[2])) return\n\n    // done - oldBox is now at the target autostepped position\n    cloneAABB(b.aabb, oldBox)\n    b.resting[0] = tmpResting[0]\n    b.resting[2] = tmpResting[2]\n    if (b.onStep) b.onStep()\n}\n\n\n\n\n\n/*\n *    SLEEP CHECK\n*/\n\nfunction bodyAsleep(self, body, dt, noGravity) {\n    if (body._sleepFrameCount > 0) return false\n    // without gravity bodies stay asleep until a force/impulse wakes them up\n    if (noGravity) return true\n    // otherwise check body is resting against something\n    // i.e. sweep along by distance d = 1/2 g*t^2\n    // and check there's still a collision\n    var isResting = false\n    var gmult = 0.5 * dt * dt * body.gravityMultiplier\n    vec3.scale(sleepVec, self.gravity, gmult)\n    sweep(self.testSolid, body.aabb, sleepVec, function () {\n        isResting = true\n        return true\n    }, true)\n    return isResting\n}\nvar sleepVec = vec3.create()\n\n\n\n\n\nfunction equals(a, b) { return Math.abs(a - b) < 1e-5 }\n\nfunction cloneAABB(tgt, src) {\n    for (var i = 0; i < 3; i++) {\n        tgt.base[i] = src.base[i]\n        tgt.max[i] = src.max[i]\n        tgt.vec[i] = src.vec[i]\n    }\n}\n\n\n\nvar sanityCheck = function (v) { }\nif (DEBUG) sanityCheck = function (v) {\n    if (isNaN(vec3.length(v))) throw 'Vector with NAN: ' + v\n}\n","/** \n * The Physics class is found at [[Physics | `noa.physics`]].\n * @module noa.physics\n */\n\n\nimport { Physics as VoxelPhysics } from 'voxel-physics-engine'\n\n\n\n\nvar defaultOptions = {\n    gravity: [0, -10, 0],\n    airDrag: 0.1,\n}\n\n/**\n * `noa.physics` - Wrapper module for the physics engine.\n * \n * This module extends \n * [voxel-physics-engine](https://github.com/fenomas/voxel-physics-engine),\n * so turn on \"Inherited\" to see its APIs here, or view the base module \n * for full docs.\n * \n * This module uses the following default options (from the options\n * object passed to the [[Engine]]):\n * \n * ```js\n * {\n *     gravity: [0, -10, 0],\n *     airDrag: 0.1,\n *     fluidDrag: 0.4,\n *     fluidDensity: 2.0,\n *     minBounceImpulse: .5,      // cutoff for a bounce to occur\n * }\n * ```\n*/\n\nexport class Physics extends VoxelPhysics {\n\n    /** \n     * @internal \n     * @param {import('../index').Engine} noa\n    */\n    constructor(noa, opts) {\n        opts = Object.assign({}, defaultOptions, opts)\n        var world = noa.world\n        var solidLookup = noa.registry._solidityLookup\n        var fluidLookup = noa.registry._fluidityLookup\n\n        // physics engine runs in offset coords, so voxel getters need to match\n        var offset = noa.worldOriginOffset\n\n        var blockGetter = (x, y, z) => {\n            var id = world.getBlockID(x + offset[0], y + offset[1], z + offset[2])\n            return solidLookup[id]\n        }\n        var isFluidGetter = (x, y, z) => {\n            var id = world.getBlockID(x + offset[0], y + offset[1], z + offset[2])\n            return fluidLookup[id]\n        }\n\n        super(opts, blockGetter, isFluidGetter)\n    }\n\n}\n\n\n\n","/** \n * @module\n * @internal\n */\n\nimport { LocationQueue } from './util'\n\nvar ndarray = require('ndarray')\n\nexport default Chunk\n\n\n/* \n * \n *   Chunk\n * \n *  Stores and manages voxel ids and flags for each voxel within chunk\n * \n */\n\n\n\n\n\n/*\n *\n *    Chunk constructor\n *\n */\n\n/** @param {import('../index').Engine} noa */\nfunction Chunk(noa, requestID, ci, cj, ck, size, dataArray, fillVoxelID) {\n    this.noa = noa\n    this.isDisposed = false\n\n    // voxel data and properties\n    this.requestID = requestID     // id sent to game client\n    this.voxels = dataArray\n    this.i = ci\n    this.j = cj\n    this.k = ck\n    this.size = size\n    this.x = ci * size\n    this.y = cj * size\n    this.z = ck * size\n    this.pos = [this.x, this.y, this.z]\n\n    // flags to track if things need re-meshing\n    this._terrainDirty = false\n    this._objectsDirty = false\n\n    // inits state of terrain / object meshing\n    this._terrainMeshes = []\n    noa._terrainMesher.initChunk(this)\n    noa._objectMesher.initChunk(this)\n    this._isFull = false\n    this._isEmpty = false\n    this._filledWithVoxel = -1\n\n    if (fillVoxelID >= 0) {\n        this.voxels.data.fill(fillVoxelID, 0, this.voxels.size)\n        this._filledWithVoxel = fillVoxelID\n    }\n\n    // references to neighboring chunks, if they exist (filled in by `world`)\n    var narr = Array.from(Array(27), () => null)\n    this._neighbors = ndarray(narr, [3, 3, 3]).lo(1, 1, 1)\n    this._neighbors.set(0, 0, 0, this)\n    this._neighborCount = 0\n    this._timesMeshed = 0\n\n    // location queue of voxels in this chunk with block handlers (assume it's rare)\n    this._blockHandlerLocs = new LocationQueue()\n\n    // passes through voxel contents, calling block handlers etc.\n    scanVoxelData(this)\n}\n\n\n// expose logic internally to create and update the voxel data array\nChunk._createVoxelArray = function (size) {\n    var arr = new Uint16Array(size * size * size)\n    return ndarray(arr, [size, size, size])\n}\n\nChunk.prototype._updateVoxelArray = function (dataArray, fillVoxelID) {\n    // dispose current object blocks\n    callAllBlockHandlers(this, 'onUnload')\n    this.noa._objectMesher.disposeChunk(this)\n    this.noa._terrainMesher.disposeChunk(this)\n    this.voxels = dataArray\n    this._terrainDirty = false\n    this._objectsDirty = false\n    this._blockHandlerLocs.empty()\n    this.noa._objectMesher.initChunk(this)\n    this.noa._terrainMesher.initChunk(this)\n    this._filledWithVoxel = -1\n    if (fillVoxelID >= 0) {\n        this._filledWithVoxel = fillVoxelID\n        this.voxels.data.fill(fillVoxelID, 0, this.voxels.size)\n    }\n    scanVoxelData(this)\n}\n\n\n\n\n\n\n\n\n/*\n *\n *    Chunk API\n *\n */\n\n// get/set deal with block IDs, so that this class acts like an ndarray\n\nChunk.prototype.get = function (i, j, k) {\n    return this.voxels.get(i, j, k)\n}\n\nChunk.prototype.getSolidityAt = function (i, j, k) {\n    var solidLookup = this.noa.registry._solidityLookup\n    return solidLookup[this.voxels.get(i, j, k)]\n}\n\nChunk.prototype.set = function (i, j, k, newID) {\n    var oldID = this.voxels.get(i, j, k)\n    if (newID === oldID) return\n\n    // update voxel data\n    this.voxels.set(i, j, k, newID)\n\n    // lookup tables from registry, etc\n    var solidLookup = this.noa.registry._solidityLookup\n    var objectLookup = this.noa.registry._objectLookup\n    var opaqueLookup = this.noa.registry._opacityLookup\n    var handlerLookup = this.noa.registry._blockHandlerLookup\n\n    // voxel lifecycle handling\n    var hold = handlerLookup[oldID]\n    var hnew = handlerLookup[newID]\n    if (hold) callBlockHandler(this, hold, 'onUnset', i, j, k)\n    if (hnew) {\n        callBlockHandler(this, hnew, 'onSet', i, j, k)\n        this._blockHandlerLocs.add(i, j, k)\n    } else {\n        this._blockHandlerLocs.remove(i, j, k)\n    }\n\n    // track object block states\n    var objMesher = this.noa._objectMesher\n    var objOld = objectLookup[oldID]\n    var objNew = objectLookup[newID]\n    if (objOld) objMesher.setObjectBlock(this, 0, i, j, k)\n    if (objNew) objMesher.setObjectBlock(this, newID, i, j, k)\n\n    // track full/emptiness and dirty flags for the chunk\n    if (!opaqueLookup[newID]) this._isFull = false\n    if (newID !== 0) this._isEmpty = false\n    this._filledWithVoxel = -1\n\n    var solidityChanged = (solidLookup[oldID] !== solidLookup[newID])\n    var opacityChanged = (opaqueLookup[oldID] !== opaqueLookup[newID])\n    var wasTerrain = !objOld && (oldID !== 0)\n    var nowTerrain = !objNew && (newID !== 0)\n\n    if (objOld || objNew) this._objectsDirty = true\n    if (solidityChanged || opacityChanged || wasTerrain || nowTerrain) {\n        this._terrainDirty = true\n    }\n\n    if (this._terrainDirty || this._objectsDirty) {\n        this.noa.world._queueChunkForRemesh(this)\n    }\n\n    // neighbors only affected if solidity or opacity changed on an edge\n    if (solidityChanged || opacityChanged) {\n        var edge = this.size - 1\n        var imin = (i === 0) ? -1 : 0\n        var jmin = (j === 0) ? -1 : 0\n        var kmin = (k === 0) ? -1 : 0\n        var imax = (i === edge) ? 1 : 0\n        var jmax = (j === edge) ? 1 : 0\n        var kmax = (k === edge) ? 1 : 0\n        for (var ni = imin; ni <= imax; ni++) {\n            for (var nj = jmin; nj <= jmax; nj++) {\n                for (var nk = kmin; nk <= kmax; nk++) {\n                    if ((ni | nj | nk) === 0) continue\n                    var nab = this._neighbors.get(ni, nj, nk)\n                    if (!nab) continue\n                    nab._terrainDirty = true\n                    this.noa.world._queueChunkForRemesh(nab)\n                }\n            }\n        }\n    }\n}\n\n\n\n// helper to call handler of a given type at a particular xyz\nfunction callBlockHandler(chunk, handlers, type, i, j, k) {\n    var handler = handlers[type]\n    if (!handler) return\n    handler(chunk.x + i, chunk.y + j, chunk.z + k)\n}\n\n\n// gets called by World when this chunk has been queued for remeshing\nChunk.prototype.updateMeshes = function () {\n    if (this._terrainDirty) {\n        this.noa._terrainMesher.meshChunk(this)\n        this._timesMeshed++\n        this._terrainDirty = false\n    }\n    if (this._objectsDirty) {\n        this.noa._objectMesher.buildObjectMeshes()\n        this._objectsDirty = false\n    }\n}\n\n\n\n\n\n\n\n\n\n\n\n\n/*\n * \n *      Init\n * \n *  Scans voxel data, processing object blocks and setting chunk flags\n * \n*/\n\nfunction scanVoxelData(chunk) {\n    var voxels = chunk.voxels\n    var data = voxels.data\n    var len = voxels.shape[0]\n    var opaqueLookup = chunk.noa.registry._opacityLookup\n    var handlerLookup = chunk.noa.registry._blockHandlerLookup\n    var objectLookup = chunk.noa.registry._objectLookup\n    var plainLookup = chunk.noa.registry._blockIsPlainLookup\n    var objMesher = chunk.noa._objectMesher\n\n    // fastest case where entire chunk is air/dirt/etc\n    var monoID = chunk._filledWithVoxel\n    if (monoID >= 0 && !objMesher[monoID] && !handlerLookup[monoID]) {\n        chunk._isFull = !!opaqueLookup[monoID]\n        chunk._isEmpty = (monoID === 0)\n        chunk._terrainDirty = !chunk._isEmpty\n        return\n    }\n\n    // flags for tracking if chunk is entirely opaque or transparent\n    var fullyOpaque = true\n    var fullyAir = true\n\n    for (var i = 0; i < len; ++i) {\n        for (var j = 0; j < len; ++j) {\n            var index = voxels.index(i, j, 0)\n            for (var k = 0; k < len; ++k, ++index) {\n                var id = data[index]\n                // most common cases: air block...\n                if (id === 0) {\n                    fullyOpaque = false\n                    continue\n                }\n                // ...or plain boring block (no mesh, handlers, etc)\n                if (plainLookup[id]) {\n                    fullyAir = false\n                    continue\n                }\n                // otherwise check opacity, object mesh, and handlers\n                fullyOpaque = fullyOpaque && opaqueLookup[id]\n                fullyAir = false\n                if (objectLookup[id]) {\n                    objMesher.setObjectBlock(chunk, id, i, j, k)\n                    chunk._objectsDirty = true\n                }\n                var handlers = handlerLookup[id]\n                if (handlers) {\n                    chunk._blockHandlerLocs.add(i, j, k)\n                    callBlockHandler(chunk, handlers, 'onLoad', i, j, k)\n                }\n            }\n        }\n    }\n\n    chunk._isFull = fullyOpaque\n    chunk._isEmpty = fullyAir\n    chunk._terrainDirty = !chunk._isEmpty\n}\n\n\n\n\n\n\n\n\n\n\n// dispose function - just clears properties and references\n\nChunk.prototype.dispose = function () {\n    // look through the data for onUnload handlers\n    callAllBlockHandlers(this, 'onUnload')\n    this._blockHandlerLocs.empty()\n\n    // let meshers dispose their stuff\n    this.noa._objectMesher.disposeChunk(this)\n    this.noa._terrainMesher.disposeChunk(this)\n\n    // apparently there's no way to dispose typed arrays, so just null everything\n    this.voxels.data = null\n    this.voxels = null\n    this._neighbors.data = null\n    this._neighbors = null\n\n    this.isDisposed = true\n}\n\n\n\n// helper to call a given handler for all blocks in the chunk\nfunction callAllBlockHandlers(chunk, type) {\n    var voxels = chunk.voxels\n    var handlerLookup = chunk.noa.registry._blockHandlerLookup\n    chunk._blockHandlerLocs.arr.forEach(([i, j, k]) => {\n        var id = voxels.get(i, j, k)\n        callBlockHandler(chunk, handlerLookup[id], type, i, j, k)\n    })\n}\n","/** \n * The World class is found at [[World | `noa.world`]].\n * @module noa.world\n */\n\n\nimport EventEmitter from 'events'\nimport Chunk from './chunk'\nimport { LocationQueue, ChunkStorage, locationHasher, loopForTime } from './util'\n\nvar PROFILE_EVERY = 0               // ticks\nvar PROFILE_QUEUES_EVERY = 0        // ticks\n\n\n\n\n\n\nvar defaultOptions = {\n    chunkSize: 24,\n    chunkAddDistance: [2, 2],           // [horizontal, vertical]\n    chunkRemoveDistance: [3, 3],        // [horizontal, vertical]\n    worldGenWhilePaused: false,\n    manuallyControlChunkLoading: false,\n}\n\n/**\n * `noa.world` - manages world data, chunks, voxels.\n * \n * This module uses the following default options (from the options\n * object passed to the [[Engine]]):\n * ```js\n * var defaultOptions = {\n *   chunkSize: 24,\n *   chunkAddDistance: [2, 2],           // [horizontal, vertical]\n *   chunkRemoveDistance: [3, 3],        // [horizontal, vertical]\n *   worldGenWhilePaused: false,\n *   manuallyControlChunkLoading: false,\n * }\n * ```\n*/\nexport class World extends EventEmitter {\n\n    /** @internal */\n    constructor(noa, opts) {\n        super()\n        opts = Object.assign({}, defaultOptions, opts)\n        /** @internal */\n        this.noa = noa\n\n        /** @internal */\n        this.playerChunkLoaded = false\n\n        /** @internal */\n        this.Chunk = Chunk // expose this class for ...reasons\n\n        /**\n         * Game clients should set this if they need to manually control \n         * which chunks to load and unload. When set, client should call \n         * `noa.world.manuallyLoadChunk` / `manuallyUnloadChunk` as needed.\n         */\n        this.manuallyControlChunkLoading = !!opts.manuallyControlChunkLoading\n\n        /**\n         * Defining this function sets a custom order in which to create chunks.\n         * The function should look like:\n         * ```js\n         *   (i, j, k) => 1 // return a smaller number for chunks to process first\n         * ```\n         */\n        this.chunkSortingDistFn = defaultSortDistance\n\n        /**\n         * Set this higher to cause chunks not to mesh until they have some neighbors.\n         * Max legal value is 26 (each chunk will mesh only when all neighbors are present)\n         */\n        this.minNeighborsToMesh = 6\n\n        /** When true, worldgen queues will keep running if engine is paused. */\n        this.worldGenWhilePaused = !!opts.worldGenWhilePaused\n\n        /** Limit the size of internal chunk processing queues \n         * @type {number} \n        */\n        this.maxChunksPendingCreation = 10\n\n        /** Limit the size of internal chunk processing queues \n         * @type {number} \n        */\n        this.maxChunksPendingMeshing = 10\n\n        /** Cutoff (in ms) of time spent each **tick** \n         * @type {number}\n        */\n        this.maxProcessingPerTick = 9\n\n        /** Cutoff (in ms) of time spent each **render** \n         * @type {number}\n        */\n        this.maxProcessingPerRender = 5\n\n\n        // set up internal state\n\n\n        /** @internal */\n        this._chunkSize = opts.chunkSize\n        /** @internal */\n        this._chunkAddDistance = [2, 2]\n        /** @internal */\n        this._chunkRemoveDistance = [3, 3]\n        /** @internal */\n        this._addDistanceFn = null\n        /** @internal */\n        this._remDistanceFn = null\n        /** @internal */\n        this._prevWorldName = ''\n        /** @internal */\n        this._prevPlayerChunkHash = 0\n        /** @internal */\n        this._chunkAddSearchFrom = 0\n        /** @internal */\n        this._prevSortingFn = null\n\n        /** @internal */\n        this._chunksKnown = null\n        /** @internal */\n        this._chunksPending = null\n        /** @internal */\n        this._chunksToRequest = null\n        /** @internal */\n        this._chunksToRemove = null\n        /** @internal */\n        this._chunksToMesh = null\n        /** @internal */\n        this._chunksToMeshFirst = null\n        /** @internal */\n        this._chunksSortedLocs = null\n        initChunkQueues(this)\n\n        // validate add/remove sizes through a setter that clients can use later\n        this.setAddRemoveDistance(opts.chunkAddDistance, opts.chunkRemoveDistance)\n\n        // chunks stored in a data structure for quick lookup\n        // note that the hash wraps around every 1024 chunk indexes!!\n        // i.e. two chunks that far apart can't be loaded at the same time\n        /** @internal */\n        this._storage = new ChunkStorage()\n\n        // coordinate converter functions - default versions first:\n        var cs = this._chunkSize\n        /** @internal */\n        this._coordsToChunkIndexes = chunkCoordsToIndexesGeneral\n        /** @internal */\n        this._coordsToChunkLocals = chunkCoordsToLocalsGeneral\n\n        // when chunk size is a power of two, override with bit-twiddling:\n        var powerOfTwo = ((cs & cs - 1) === 0)\n        if (powerOfTwo) {\n            /** @internal */\n            this._coordShiftBits = Math.log2(cs) | 0\n            /** @internal */\n            this._coordMask = (cs - 1) | 0\n            /** @internal */\n            this._coordsToChunkIndexes = chunkCoordsToIndexesPowerOfTwo\n            /** @internal */\n            this._coordsToChunkLocals = chunkCoordsToLocalsPowerOfTwo\n        }\n    }\n}\n\n\n\n\n\n/*\n *\n *\n *\n *\n *                  PUBLIC API \n *\n *\n *\n *\n*/\n\n/** @param x,y,z */\nWorld.prototype.getBlockID = function (x, y, z) {\n    var [ci, cj, ck] = this._coordsToChunkIndexes(x, y, z)\n    var chunk = this._storage.getChunkByIndexes(ci, cj, ck)\n    if (!chunk) return 0\n    var [i, j, k] = this._coordsToChunkLocals(x, y, z)\n    return chunk.voxels.get(i, j, k)\n}\n\n/** @param x,y,z */\nWorld.prototype.getBlockSolidity = function (x, y, z) {\n    var [ci, cj, ck] = this._coordsToChunkIndexes(x, y, z)\n    var chunk = this._storage.getChunkByIndexes(ci, cj, ck)\n    if (!chunk) return false\n    var [i, j, k] = this._coordsToChunkLocals(x, y, z)\n    return !!chunk.getSolidityAt(i, j, k)\n}\n\n/** @param x,y,z */\nWorld.prototype.getBlockOpacity = function (x, y, z) {\n    var id = this.getBlockID(x, y, z)\n    return this.noa.registry.getBlockOpacity(id)\n}\n\n/** @param x,y,z */\nWorld.prototype.getBlockFluidity = function (x, y, z) {\n    var id = this.getBlockID(x, y, z)\n    return this.noa.registry.getBlockFluidity(id)\n}\n\n/** @param x,y,z */\nWorld.prototype.getBlockProperties = function (x, y, z) {\n    var id = this.getBlockID(x, y, z)\n    return this.noa.registry.getBlockProps(id)\n}\n\n\n\n/** @param val,x,y,z */\nWorld.prototype.setBlockID = function (val, x, y, z) {\n    var [ci, cj, ck] = this._coordsToChunkIndexes(x, y, z)\n    var chunk = this._storage.getChunkByIndexes(ci, cj, ck)\n    if (!chunk) return\n    var [i, j, k] = this._coordsToChunkLocals(x, y, z)\n    return chunk.set(i, j, k, val, x, y, z)\n}\n\n\n/** @param box */\nWorld.prototype.isBoxUnobstructed = function (box) {\n    var base = box.base\n    var max = box.max\n    for (var i = Math.floor(base[0]); i < max[0] + 1; i++) {\n        for (var j = Math.floor(base[1]); j < max[1] + 1; j++) {\n            for (var k = Math.floor(base[2]); k < max[2] + 1; k++) {\n                if (this.getBlockSolidity(i, j, k)) return false\n            }\n        }\n    }\n    return true\n}\n\n\n/** client should call this after creating a chunk's worth of data (as an ndarray)  \n * If userData is passed in it will be attached to the chunk\n * @param {string} id - the string specified when the chunk was requested \n * @param {*} array - an ndarray of voxel data\n * @param {*} userData - an arbitrary value for game client use\n * @param {number} fillVoxelID - specify a voxel ID here if you want to signify that \n * the entire chunk should be solidly filled with that voxel (e.g. `0` for air). \n * If you do this, the voxel array data will be overwritten and the engine will \n * take a fast path through some initialization steps.\n */\nWorld.prototype.setChunkData = function (id, array, userData = null, fillVoxelID = -1) {\n    setChunkData(this, id, array, userData, fillVoxelID)\n}\n\n\n\n/** \n * Sets the distances within which to load new chunks, and beyond which \n * to unload them. Generally you want the remove distance to be somewhat\n * farther, so that moving back and forth across the same chunk border doesn't\n * keep loading/unloading the same distant chunks.\n * \n * Both arguments can be numbers (number of voxels), or arrays like:\n * `[horiz, vert]` specifying different horizontal and vertical distances.\n * @param {number | number[]} addDist\n * @param {number | number[]} remDist\n */\nWorld.prototype.setAddRemoveDistance = function (addDist = 2, remDist = 3) {\n    var addArr = Array.isArray(addDist) ? addDist : [addDist, addDist]\n    var remArr = Array.isArray(remDist) ? remDist : [remDist, remDist]\n    var minGap = 1\n    if (remArr[0] < addArr[0] + minGap) remArr[0] = addArr[0] + minGap\n    if (remArr[1] < addArr[1] + minGap) remArr[1] = addArr[1] + minGap\n    this._chunkAddDistance = addArr\n    this._chunkRemoveDistance = remArr\n    // rebuild chunk distance functions and add search locations\n    this._addDistanceFn = makeDistanceTestFunction(addArr[0], addArr[1])\n    this._remDistanceFn = makeDistanceTestFunction(remArr[0], remArr[1])\n    this._chunksSortedLocs.empty()\n    // this queue holds only 1/16th the search space: i=0..max, j=0..i, k=0..max\n    for (var i = 0; i <= addArr[0]; i++) {\n        for (var k = 0; k <= i; k++) {\n            for (var j = 0; j <= addArr[1]; j++) {\n                if (!this._addDistanceFn(i, j, k)) continue\n                this._chunksSortedLocs.add(i, j, k)\n            }\n        }\n    }\n    // resets state of nearby chunk search\n    this._prevSortingFn = null\n    this._chunkAddSearchFrom = 0\n}\n\n\n\n\n\n\n/** Tells noa to discard voxel data within a given `AABB` (e.g. because \n * the game client received updated data from a server). \n * The engine will mark all affected chunks for disposal, and will later emit \n * new `worldDataNeeded` events (if the chunk is still in draw range).\n * Note that chunks invalidated this way will not emit a `chunkBeingRemoved` event \n * for the client to save data from.\n */\nWorld.prototype.invalidateVoxelsInAABB = function (box) {\n    invalidateChunksInBox(this, box)\n}\n\n\n/** When manually controlling chunk loading, tells the engine that the \n * chunk containing the specified (x,y,z) needs to be created and loaded.\n * > Note: has no effect when `noa.world.manuallyControlChunkLoading` is not set.\n * @param x, y, z\n */\nWorld.prototype.manuallyLoadChunk = function (x, y, z) {\n    if (!this.manuallyControlChunkLoading) throw manualErr\n    var [i, j, k] = this._coordsToChunkIndexes(x, y, z)\n    this._chunksKnown.add(i, j, k)\n    this._chunksToRequest.add(i, j, k)\n}\n\n/** When manually controlling chunk loading, tells the engine that the \n * chunk containing the specified (x,y,z) needs to be unloaded and disposed.\n * > Note: has no effect when `noa.world.manuallyControlChunkLoading` is not set.\n * @param x, y, z\n */\nWorld.prototype.manuallyUnloadChunk = function (x, y, z) {\n    if (!this.manuallyControlChunkLoading) throw manualErr\n    var [i, j, k] = this._coordsToChunkIndexes(x, y, z)\n    this._chunksToRemove.add(i, j, k)\n    this._chunksToMesh.remove(i, j, k)\n    this._chunksToRequest.remove(i, j, k)\n    this._chunksToMeshFirst.remove(i, j, k)\n}\nvar manualErr = 'Set `noa.world.manuallyControlChunkLoading` if you need this API'\n\n\n\n\n/*\n * \n * \n * \n *                  internals:\n * \n *          tick functions that process queues and trigger events\n * \n * \n * \n*/\n\n/** @internal */\nWorld.prototype.tick = function () {\n    var tickStartTime = performance.now()\n\n    // get indexes of player's current chunk, and has it changed since last tick?\n    var [ci, cj, ck] = getPlayerChunkIndexes(this)\n    var chunkLocHash = locationHasher(ci, cj, ck)\n    var changedChunks = (chunkLocHash !== this._prevPlayerChunkHash)\n    if (changedChunks) {\n        this.emit('playerEnteredChunk', ci, cj, ck)\n        this._prevPlayerChunkHash = chunkLocHash\n        this._chunkAddSearchFrom = 0\n    }\n\n    // if world has changed, mark everything to be removed, and ping \n    // removals queue so that player's chunk gets loaded back quickly\n    if (this._prevWorldName !== this.noa.worldName) {\n        markAllChunksForRemoval(this)\n        this._prevWorldName = this.noa.worldName\n        this._chunkAddSearchFrom = 0\n        processRemoveQueue(this)\n    }\n\n    profile_hook('start')\n    profile_queues_hook('start')\n\n    // scan for chunks to add/remove (unless client handles manually)\n    if (!this.manuallyControlChunkLoading) {\n        if (changedChunks) {\n            findDistantChunksToRemove(this, ci, cj, ck)\n            profile_hook('remQueue')\n        }\n        findNewChunksInRange(this, ci, cj, ck)\n        profile_hook('addQueue')\n    }\n\n    // process (create or mesh) some chunks, up to max iteration time\n    var ptime = Math.max(1, this.maxProcessingPerTick || 0)\n    var done1 = false\n    var done2 = false\n    var done3 = false\n    loopForTime(ptime, () => {\n        if (!done1) done1 = processRequestQueue(this); profile_hook('requests')\n        if (!done2) done2 = processMeshingQueue(this, false); profile_hook('meshes')\n        if (!done3) {\n            done3 = processRemoveQueue(this)\n                || processRemoveQueue(this)\n                || processRemoveQueue(this)\n            profile_hook('removes')\n        }\n        return (done1 && done2 && done3)\n    }, tickStartTime)\n\n    // if time is left over, look for low-priority extra meshing\n    var dt = performance.now() - tickStartTime\n    ptime -= dt\n    if (ptime > 0.5) {\n        lookForChunksToMesh(this)\n        profile_hook('looking')\n        loopForTime(ptime, () => processMeshingQueue(this, false), tickStartTime)\n        profile_hook('meshes')\n    }\n\n    // track whether the player's local chunk is loaded and ready or not\n    var pChunk = this._storage.getChunkByIndexes(ci, cj, ck)\n    this.playerChunkLoaded = !!pChunk\n\n    profile_queues_hook('end', this)\n    profile_hook('end')\n}\n\n\n/** @internal */\nWorld.prototype.render = function () {\n    // on render, quickly process the high-priority meshing queue\n    // to help avoid flashes of background while neighboring chunks update\n    var mpr = this.maxProcessingPerRender\n    if (mpr > 0) loopForTime(mpr, () => {\n        return processMeshingQueue(this, true)\n    })\n}\n\n\n/** @internal */\nWorld.prototype._getChunkByCoords = function (x, y, z) {\n    // let internal modules request a chunk object\n    var [i, j, k] = this._coordsToChunkIndexes(x, y, z)\n    return this._storage.getChunkByIndexes(i, j, k)\n}\n\n\n\n\n\n\n\n\n\n\n/*\n * \n * \n * \n *              chunk queues and queue processing\n * \n * \n * \n*/\n\n\nfunction initChunkQueues(world) {\n    // queue meanings:\n    //    Known:        all chunks existing in any queue\n    //    ToRequest:    needed but not yet requested from client\n    //    Pending:      requested, awaiting data event from client\n    //    ToMesh:       has data, but not yet meshed (or re-meshed)\n    //    ToMeshFirst:  priority version of the previous\n    //    ToRemove:     chunks awaiting disposal\n    //    SortedLocs:   locations in 1/16th quadrant of add area, sorted (reverse order of other queues!)\n    world._chunksKnown = new LocationQueue()\n    world._chunksToMesh = new LocationQueue()\n    world._chunksPending = new LocationQueue()\n    world._chunksToRemove = new LocationQueue()\n    world._chunksToRequest = new LocationQueue()\n    world._chunksToMeshFirst = new LocationQueue()\n    world._chunksSortedLocs = new LocationQueue()\n}\n\n// internal accessor for chunks to queue themeselves for remeshing \n// after their data changes\nWorld.prototype._queueChunkForRemesh = function (chunk) {\n    possiblyQueueChunkForMeshing(this, chunk)\n}\n\n\n\n// helper - chunk indexes of where the player is\nfunction getPlayerChunkIndexes(world) {\n    var [x, y, z] = world.noa.entities.getPosition(world.noa.playerEntity)\n    return world._coordsToChunkIndexes(x, y, z)\n}\n\n\n\n\n// process neighborhood chunks, add missing ones to \"toRequest\" and \"inMemory\"\nfunction findNewChunksInRange(world, ci, cj, ck) {\n    var toRequest = world._chunksToRequest\n    var startIx = world._chunkAddSearchFrom\n    var locs = world._chunksSortedLocs\n    if (startIx >= locs.arr.length) return\n\n    // don't bother if in progress and request queue is backed up\n    if (world._chunksToRequest.count() > 50) return\n\n    // conform of chunk location sorting function\n    if (world._prevSortingFn !== world.chunkSortingDistFn) {\n        if (!world.chunkSortingDistFn) world.chunkSortingDistFn = defaultSortDistance\n        sortQueueByDistanceFrom(locs, 0, 0, 0, world.chunkSortingDistFn, true)\n        world._prevSortingFn = world.chunkSortingDistFn\n    }\n\n    // consume the pre-sorted positions array, checking each loc and its reflections\n    // add new locations, and remember if any have been seen that are pending removal\n    // store the recursion state in a little object to keep things clean (er?)\n    checkingState.removals = 0\n    checkingState.ci = ci\n    checkingState.cj = cj\n    checkingState.ck = ck\n    var posArr = world._chunksSortedLocs.arr\n    for (var i = startIx; i < posArr.length; i++) {\n        var [di, dj, dk] = posArr[i]\n        checkReflectedLocations(world, checkingState, di, dj, dk)\n        // store progress and break early differently depending on if removals were seen\n        if (checkingState.removals === 0) {\n            world._chunkAddSearchFrom = i + 1\n            if (toRequest.count() > 100) break\n            if (i - startIx > 50) break\n        } else {\n            if (toRequest.count() > 50) break\n            if (i - startIx > 5) break\n        }\n    }\n\n    // queue should be mostly sorted, but may not have been empty\n    sortQueueByDistanceFrom(toRequest, ci, cj, ck, world.chunkSortingDistFn)\n}\n\n// Helpers for checking whether to add a location, and reflections of it\nvar checkingState = {}\nvar checkReflectedLocations = (world, state, i, j, k) => {\n    checkOneLocation(world, state, state.ci + i, state.cj + j, state.ck + k)\n    if (i !== k) checkOneLocation(world, state, state.ci + k, state.cj + j, state.ck + i)\n    if (i > 0) checkReflectedLocations(world, state, -i, j, k)\n    if (j > 0) checkReflectedLocations(world, state, i, -j, k)\n    if (k > 0) checkReflectedLocations(world, state, i, j, -k)\n}\nvar checkOneLocation = (world, state, i, j, k) => {\n    if (world._chunksKnown.includes(i, j, k)) {\n        if (world._chunksToRemove.includes(i, j, k)) state.removals++\n    } else {\n        world._chunksKnown.add(i, j, k)\n        world._chunksToRequest.addToFront(i, j, k)\n    }\n}\n\n\n\n\n\n\n\n// rebuild queue of chunks to be removed from around (ci,cj,ck)\nfunction findDistantChunksToRemove(world, ci, cj, ck) {\n    var distFn = world._remDistanceFn\n    var toRemove = world._chunksToRemove\n    world._chunksKnown.forEach(([i, j, k]) => {\n        if (toRemove.includes(i, j, k)) return\n        if (distFn(i - ci, j - cj, k - ck)) return\n        // flag chunk for removal and remove it from work queues\n        world._chunksToRemove.add(i, j, k)\n        world._chunksToMesh.remove(i, j, k)\n        world._chunksToRequest.remove(i, j, k)\n        world._chunksToMeshFirst.remove(i, j, k)\n    })\n    sortQueueByDistanceFrom(toRemove, ci, cj, ck, world.chunkSortingDistFn)\n}\n\n\n// invalidate chunks overlapping the given AABB\nfunction invalidateChunksInBox(world, box) {\n    var min = world._coordsToChunkIndexes(box.base[0], box.base[1], box.base[2])\n    var max = world._coordsToChunkIndexes(box.max[0], box.max[1], box.max[2])\n    for (var i = 0; i < 3; i++) {\n        if (!Number.isFinite(box.base[i])) min[i] = box.base[i]\n        if (!Number.isFinite(box.max[i])) max[i] = box.max[i]\n    }\n    world._chunksKnown.forEach(loc => {\n        for (var i = 0; i < 3; i++) {\n            if (loc[i] < min[i] || loc[i] >= max[i]) return\n        }\n        world._chunksToRemove.add(loc[0], loc[1], loc[2])\n        world._chunksToMesh.remove(loc[0], loc[1], loc[2])\n        world._chunksToRequest.remove(loc[0], loc[1], loc[2])\n        world._chunksToMeshFirst.remove(loc[0], loc[1], loc[2])\n    })\n}\n\n\n\n// when current world changes - empty work queues and mark all for removal\nfunction markAllChunksForRemoval(world) {\n    world._chunksToRemove.copyFrom(world._chunksKnown)\n    world._chunksToRequest.empty()\n    world._chunksToMesh.empty()\n    world._chunksToMeshFirst.empty()\n    var [i, j, k] = getPlayerChunkIndexes(world)\n    sortQueueByDistanceFrom(world._chunksToRemove, i, j, k, world.chunkSortingDistFn)\n}\n\n\n\n// incrementally look for chunks that could be re-meshed\nfunction lookForChunksToMesh(world) {\n    var limit = 5\n    var numQueued = world._chunksToMesh.count() + world._chunksToMeshFirst.count()\n    if (numQueued > limit) return\n    var knownLocs = world._chunksKnown.arr\n    var ct = Math.min(50, knownLocs.length)\n    for (var n = 0; n < ct; n++) {\n        lookIndex = (lookIndex + 1) % knownLocs.length\n        var [i, j, k] = knownLocs[lookIndex]\n        var chunk = world._storage.getChunkByIndexes(i, j, k)\n        if (!chunk) continue\n        var res = possiblyQueueChunkForMeshing(world, chunk)\n        if (res) numQueued++\n        if (numQueued > limit) return\n    }\n}\nvar lookIndex = -1\n\n\n\n// run through chunk tracking queues looking for work to do next\nfunction processRequestQueue(world) {\n    var toRequest = world._chunksToRequest\n    if (toRequest.isEmpty()) return true\n    // skip if too many outstanding requests, or if meshing queue is full\n    var pending = world._chunksPending.count()\n    var toMesh = world._chunksToMesh.count()\n    if (pending >= world.maxChunksPendingCreation) return true\n    if (toMesh >= world.maxChunksPendingMeshing) return true\n    var [i, j, k] = toRequest.pop()\n    requestNewChunk(world, i, j, k)\n    return toRequest.isEmpty()\n}\n\n\nfunction processRemoveQueue(world) {\n    var toRemove = world._chunksToRemove\n    if (toRemove.isEmpty()) return true\n    var [i, j, k] = toRemove.pop()\n    removeChunk(world, i, j, k)\n    return (toRemove.isEmpty())\n}\n\n\n// similar to above but for chunks waiting to be meshed\nfunction processMeshingQueue(world, firstOnly) {\n    var queue = world._chunksToMeshFirst\n    if (queue.isEmpty() && !firstOnly) queue = world._chunksToMesh\n    if (queue.isEmpty()) return true\n    var [i, j, k] = queue.pop()\n    if (world._chunksToRemove.includes(i, j, k)) return\n    var chunk = world._storage.getChunkByIndexes(i, j, k)\n    if (chunk) doChunkRemesh(world, chunk)\n}\n\n\nfunction possiblyQueueChunkForMeshing(world, chunk) {\n    if (!(chunk._terrainDirty || chunk._objectsDirty)) return false\n    if (chunk._neighborCount < chunk.minNeighborsToMesh) return false\n    if (world._chunksToMesh.includes(chunk.i, chunk.j, chunk.k)) return false\n    if (world._chunksToMeshFirst.includes(chunk.i, chunk.j, chunk.k)) return false\n    var queue = (chunk._neighborCount === 26) ?\n        world._chunksToMeshFirst : world._chunksToMesh\n    queue.add(chunk.i, chunk.j, chunk.k)\n    return true\n}\n\n\n\n\n\n\n\n/*\n * \n * \n * \n *              chunk lifecycle - create / set / remove / modify\n * \n * \n * \n*/\n\n\n// create chunk object and request voxel data from client\nfunction requestNewChunk(world, i, j, k) {\n    var size = world._chunkSize\n    var dataArr = Chunk._createVoxelArray(world._chunkSize)\n    var worldName = world.noa.worldName\n    var requestID = [i, j, k, worldName].join('|')\n    var x = i * size\n    var y = j * size\n    var z = k * size\n    world._chunksPending.add(i, j, k)\n    world.emit('worldDataNeeded', requestID, dataArr, x, y, z, worldName)\n    profile_queues_hook('request')\n}\n\n// called when client sets a chunk's voxel data\n// If userData is passed in it will be attached to the chunk\nfunction setChunkData(world, reqID, array, userData, fillVoxelID) {\n    var arr = reqID.split('|')\n    var i = parseInt(arr.shift())\n    var j = parseInt(arr.shift())\n    var k = parseInt(arr.shift())\n    var worldName = arr.join('|')\n    world._chunksPending.remove(i, j, k)\n    // discard data if it's for a world that's no longer current\n    if (worldName !== world.noa.worldName) return\n    // discard if chunk is no longer needed\n    if (!world._chunksKnown.includes(i, j, k)) return\n    if (world._chunksToRemove.includes(i, j, k)) return\n\n    var chunk = world._storage.getChunkByIndexes(i, j, k)\n    if (!chunk) {\n        // if chunk doesn't exist, create and init\n        var size = world._chunkSize\n        chunk = new Chunk(world.noa, reqID, i, j, k, size, array, fillVoxelID)\n        world._storage.storeChunkByIndexes(i, j, k, chunk)\n        chunk.userData = userData\n        world.noa.rendering.prepareChunkForRendering(chunk)\n        world.emit('chunkAdded', chunk)\n    } else {\n        // else we're updating data for an existing chunk\n        chunk._updateVoxelArray(array, fillVoxelID)\n    }\n    // chunk can now be meshed, and ping neighbors\n    possiblyQueueChunkForMeshing(world, chunk)\n    updateNeighborsOfChunk(world, i, j, k, chunk)\n\n    profile_queues_hook('receive')\n}\n\n\n\n// remove a chunk that wound up in the remove queue\nfunction removeChunk(world, i, j, k) {\n    var chunk = world._storage.getChunkByIndexes(i, j, k)\n\n    if (chunk) {\n        world.emit('chunkBeingRemoved', chunk.requestID, chunk.voxels, chunk.userData)\n        world.noa.rendering.disposeChunkForRendering(chunk)\n        chunk.dispose()\n        profile_queues_hook('dispose')\n        updateNeighborsOfChunk(world, i, j, k, null)\n    }\n\n    world._storage.removeChunkByIndexes(i, j, k)\n    world._chunksKnown.remove(i, j, k)\n    world._chunksToMesh.remove(i, j, k)\n    world._chunksToMeshFirst.remove(i, j, k)\n}\n\n\nfunction doChunkRemesh(world, chunk) {\n    world._chunksToMesh.remove(chunk.i, chunk.j, chunk.k)\n    world._chunksToMeshFirst.remove(chunk.i, chunk.j, chunk.k)\n    chunk.updateMeshes()\n    profile_queues_hook('mesh')\n}\n\n\n\n\n\n\n\n\n\n\n/*\n * \n * \n *          two different versions of logic to convert\n *          chunk coords to chunk indexes or local scope\n * \n * \n*/\n\nfunction chunkCoordsToIndexesGeneral(x, y, z) {\n    var cs = this._chunkSize\n    return [Math.floor(x / cs) | 0, Math.floor(y / cs) | 0, Math.floor(z / cs) | 0]\n}\nfunction chunkCoordsToLocalsGeneral(x, y, z) {\n    var cs = this._chunkSize\n    var i = (x % cs) | 0; if (i < 0) i += cs\n    var j = (y % cs) | 0; if (j < 0) j += cs\n    var k = (z % cs) | 0; if (k < 0) k += cs\n    return [i, j, k]\n}\nfunction chunkCoordsToIndexesPowerOfTwo(x, y, z) {\n    var shift = this._coordShiftBits\n    return [(x >> shift) | 0, (y >> shift) | 0, (z >> shift) | 0]\n}\nfunction chunkCoordsToLocalsPowerOfTwo(x, y, z) {\n    var mask = this._coordMask\n    return [(x & mask) | 0, (y & mask) | 0, (z & mask) | 0]\n}\n\n\n\n\n\n\n\n/*\n * \n * \n * \n *          misc helpers and implementation functions\n * \n * \n * \n*/\n\n\nfunction sortQueueByDistanceFrom(queue, pi, pj, pk, distFn, reverse = false) {\n    if (reverse) {\n        queue.sortByDistance((i, j, k) => -distFn(pi - i, pj - j, pk - k))\n    } else {\n        queue.sortByDistance((i, j, k) => distFn(pi - i, pj - j, pk - k))\n    }\n}\nvar defaultSortDistance = (i, j, k) => (i * i) + (j * j) + (k * k)\n\n\n\n\n// keep neighbor data updated when chunk is added or removed\nfunction updateNeighborsOfChunk(world, ci, cj, ck, chunk) {\n    var terrainChanged = (!chunk) || (chunk && !chunk.isEmpty)\n    for (var i = -1; i <= 1; i++) {\n        for (var j = -1; j <= 1; j++) {\n            for (var k = -1; k <= 1; k++) {\n                if ((i | j | k) === 0) continue\n                var neighbor = world._storage.getChunkByIndexes(ci + i, cj + j, ck + k)\n                if (!neighbor) continue\n                // flag neighbor, assume terrain needs remeshing\n                if (terrainChanged) neighbor._terrainDirty = true\n                // update neighbor counts and references, both ways\n                if (chunk && !chunk._neighbors.get(i, j, k)) {\n                    chunk._neighborCount++\n                    chunk._neighbors.set(i, j, k, neighbor)\n                }\n                var nabRef = neighbor._neighbors.get(-i, -j, -k)\n                if (chunk && !nabRef) {\n                    neighbor._neighborCount++\n                    neighbor._neighbors.set(-i, -j, -k, chunk)\n                    // immediately queue neighbor if it's surrounded\n                    if (neighbor._neighborCount === 26) {\n                        possiblyQueueChunkForMeshing(world, neighbor)\n                    }\n                }\n                if (!chunk && nabRef) {\n                    neighbor._neighborCount--\n                    neighbor._neighbors.set(-i, -j, -k, null)\n                }\n            }\n        }\n    }\n}\n\n\n// make a function to check if an (i,j,k) is within a sphere/ellipse of given size\nfunction makeDistanceTestFunction(xsize, ysize) {\n    var asq = xsize * xsize\n    var bsq = ysize * ysize\n    // spherical case\n    if (xsize === ysize) return (i, j, k) => (i * i + j * j + k * k <= asq)\n    // otherwise do clipped spheres for now\n    if (xsize > ysize) return (i, j, k) => {\n        if (Math.abs(j) > ysize) return false\n        return (i * i + j * j + k * k <= asq)\n    }\n    return (i, j, k) => {\n        var dxsq = i * i + k * k\n        if (dxsq > asq) return false\n        return (dxsq + j * j <= bsq)\n    }\n}\n\n\n\n\n\n\n\n\n\n\n/*\n * \n * \n * \n * \n *                  debugging\n * \n * \n * \n * \n*/\n\n/** @internal */\nWorld.prototype.report = function () {\n    console.log('World report - playerChunkLoaded: ', this.playerChunkLoaded)\n    _report(this, '  known:     ', this._chunksKnown.arr, true)\n    _report(this, '  to request:', this._chunksToRequest.arr, 0)\n    _report(this, '  to remove: ', this._chunksToRemove.arr, 0)\n    _report(this, '  creating:  ', this._chunksPending.arr, 0)\n    _report(this, '  to mesh:   ', this._chunksToMesh.arr.concat(this._chunksToMeshFirst.arr), 0)\n}\n\nfunction _report(world, name, arr, ext) {\n    var full = 0,\n        empty = 0,\n        exist = 0,\n        surrounded = 0,\n        remeshes = []\n    arr.forEach(loc => {\n        var chunk = world._storage.getChunkByIndexes(loc[0], loc[1], loc[2])\n        if (!chunk) return\n        exist++\n        remeshes.push(chunk._timesMeshed)\n        if (chunk._isFull) full++\n        if (chunk._isEmpty) empty++\n        if (chunk._neighborCount === 26) surrounded++\n    })\n    var out = arr.length.toString().padEnd(8)\n    out += ('exist: ' + exist).padEnd(12)\n    out += ('full: ' + full).padEnd(12)\n    out += ('empty: ' + empty).padEnd(12)\n    out += ('surr: ' + surrounded).padEnd(12)\n    if (ext) {\n        var sum = remeshes.reduce((acc, val) => acc + val, 0)\n        var max = remeshes.reduce((acc, val) => Math.max(acc, val), 0)\n        var min = remeshes.reduce((acc, val) => Math.min(acc, val), 0)\n        out += 'times meshed: avg ' + (sum / exist).toFixed(2)\n        out += '  max ' + max\n        out += '  min ' + min\n    }\n    console.log(name, out)\n}\n\n\nimport { makeProfileHook } from './util'\nvar profile_hook = makeProfileHook(PROFILE_EVERY, 'world ticks:', 1)\nvar profile_queues_hook = ((every) => {\n    if (!(every > 0)) return () => { }\n    var iter = 0\n    var counts = {}\n    var queues = {}\n    var started = performance.now()\n    return function profile_queues_hook(state, world) {\n        if (state === 'start') return\n        if (state !== 'end') return counts[state] = (counts[state] || 0) + 1\n        queues.toreq = (queues.toreq || 0) + world._chunksToRequest.count()\n        queues.toget = (queues.toget || 0) + world._chunksPending.count()\n        queues.tomesh = (queues.tomesh || 0) + world._chunksToMesh.count() + world._chunksToMeshFirst.count()\n        queues.tomesh1 = (queues.tomesh1 || 0) + world._chunksToMeshFirst.count()\n        queues.torem = (queues.torem || 0) + world._chunksToRemove.count()\n        if (++iter < every) return\n        var t = performance.now(), dt = t - started\n        var res = {}\n        Object.keys(queues).forEach(k => {\n            var num = Math.round((queues[k] || 0) / iter)\n            res[k] = `[${num}]`.padStart(5)\n        })\n        Object.keys(counts).forEach(k => {\n            var num = Math.round((counts[k] || 0) * 1000 / dt)\n            res[k] = ('' + num).padStart(3)\n        })\n        console.log('chunk flow: ',\n            `${res.toreq}-> ${res.request || 0} req/s  `,\n            `${res.toget}-> ${res.receive || 0} got/s  `,\n            `${(res.tomesh)}-> ${res.mesh || 0} mesh/s  `,\n            `${res.torem}-> ${res.dispose || 0} rem/s  `,\n            `(meshFirst: ${res.tomesh1.trim()})`,\n        )\n        iter = 0\n        counts = {}\n        queues = {}\n        started = performance.now()\n    }\n})(PROFILE_QUEUES_EVERY)\n","/** @module noa */\n\n/*!\n * noa: an experimental voxel game engine.\n * @url      github.com/fenomas/noa\n * @author   Andy Hall <andy@fenomas.com>\n * @license  MIT\n */\n\nimport vec3 from 'gl-vec3'\nimport ndarray from 'ndarray'\nimport { EventEmitter } from 'events'\nimport raycast from 'fast-voxel-raycast'\n\nimport { Inputs } from './lib/inputs'\nimport { Container } from './lib/container'\nimport { Camera } from './lib/camera'\nimport { Entities } from './lib/entities'\nimport ObjectMesher from './lib/objectMesher'\nimport TerrainMesher from './lib/terrainMesher'\nimport { Registry } from './lib/registry'\nimport { Rendering } from './lib/rendering'\nimport { Physics } from './lib/physics'\nimport { World } from './lib/world'\nimport { locationHasher } from './lib/util'\n\n\nimport packageJSON from '../package.json'\nvar version = packageJSON.version\n\n\n\n// profile every N ticks/renders\nvar PROFILE = 0\nvar PROFILE_RENDER = 0\n\n\nvar defaultOptions = {\n    debug: false,\n    silent: false,\n    silentBabylon: false,\n    playerHeight: 1.8,\n    playerWidth: 0.6,\n    playerStart: [0, 10, 0],\n    playerAutoStep: false,\n    tickRate: 30,           // ticks per second\n    maxRenderRate: 0,       // max FPS, 0 for uncapped \n    blockTestDistance: 10,\n    stickyPointerLock: true,\n    dragCameraOutsidePointerLock: true,\n    stickyFullscreen: false,\n    skipDefaultHighlighting: false,\n    originRebaseDistance: 25,\n}\n\n\n/**\n * Main engine class.  \n * Takes an object full of optional settings as a parameter.\n * \n * ```js\n * import { Engine } from 'noa-engine'\n * var noa = new Engine({\n *    debug: false,\n * })\n * ```\n * \n * Note that the options object is also passed to noa's \n * child modules ({@link Rendering}, {@link Container}, etc).\n * See docs for each module for their options.\n * \n * @emits tick(dt)\n * @emits beforeRender(dt)\n * @emits afterRender(dt)\n * @emits targetBlockChanged(blockDesc)\n*/\n\nexport class Engine extends EventEmitter {\n\n    /**\n     * The core Engine constructor uses the following options:\n     * \n     * ```js\n     * var defaultOptions = {\n     *    debug: false,\n     *    silent: false,\n     *    playerHeight: 1.8,\n     *    playerWidth: 0.6,\n     *    playerStart: [0, 10, 0],\n     *    playerAutoStep: false,\n     *    tickRate: 30,           // ticks per second\n     *    maxRenderRate: 0,       // max FPS, 0 for uncapped \n     *    blockTestDistance: 10,\n     *    stickyPointerLock: true,\n     *    dragCameraOutsidePointerLock: true,\n     *    stickyFullscreen: false,\n     *    skipDefaultHighlighting: false,\n     *    originRebaseDistance: 25,\n     * }\n     * ```\n    */\n    constructor(opts = {}) {\n        super()\n        opts = Object.assign({}, defaultOptions, opts)\n\n        /** Version string, e.g. `\"0.25.4\"` */\n        this.version = version\n        if (!opts.silent) {\n            var debugstr = (opts.debug) ? ' (debug)' : ''\n            console.log(`noa-engine v${this.version}${debugstr}`)\n        }\n\n        /** @internal */\n        this._paused = false\n\n        /** @internal */\n        this._dragOutsideLock = opts.dragCameraOutsidePointerLock\n\n        /** @internal */\n        this._originRebaseDistance = opts.originRebaseDistance\n\n        // world origin offset, used throughout engine for origin rebasing\n        /** @internal */\n        this.worldOriginOffset = [0, 0, 0]\n\n        // how far engine is into the current tick. Updated each render.\n        /** @internal */\n        this.positionInCurrentTick = 0\n\n        /** \n         * String identifier for the current world. \n         * It's safe to ignore this if your game has only one level/world. \n        */\n        this.worldName = 'default'\n\n        /**\n         * Multiplier for how fast time moves. Setting this to a value other than \n         * `1` will make the game speed up or slow down. This can significantly \n         * affect how core systems behave (particularly physics!).\n        */\n        this.timeScale = 1\n\n        /** Child module for managing the game's container, canvas, etc. */\n        this.container = new Container(this, opts)\n\n        /** The game's tick rate (number of ticks per second) \n         * @type {number}\n         * @readonly \n        */\n        this.tickRate = this.container._shell.tickRate\n        Object.defineProperty(this, 'tickRate', {\n            get: () => this.container._shell.tickRate\n        })\n\n        /** The game's max framerate (use `0` for uncapped)\n         * @type {number}\n         */\n        this.maxRenderRate = this.container._shell.maxRenderRate\n        Object.defineProperty(this, 'maxRenderRate', {\n            get: () => this.container._shell.maxRenderRate,\n            set: (v) => { this.container._shell.maxRenderRate = v || 0 },\n        })\n\n\n        /** Manages key and mouse input bindings */\n        this.inputs = new Inputs(this, opts, this.container.element)\n\n        /** A registry where voxel/material properties are managed */\n        this.registry = new Registry(this, opts)\n\n        /** Manages the world, chunks, and all voxel data */\n        this.world = new World(this, opts)\n\n        var _consoleLog = console.log\n        if (opts.silentBabylon) console.log = () => { }\n\n        /** Rendering manager */\n        this.rendering = new Rendering(this, opts, this.container.canvas)\n\n        if (opts.silentBabylon) console.log = _consoleLog\n\n        /** Physics engine - solves collisions, properties, etc. */\n        this.physics = new Physics(this, opts)\n\n        /** Entity manager / Entity Component System (ECS) */\n        this.entities = new Entities(this, opts)\n\n        /** Alias to `noa.entities` */\n        this.ents = this.entities\n        var ents = this.entities\n\n        /** Entity id for the player entity */\n        this.playerEntity = ents.add(\n            opts.playerStart, // starting location\n            opts.playerWidth, opts.playerHeight,\n            null, null, // no mesh for now, no meshOffset, \n            true, true\n        )\n\n        // make player entity it collide with terrain and other entities\n        ents.addComponent(this.playerEntity, ents.names.collideTerrain)\n        ents.addComponent(this.playerEntity, ents.names.collideEntities)\n\n        // adjust default physics parameters\n        var body = ents.getPhysics(this.playerEntity).body\n        body.gravityMultiplier = 2 // less floaty\n        body.autoStep = opts.playerAutoStep // auto step onto blocks\n\n        // input component - sets entity's movement state from key inputs\n        ents.addComponent(this.playerEntity, ents.names.receivesInputs)\n\n        // add a component to make player mesh fade out when zooming in\n        ents.addComponent(this.playerEntity, ents.names.fadeOnZoom)\n\n        // movement component - applies movement forces\n        ents.addComponent(this.playerEntity, ents.names.movement, {\n            airJumps: 1\n        })\n\n        /** Manages the game's camera, view angle, sensitivity, etc. */\n        this.camera = new Camera(this, opts)\n\n        /** How far to check for a solid voxel the player is currently looking at \n         * @type {number}\n        */\n        this.blockTestDistance = opts.blockTestDistance\n\n        /** \n         * Callback to determine which voxels can be targeted. \n         * Defaults to a solidity check, but can be overridden with arbitrary logic.\n         * @type {(blockID: number) => boolean} \n        */\n        this.blockTargetIdCheck = this.registry.getBlockSolidity\n\n        /** \n         * Dynamically updated object describing the currently targeted block.\n         * @type {null | { \n         *      blockID:number,\n         *      position: number[],\n         *      normal: number[],\n         *      adjacent: number[],\n         * }} \n        */\n        this.targetedBlock = null\n\n        // add a default block highlighting function\n        if (!opts.skipDefaultHighlighting) {\n            // the default listener, defined onto noa in case people want to remove it later\n            this.defaultBlockHighlightFunction = (tgt) => {\n                if (tgt) {\n                    this.rendering.highlightBlockFace(true, tgt.position, tgt.normal)\n                } else {\n                    this.rendering.highlightBlockFace(false)\n                }\n            }\n            this.on('targetBlockChanged', this.defaultBlockHighlightFunction)\n        }\n\n\n        /*\n         *\n         *      Various internals...\n         *\n        */\n\n        /** @internal */\n        this._terrainMesher = new TerrainMesher(this)\n\n        /** @internal */\n        this._objectMesher = new ObjectMesher(this)\n\n        /** @internal */\n        this._targetedBlockDat = {\n            blockID: 0,\n            position: vec3.create(),\n            normal: vec3.create(),\n            adjacent: vec3.create(),\n        }\n\n        /** @internal */\n        this._prevTargetHash = 0\n\n        /** @internal */\n        this.makeTargetHash = (pos, norm, id) => {\n            var N = locationHasher(pos[0] + id, pos[1], pos[2])\n            return N ^ locationHasher(norm[0], norm[1] + id, norm[2])\n        }\n\n        /** @internal */\n        this._pickPos = vec3.create()\n\n        /** @internal */\n        this._pickResult = {\n            _localPosition: vec3.create(),\n            position: [0, 0, 0],\n            normal: [0, 0, 0],\n        }\n\n\n\n\n\n        // temp hacks for development\n        if (opts.debug) {\n            // expose often-used classes\n            /** @internal */\n            this.vec3 = vec3\n            /** @internal */\n            this.ndarray = ndarray\n            // gameplay tweaks\n            ents.getMovement(1).airJumps = 999\n            // decorate window while making TS happy\n            var win = /** @type {any} */ (window)\n            win.noa = this\n            win.vec3 = vec3\n            win.ndarray = ndarray\n            win.scene = this.rendering._scene\n        }\n\n        // add hooks to throw helpful errors when using deprecated methods\n        deprecateStuff(this)\n    }\n\n\n\n    /*\n     *\n     *\n     *              Core Engine APIs\n     *\n     *\n    */\n\n    /**\n     * Tick function, called by container module at a fixed timestep. \n     * Clients should not normally need to call this manually.\n     * @internal\n    */\n\n    tick(dt) {\n        dt *= this.timeScale || 1\n\n        // note dt is a fixed value, not an observed delay\n        if (this._paused) {\n            if (this.world.worldGenWhilePaused) this.world.tick()\n            return\n        }\n        profile_hook('start')\n        checkWorldOffset(this)\n        this.world.tick() // chunk creation/removal\n        profile_hook('world')\n        if (!this.world.playerChunkLoaded) {\n            // when waiting on worldgen, just tick the meshing queue and exit\n            this.rendering.tick(dt)\n            return\n        }\n        this.physics.tick(dt) // iterates physics\n        profile_hook('physics')\n        this._objectMesher.tick() // rebuild objects if needed\n        this.rendering.tick(dt) // does deferred chunk meshing\n        profile_hook('rendering')\n        updateBlockTargets(this) // finds targeted blocks, and highlights one if needed\n        profile_hook('targets')\n        this.entities.tick(dt) // runs all entity systems\n        profile_hook('entities')\n        this.emit('tick', dt)\n        profile_hook('tick event')\n        profile_hook('end')\n        // clear accumulated scroll inputs (mouseMove is cleared on render)\n        var pst = this.inputs.pointerState\n        pst.scrollx = pst.scrolly = pst.scrollz = 0\n    }\n\n\n\n\n    /**\n     * Render function, called every animation frame. Emits #beforeRender(dt), #afterRender(dt) \n     * where dt is the time in ms *since the last tick*.\n     * Clients should not normally need to call this manually.\n     * @internal\n    */\n    render(dt, framePart) {\n        dt *= this.timeScale || 1\n\n        // note: framePart is how far we are into the current tick\n        // dt is the *actual* time (ms) since last render, for\n        // animating things that aren't tied to game tick rate\n\n        // frame position - for rendering movement between ticks\n        this.positionInCurrentTick = framePart\n\n        // when paused, just optionally ping worldgen, then exit\n        if (this._paused) {\n            if (this.world.worldGenWhilePaused) this.world.render()\n            return\n        }\n\n        profile_hook_render('start')\n\n        // only move camera during pointerlock or mousedown, or if pointerlock is unsupported\n        if (this.container.hasPointerLock ||\n            !this.container.supportsPointerLock ||\n            (this._dragOutsideLock && this.inputs.state.fire)) {\n            this.camera.applyInputsToCamera()\n        }\n        profile_hook_render('init')\n\n        // brief run through meshing queue\n        this.world.render()\n        profile_hook_render('meshing')\n\n        // entity render systems\n        this.camera.updateBeforeEntityRenderSystems()\n        this.entities.render(dt)\n        this.camera.updateAfterEntityRenderSystems()\n        profile_hook_render('entities')\n\n        // events and render\n        this.emit('beforeRender', dt)\n        profile_hook_render('before render')\n\n        this.rendering.render()\n        this.rendering.postRender()\n        profile_hook_render('render')\n\n        this.emit('afterRender', dt)\n        profile_hook_render('after render')\n        profile_hook_render('end')\n\n        // clear accumulated mouseMove inputs (scroll inputs cleared on render)\n        this.inputs.pointerState.dx = this.inputs.pointerState.dy = 0\n    }\n\n\n\n\n    /** Pausing the engine will also stop render/tick events, etc. */\n    setPaused(paused = false) {\n        this._paused = !!paused\n        // when unpausing, clear any built-up mouse inputs\n        if (!paused) {\n            this.inputs.pointerState.dx = this.inputs.pointerState.dy = 0\n        }\n    }\n\n    /** \n     * Get the voxel ID at the specified position\n    */\n    getBlock(x, y = 0, z = 0) {\n        if (x.length) return this.world.getBlockID(x[0], x[1], x[2])\n        return this.world.getBlockID(x, y, z)\n    }\n\n    /** \n     * Sets the voxel ID at the specified position. \n     * Does not check whether any entities are in the way! \n     */\n    setBlock(id, x, y = 0, z = 0) {\n        if (x.length) return this.world.setBlockID(id, x[0], x[1], x[2])\n        return this.world.setBlockID(id, x, y, z)\n    }\n\n    /**\n     * Adds a block, unless there's an entity in the way.\n    */\n    addBlock(id, x, y = 0, z = 0) {\n        // add a new terrain block, if nothing blocks the terrain there\n        if (x.length) {\n            if (this.entities.isTerrainBlocked(x[0], x[1], x[2])) return\n            this.world.setBlockID(id, x[0], x[1], x[2])\n            return id\n        } else {\n            if (this.entities.isTerrainBlocked(x, y, z)) return\n            this.world.setBlockID(id, x, y, z)\n            return id\n        }\n    }\n\n\n\n\n\n\n\n    /*\n     *              Rebasing local <-> global coords\n    */\n\n\n    /** \n     * Precisely converts a world position to the current internal \n     * local frame of reference.\n     * \n     * See `/docs/positions.md` for more info.\n     * \n     * Params: \n     *  * `global`: input position in global coords\n     *  * `globalPrecise`: (optional) sub-voxel offset to the global position\n     *  * `local`: output array which will receive the result\n     */\n    globalToLocal(global, globalPrecise, local) {\n        var off = this.worldOriginOffset\n        if (globalPrecise) {\n            for (var i = 0; i < 3; i++) {\n                var coord = global[i] - off[i]\n                coord += globalPrecise[i]\n                local[i] = coord\n            }\n            return local\n        } else {\n            return vec3.subtract(local, global, off)\n        }\n    }\n\n    /** \n     * Precisely converts a world position to the current internal \n     * local frame of reference.\n     * \n     * See `/docs/positions.md` for more info.\n     * \n     * Params: \n     *  * `local`: input array of local coords\n     *  * `global`: output array which receives the result\n     *  * `globalPrecise`: (optional) sub-voxel offset to the output global position\n     * \n     * If both output arrays are passed in, `global` will get int values and \n     * `globalPrecise` will get fractional parts. If only one array is passed in,\n     * `global` will get the whole output position.\n    */\n    localToGlobal(local, global, globalPrecise = null) {\n        var off = this.worldOriginOffset\n        if (globalPrecise) {\n            for (var i = 0; i < 3; i++) {\n                var floored = Math.floor(local[i])\n                global[i] = floored + off[i]\n                globalPrecise[i] = local[i] - floored\n            }\n            return global\n        } else {\n            return vec3.add(global, local, off)\n        }\n    }\n\n\n\n\n    /*\n     *              Picking / raycasting\n    */\n\n    /**\n     * Raycast through the world, returning a result object for any non-air block\n     * \n     * See `/docs/positions.md` for info on working with precise positions.\n     * \n     * @param {number[]} pos where to pick from (default: player's eye pos)\n     * @param {number[]} dir direction to pick along (default: camera vector)\n     * @param {number} dist pick distance (default: `noa.blockTestDistance`)\n     * @param {(id:number) => boolean} blockTestFunction which voxel IDs can be picked (default: any solid voxel)\n    */\n    pick(pos = null, dir = null, dist = -1, blockTestFunction = null) {\n        if (dist === 0) return null\n        // input position to local coords, if any\n        var pickPos = this._pickPos\n        if (pos) {\n            this.globalToLocal(pos, null, pickPos)\n            pos = pickPos\n        }\n        return this._localPick(pos, dir, dist, blockTestFunction)\n    }\n\n\n    /**\n     * @internal\n     * Do a raycast in local coords. \n     * See `/docs/positions.md` for more info.\n     * @param {number[]} pos where to pick from (default: player's eye pos)\n     * @param {number[]} dir direction to pick along (default: camera vector)\n     * @param {number} dist pick distance (default: `noa.blockTestDistance`)\n     * @param {(id:number) => boolean} blockTestFunction which voxel IDs can be picked (default: any solid voxel)\n     * @returns { null | {\n     *      position: number[],\n     *      normal: number[],\n     *      _localPosition: number[],\n     * }}\n     */\n    _localPick(pos = null, dir = null, dist = -1, blockTestFunction = null) {\n        // do a raycast in local coords - result obj will be in global coords\n        if (dist === 0) return null\n        var testFn = blockTestFunction || this.registry.getBlockSolidity\n        var world = this.world\n        var off = this.worldOriginOffset\n        var testVoxel = function (x, y, z) {\n            var id = world.getBlockID(x + off[0], y + off[1], z + off[2])\n            return testFn(id)\n        }\n        if (!pos) pos = this.camera._localGetTargetPosition()\n        dir = dir || this.camera.getDirection()\n        dist = dist || -1\n        if (dist < 0) dist = this.blockTestDistance\n        var result = this._pickResult\n        var rpos = result._localPosition\n        var rnorm = result.normal\n        var hit = raycast(testVoxel, pos, dir, dist, rpos, rnorm)\n        if (!hit) return null\n        // position is right on a voxel border - adjust it so that flooring works reliably\n        // adjust along normal direction, i.e. away from the block struck\n        vec3.scaleAndAdd(rpos, rpos, rnorm, 0.01)\n        // add global result\n        this.localToGlobal(rpos, result.position)\n        return result\n    }\n\n}\n\n\n\n/*\n * \n * \n * \n *                  INTERNAL HELPERS\n * \n * \n * \n * \n*/\n\n\n\n\n/*\n *\n *      rebase world origin offset around the player if necessary\n *\n*/\nfunction checkWorldOffset(noa) {\n    var lpos = noa.ents.getPositionData(noa.playerEntity)._localPosition\n    var cutoff = noa._originRebaseDistance\n    if (vec3.sqrLen(lpos) < cutoff * cutoff) return\n    var delta = []\n    for (var i = 0; i < 3; i++) {\n        delta[i] = Math.floor(lpos[i])\n        noa.worldOriginOffset[i] += delta[i]\n    }\n    noa.rendering._rebaseOrigin(delta)\n    noa.entities._rebaseOrigin(delta)\n    noa._objectMesher._rebaseOrigin(delta)\n}\n\n\n\n\n\n// Each frame, by default pick along the player's view vector \n// and tell rendering to highlight the struck block face\nfunction updateBlockTargets(noa) {\n    var newhash = 0\n    var blockIdFn = noa.blockTargetIdCheck || noa.registry.getBlockSolidity\n    var result = noa._localPick(null, null, null, blockIdFn)\n    if (result) {\n        var dat = noa._targetedBlockDat\n        // pick stops just shy of voxel boundary, so floored pos is the adjacent voxel\n        vec3.floor(dat.adjacent, result.position)\n        vec3.copy(dat.normal, result.normal)\n        vec3.subtract(dat.position, dat.adjacent, dat.normal)\n        dat.blockID = noa.world.getBlockID(dat.position[0], dat.position[1], dat.position[2])\n        noa.targetedBlock = dat\n        newhash = noa.makeTargetHash(dat.position, dat.normal, dat.blockID, locationHasher)\n    } else {\n        noa.targetedBlock = null\n    }\n    if (newhash != noa._prevTargetHash) {\n        noa.emit('targetBlockChanged', noa.targetedBlock)\n        noa._prevTargetHash = newhash\n    }\n}\n\n\n\n/*\n * \n *  add some hooks for guidance on removed APIs\n * \n */\n\nfunction deprecateStuff(noa) {\n    var ver = `0.27`\n    var dep = (loc, name, msg) => {\n        var throwFn = () => { throw `This property changed in ${ver} - ${msg}` }\n        Object.defineProperty(loc, name, { get: throwFn, set: throwFn })\n    }\n    dep(noa, 'getPlayerEyePosition', 'to get the camera/player offset see API docs for `noa.camera.cameraTarget`')\n    dep(noa, 'setPlayerEyePosition', 'to set the camera/player offset see API docs for `noa.camera.cameraTarget`')\n    dep(noa, 'getPlayerPosition', 'use `noa.ents.getPosition(noa.playerEntity)` or similar')\n    dep(noa, 'getCameraVector', 'use `noa.camera.getDirection`')\n    dep(noa, 'getPlayerMesh', 'use `noa.ents.getMeshData(noa.playerEntity).mesh` or similar')\n    dep(noa, 'playerBody', 'use `noa.ents.getPhysicsBody(noa.playerEntity)`')\n    dep(noa.rendering, 'zoomDistance', 'use `noa.camera.zoomDistance`')\n    dep(noa.rendering, '_currentZoom', 'use `noa.camera.currentZoom`')\n    dep(noa.rendering, '_cameraZoomSpeed', 'use `noa.camera.zoomSpeed`')\n    dep(noa.rendering, 'getCameraVector', 'use `noa.camera.getDirection`')\n    dep(noa.rendering, 'getCameraPosition', 'use `noa.camera.getLocalPosition`')\n    dep(noa.rendering, 'getCameraRotation', 'use `noa.camera.heading` and `noa.camera.pitch`')\n    dep(noa.rendering, 'setCameraRotation', 'to customize camera behavior see API docs for `noa.camera`')\n    ver = '0.28'\n    dep(noa.rendering, 'makeMeshInstance', 'removed, use Babylon\\'s `mesh.createInstance`')\n    dep(noa.world, '_maxChunksPendingCreation', 'use `maxChunksPendingCreation` (no \"_\")')\n    dep(noa.world, '_maxChunksPendingMeshing', 'use `maxChunksPendingMeshing` (no \"_\")')\n    dep(noa.world, '_maxProcessingPerTick', 'use `maxProcessingPerTick` (no \"_\")')\n    dep(noa.world, '_maxProcessingPerRender', 'use `maxProcessingPerRender` (no \"_\")')\n    ver = '0.29'\n    dep(noa, '_constants', 'removed, voxel IDs are no longer packed with bit flags')\n    ver = '0.30'\n    dep(noa, '_tickRate', 'tickRate is now at `noa.tickRate`')\n    dep(noa.container, '_tickRate', 'tickRate is now at `noa.tickRate`')\n    ver = '0.31'\n    dep(noa.world, 'chunkSize', 'effectively an internal, so changed to `_chunkSize`')\n    dep(noa.world, 'chunkAddDistance', 'set this with `noa.world.setAddRemoveDistance`')\n    dep(noa.world, 'chunkRemoveDistance', 'set this with `noa.world.setAddRemoveDistance`')\n}\n\n\n\n\n\nvar makeProfileHook = require('./lib/util').makeProfileHook\nvar profile_hook = (PROFILE > 0) ?\n    makeProfileHook(PROFILE, 'tick   ') : () => { }\nvar profile_hook_render = (PROFILE_RENDER > 0) ?\n    makeProfileHook(PROFILE_RENDER, 'render ') : () => { }\n","\n\n/* \n * \n *          noa hello-world example\n * \n *  This is a bare-minimum example world, intended to be a \n *  starting point for hacking on noa game world content.\n * \n*/\n\n\n\n// Engine options object, and engine instantiation:\n// import { Engine } from 'noa-engine'\n\n// or import from local filesystem when hacking locally:\nimport { Engine } from '../../../noa'\n\n\nvar opts = {\n    debug: true,\n    showFPS: true,\n    chunkSize: 32,\n    chunkAddDistance: 2.5,\n    chunkRemoveDistance: 3.5,\n    // See `test` example, or noa docs/source, for more options\n}\nvar noa = new Engine(opts)\n\n\n\n/*\n *\n *      Registering voxel types\n * \n *  Two step process. First you register a material, specifying the \n *  color/texture/etc. of a given block face, then you register a \n *  block, which specifies the materials for a given block type.\n * \n*/\n\n// block materials (just colors for this demo)\nvar brownish = [0.45, 0.36, 0.22]\nvar greenish = [0.1, 0.8, 0.2]\nnoa.registry.registerMaterial('dirt', { color: brownish })\nnoa.registry.registerMaterial('grass', { color: greenish })\n\n\n// block types and their material names\nvar dirtID = noa.registry.registerBlock(1, { material: 'dirt' })\nvar grassID = noa.registry.registerBlock(2, { material: 'grass' })\n\n\n\n\n/*\n * \n *      World generation\n * \n *  The world is divided into chunks, and `noa` will emit an \n *  `worldDataNeeded` event for each chunk of data it needs.\n *  The game client should catch this, and call \n *  `noa.world.setChunkData` whenever the world data is ready.\n *  (The latter can be done asynchronously.)\n * \n*/\n\n// simple height map worldgen function\nfunction getVoxelID(x, y, z) {\n    if (y < -3) return dirtID\n    var height = 2 * Math.sin(x / 10) + 3 * Math.cos(z / 20)\n    if (y < height) return grassID\n    return 0 // signifying empty space\n}\n\n// register for world events\nnoa.world.on('worldDataNeeded', function (id, data, x, y, z) {\n    // `id` - a unique string id for the chunk\n    // `data` - an `ndarray` of voxel ID data (see: https://github.com/scijs/ndarray)\n    // `x, y, z` - world coords of the corner of the chunk\n    for (var i = 0; i < data.shape[0]; i++) {\n        for (var j = 0; j < data.shape[1]; j++) {\n            for (var k = 0; k < data.shape[2]; k++) {\n                var voxelID = getVoxelID(x + i, y + j, z + k)\n                data.set(i, j, k, voxelID)\n            }\n        }\n    }\n    // tell noa the chunk's terrain data is now set\n    noa.world.setChunkData(id, data)\n})\n\n\n\n\n/*\n * \n *      Create a mesh to represent the player:\n * \n*/\n\n// get the player entity's ID and other info (position, size, ..)\nvar player = noa.playerEntity\nvar dat = noa.entities.getPositionData(player)\nvar w = dat.width\nvar h = dat.height\n\n// add a mesh to represent the player, and scale it, etc.\nimport { Mesh } from '@babylonjs/core/Meshes/mesh'\nimport '@babylonjs/core/Meshes/Builders/boxBuilder'\n\nvar scene = noa.rendering.getScene()\nvar mesh = Mesh.CreateBox('player-mesh', 1, scene)\nmesh.scaling.x = w\nmesh.scaling.z = w\nmesh.scaling.y = h\n\n\n// add \"mesh\" component to the player entity\n// this causes the mesh to move around in sync with the player entity\nnoa.entities.addComponent(player, noa.entities.names.mesh, {\n    mesh: mesh,\n    // offset vector is needed because noa positions are always the \n    // bottom-center of the entity, and Babylon's CreateBox gives a \n    // mesh registered at the center of the box\n    offset: [0, h / 2, 0],\n})\n\n\n\n/*\n * \n *      Minimal interactivity \n * \n*/\n\n// clear targeted block on on left click\nnoa.inputs.down.on('fire', function () {\n    if (noa.targetedBlock) {\n        var pos = noa.targetedBlock.position\n        noa.setBlock(0, pos[0], pos[1], pos[2])\n    }\n})\n\n// place some grass on right click\nnoa.inputs.down.on('alt-fire', function () {\n    if (noa.targetedBlock) {\n        var pos = noa.targetedBlock.adjacent\n        noa.setBlock(grassID, pos[0], pos[1], pos[2])\n    }\n})\n\n// add a key binding for \"E\" to do the same as alt-fire\nnoa.inputs.bind('alt-fire', 'KeyE')\n\n\n// each tick, consume any scroll events and use them to zoom camera\nnoa.on('tick', function (dt) {\n    var scroll = noa.inputs.pointerState.scrolly\n    if (scroll !== 0) {\n        noa.camera.zoomDistance += (scroll > 0) ? 1 : -1\n        if (noa.camera.zoomDistance < 0) noa.camera.zoomDistance = 0\n        if (noa.camera.zoomDistance > 10) noa.camera.zoomDistance = 10\n    }\n})\n","'use strict'\n\nvar bits = require('bit-twiddle')\nvar dup = require('dup')\nvar isBuffer = require('is-buffer')\n\n//Legacy pool support\nif(!global.__TYPEDARRAY_POOL) {\n  global.__TYPEDARRAY_POOL = {\n      UINT8   : dup([32, 0])\n    , UINT16  : dup([32, 0])\n    , UINT32  : dup([32, 0])\n    , INT8    : dup([32, 0])\n    , INT16   : dup([32, 0])\n    , INT32   : dup([32, 0])\n    , FLOAT   : dup([32, 0])\n    , DOUBLE  : dup([32, 0])\n    , DATA    : dup([32, 0])\n    , UINT8C  : dup([32, 0])\n    , BUFFER  : dup([32, 0])\n  }\n}\n\nvar hasUint8C = (typeof Uint8ClampedArray) !== 'undefined'\nvar POOL = global.__TYPEDARRAY_POOL\n\n//Upgrade pool\nif(!POOL.UINT8C) {\n  POOL.UINT8C = dup([32, 0])\n}\nif(!POOL.BUFFER) {\n  POOL.BUFFER = dup([32, 0])\n}\n\n//New technique: Only allocate from ArrayBufferView and Buffer\nvar DATA    = POOL.DATA\n  , BUFFER  = POOL.BUFFER\n\nexports.free = function free(array) {\n  if(isBuffer(array)) {\n    BUFFER[bits.log2(array.length)].push(array)\n  } else {\n    if(Object.prototype.toString.call(array) !== '[object ArrayBuffer]') {\n      array = array.buffer\n    }\n    if(!array) {\n      return\n    }\n    var n = array.length || array.byteLength\n    var log_n = bits.log2(n)|0\n    DATA[log_n].push(array)\n  }\n}\n\nfunction freeArrayBuffer(buffer) {\n  if(!buffer) {\n    return\n  }\n  var n = buffer.length || buffer.byteLength\n  var log_n = bits.log2(n)\n  DATA[log_n].push(buffer)\n}\n\nfunction freeTypedArray(array) {\n  freeArrayBuffer(array.buffer)\n}\n\nexports.freeUint8 =\nexports.freeUint16 =\nexports.freeUint32 =\nexports.freeInt8 =\nexports.freeInt16 =\nexports.freeInt32 =\nexports.freeFloat32 = \nexports.freeFloat =\nexports.freeFloat64 = \nexports.freeDouble = \nexports.freeUint8Clamped = \nexports.freeDataView = freeTypedArray\n\nexports.freeArrayBuffer = freeArrayBuffer\n\nexports.freeBuffer = function freeBuffer(array) {\n  BUFFER[bits.log2(array.length)].push(array)\n}\n\nexports.malloc = function malloc(n, dtype) {\n  if(dtype === undefined || dtype === 'arraybuffer') {\n    return mallocArrayBuffer(n)\n  } else {\n    switch(dtype) {\n      case 'uint8':\n        return mallocUint8(n)\n      case 'uint16':\n        return mallocUint16(n)\n      case 'uint32':\n        return mallocUint32(n)\n      case 'int8':\n        return mallocInt8(n)\n      case 'int16':\n        return mallocInt16(n)\n      case 'int32':\n        return mallocInt32(n)\n      case 'float':\n      case 'float32':\n        return mallocFloat(n)\n      case 'double':\n      case 'float64':\n        return mallocDouble(n)\n      case 'uint8_clamped':\n        return mallocUint8Clamped(n)\n      case 'buffer':\n        throw 'Buffer not supported'\n      case 'data':\n      case 'dataview':\n        return mallocDataView(n)\n\n      default:\n        return null\n    }\n  }\n  return null\n}\n\nfunction mallocArrayBuffer(n) {\n  var n = bits.nextPow2(n)\n  var log_n = bits.log2(n)\n  var d = DATA[log_n]\n  if(d.length > 0) {\n    return d.pop()\n  }\n  return new ArrayBuffer(n)\n}\nexports.mallocArrayBuffer = mallocArrayBuffer\n\nfunction mallocUint8(n) {\n  return new Uint8Array(mallocArrayBuffer(n), 0, n)\n}\nexports.mallocUint8 = mallocUint8\n\nfunction mallocUint16(n) {\n  return new Uint16Array(mallocArrayBuffer(2*n), 0, n)\n}\nexports.mallocUint16 = mallocUint16\n\nfunction mallocUint32(n) {\n  return new Uint32Array(mallocArrayBuffer(4*n), 0, n)\n}\nexports.mallocUint32 = mallocUint32\n\nfunction mallocInt8(n) {\n  return new Int8Array(mallocArrayBuffer(n), 0, n)\n}\nexports.mallocInt8 = mallocInt8\n\nfunction mallocInt16(n) {\n  return new Int16Array(mallocArrayBuffer(2*n), 0, n)\n}\nexports.mallocInt16 = mallocInt16\n\nfunction mallocInt32(n) {\n  return new Int32Array(mallocArrayBuffer(4*n), 0, n)\n}\nexports.mallocInt32 = mallocInt32\n\nfunction mallocFloat(n) {\n  return new Float32Array(mallocArrayBuffer(4*n), 0, n)\n}\nexports.mallocFloat32 = exports.mallocFloat = mallocFloat\n\nfunction mallocDouble(n) {\n  return new Float64Array(mallocArrayBuffer(8*n), 0, n)\n}\nexports.mallocFloat64 = exports.mallocDouble = mallocDouble\n\nfunction mallocUint8Clamped(n) {\n  if(hasUint8C) {\n    return new Uint8ClampedArray(mallocArrayBuffer(n), 0, n)\n  } else {\n    return mallocUint8(n)\n  }\n}\nexports.mallocUint8Clamped = mallocUint8Clamped\n\nfunction mallocDataView(n) {\n  return new DataView(mallocArrayBuffer(n), 0, n)\n}\nexports.mallocDataView = mallocDataView\n\nexports.clearCache = function clearCache() {\n  for(var i=0; i<32; ++i) {\n    POOL.UINT8[i].length = 0\n    POOL.UINT16[i].length = 0\n    POOL.UINT32[i].length = 0\n    POOL.INT8[i].length = 0\n    POOL.INT16[i].length = 0\n    POOL.INT32[i].length = 0\n    POOL.FLOAT[i].length = 0\n    POOL.DOUBLE[i].length = 0\n    POOL.UINT8C[i].length = 0\n    DATA[i].length = 0\n    BUFFER[i].length = 0\n  }\n}","module.exports = AABB\n\nvar vec3 = require('gl-vec3')\n\nfunction AABB(pos, vec) {\n\n  if(!(this instanceof AABB)) {\n    return new AABB(pos, vec)\n  }\n\n  var pos2 = vec3.create()\n  vec3.add(pos2, pos, vec)\n \n  this.base = vec3.min(vec3.create(), pos, pos2)\n  this.vec = vec3.clone(vec)\n  this.max = vec3.max(vec3.create(), pos, pos2)\n\n  this.mag = vec3.length(this.vec)\n\n}\n\nvar cons = AABB\n  , proto = cons.prototype\n\nproto.width = function() {\n  return this.vec[0]\n}\n\nproto.height = function() {\n  return this.vec[1]\n}\n\nproto.depth = function() {\n  return this.vec[2]\n}\n\nproto.x0 = function() {\n  return this.base[0]\n}\n\nproto.y0 = function() {\n  return this.base[1]\n}\n\nproto.z0 = function() {\n  return this.base[2]\n}\n\nproto.x1 = function() {\n  return this.max[0]\n}\n\nproto.y1 = function() {\n  return this.max[1]\n}\n\nproto.z1 = function() {\n  return this.max[2]\n}\n\nproto.translate = function(by) {\n  vec3.add(this.max, this.max, by)\n  vec3.add(this.base, this.base, by)\n  return this\n}\n\nproto.setPosition = function(pos) {\n  vec3.add(this.max, pos, this.vec)\n  vec3.copy(this.base, pos)\n  return this\n}\n\nproto.expand = function(aabb) {\n  var max = vec3.create()\n    , min = vec3.create()\n\n  vec3.max(max, aabb.max, this.max)\n  vec3.min(min, aabb.base, this.base)\n  vec3.subtract(max, max, min)\n\n  return new AABB(min, max)\n}\n\nproto.intersects = function(aabb) {\n  if(aabb.base[0] > this.max[0]) return false\n  if(aabb.base[1] > this.max[1]) return false\n  if(aabb.base[2] > this.max[2]) return false\n  if(aabb.max[0] < this.base[0]) return false\n  if(aabb.max[1] < this.base[1]) return false\n  if(aabb.max[2] < this.base[2]) return false\n\n  return true\n}\n\nproto.touches = function(aabb) {\n\n  var intersection = this.union(aabb);\n\n  return (intersection !== null) &&\n         ((intersection.width() == 0) ||\n         (intersection.height() == 0) || \n         (intersection.depth() == 0))\n\n}\n\nproto.union = function(aabb) {\n  if(!this.intersects(aabb)) return null\n\n  var base_x = Math.max(aabb.base[0], this.base[0])\n    , base_y = Math.max(aabb.base[1], this.base[1])\n    , base_z = Math.max(aabb.base[2], this.base[2])\n    , max_x = Math.min(aabb.max[0], this.max[0])\n    , max_y = Math.min(aabb.max[1], this.max[1])\n    , max_z = Math.min(aabb.max[2], this.max[2])\n\n  return new AABB([base_x, base_y, base_z], [max_x - base_x, max_y - base_y, max_z - base_z])\n}\n\n\n\n\n","/**\n * Bit twiddling hacks for JavaScript.\n *\n * Author: Mikola Lysenko\n *\n * Ported from Stanford bit twiddling hack library:\n *    http://graphics.stanford.edu/~seander/bithacks.html\n */\n\n\"use strict\"; \"use restrict\";\n\n//Number of bits in an integer\nvar INT_BITS = 32;\n\n//Constants\nexports.INT_BITS  = INT_BITS;\nexports.INT_MAX   =  0x7fffffff;\nexports.INT_MIN   = -1<<(INT_BITS-1);\n\n//Returns -1, 0, +1 depending on sign of x\nexports.sign = function(v) {\n  return (v > 0) - (v < 0);\n}\n\n//Computes absolute value of integer\nexports.abs = function(v) {\n  var mask = v >> (INT_BITS-1);\n  return (v ^ mask) - mask;\n}\n\n//Computes minimum of integers x and y\nexports.min = function(x, y) {\n  return y ^ ((x ^ y) & -(x < y));\n}\n\n//Computes maximum of integers x and y\nexports.max = function(x, y) {\n  return x ^ ((x ^ y) & -(x < y));\n}\n\n//Checks if a number is a power of two\nexports.isPow2 = function(v) {\n  return !(v & (v-1)) && (!!v);\n}\n\n//Computes log base 2 of v\nexports.log2 = function(v) {\n  var r, shift;\n  r =     (v > 0xFFFF) << 4; v >>>= r;\n  shift = (v > 0xFF  ) << 3; v >>>= shift; r |= shift;\n  shift = (v > 0xF   ) << 2; v >>>= shift; r |= shift;\n  shift = (v > 0x3   ) << 1; v >>>= shift; r |= shift;\n  return r | (v >> 1);\n}\n\n//Computes log base 10 of v\nexports.log10 = function(v) {\n  return  (v >= 1000000000) ? 9 : (v >= 100000000) ? 8 : (v >= 10000000) ? 7 :\n          (v >= 1000000) ? 6 : (v >= 100000) ? 5 : (v >= 10000) ? 4 :\n          (v >= 1000) ? 3 : (v >= 100) ? 2 : (v >= 10) ? 1 : 0;\n}\n\n//Counts number of bits\nexports.popCount = function(v) {\n  v = v - ((v >>> 1) & 0x55555555);\n  v = (v & 0x33333333) + ((v >>> 2) & 0x33333333);\n  return ((v + (v >>> 4) & 0xF0F0F0F) * 0x1010101) >>> 24;\n}\n\n//Counts number of trailing zeros\nfunction countTrailingZeros(v) {\n  var c = 32;\n  v &= -v;\n  if (v) c--;\n  if (v & 0x0000FFFF) c -= 16;\n  if (v & 0x00FF00FF) c -= 8;\n  if (v & 0x0F0F0F0F) c -= 4;\n  if (v & 0x33333333) c -= 2;\n  if (v & 0x55555555) c -= 1;\n  return c;\n}\nexports.countTrailingZeros = countTrailingZeros;\n\n//Rounds to next power of 2\nexports.nextPow2 = function(v) {\n  v += v === 0;\n  --v;\n  v |= v >>> 1;\n  v |= v >>> 2;\n  v |= v >>> 4;\n  v |= v >>> 8;\n  v |= v >>> 16;\n  return v + 1;\n}\n\n//Rounds down to previous power of 2\nexports.prevPow2 = function(v) {\n  v |= v >>> 1;\n  v |= v >>> 2;\n  v |= v >>> 4;\n  v |= v >>> 8;\n  v |= v >>> 16;\n  return v - (v>>>1);\n}\n\n//Computes parity of word\nexports.parity = function(v) {\n  v ^= v >>> 16;\n  v ^= v >>> 8;\n  v ^= v >>> 4;\n  v &= 0xf;\n  return (0x6996 >>> v) & 1;\n}\n\nvar REVERSE_TABLE = new Array(256);\n\n(function(tab) {\n  for(var i=0; i<256; ++i) {\n    var v = i, r = i, s = 7;\n    for (v >>>= 1; v; v >>>= 1) {\n      r <<= 1;\n      r |= v & 1;\n      --s;\n    }\n    tab[i] = (r << s) & 0xff;\n  }\n})(REVERSE_TABLE);\n\n//Reverse bits in a 32 bit word\nexports.reverse = function(v) {\n  return  (REVERSE_TABLE[ v         & 0xff] << 24) |\n          (REVERSE_TABLE[(v >>> 8)  & 0xff] << 16) |\n          (REVERSE_TABLE[(v >>> 16) & 0xff] << 8)  |\n           REVERSE_TABLE[(v >>> 24) & 0xff];\n}\n\n//Interleave bits of 2 coordinates with 16 bits.  Useful for fast quadtree codes\nexports.interleave2 = function(x, y) {\n  x &= 0xFFFF;\n  x = (x | (x << 8)) & 0x00FF00FF;\n  x = (x | (x << 4)) & 0x0F0F0F0F;\n  x = (x | (x << 2)) & 0x33333333;\n  x = (x | (x << 1)) & 0x55555555;\n\n  y &= 0xFFFF;\n  y = (y | (y << 8)) & 0x00FF00FF;\n  y = (y | (y << 4)) & 0x0F0F0F0F;\n  y = (y | (y << 2)) & 0x33333333;\n  y = (y | (y << 1)) & 0x55555555;\n\n  return x | (y << 1);\n}\n\n//Extracts the nth interleaved component\nexports.deinterleave2 = function(v, n) {\n  v = (v >>> n) & 0x55555555;\n  v = (v | (v >>> 1))  & 0x33333333;\n  v = (v | (v >>> 2))  & 0x0F0F0F0F;\n  v = (v | (v >>> 4))  & 0x00FF00FF;\n  v = (v | (v >>> 16)) & 0x000FFFF;\n  return (v << 16) >> 16;\n}\n\n\n//Interleave bits of 3 coordinates, each with 10 bits.  Useful for fast octree codes\nexports.interleave3 = function(x, y, z) {\n  x &= 0x3FF;\n  x  = (x | (x<<16)) & 4278190335;\n  x  = (x | (x<<8))  & 251719695;\n  x  = (x | (x<<4))  & 3272356035;\n  x  = (x | (x<<2))  & 1227133513;\n\n  y &= 0x3FF;\n  y  = (y | (y<<16)) & 4278190335;\n  y  = (y | (y<<8))  & 251719695;\n  y  = (y | (y<<4))  & 3272356035;\n  y  = (y | (y<<2))  & 1227133513;\n  x |= (y << 1);\n  \n  z &= 0x3FF;\n  z  = (z | (z<<16)) & 4278190335;\n  z  = (z | (z<<8))  & 251719695;\n  z  = (z | (z<<4))  & 3272356035;\n  z  = (z | (z<<2))  & 1227133513;\n  \n  return x | (z << 2);\n}\n\n//Extracts nth interleaved component of a 3-tuple\nexports.deinterleave3 = function(v, n) {\n  v = (v >>> n)       & 1227133513;\n  v = (v | (v>>>2))   & 3272356035;\n  v = (v | (v>>>4))   & 251719695;\n  v = (v | (v>>>8))   & 4278190335;\n  v = (v | (v>>>16))  & 0x3FF;\n  return (v<<22)>>22;\n}\n\n//Computes next combination in colexicographic order (this is mistakenly called nextPermutation on the bit twiddling hacks page)\nexports.nextCombination = function(v) {\n  var t = v | (v - 1);\n  return (t + 1) | (((~t & -~t) - 1) >>> (countTrailingZeros(v) + 1));\n}\n\n","'use strict'\n\nmodule.exports = boxIntersectWrapper\n\nvar pool = require('@jpweeks/typedarray-pool')\nvar sweep = require('./lib/sweep')\nvar boxIntersectIter = require('./lib/intersect')\n\nfunction boxEmpty(d, box) {\n  for(var j=0; j<d; ++j) {\n    if(!(box[j] <= box[j+d])) {\n      return true\n    }\n  }\n  return false\n}\n\n//Unpack boxes into a flat typed array, remove empty boxes\nfunction convertBoxes(boxes, d, data, ids) {\n  var ptr = 0\n  var count = 0\n  for(var i=0, n=boxes.length; i<n; ++i) {\n    var b = boxes[i]\n    if(boxEmpty(d, b)) {\n      continue\n    }\n    for(var j=0; j<2*d; ++j) {\n      data[ptr++] = b[j]\n    }\n    ids[count++] = i\n  }\n  return count\n}\n\n//Perform type conversions, check bounds\nfunction boxIntersect(red, blue, visit, full) {\n  var n = red.length\n  var m = blue.length\n\n  //If either array is empty, then we can skip this whole thing\n  if(n <= 0 || m <= 0) {\n    return\n  }\n\n  //Compute dimension, if it is 0 then we skip\n  var d = (red[0].length)>>>1\n  if(d <= 0) {\n    return\n  }\n\n  var retval\n\n  //Convert red boxes\n  var redList  = pool.mallocDouble(2*d*n)\n  var redIds   = pool.mallocInt32(n)\n  n = convertBoxes(red, d, redList, redIds)\n\n  if(n > 0) {\n    if(d === 1 && full) {\n      //Special case: 1d complete\n      sweep.init(n)\n      retval = sweep.sweepComplete(\n        d, visit, \n        0, n, redList, redIds,\n        0, n, redList, redIds)\n    } else {\n\n      //Convert blue boxes\n      var blueList = pool.mallocDouble(2*d*m)\n      var blueIds  = pool.mallocInt32(m)\n      m = convertBoxes(blue, d, blueList, blueIds)\n\n      if(m > 0) {\n        sweep.init(n+m)\n\n        if(d === 1) {\n          //Special case: 1d bipartite\n          retval = sweep.sweepBipartite(\n            d, visit, \n            0, n, redList,  redIds,\n            0, m, blueList, blueIds)\n        } else {\n          //General case:  d>1\n          retval = boxIntersectIter(\n            d, visit,    full,\n            n, redList,  redIds,\n            m, blueList, blueIds)\n        }\n\n        pool.free(blueList)\n        pool.free(blueIds)\n      }\n    }\n\n    pool.free(redList)\n    pool.free(redIds)\n  }\n\n  return retval\n}\n\n\nvar RESULT\n\nfunction appendItem(i,j) {\n  RESULT.push([i,j])\n}\n\nfunction intersectFullArray(x) {\n  RESULT = []\n  boxIntersect(x, x, appendItem, true)\n  return RESULT\n}\n\nfunction intersectBipartiteArray(x, y) {\n  RESULT = []\n  boxIntersect(x, y, appendItem, false)\n  return RESULT\n}\n\n//User-friendly wrapper, handle full input and no-visitor cases\nfunction boxIntersectWrapper(arg0, arg1, arg2) {\n  var result\n  switch(arguments.length) {\n    case 1:\n      return intersectFullArray(arg0)\n    case 2:\n      if(typeof arg1 === 'function') {\n        return boxIntersect(arg0, arg0, arg1, true)\n      } else {\n        return intersectBipartiteArray(arg0, arg1)\n      }\n    case 3:\n      return boxIntersect(arg0, arg1, arg2, false)\n    default:\n      throw new Error('box-intersect: Invalid arguments')\n  }\n}","'use strict'\n\nvar DIMENSION   = 'd'\nvar AXIS        = 'ax'\nvar VISIT       = 'vv'\nvar FLIP        = 'fp'\n\nvar ELEM_SIZE   = 'es'\n\nvar RED_START   = 'rs'\nvar RED_END     = 're'\nvar RED_BOXES   = 'rb'\nvar RED_INDEX   = 'ri'\nvar RED_PTR     = 'rp'\n\nvar BLUE_START  = 'bs'\nvar BLUE_END    = 'be'\nvar BLUE_BOXES  = 'bb'\nvar BLUE_INDEX  = 'bi'\nvar BLUE_PTR    = 'bp'\n\nvar RETVAL      = 'rv'\n\nvar INNER_LABEL = 'Q'\n\nvar ARGS = [\n  DIMENSION,\n  AXIS,\n  VISIT,\n  RED_START,\n  RED_END,\n  RED_BOXES,\n  RED_INDEX,\n  BLUE_START,\n  BLUE_END,\n  BLUE_BOXES,\n  BLUE_INDEX\n]\n\nfunction generateBruteForce(redMajor, flip, full) {\n  var funcName = 'bruteForce' + \n    (redMajor ? 'Red' : 'Blue') + \n    (flip ? 'Flip' : '') +\n    (full ? 'Full' : '')\n\n  var code = ['function ', funcName, '(', ARGS.join(), '){',\n    'var ', ELEM_SIZE, '=2*', DIMENSION, ';']\n\n  var redLoop = \n    'for(var i=' + RED_START + ',' + RED_PTR + '=' + ELEM_SIZE + '*' + RED_START + ';' +\n        'i<' + RED_END +';' +\n        '++i,' + RED_PTR + '+=' + ELEM_SIZE + '){' +\n        'var x0=' + RED_BOXES + '[' + AXIS + '+' + RED_PTR + '],' +\n            'x1=' + RED_BOXES + '[' + AXIS + '+' + RED_PTR + '+' + DIMENSION + '],' +\n            'xi=' + RED_INDEX + '[i];'\n\n  var blueLoop = \n    'for(var j=' + BLUE_START + ',' + BLUE_PTR + '=' + ELEM_SIZE + '*' + BLUE_START + ';' +\n        'j<' + BLUE_END + ';' +\n        '++j,' + BLUE_PTR + '+=' + ELEM_SIZE + '){' +\n        'var y0=' + BLUE_BOXES + '[' + AXIS + '+' + BLUE_PTR + '],' +\n            (full ? 'y1=' + BLUE_BOXES + '[' + AXIS + '+' + BLUE_PTR + '+' + DIMENSION + '],' : '') +\n            'yi=' + BLUE_INDEX + '[j];'\n\n  if(redMajor) {\n    code.push(redLoop, INNER_LABEL, ':', blueLoop)\n  } else {\n    code.push(blueLoop, INNER_LABEL, ':', redLoop)\n  }\n\n  if(full) {\n    code.push('if(y1<x0||x1<y0)continue;')\n  } else if(flip) {\n    code.push('if(y0<=x0||x1<y0)continue;')\n  } else {\n    code.push('if(y0<x0||x1<y0)continue;')\n  }\n\n  code.push('for(var k='+AXIS+'+1;k<'+DIMENSION+';++k){'+\n    'var r0='+RED_BOXES+'[k+'+RED_PTR+'],'+\n        'r1='+RED_BOXES+'[k+'+DIMENSION+'+'+RED_PTR+'],'+\n        'b0='+BLUE_BOXES+'[k+'+BLUE_PTR+'],'+\n        'b1='+BLUE_BOXES+'[k+'+DIMENSION+'+'+BLUE_PTR+'];'+\n      'if(r1<b0||b1<r0)continue ' + INNER_LABEL + ';}' +\n      'var ' + RETVAL + '=' + VISIT + '(')\n\n  if(flip) {\n    code.push('yi,xi')\n  } else {\n    code.push('xi,yi')\n  }\n\n  code.push(');if(' + RETVAL + '!==void 0)return ' + RETVAL + ';}}}')\n\n  return {\n    name: funcName, \n    code: code.join('')\n  }\n}\n\nfunction bruteForcePlanner(full) {\n  var funcName = 'bruteForce' + (full ? 'Full' : 'Partial')\n  var prefix = []\n  var fargs = ARGS.slice()\n  if(!full) {\n    fargs.splice(3, 0, FLIP)\n  }\n\n  var code = ['function ' + funcName + '(' + fargs.join() + '){']\n\n  function invoke(redMajor, flip) {\n    var res = generateBruteForce(redMajor, flip, full)\n    prefix.push(res.code)\n    code.push('return ' + res.name + '(' + ARGS.join() + ');')\n  }\n\n  code.push('if(' + RED_END + '-' + RED_START + '>' +\n                    BLUE_END + '-' + BLUE_START + '){')\n\n  if(full) {\n    invoke(true, false)\n    code.push('}else{')\n    invoke(false, false)\n  } else {\n    code.push('if(' + FLIP + '){')\n    invoke(true, true)\n    code.push('}else{')\n    invoke(true, false)\n    code.push('}}else{if(' + FLIP + '){')\n    invoke(false, true)\n    code.push('}else{')\n    invoke(false, false)\n    code.push('}')\n  }\n  code.push('}}return ' + funcName)\n\n  var codeStr = prefix.join('') + code.join('')\n  var proc = new Function(codeStr)\n  return proc()\n}\n\n\nexports.partial = bruteForcePlanner(false)\nexports.full    = bruteForcePlanner(true)","'use strict'\n\nmodule.exports = boxIntersectIter\n\nvar pool = require('@jpweeks/typedarray-pool')\nvar bits = require('bit-twiddle')\nvar bruteForce = require('./brute')\nvar bruteForcePartial = bruteForce.partial\nvar bruteForceFull = bruteForce.full\nvar sweep = require('./sweep')\nvar findMedian = require('./median')\nvar genPartition = require('./partition')\n\n//Twiddle parameters\nvar BRUTE_FORCE_CUTOFF    = 128       //Cut off for brute force search\nvar SCAN_CUTOFF           = (1<<22)   //Cut off for two way scan\nvar SCAN_COMPLETE_CUTOFF  = (1<<22)  \n\n//Partition functions\nvar partitionInteriorContainsInterval = genPartition(\n  '!(lo>=p0)&&!(p1>=hi)', \n  ['p0', 'p1'])\n\nvar partitionStartEqual = genPartition(\n  'lo===p0',\n  ['p0'])\n\nvar partitionStartLessThan = genPartition(\n  'lo<p0',\n  ['p0'])\n\nvar partitionEndLessThanEqual = genPartition(\n  'hi<=p0',\n  ['p0'])\n\nvar partitionContainsPoint = genPartition(\n  'lo<=p0&&p0<=hi',\n  ['p0'])\n\nvar partitionContainsPointProper = genPartition(\n  'lo<p0&&p0<=hi',\n  ['p0'])\n\n//Frame size for iterative loop\nvar IFRAME_SIZE = 6\nvar DFRAME_SIZE = 2\n\n//Data for box statck\nvar INIT_CAPACITY = 1024\nvar BOX_ISTACK  = pool.mallocInt32(INIT_CAPACITY)\nvar BOX_DSTACK  = pool.mallocDouble(INIT_CAPACITY)\n\n//Initialize iterative loop queue\nfunction iterInit(d, count) {\n  var levels = (8 * bits.log2(count+1) * (d+1))|0\n  var maxInts = bits.nextPow2(IFRAME_SIZE*levels)\n  if(BOX_ISTACK.length < maxInts) {\n    pool.free(BOX_ISTACK)\n    BOX_ISTACK = pool.mallocInt32(maxInts)\n  }\n  var maxDoubles = bits.nextPow2(DFRAME_SIZE*levels)\n  if(BOX_DSTACK.length < maxDoubles) {\n    pool.free(BOX_DSTACK)\n    BOX_DSTACK = pool.mallocDouble(maxDoubles)\n  }\n}\n\n//Append item to queue\nfunction iterPush(ptr,\n  axis, \n  redStart, redEnd, \n  blueStart, blueEnd, \n  state, \n  lo, hi) {\n\n  var iptr = IFRAME_SIZE * ptr\n  BOX_ISTACK[iptr]   = axis\n  BOX_ISTACK[iptr+1] = redStart\n  BOX_ISTACK[iptr+2] = redEnd\n  BOX_ISTACK[iptr+3] = blueStart\n  BOX_ISTACK[iptr+4] = blueEnd\n  BOX_ISTACK[iptr+5] = state\n\n  var dptr = DFRAME_SIZE * ptr\n  BOX_DSTACK[dptr]   = lo\n  BOX_DSTACK[dptr+1] = hi\n}\n\n//Special case:  Intersect single point with list of intervals\nfunction onePointPartial(\n  d, axis, visit, flip,\n  redStart, redEnd, red, redIndex,\n  blueOffset, blue, blueId) {\n\n  var elemSize = 2 * d\n  var bluePtr  = blueOffset * elemSize\n  var blueX    = blue[bluePtr + axis]\n\nred_loop:\n  for(var i=redStart, redPtr=redStart*elemSize; i<redEnd; ++i, redPtr+=elemSize) {\n    var r0 = red[redPtr+axis]\n    var r1 = red[redPtr+axis+d]\n    if(blueX < r0 || r1 < blueX) {\n      continue\n    }\n    if(flip && blueX === r0) {\n      continue\n    }\n    var redId = redIndex[i]\n    for(var j=axis+1; j<d; ++j) {\n      var r0 = red[redPtr+j]\n      var r1 = red[redPtr+j+d]\n      var b0 = blue[bluePtr+j]\n      var b1 = blue[bluePtr+j+d]\n      if(r1 < b0 || b1 < r0) {\n        continue red_loop\n      }\n    }\n    var retval\n    if(flip) {\n      retval = visit(blueId, redId)\n    } else {\n      retval = visit(redId, blueId)\n    }\n    if(retval !== void 0) {\n      return retval\n    }\n  }\n}\n\n//Special case:  Intersect one point with list of intervals\nfunction onePointFull(\n  d, axis, visit,\n  redStart, redEnd, red, redIndex,\n  blueOffset, blue, blueId) {\n\n  var elemSize = 2 * d\n  var bluePtr  = blueOffset * elemSize\n  var blueX    = blue[bluePtr + axis]\n\nred_loop:\n  for(var i=redStart, redPtr=redStart*elemSize; i<redEnd; ++i, redPtr+=elemSize) {\n    var redId = redIndex[i]\n    if(redId === blueId) {\n      continue\n    }\n    var r0 = red[redPtr+axis]\n    var r1 = red[redPtr+axis+d]\n    if(blueX < r0 || r1 < blueX) {\n      continue\n    }\n    for(var j=axis+1; j<d; ++j) {\n      var r0 = red[redPtr+j]\n      var r1 = red[redPtr+j+d]\n      var b0 = blue[bluePtr+j]\n      var b1 = blue[bluePtr+j+d]\n      if(r1 < b0 || b1 < r0) {\n        continue red_loop\n      }\n    }\n    var retval = visit(redId, blueId)\n    if(retval !== void 0) {\n      return retval\n    }\n  }\n}\n\n//The main box intersection routine\nfunction boxIntersectIter(\n  d, visit, initFull,\n  xSize, xBoxes, xIndex,\n  ySize, yBoxes, yIndex) {\n\n  //Reserve memory for stack\n  iterInit(d, xSize + ySize)\n\n  var top  = 0\n  var elemSize = 2 * d\n  var retval\n\n  iterPush(top++,\n      0,\n      0, xSize,\n      0, ySize,\n      initFull ? 16 : 0, \n      -Infinity, Infinity)\n  if(!initFull) {\n    iterPush(top++,\n      0,\n      0, ySize,\n      0, xSize,\n      1, \n      -Infinity, Infinity)\n  }\n\n  while(top > 0) {\n    top  -= 1\n\n    var iptr = top * IFRAME_SIZE\n    var axis      = BOX_ISTACK[iptr]\n    var redStart  = BOX_ISTACK[iptr+1]\n    var redEnd    = BOX_ISTACK[iptr+2]\n    var blueStart = BOX_ISTACK[iptr+3]\n    var blueEnd   = BOX_ISTACK[iptr+4]\n    var state     = BOX_ISTACK[iptr+5]\n\n    var dptr = top * DFRAME_SIZE\n    var lo        = BOX_DSTACK[dptr]\n    var hi        = BOX_DSTACK[dptr+1]\n\n    //Unpack state info\n    var flip      = (state & 1)\n    var full      = !!(state & 16)\n\n    //Unpack indices\n    var red       = xBoxes\n    var redIndex  = xIndex\n    var blue      = yBoxes\n    var blueIndex = yIndex\n    if(flip) {\n      red         = yBoxes\n      redIndex    = yIndex\n      blue        = xBoxes\n      blueIndex   = xIndex\n    }\n\n    if(state & 2) {\n      redEnd = partitionStartLessThan(\n        d, axis,\n        redStart, redEnd, red, redIndex,\n        hi)\n      if(redStart >= redEnd) {\n        continue\n      }\n    }\n    if(state & 4) {\n      redStart = partitionEndLessThanEqual(\n        d, axis,\n        redStart, redEnd, red, redIndex,\n        lo)\n      if(redStart >= redEnd) {\n        continue\n      }\n    }\n    \n    var redCount  = redEnd  - redStart\n    var blueCount = blueEnd - blueStart\n\n    if(full) {\n      if(d * redCount * (redCount + blueCount) < SCAN_COMPLETE_CUTOFF) {\n        retval = sweep.scanComplete(\n          d, axis, visit, \n          redStart, redEnd, red, redIndex,\n          blueStart, blueEnd, blue, blueIndex)\n        if(retval !== void 0) {\n          return retval\n        }\n        continue\n      }\n    } else {\n      if(d * Math.min(redCount, blueCount) < BRUTE_FORCE_CUTOFF) {\n        //If input small, then use brute force\n        retval = bruteForcePartial(\n            d, axis, visit, flip,\n            redStart,  redEnd,  red,  redIndex,\n            blueStart, blueEnd, blue, blueIndex)\n        if(retval !== void 0) {\n          return retval\n        }\n        continue\n      } else if(d * redCount * blueCount < SCAN_CUTOFF) {\n        //If input medium sized, then use sweep and prune\n        retval = sweep.scanBipartite(\n          d, axis, visit, flip, \n          redStart, redEnd, red, redIndex,\n          blueStart, blueEnd, blue, blueIndex)\n        if(retval !== void 0) {\n          return retval\n        }\n        continue\n      }\n    }\n    \n    //First, find all red intervals whose interior contains (lo,hi)\n    var red0 = partitionInteriorContainsInterval(\n      d, axis, \n      redStart, redEnd, red, redIndex,\n      lo, hi)\n\n    //Lower dimensional case\n    if(redStart < red0) {\n\n      if(d * (red0 - redStart) < BRUTE_FORCE_CUTOFF) {\n        //Special case for small inputs: use brute force\n        retval = bruteForceFull(\n          d, axis+1, visit,\n          redStart, red0, red, redIndex,\n          blueStart, blueEnd, blue, blueIndex)\n        if(retval !== void 0) {\n          return retval\n        }\n      } else if(axis === d-2) {\n        if(flip) {\n          retval = sweep.sweepBipartite(\n            d, visit,\n            blueStart, blueEnd, blue, blueIndex,\n            redStart, red0, red, redIndex)\n        } else {\n          retval = sweep.sweepBipartite(\n            d, visit,\n            redStart, red0, red, redIndex,\n            blueStart, blueEnd, blue, blueIndex)\n        }\n        if(retval !== void 0) {\n          return retval\n        }\n      } else {\n        iterPush(top++,\n          axis+1,\n          redStart, red0,\n          blueStart, blueEnd,\n          flip,\n          -Infinity, Infinity)\n        iterPush(top++,\n          axis+1,\n          blueStart, blueEnd,\n          redStart, red0,\n          flip^1,\n          -Infinity, Infinity)\n      }\n    }\n\n    //Divide and conquer phase\n    if(red0 < redEnd) {\n\n      //Cut blue into 3 parts:\n      //\n      //  Points < mid point\n      //  Points = mid point\n      //  Points > mid point\n      //\n      var blue0 = findMedian(\n        d, axis, \n        blueStart, blueEnd, blue, blueIndex)\n      var mid = blue[elemSize * blue0 + axis]\n      var blue1 = partitionStartEqual(\n        d, axis,\n        blue0, blueEnd, blue, blueIndex,\n        mid)\n\n      //Right case\n      if(blue1 < blueEnd) {\n        iterPush(top++,\n          axis,\n          red0, redEnd,\n          blue1, blueEnd,\n          (flip|4) + (full ? 16 : 0),\n          mid, hi)\n      }\n\n      //Left case\n      if(blueStart < blue0) {\n        iterPush(top++,\n          axis,\n          red0, redEnd,\n          blueStart, blue0,\n          (flip|2) + (full ? 16 : 0),\n          lo, mid)\n      }\n\n      //Center case (the hard part)\n      if(blue0 + 1 === blue1) {\n        //Optimization: Range with exactly 1 point, use a brute force scan\n        if(full) {\n          retval = onePointFull(\n            d, axis, visit,\n            red0, redEnd, red, redIndex,\n            blue0, blue, blueIndex[blue0])\n        } else {\n          retval = onePointPartial(\n            d, axis, visit, flip,\n            red0, redEnd, red, redIndex,\n            blue0, blue, blueIndex[blue0])\n        }\n        if(retval !== void 0) {\n          return retval\n        }\n      } else if(blue0 < blue1) {\n        var red1\n        if(full) {\n          //If full intersection, need to handle special case\n          red1 = partitionContainsPoint(\n            d, axis,\n            red0, redEnd, red, redIndex,\n            mid)\n          if(red0 < red1) {\n            var redX = partitionStartEqual(\n              d, axis,\n              red0, red1, red, redIndex,\n              mid)\n            if(axis === d-2) {\n              //Degenerate sweep intersection:\n              //  [red0, redX] with [blue0, blue1]\n              if(red0 < redX) {\n                retval = sweep.sweepComplete(\n                  d, visit,\n                  red0, redX, red, redIndex,\n                  blue0, blue1, blue, blueIndex)\n                if(retval !== void 0) {\n                  return retval\n                }\n              }\n\n              //Normal sweep intersection:\n              //  [redX, red1] with [blue0, blue1]\n              if(redX < red1) {\n                retval = sweep.sweepBipartite(\n                  d, visit,\n                  redX, red1, red, redIndex,\n                  blue0, blue1, blue, blueIndex)\n                if(retval !== void 0) {\n                  return retval\n                }\n              }\n            } else {\n              if(red0 < redX) {\n                iterPush(top++,\n                  axis+1,\n                  red0, redX,\n                  blue0, blue1,\n                  16,\n                  -Infinity, Infinity)\n              }\n              if(redX < red1) {\n                iterPush(top++,\n                  axis+1,\n                  redX, red1,\n                  blue0, blue1,\n                  0,\n                  -Infinity, Infinity)\n                iterPush(top++,\n                  axis+1,\n                  blue0, blue1,\n                  redX, red1,\n                  1,\n                  -Infinity, Infinity)\n              }\n            }\n          }\n        } else {\n          if(flip) {\n            red1 = partitionContainsPointProper(\n              d, axis,\n              red0, redEnd, red, redIndex,\n              mid)\n          } else {\n            red1 = partitionContainsPoint(\n              d, axis,\n              red0, redEnd, red, redIndex,\n              mid)\n          }\n          if(red0 < red1) {\n            if(axis === d-2) {\n              if(flip) {\n                retval = sweep.sweepBipartite(\n                  d, visit,\n                  blue0, blue1, blue, blueIndex,\n                  red0, red1, red, redIndex)\n              } else {\n                retval = sweep.sweepBipartite(\n                  d, visit,\n                  red0, red1, red, redIndex,\n                  blue0, blue1, blue, blueIndex)\n              }\n            } else {\n              iterPush(top++,\n                axis+1,\n                red0, red1,\n                blue0, blue1,\n                flip,\n                -Infinity, Infinity)\n              iterPush(top++,\n                axis+1,\n                blue0, blue1,\n                red0, red1,\n                flip^1,\n                -Infinity, Infinity)\n            }\n          }\n        }\n      }\n    }\n  }\n}","'use strict'\n\nmodule.exports = findMedian\n\nvar genPartition = require('./partition')\n\nvar partitionStartLessThan = genPartition('lo<p0', ['p0'])\n\nvar PARTITION_THRESHOLD = 8   //Cut off for using insertion sort in findMedian\n\n//Base case for median finding:  Use insertion sort\nfunction insertionSort(d, axis, start, end, boxes, ids) {\n  var elemSize = 2 * d\n  var boxPtr = elemSize * (start+1) + axis\n  for(var i=start+1; i<end; ++i, boxPtr+=elemSize) {\n    var x = boxes[boxPtr]\n    for(var j=i, ptr=elemSize*(i-1); \n        j>start && boxes[ptr+axis] > x; \n        --j, ptr-=elemSize) {\n      //Swap\n      var aPtr = ptr\n      var bPtr = ptr+elemSize\n      for(var k=0; k<elemSize; ++k, ++aPtr, ++bPtr) {\n        var y = boxes[aPtr]\n        boxes[aPtr] = boxes[bPtr]\n        boxes[bPtr] = y\n      }\n      var tmp = ids[j]\n      ids[j] = ids[j-1]\n      ids[j-1] = tmp\n    }\n  }\n}\n\n//Find median using quick select algorithm\n//  takes O(n) time with high probability\nfunction findMedian(d, axis, start, end, boxes, ids) {\n  if(end <= start+1) {\n    return start\n  }\n\n  var lo       = start\n  var hi       = end\n  var mid      = ((end + start) >>> 1)\n  var elemSize = 2*d\n  var pivot    = mid\n  var value    = boxes[elemSize*mid+axis]\n  \n  while(lo < hi) {\n    if(hi - lo < PARTITION_THRESHOLD) {\n      insertionSort(d, axis, lo, hi, boxes, ids)\n      value = boxes[elemSize*mid+axis]\n      break\n    }\n    \n    //Select pivot using median-of-3\n    var count  = hi - lo\n    var pivot0 = (Math.random()*count+lo)|0\n    var value0 = boxes[elemSize*pivot0 + axis]\n    var pivot1 = (Math.random()*count+lo)|0\n    var value1 = boxes[elemSize*pivot1 + axis]\n    var pivot2 = (Math.random()*count+lo)|0\n    var value2 = boxes[elemSize*pivot2 + axis]\n    if(value0 <= value1) {\n      if(value2 >= value1) {\n        pivot = pivot1\n        value = value1\n      } else if(value0 >= value2) {\n        pivot = pivot0\n        value = value0\n      } else {\n        pivot = pivot2\n        value = value2\n      }\n    } else {\n      if(value1 >= value2) {\n        pivot = pivot1\n        value = value1\n      } else if(value2 >= value0) {\n        pivot = pivot0\n        value = value0\n      } else {\n        pivot = pivot2\n        value = value2\n      }\n    }\n\n    //Swap pivot to end of array\n    var aPtr = elemSize * (hi-1)\n    var bPtr = elemSize * pivot\n    for(var i=0; i<elemSize; ++i, ++aPtr, ++bPtr) {\n      var x = boxes[aPtr]\n      boxes[aPtr] = boxes[bPtr]\n      boxes[bPtr] = x\n    }\n    var y = ids[hi-1]\n    ids[hi-1] = ids[pivot]\n    ids[pivot] = y\n\n    //Partition using pivot\n    pivot = partitionStartLessThan(\n      d, axis, \n      lo, hi-1, boxes, ids,\n      value)\n\n    //Swap pivot back\n    var aPtr = elemSize * (hi-1)\n    var bPtr = elemSize * pivot\n    for(var i=0; i<elemSize; ++i, ++aPtr, ++bPtr) {\n      var x = boxes[aPtr]\n      boxes[aPtr] = boxes[bPtr]\n      boxes[bPtr] = x\n    }\n    var y = ids[hi-1]\n    ids[hi-1] = ids[pivot]\n    ids[pivot] = y\n\n    //Swap pivot to last pivot\n    if(mid < pivot) {\n      hi = pivot-1\n      while(lo < hi && \n        boxes[elemSize*(hi-1)+axis] === value) {\n        hi -= 1\n      }\n      hi += 1\n    } else if(pivot < mid) {\n      lo = pivot + 1\n      while(lo < hi &&\n        boxes[elemSize*lo+axis] === value) {\n        lo += 1\n      }\n    } else {\n      break\n    }\n  }\n\n  //Make sure pivot is at start\n  return partitionStartLessThan(\n    d, axis, \n    start, mid, boxes, ids,\n    boxes[elemSize*mid+axis])\n}","'use strict'\n\nmodule.exports = genPartition\n\nvar code = 'for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m'\n\nfunction genPartition(predicate, args) {\n  var fargs ='abcdef'.split('').concat(args)\n  var reads = []\n  if(predicate.indexOf('lo') >= 0) {\n    reads.push('lo=e[k+n]')\n  }\n  if(predicate.indexOf('hi') >= 0) {\n    reads.push('hi=e[k+o]')\n  }\n  fargs.push(\n    code.replace('_', reads.join())\n        .replace('$', predicate))\n  return Function.apply(void 0, fargs)\n}","'use strict';\n\n//This code is extracted from ndarray-sort\n//It is inlined here as a temporary workaround\n\nmodule.exports = wrapper;\n\nvar INSERT_SORT_CUTOFF = 32\n\nfunction wrapper(data, n0) {\n  if (n0 <= 4*INSERT_SORT_CUTOFF) {\n    insertionSort(0, n0 - 1, data);\n  } else {\n    quickSort(0, n0 - 1, data);\n  }\n}\n\nfunction insertionSort(left, right, data) {\n  var ptr = 2*(left+1)\n  for(var i=left+1; i<=right; ++i) {\n    var a = data[ptr++]\n    var b = data[ptr++]\n    var j = i\n    var jptr = ptr-2\n    while(j-- > left) {\n      var x = data[jptr-2]\n      var y = data[jptr-1]\n      if(x < a) {\n        break\n      } else if(x === a && y < b) {\n        break\n      }\n      data[jptr]   = x\n      data[jptr+1] = y\n      jptr -= 2\n    }\n    data[jptr]   = a\n    data[jptr+1] = b\n  }\n}\n\nfunction swap(i, j, data) {\n  i *= 2\n  j *= 2\n  var x = data[i]\n  var y = data[i+1]\n  data[i] = data[j]\n  data[i+1] = data[j+1]\n  data[j] = x\n  data[j+1] = y\n}\n\nfunction move(i, j, data) {\n  i *= 2\n  j *= 2\n  data[i] = data[j]\n  data[i+1] = data[j+1]\n}\n\nfunction rotate(i, j, k, data) {\n  i *= 2\n  j *= 2\n  k *= 2\n  var x = data[i]\n  var y = data[i+1]\n  data[i] = data[j]\n  data[i+1] = data[j+1]\n  data[j] = data[k]\n  data[j+1] = data[k+1]\n  data[k] = x\n  data[k+1] = y\n}\n\nfunction shufflePivot(i, j, px, py, data) {\n  i *= 2\n  j *= 2\n  data[i] = data[j]\n  data[j] = px\n  data[i+1] = data[j+1]\n  data[j+1] = py\n}\n\nfunction compare(i, j, data) {\n  i *= 2\n  j *= 2\n  var x = data[i],\n      y = data[j]\n  if(x < y) {\n    return false\n  } else if(x === y) {\n    return data[i+1] > data[j+1]\n  }\n  return true\n}\n\nfunction comparePivot(i, y, b, data) {\n  i *= 2\n  var x = data[i]\n  if(x < y) {\n    return true\n  } else if(x === y) {\n    return data[i+1] < b\n  }\n  return false\n}\n\nfunction quickSort(left, right, data) {\n  var sixth = (right - left + 1) / 6 | 0, \n      index1 = left + sixth, \n      index5 = right - sixth, \n      index3 = left + right >> 1, \n      index2 = index3 - sixth, \n      index4 = index3 + sixth, \n      el1 = index1, \n      el2 = index2, \n      el3 = index3, \n      el4 = index4, \n      el5 = index5, \n      less = left + 1, \n      great = right - 1, \n      tmp = 0\n  if(compare(el1, el2, data)) {\n    tmp = el1\n    el1 = el2\n    el2 = tmp\n  }\n  if(compare(el4, el5, data)) {\n    tmp = el4\n    el4 = el5\n    el5 = tmp\n  }\n  if(compare(el1, el3, data)) {\n    tmp = el1\n    el1 = el3\n    el3 = tmp\n  }\n  if(compare(el2, el3, data)) {\n    tmp = el2\n    el2 = el3\n    el3 = tmp\n  }\n  if(compare(el1, el4, data)) {\n    tmp = el1\n    el1 = el4\n    el4 = tmp\n  }\n  if(compare(el3, el4, data)) {\n    tmp = el3\n    el3 = el4\n    el4 = tmp\n  }\n  if(compare(el2, el5, data)) {\n    tmp = el2\n    el2 = el5\n    el5 = tmp\n  }\n  if(compare(el2, el3, data)) {\n    tmp = el2\n    el2 = el3\n    el3 = tmp\n  }\n  if(compare(el4, el5, data)) {\n    tmp = el4\n    el4 = el5\n    el5 = tmp\n  }\n\n  var pivot1X = data[2*el2]\n  var pivot1Y = data[2*el2+1]\n  var pivot2X = data[2*el4]\n  var pivot2Y = data[2*el4+1]\n\n  var ptr0 = 2 * el1;\n  var ptr2 = 2 * el3;\n  var ptr4 = 2 * el5;\n  var ptr5 = 2 * index1;\n  var ptr6 = 2 * index3;\n  var ptr7 = 2 * index5;\n  for (var i1 = 0; i1 < 2; ++i1) {\n    var x = data[ptr0+i1];\n    var y = data[ptr2+i1];\n    var z = data[ptr4+i1];\n    data[ptr5+i1] = x;\n    data[ptr6+i1] = y;\n    data[ptr7+i1] = z;\n  }\n\n  move(index2, left, data)\n  move(index4, right, data)\n  for (var k = less; k <= great; ++k) {\n    if (comparePivot(k, pivot1X, pivot1Y, data)) {\n      if (k !== less) {\n        swap(k, less, data)\n      }\n      ++less;\n    } else {\n      if (!comparePivot(k, pivot2X, pivot2Y, data)) {\n        while (true) {\n          if (!comparePivot(great, pivot2X, pivot2Y, data)) {\n            if (--great < k) {\n              break;\n            }\n            continue;\n          } else {\n            if (comparePivot(great, pivot1X, pivot1Y, data)) {\n              rotate(k, less, great, data)\n              ++less;\n              --great;\n            } else {\n              swap(k, great, data)\n              --great;\n            }\n            break;\n          }\n        }\n      }\n    }\n  }\n  shufflePivot(left, less-1, pivot1X, pivot1Y, data)\n  shufflePivot(right, great+1, pivot2X, pivot2Y, data)\n  if (less - 2 - left <= INSERT_SORT_CUTOFF) {\n    insertionSort(left, less - 2, data);\n  } else {\n    quickSort(left, less - 2, data);\n  }\n  if (right - (great + 2) <= INSERT_SORT_CUTOFF) {\n    insertionSort(great + 2, right, data);\n  } else {\n    quickSort(great + 2, right, data);\n  }\n  if (great - less <= INSERT_SORT_CUTOFF) {\n    insertionSort(less, great, data);\n  } else {\n    quickSort(less, great, data);\n  }\n}","'use strict'\n\nmodule.exports = {\n  init:           sqInit,\n  sweepBipartite: sweepBipartite,\n  sweepComplete:  sweepComplete,\n  scanBipartite:  scanBipartite,\n  scanComplete:   scanComplete\n}\n\nvar pool  = require('@jpweeks/typedarray-pool')\nvar bits  = require('bit-twiddle')\nvar isort = require('./sort')\n\n//Flag for blue\nvar BLUE_FLAG = (1<<28)\n\n//1D sweep event queue stuff (use pool to save space)\nvar INIT_CAPACITY      = 1024\nvar RED_SWEEP_QUEUE    = pool.mallocInt32(INIT_CAPACITY)\nvar RED_SWEEP_INDEX    = pool.mallocInt32(INIT_CAPACITY)\nvar BLUE_SWEEP_QUEUE   = pool.mallocInt32(INIT_CAPACITY)\nvar BLUE_SWEEP_INDEX   = pool.mallocInt32(INIT_CAPACITY)\nvar COMMON_SWEEP_QUEUE = pool.mallocInt32(INIT_CAPACITY)\nvar COMMON_SWEEP_INDEX = pool.mallocInt32(INIT_CAPACITY)\nvar SWEEP_EVENTS       = pool.mallocDouble(INIT_CAPACITY * 8)\n\n//Reserves memory for the 1D sweep data structures\nfunction sqInit(count) {\n  var rcount = bits.nextPow2(count)\n  if(RED_SWEEP_QUEUE.length < rcount) {\n    pool.free(RED_SWEEP_QUEUE)\n    RED_SWEEP_QUEUE = pool.mallocInt32(rcount)\n  }\n  if(RED_SWEEP_INDEX.length < rcount) {\n    pool.free(RED_SWEEP_INDEX)\n    RED_SWEEP_INDEX = pool.mallocInt32(rcount)\n  }\n  if(BLUE_SWEEP_QUEUE.length < rcount) {\n    pool.free(BLUE_SWEEP_QUEUE)\n    BLUE_SWEEP_QUEUE = pool.mallocInt32(rcount)\n  }\n  if(BLUE_SWEEP_INDEX.length < rcount) {\n    pool.free(BLUE_SWEEP_INDEX)\n    BLUE_SWEEP_INDEX = pool.mallocInt32(rcount)\n  }\n  if(COMMON_SWEEP_QUEUE.length < rcount) {\n    pool.free(COMMON_SWEEP_QUEUE)\n    COMMON_SWEEP_QUEUE = pool.mallocInt32(rcount)\n  }\n  if(COMMON_SWEEP_INDEX.length < rcount) {\n    pool.free(COMMON_SWEEP_INDEX)\n    COMMON_SWEEP_INDEX = pool.mallocInt32(rcount)\n  }\n  var eventLength = 8 * rcount\n  if(SWEEP_EVENTS.length < eventLength) {\n    pool.free(SWEEP_EVENTS)\n    SWEEP_EVENTS = pool.mallocDouble(eventLength)\n  }\n}\n\n//Remove an item from the active queue in O(1)\nfunction sqPop(queue, index, count, item) {\n  var idx = index[item]\n  var top = queue[count-1]\n  queue[idx] = top\n  index[top] = idx\n}\n\n//Insert an item into the active queue in O(1)\nfunction sqPush(queue, index, count, item) {\n  queue[count] = item\n  index[item]  = count\n}\n\n//Recursion base case: use 1D sweep algorithm\nfunction sweepBipartite(\n    d, visit,\n    redStart,  redEnd, red, redIndex,\n    blueStart, blueEnd, blue, blueIndex) {\n\n  //store events as pairs [coordinate, idx]\n  //\n  //  red create:  -(idx+1)\n  //  red destroy: idx\n  //  blue create: -(idx+BLUE_FLAG)\n  //  blue destroy: idx+BLUE_FLAG\n  //\n  var ptr      = 0\n  var elemSize = 2*d\n  var istart   = d-1\n  var iend     = elemSize-1\n\n  for(var i=redStart; i<redEnd; ++i) {\n    var idx = redIndex[i]\n    var redOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = red[redOffset+istart]\n    SWEEP_EVENTS[ptr++] = -(idx+1)\n    SWEEP_EVENTS[ptr++] = red[redOffset+iend]\n    SWEEP_EVENTS[ptr++] = idx\n  }\n\n  for(var i=blueStart; i<blueEnd; ++i) {\n    var idx = blueIndex[i]+BLUE_FLAG\n    var blueOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = blue[blueOffset+istart]\n    SWEEP_EVENTS[ptr++] = -idx\n    SWEEP_EVENTS[ptr++] = blue[blueOffset+iend]\n    SWEEP_EVENTS[ptr++] = idx\n  }\n\n  //process events from left->right\n  var n = ptr >>> 1\n  isort(SWEEP_EVENTS, n)\n  \n  var redActive  = 0\n  var blueActive = 0\n  for(var i=0; i<n; ++i) {\n    var e = SWEEP_EVENTS[2*i+1]|0\n    if(e >= BLUE_FLAG) {\n      //blue destroy event\n      e = (e-BLUE_FLAG)|0\n      sqPop(BLUE_SWEEP_QUEUE, BLUE_SWEEP_INDEX, blueActive--, e)\n    } else if(e >= 0) {\n      //red destroy event\n      sqPop(RED_SWEEP_QUEUE, RED_SWEEP_INDEX, redActive--, e)\n    } else if(e <= -BLUE_FLAG) {\n      //blue create event\n      e = (-e-BLUE_FLAG)|0\n      for(var j=0; j<redActive; ++j) {\n        var retval = visit(RED_SWEEP_QUEUE[j], e)\n        if(retval !== void 0) {\n          return retval\n        }\n      }\n      sqPush(BLUE_SWEEP_QUEUE, BLUE_SWEEP_INDEX, blueActive++, e)\n    } else {\n      //red create event\n      e = (-e-1)|0\n      for(var j=0; j<blueActive; ++j) {\n        var retval = visit(e, BLUE_SWEEP_QUEUE[j])\n        if(retval !== void 0) {\n          return retval\n        }\n      }\n      sqPush(RED_SWEEP_QUEUE, RED_SWEEP_INDEX, redActive++, e)\n    }\n  }\n}\n\n//Complete sweep\nfunction sweepComplete(d, visit, \n  redStart, redEnd, red, redIndex,\n  blueStart, blueEnd, blue, blueIndex) {\n\n  var ptr      = 0\n  var elemSize = 2*d\n  var istart   = d-1\n  var iend     = elemSize-1\n\n  for(var i=redStart; i<redEnd; ++i) {\n    var idx = (redIndex[i]+1)<<1\n    var redOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = red[redOffset+istart]\n    SWEEP_EVENTS[ptr++] = -idx\n    SWEEP_EVENTS[ptr++] = red[redOffset+iend]\n    SWEEP_EVENTS[ptr++] = idx\n  }\n\n  for(var i=blueStart; i<blueEnd; ++i) {\n    var idx = (blueIndex[i]+1)<<1\n    var blueOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = blue[blueOffset+istart]\n    SWEEP_EVENTS[ptr++] = (-idx)|1\n    SWEEP_EVENTS[ptr++] = blue[blueOffset+iend]\n    SWEEP_EVENTS[ptr++] = idx|1\n  }\n\n  //process events from left->right\n  var n = ptr >>> 1\n  isort(SWEEP_EVENTS, n)\n  \n  var redActive    = 0\n  var blueActive   = 0\n  var commonActive = 0\n  for(var i=0; i<n; ++i) {\n    var e     = SWEEP_EVENTS[2*i+1]|0\n    var color = e&1\n    if(i < n-1 && (e>>1) === (SWEEP_EVENTS[2*i+3]>>1)) {\n      color = 2\n      i += 1\n    }\n    \n    if(e < 0) {\n      //Create event\n      var id = -(e>>1) - 1\n\n      //Intersect with common\n      for(var j=0; j<commonActive; ++j) {\n        var retval = visit(COMMON_SWEEP_QUEUE[j], id)\n        if(retval !== void 0) {\n          return retval\n        }\n      }\n\n      if(color !== 0) {\n        //Intersect with red\n        for(var j=0; j<redActive; ++j) {\n          var retval = visit(RED_SWEEP_QUEUE[j], id)\n          if(retval !== void 0) {\n            return retval\n          }\n        }\n      }\n\n      if(color !== 1) {\n        //Intersect with blue\n        for(var j=0; j<blueActive; ++j) {\n          var retval = visit(BLUE_SWEEP_QUEUE[j], id)\n          if(retval !== void 0) {\n            return retval\n          }\n        }\n      }\n\n      if(color === 0) {\n        //Red\n        sqPush(RED_SWEEP_QUEUE, RED_SWEEP_INDEX, redActive++, id)\n      } else if(color === 1) {\n        //Blue\n        sqPush(BLUE_SWEEP_QUEUE, BLUE_SWEEP_INDEX, blueActive++, id)\n      } else if(color === 2) {\n        //Both\n        sqPush(COMMON_SWEEP_QUEUE, COMMON_SWEEP_INDEX, commonActive++, id)\n      }\n    } else {\n      //Destroy event\n      var id = (e>>1) - 1\n      if(color === 0) {\n        //Red\n        sqPop(RED_SWEEP_QUEUE, RED_SWEEP_INDEX, redActive--, id)\n      } else if(color === 1) {\n        //Blue\n        sqPop(BLUE_SWEEP_QUEUE, BLUE_SWEEP_INDEX, blueActive--, id)\n      } else if(color === 2) {\n        //Both\n        sqPop(COMMON_SWEEP_QUEUE, COMMON_SWEEP_INDEX, commonActive--, id)\n      }\n    }\n  }\n}\n\n//Sweep and prune/scanline algorithm:\n//  Scan along axis, detect intersections\n//  Brute force all boxes along axis\nfunction scanBipartite(\n  d, axis, visit, flip,\n  redStart,  redEnd, red, redIndex,\n  blueStart, blueEnd, blue, blueIndex) {\n  \n  var ptr      = 0\n  var elemSize = 2*d\n  var istart   = axis\n  var iend     = axis+d\n\n  var redShift  = 1\n  var blueShift = 1\n  if(flip) {\n    blueShift = BLUE_FLAG\n  } else {\n    redShift  = BLUE_FLAG\n  }\n\n  for(var i=redStart; i<redEnd; ++i) {\n    var idx = i + redShift\n    var redOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = red[redOffset+istart]\n    SWEEP_EVENTS[ptr++] = -idx\n    SWEEP_EVENTS[ptr++] = red[redOffset+iend]\n    SWEEP_EVENTS[ptr++] = idx\n  }\n  for(var i=blueStart; i<blueEnd; ++i) {\n    var idx = i + blueShift\n    var blueOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = blue[blueOffset+istart]\n    SWEEP_EVENTS[ptr++] = -idx\n  }\n\n  //process events from left->right\n  var n = ptr >>> 1\n  isort(SWEEP_EVENTS, n)\n  \n  var redActive    = 0\n  for(var i=0; i<n; ++i) {\n    var e = SWEEP_EVENTS[2*i+1]|0\n    if(e < 0) {\n      var idx   = -e\n      var isRed = false\n      if(idx >= BLUE_FLAG) {\n        isRed = !flip\n        idx -= BLUE_FLAG \n      } else {\n        isRed = !!flip\n        idx -= 1\n      }\n      if(isRed) {\n        sqPush(RED_SWEEP_QUEUE, RED_SWEEP_INDEX, redActive++, idx)\n      } else {\n        var blueId  = blueIndex[idx]\n        var bluePtr = elemSize * idx\n        \n        var b0 = blue[bluePtr+axis+1]\n        var b1 = blue[bluePtr+axis+1+d]\n\nred_loop:\n        for(var j=0; j<redActive; ++j) {\n          var oidx   = RED_SWEEP_QUEUE[j]\n          var redPtr = elemSize * oidx\n\n          if(b1 < red[redPtr+axis+1] || \n             red[redPtr+axis+1+d] < b0) {\n            continue\n          }\n\n          for(var k=axis+2; k<d; ++k) {\n            if(blue[bluePtr + k + d] < red[redPtr + k] || \n               red[redPtr + k + d] < blue[bluePtr + k]) {\n              continue red_loop\n            }\n          }\n\n          var redId  = redIndex[oidx]\n          var retval\n          if(flip) {\n            retval = visit(blueId, redId)\n          } else {\n            retval = visit(redId, blueId)\n          }\n          if(retval !== void 0) {\n            return retval \n          }\n        }\n      }\n    } else {\n      sqPop(RED_SWEEP_QUEUE, RED_SWEEP_INDEX, redActive--, e - redShift)\n    }\n  }\n}\n\nfunction scanComplete(\n  d, axis, visit,\n  redStart,  redEnd, red, redIndex,\n  blueStart, blueEnd, blue, blueIndex) {\n\n  var ptr      = 0\n  var elemSize = 2*d\n  var istart   = axis\n  var iend     = axis+d\n\n  for(var i=redStart; i<redEnd; ++i) {\n    var idx = i + BLUE_FLAG\n    var redOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = red[redOffset+istart]\n    SWEEP_EVENTS[ptr++] = -idx\n    SWEEP_EVENTS[ptr++] = red[redOffset+iend]\n    SWEEP_EVENTS[ptr++] = idx\n  }\n  for(var i=blueStart; i<blueEnd; ++i) {\n    var idx = i + 1\n    var blueOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = blue[blueOffset+istart]\n    SWEEP_EVENTS[ptr++] = -idx\n  }\n\n  //process events from left->right\n  var n = ptr >>> 1\n  isort(SWEEP_EVENTS, n)\n  \n  var redActive    = 0\n  for(var i=0; i<n; ++i) {\n    var e = SWEEP_EVENTS[2*i+1]|0\n    if(e < 0) {\n      var idx   = -e\n      if(idx >= BLUE_FLAG) {\n        RED_SWEEP_QUEUE[redActive++] = idx - BLUE_FLAG\n      } else {\n        idx -= 1\n        var blueId  = blueIndex[idx]\n        var bluePtr = elemSize * idx\n\n        var b0 = blue[bluePtr+axis+1]\n        var b1 = blue[bluePtr+axis+1+d]\n\nred_loop:\n        for(var j=0; j<redActive; ++j) {\n          var oidx   = RED_SWEEP_QUEUE[j]\n          var redId  = redIndex[oidx]\n\n          if(redId === blueId) {\n            break\n          }\n\n          var redPtr = elemSize * oidx\n          if(b1 < red[redPtr+axis+1] || \n            red[redPtr+axis+1+d] < b0) {\n            continue\n          }\n          for(var k=axis+2; k<d; ++k) {\n            if(blue[bluePtr + k + d] < red[redPtr + k] || \n               red[redPtr + k + d]   < blue[bluePtr + k]) {\n              continue red_loop\n            }\n          }\n\n          var retval = visit(redId, blueId)\n          if(retval !== void 0) {\n            return retval \n          }\n        }\n      }\n    } else {\n      var idx = e - BLUE_FLAG\n      for(var j=redActive-1; j>=0; --j) {\n        if(RED_SWEEP_QUEUE[j] === idx) {\n          for(var k=j+1; k<redActive; ++k) {\n            RED_SWEEP_QUEUE[k-1] = RED_SWEEP_QUEUE[k]\n          }\n          break\n        }\n      }\n      --redActive\n    }\n  }\n}","\"use strict\"\n\nfunction dupe_array(count, value, i) {\n  var c = count[i]|0\n  if(c <= 0) {\n    return []\n  }\n  var result = new Array(c), j\n  if(i === count.length-1) {\n    for(j=0; j<c; ++j) {\n      result[j] = value\n    }\n  } else {\n    for(j=0; j<c; ++j) {\n      result[j] = dupe_array(count, value, i+1)\n    }\n  }\n  return result\n}\n\nfunction dupe_number(count, value) {\n  var result, i\n  result = new Array(count)\n  for(i=0; i<count; ++i) {\n    result[i] = value\n  }\n  return result\n}\n\nfunction dupe(count, value) {\n  if(typeof value === \"undefined\") {\n    value = 0\n  }\n  switch(typeof count) {\n    case \"number\":\n      if(count > 0) {\n        return dupe_number(count|0, value)\n      }\n    break\n    case \"object\":\n      if(typeof (count.length) === \"number\") {\n        return dupe_array(count, value, 0)\n      }\n    break\n  }\n  return []\n}\n\nmodule.exports = dupe","\nmodule.exports = ECS\nvar DataStore = require('./dataStore')\n\n\n\n/*!\n * ent-comp: a light, *fast* Entity Component System in JS\n * @url      github.com/andyhall/ent-comp\n * @author   Andy Hall <andy@fenomas.com>\n * @license  MIT\n*/\n\n\n\n/**\n * Constructor for a new entity-component-system manager.\n * \n * ```js\n * var ECS = require('ent-comp')\n * var ecs = new ECS()\n * ```\n * @class\n * @constructor\n * @exports ECS\n * @typicalname ecs\n*/\n\nfunction ECS() {\n\tvar self = this\n\n\t/** \n\t * Hash of component definitions. Also aliased to `comps`.\n\t * \n\t * ```js\n\t * var comp = { name: 'foo' }\n\t * ecs.createComponent(comp)\n\t * ecs.components['foo'] === comp  // true\n\t * ecs.comps['foo']                // same\n\t * ```\n\t*/\n\tthis.components = {}\n\tthis.comps = this.components\n\n\n\n\t/*\n\t * \n\t * \t\tinternal properties:\n\t * \n\t*/\n\n\tvar components = this.components\n\n\t// counter for entity IDs\n\tvar UID = 1\n\n\t// Storage for all component state data:\n\t// storage['component-name'] = DataStore instance\n\tvar storage = {}\n\n\t// flat arrays of names of components with systems\n\tvar systems = []\n\tvar renderSystems = []\n\n\t// flags and arrays for deferred cleanup of removed stuff\n\tvar deferrals = {\n\t\ttimeout: false,\n\t\tremovals: [],\n\t\tmultiComps: [],\n\t}\n\n\t// expose references to internals for debugging or hacking\n\tthis._storage = storage\n\tthis._systems = systems\n\tthis._renderSystems = renderSystems\n\n\n\n\n\n\t/*\n\t * \n\t * \n\t * \t\t\t\tPublic API\n\t * \n\t * \n\t*/\n\n\n\n\n\t/**\n\t * Creates a new entity id (currently just an incrementing integer).\n\t * \n\t * Optionally takes a list of component names to add to the entity (with default state data).\n\t * \n\t * ```js\n\t * var id1 = ecs.createEntity()\n\t * var id2 = ecs.createEntity([ 'some-component', 'other-component' ])\n\t * ```\n\t*/\n\tthis.createEntity = function (compList) {\n\t\tvar id = UID++\n\t\tif (Array.isArray(compList)) {\n\t\t\tcompList.forEach(compName => self.addComponent(id, compName))\n\t\t}\n\t\treturn id\n\t}\n\n\n\n\t/**\n\t * Deletes an entity, which in practice means removing all its components.\n\t * \n\t * ```js\n\t * ecs.deleteEntity(id)\n\t * ```\n\t*/\n\tthis.deleteEntity = function (entID) {\n\t\t// loop over all components and maybe remove them\n\t\t// this avoids needing to keep a list of components-per-entity\n\t\tObject.keys(storage).forEach(compName => {\n\t\t\tvar data = storage[compName]\n\t\t\tif (data.hash[entID]) {\n\t\t\t\tremoveComponent(entID, compName)\n\t\t\t}\n\t\t})\n\t\treturn self\n\t}\n\n\n\n\n\n\n\n\t/**\n\t * Creates a new component from a definition object. \n\t * The definition must have a `name`; all other properties are optional.\n\t * \n\t * Returns the component name, to make it easy to grab when the component\n\t * is being `require`d from a module.\n\t * \n\t * ```js\n\t * var comp = {\n\t * \t name: 'some-unique-string',\n\t * \t state: {},\n\t * \t order: 99,\n\t * \t multi: false,\n\t * \t onAdd:        (id, state) => { },\n\t * \t onRemove:     (id, state) => { },\n\t * \t system:       (dt, states) => { },\n\t * \t renderSystem: (dt, states) => { },\n\t * }\n\t * \n\t * var name = ecs.createComponent( comp )\n\t * // name == 'some-unique-string'\n\t * ```\n\t * \n\t * Note the `multi` flag - for components where this is true, a given \n\t * entity can have multiple state objects for that component.\n\t * For multi-components, APIs that would normally return a state object \n\t * (like `getState`) will instead return an array of them.\n\t*/\n\tthis.createComponent = function (compDefn) {\n\t\tif (!compDefn) throw 'Missing component definition'\n\t\tvar name = compDefn.name\n\t\tif (!name) throw 'Component definition must have a name property.'\n\t\tif (typeof name !== 'string') throw 'Component name must be a string.'\n\t\tif (name === '') throw 'Component name must be a non-empty string.'\n\t\tif (storage[name]) throw `Component ${name} already exists.`\n\n\t\t// rebuild definition object for monomorphism\n\t\tvar internalDef = {}\n\t\tinternalDef.name = name\n\t\tinternalDef.multi = !!compDefn.multi\n\t\tinternalDef.order = isNaN(compDefn.order) ? 99 : compDefn.order\n\t\tinternalDef.state = compDefn.state || {}\n\t\tinternalDef.onAdd = compDefn.onAdd || null\n\t\tinternalDef.onRemove = compDefn.onRemove || null\n\t\tinternalDef.system = compDefn.system || null\n\t\tinternalDef.renderSystem = compDefn.renderSystem || null\n\n\t\tcomponents[name] = internalDef\n\t\tstorage[name] = new DataStore()\n\t\tstorage[name]._pendingMultiCleanup = false\n\t\tstorage[name]._multiCleanupIDs = (internalDef.multi) ? [] : null\n\n\t\tif (internalDef.system) {\n\t\t\tsystems.push(name)\n\t\t\tsystems.sort((a, b) => components[a].order - components[b].order)\n\t\t}\n\t\tif (internalDef.renderSystem) {\n\t\t\trenderSystems.push(name)\n\t\t\trenderSystems.sort((a, b) => components[a].order - components[b].order)\n\t\t}\n\n\t\treturn name\n\t}\n\n\n\n\n\n\t/**\n\t * Deletes the component definition with the given name. \n\t * First removes the component from all entities that have it.\n\t * \n\t * **Note:** This API shouldn't be necessary in most real-world usage - \n\t * you should set up all your components during init and then leave them be.\n\t * But it's useful if, say, you receive an ECS from another library and \n\t * you need to replace its components.\n\t * \n\t * ```js\n\t * ecs.deleteComponent( 'some-component' )\n\t * ```\n\t*/\n\tthis.deleteComponent = function (compName) {\n\t\tvar data = storage[compName]\n\t\tif (!data) throw `Unknown component: ${compName}`\n\n\t\tdata.flush()\n\t\tdata.list.forEach(obj => {\n\t\t\tif (!obj) return\n\t\t\tvar id = obj.__id || obj[0].__id\n\t\t\tremoveComponent(id, compName)\n\t\t})\n\n\t\tvar i = systems.indexOf(compName)\n\t\tvar j = renderSystems.indexOf(compName)\n\t\tif (i > -1) systems.splice(i, 1)\n\t\tif (j > -1) renderSystems.splice(j, 1)\n\n\t\tstorage[compName].dispose()\n\t\tdelete storage[compName]\n\t\tdelete components[compName]\n\n\t\treturn self\n\t}\n\n\n\n\n\t/**\n\t * Adds a component to an entity, optionally initializing the state object.\n\t * \n\t * ```js\n\t * ecs.createComponent({\n\t * \tname: 'foo',\n\t * \tstate: { val: 1 }\n\t * })\n\t * ecs.addComponent(id1, 'foo')             // use default state\n\t * ecs.addComponent(id2, 'foo', { val:2 })  // pass in state data\n\t * ```\n\t*/\n\tthis.addComponent = function (entID, compName, state) {\n\t\tvar def = components[compName]\n\t\tvar data = storage[compName]\n\t\tif (!data) throw `Unknown component: ${compName}.`\n\n\t\t// treat adding an existing (non-multi-) component as an error\n\t\tif (data.hash[entID] && !def.multi) {\n\t\t\tthrow `Entity ${entID} already has component: ${compName}.`\n\t\t}\n\n\t\t// create new component state object for this entity\n\t\tvar newState = Object.assign({}, { __id: entID }, def.state, state)\n\n\t\t// just in case passed-in state object had an __id property\n\t\tnewState.__id = entID\n\n\t\t// add to data store - for multi components, may already be present\n\t\tif (def.multi) {\n\t\t\tvar statesArr = data.hash[entID]\n\t\t\tif (!statesArr) {\n\t\t\t\tstatesArr = []\n\t\t\t\tdata.add(entID, statesArr)\n\t\t\t}\n\t\t\tstatesArr.push(newState)\n\t\t} else {\n\t\t\tdata.add(entID, newState)\n\t\t}\n\n\t\t// call handler and return\n\t\tif (def.onAdd) def.onAdd(entID, newState)\n\n\t\treturn this\n\t}\n\n\n\n\t/**\n\t * Checks if an entity has a component.\n\t * \n\t * ```js\n\t * ecs.addComponent(id, 'foo')\n\t * ecs.hasComponent(id, 'foo')       // true\n\t * ```\n\t*/\n\n\tthis.hasComponent = function (entID, compName) {\n\t\tvar data = storage[compName]\n\t\tif (!data) throw `Unknown component: ${compName}.`\n\t\treturn !!data.hash[entID]\n\t}\n\n\n\n\n\n\t/**\n\t * Removes a component from an entity, triggering the component's \n\t * `onRemove` handler, and then deleting any state data.\n\t * \n\t * ```js\n\t * ecs.removeComponent(id, 'foo')\n\t * ecs.hasComponent(id, 'foo')     \t // false\n\t * ```\n\t*/\n\tthis.removeComponent = function (entID, compName) {\n\t\tvar data = storage[compName]\n\t\tif (!data) throw `Unknown component: ${compName}.`\n\n\t\t// removal implementations at end\n\t\tremoveComponent(entID, compName)\n\n\t\treturn self\n\t}\n\n\n\n\n\n\t/**\n\t * Get the component state for a given entity.\n\t * It will automatically have an `__id` property for the entity id.\n\t * \n\t * ```js\n\t * ecs.createComponent({\n\t * \tname: 'foo',\n\t * \tstate: { val: 0 }\n\t * })\n\t * ecs.addComponent(id, 'foo')\n\t * ecs.getState(id, 'foo').val       // 0\n\t * ecs.getState(id, 'foo').__id      // equals id\n\t * ```\n\t*/\n\n\tthis.getState = function (entID, compName) {\n\t\tvar data = storage[compName]\n\t\tif (!data) throw `Unknown component: ${compName}.`\n\t\treturn data.hash[entID]\n\t}\n\n\n\n\n\t/**\n\t * Get an array of state objects for every entity with the given component. \n\t * Each one will have an `__id` property for the entity id it refers to.\n\t * Don't add or remove elements from the returned list!\n\t * \n\t * ```js\n\t * var arr = ecs.getStatesList('foo')\n\t * // returns something shaped like:\n\t * //   [\n\t * //     {__id:0, x:1},\n\t * //     {__id:7, x:2},\n\t * //   ]\n\t * ```  \n\t*/\n\n\tthis.getStatesList = function (compName) {\n\t\tvar data = storage[compName]\n\t\tif (!data) throw `Unknown component: ${compName}.`\n\t\tdoDeferredCleanup(data)\n\t\treturn data.list\n\t}\n\n\n\n\n\t/**\n\t * Makes a `getState`-like accessor bound to a given component. \n\t * The accessor is faster than `getState`, so you may want to create \n\t * an accessor for any component you'll be accessing a lot.\n\t * \n\t * ```js\n\t * ecs.createComponent({\n\t * \tname: 'size',\n\t * \tstate: { val: 0 }\n\t * })\n\t * var getEntitySize = ecs.getStateAccessor('size')\n\t * // ...\n\t * ecs.addComponent(id, 'size', { val:123 })\n\t * getEntitySize(id).val      // 123\n\t * ```  \n\t*/\n\n\tthis.getStateAccessor = function (compName) {\n\t\tif (!storage[compName]) throw `Unknown component: ${compName}.`\n\t\tvar hash = storage[compName].hash\n\t\treturn (id) => hash[id]\n\t}\n\n\n\n\n\t/**\n\t * Makes a `hasComponent`-like accessor function bound to a given component. \n\t * The accessor is much faster than `hasComponent`.\n\t * \n\t * ```js\n\t * ecs.createComponent({\n\t * \tname: 'foo',\n\t * })\n\t * var hasFoo = ecs.getComponentAccessor('foo')\n\t * // ...\n\t * ecs.addComponent(id, 'foo')\n\t * hasFoo(id) // true\n\t * ```  \n\t*/\n\n\tthis.getComponentAccessor = function (compName) {\n\t\tif (!storage[compName]) throw `Unknown component: ${compName}.`\n\t\tvar hash = storage[compName].hash\n\t\treturn (id) => !!hash[id]\n\t}\n\n\n\n\n\n\t/**\n\t * Tells the ECS that a game tick has occurred, causing component \n\t * `system` functions to get called.\n\t * \n\t * The optional parameter simply gets passed to the system functions. \n\t * It's meant to be a timestep, but can be used (or not used) as you like.    \n\t * \n\t * If components have an `order` property, they'll get called in that order\n\t * (lowest to highest). Component order defaults to `99`.\n\t * ```js\n\t * ecs.createComponent({\n\t * \tname: foo,\n\t * \torder: 1,\n\t * \tsystem: function(dt, states) {\n\t * \t\t// states is the same array you'd get from #getStatesList()\n\t * \t\tstates.forEach(state => {\n\t * \t\t\tconsole.log('Entity ID: ', state.__id)\n\t * \t\t})\n\t * \t}\n\t * })\n\t * ecs.tick(30) // triggers log statements\n\t * ```\n\t*/\n\n\tthis.tick = function (dt) {\n\t\tdoDeferredCleanup()\n\t\tfor (var i = 0; i < systems.length; i++) {\n\t\t\tvar compName = systems[i]\n\t\t\tvar comp = components[compName]\n\t\t\tvar data = storage[compName]\n\t\t\tcomp.system(dt, data.list)\n\t\t\tdoDeferredCleanup()\n\t\t}\n\t\treturn self\n\t}\n\n\n\n\t/**\n\t * Functions exactly like `tick`, but calls `renderSystem` functions.\n\t * this effectively gives you a second set of systems that are \n\t * called with separate timing, in case you want to \n\t * [tick and render in separate loops](http://gafferongames.com/game-physics/fix-your-timestep/)\n\t * (which you should!).\n\t * \n\t * ```js\n\t * ecs.createComponent({\n\t * \tname: foo,\n\t * \torder: 5,\n\t * \trenderSystem: function(dt, states) {\n\t * \t\t// states is the same array you'd get from #getStatesList()\n\t * \t}\n\t * })\n\t * ecs.render(1000/60)\n\t * ```\n\t*/\n\n\tthis.render = function (dt) {\n\t\tdoDeferredCleanup()\n\t\tfor (var i = 0; i < renderSystems.length; i++) {\n\t\t\tvar compName = renderSystems[i]\n\t\t\tvar comp = components[compName]\n\t\t\tvar data = storage[compName]\n\t\t\tcomp.renderSystem(dt, data.list)\n\t\t\tdoDeferredCleanup()\n\t\t}\n\t\treturn self\n\t}\n\n\n\n\n\t/**\n\t * Removes one particular instance of a multi-component.\n\t * To avoid breaking loops, the relevant state object will get nulled\n\t * immediately, and spliced from the states array later when safe \n\t * (after the current tick/render/animationFrame).\n\t * \n\t * ```js\n\t * // where component 'foo' is a multi-component\n\t * ecs.getState(id, 'foo')   // [ state1, state2, state3 ]\n\t * ecs.removeMultiComponent(id, 'foo', 1)\n\t * ecs.getState(id, 'foo')   // [ state1, null, state3 ]\n\t * // one JS event loop later...\n\t * ecs.getState(id, 'foo')   // [ state1, state3 ]\n\t * ```\n\t */\n\tthis.removeMultiComponent = function (entID, compName, index) {\n\t\tvar def = components[compName]\n\t\tvar data = storage[compName]\n\t\tif (!data) throw `Unknown component: ${compName}.`\n\t\tif (!def.multi) throw 'removeMultiComponent called on non-multi component'\n\n\t\t// removal implementations at end\n\t\tremoveMultiCompElement(entID, def, data, index)\n\n\t\treturn self\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t/*\n\t * \n\t * \n\t *\t\tinternal implementations of remove/delete operations\n\t * \t\ta bit hairy due to deferred cleanup, etc.\n\t * \n\t * \n\t*/\n\n\n\t// remove given component from an entity\n\tfunction removeComponent(entID, compName) {\n\t\tvar def = components[compName]\n\t\tvar data = storage[compName]\n\n\t\t// fail silently on all cases where removal target isn't present,\n\t\t// since multiple pieces of logic often remove/delete simultaneously\n\t\tvar state = data.hash[entID]\n\t\tif (!state) return\n\n\t\t// null out data now, so overlapped remove events won't fire\n\t\tdata.remove(entID)\n\n\t\t// call onRemove handler - on each instance for multi components\n\t\tif (def.onRemove) {\n\t\t\tif (def.multi) {\n\t\t\t\tstate.forEach(state => {\n\t\t\t\t\tif (state) def.onRemove(entID, state)\n\t\t\t\t})\n\t\t\t\tstate.length = 0\n\t\t\t} else {\n\t\t\t\tdef.onRemove(entID, state)\n\t\t\t}\n\t\t}\n\n\t\tdeferrals.removals.push(data)\n\t\tpingDeferrals()\n\t}\n\n\n\t// remove one state from a multi component\n\tfunction removeMultiCompElement(entID, def, data, index) {\n\t\t// if statesArr isn't present there's no work or cleanup to do\n\t\tvar statesArr = data.hash[entID]\n\t\tif (!statesArr) return\n\n\t\t// as above, ignore cases where removal target doesn't exist\n\t\tvar state = statesArr[index]\n\t\tif (!state) return\n\n\t\t// null out element and fire event\n\t\tstatesArr[index] = null\n\t\tif (def.onRemove) def.onRemove(entID, state)\n\n\t\tdeferrals.multiComps.push({ entID, data })\n\t\tpingDeferrals()\n\t}\n\n\n\n\n\n\n\n\t// rigging\n\tfunction pingDeferrals() {\n\t\tif (deferrals.timeout) return\n\t\tdeferrals.timeout = true\n\t\tsetTimeout(deferralHandler, 1)\n\t}\n\n\tfunction deferralHandler() {\n\t\tdeferrals.timeout = false\n\t\tdoDeferredCleanup()\n\t}\n\n\n\t/*\n\t * \n\t *\t\tgeneral handling for deferred data cleanup\n\t * \t\t\t- removes null states if component is multi\n\t * \t\t\t- removes null entries from component dataStore\n\t * \t\tshould be called at safe times - not during state loops\n\t * \n\t*/\n\n\tfunction doDeferredCleanup() {\n\t\tif (deferrals.multiComps.length) {\n\t\t\tdeferredMultiCompCleanup(deferrals.multiComps)\n\t\t}\n\t\tif (deferrals.removals.length) {\n\t\t\tdeferredComponentCleanup(deferrals.removals)\n\t\t}\n\t}\n\n\t// removes null elements from multi-comp state arrays\n\tfunction deferredMultiCompCleanup(list) {\n\t\tfor (var i = 0; i < list.length; i++) {\n\t\t\tvar { entID, data } = list[i]\n\t\t\tvar statesArr = data.hash[entID]\n\t\t\tif (!statesArr) continue\n\t\t\tfor (var j = 0; j < statesArr.length; j++) {\n\t\t\t\tif (statesArr[j]) continue\n\t\t\t\tstatesArr.splice(j, 1)\n\t\t\t\tj--\n\t\t\t}\n\t\t\t// if this leaves the states list empty, remove the whole component\n\t\t\tif (statesArr.length === 0) {\n\t\t\t\tdata.remove(entID)\n\t\t\t\tdeferrals.removals.push(data)\n\t\t\t}\n\t\t}\n\t\tlist.length = 0\n\t}\n\n\t// flushes dataStore after components have been removed\n\tfunction deferredComponentCleanup(list) {\n\t\tfor (var i = 0; i < list.length; i++) {\n\t\t\tvar data = list[i]\n\t\t\tdata.flush()\n\t\t}\n\t\tlist.length = 0\n\t}\n\n\n\n}\n\n","\n\n/*\n * \n *      Encapsulates (mostly) a collection of objects, \n *      exposed both as a hash and as an array\n *      _map maps hash id to list index\n * \n *      Note this is a dumb store, it doesn't check any inputs at all.\n *      It also assumes every stored data object is stored like:\n *          dataStore.add(37, {__id:37} )\n * \n*/\n\n\nmodule.exports = class DataStore {\n\n    constructor() {\n        this.list = []\n        this.hash = {}\n        this._map = {}\n        this._pendingRemovals = []\n    }\n\n\n    // add a new state object\n    add(id, stateObject) {\n        if (typeof this._map[id] === 'number') {\n            // this happens if id is removed/readded without flushing\n            var index = this._map[id]\n            this.hash[id] = stateObject\n            this.list[index] = stateObject\n        } else {\n            this._map[id] = this.list.length\n            this.hash[id] = stateObject\n            this.list.push(stateObject)\n        }\n    }\n\n\n    // remove - nulls the state object, actual removal comes later\n    remove(id) {\n        var index = this._map[id]\n        this.hash[id] = null\n        this.list[index] = null\n        this._pendingRemovals.push(id)\n    }\n\n\n    // just sever references\n    dispose() {\n        this.list = null\n        this.hash = null\n        this._map = null\n        this._pendingRemovals.length = 0\n    }\n\n\n    // deletes removed objects from data structures\n    flush() {\n        for (var i = 0; i < this._pendingRemovals.length; i++) {\n            var id = this._pendingRemovals[i]\n            // removal might have been reversed, or already handled\n            if (this.hash[id] !== null) continue\n            removeElement(this, id)\n        }\n        this._pendingRemovals.length = 0\n    }\n\n}\n\n\n/*\n * \n *      actual remove / cleanup logic, fixes up data structures after removal\n * \n * \n*/\n\n\nfunction removeElement(data, id) {\n    // current location of this element in the list\n    var index = data._map[id]\n    // for hash and map, just delete by id\n    delete data.hash[id]\n    delete data._map[id]\n    // now splice - either by popping or by swapping with final element\n    if (index === data.list.length - 1) {\n        data.list.pop()\n    } else {\n        // swap last item with the one we're removing\n        var swapped = data.list.pop()\n        data.list[index] = swapped\n        // need to fix _map for swapped item\n        if (swapped === null || swapped[0] === null) {\n            // slowest but rarest case - swapped item is ALSO pending removal\n            var prevIndex = data.list.length\n            for (var swapID in data._map) {\n                if (data._map[swapID] === prevIndex) {\n                    data._map[swapID] = index\n                    return\n                }\n            }\n        } else {\n            var swappedID = swapped.__id || swapped[0].__id\n            data._map[swappedID] = index\n        }\n    }\n}\n\n\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","\"use strict\"\n\nfunction traceRay_impl( getVoxel,\n\tpx, py, pz,\n\tdx, dy, dz,\n\tmax_d, hit_pos, hit_norm) {\n\t\n\t// consider raycast vector to be parametrized by t\n\t//   vec = [px,py,pz] + t * [dx,dy,dz]\n\t\n\t// algo below is as described by this paper:\n\t// http://www.cse.chalmers.se/edu/year/2010/course/TDA361/grid.pdf\n\t\n\tvar t = 0.0\n\t\t, floor = Math.floor\n\t\t, ix = floor(px) | 0\n\t\t, iy = floor(py) | 0\n\t\t, iz = floor(pz) | 0\n\n\t\t, stepx = (dx > 0) ? 1 : -1\n\t\t, stepy = (dy > 0) ? 1 : -1\n\t\t, stepz = (dz > 0) ? 1 : -1\n\t\t\n\t// dx,dy,dz are already normalized\n\t\t, txDelta = Math.abs(1 / dx)\n\t\t, tyDelta = Math.abs(1 / dy)\n\t\t, tzDelta = Math.abs(1 / dz)\n\n\t\t, xdist = (stepx > 0) ? (ix + 1 - px) : (px - ix)\n\t\t, ydist = (stepy > 0) ? (iy + 1 - py) : (py - iy)\n\t\t, zdist = (stepz > 0) ? (iz + 1 - pz) : (pz - iz)\n\t\t\n\t// location of nearest voxel boundary, in units of t \n\t\t, txMax = (txDelta < Infinity) ? txDelta * xdist : Infinity\n\t\t, tyMax = (tyDelta < Infinity) ? tyDelta * ydist : Infinity\n\t\t, tzMax = (tzDelta < Infinity) ? tzDelta * zdist : Infinity\n\n\t\t, steppedIndex = -1\n\t\n\t// main loop along raycast vector\n\twhile (t <= max_d) {\n\t\t\n\t\t// exit check\n\t\tvar b = getVoxel(ix, iy, iz)\n\t\tif (b) {\n\t\t\tif (hit_pos) {\n\t\t\t\thit_pos[0] = px + t * dx\n\t\t\t\thit_pos[1] = py + t * dy\n\t\t\t\thit_pos[2] = pz + t * dz\n\t\t\t}\n\t\t\tif (hit_norm) {\n\t\t\t\thit_norm[0] = hit_norm[1] = hit_norm[2] = 0\n\t\t\t\tif (steppedIndex === 0) hit_norm[0] = -stepx\n\t\t\t\tif (steppedIndex === 1) hit_norm[1] = -stepy\n\t\t\t\tif (steppedIndex === 2) hit_norm[2] = -stepz\n\t\t\t}\n\t\t\treturn b\n\t\t}\n\t\t\n\t\t// advance t to next nearest voxel boundary\n\t\tif (txMax < tyMax) {\n\t\t\tif (txMax < tzMax) {\n\t\t\t\tix += stepx\n\t\t\t\tt = txMax\n\t\t\t\ttxMax += txDelta\n\t\t\t\tsteppedIndex = 0\n\t\t\t} else {\n\t\t\t\tiz += stepz\n\t\t\t\tt = tzMax\n\t\t\t\ttzMax += tzDelta\n\t\t\t\tsteppedIndex = 2\n\t\t\t}\n\t\t} else {\n\t\t\tif (tyMax < tzMax) {\n\t\t\t\tiy += stepy\n\t\t\t\tt = tyMax\n\t\t\t\ttyMax += tyDelta\n\t\t\t\tsteppedIndex = 1\n\t\t\t} else {\n\t\t\t\tiz += stepz\n\t\t\t\tt = tzMax\n\t\t\t\ttzMax += tzDelta\n\t\t\t\tsteppedIndex = 2\n\t\t\t}\n\t\t}\n\n\t}\n\t\n\t// no voxel hit found\n\tif (hit_pos) {\n\t\thit_pos[0] = px + t * dx\n\t\thit_pos[1] = py + t * dy\n\t\thit_pos[2] = pz + t * dz\n\t}\n\tif (hit_norm) {\n\t\thit_norm[0] = hit_norm[1] = hit_norm[2] = 0\n\t}\n\n\treturn 0\n\n}\n\n\n// conform inputs\n\nfunction traceRay(getVoxel, origin, direction, max_d, hit_pos, hit_norm) {\n\tvar px = +origin[0]\n\t\t, py = +origin[1]\n\t\t, pz = +origin[2]\n\t\t, dx = +direction[0]\n\t\t, dy = +direction[1]\n\t\t, dz = +direction[2]\n\t\t, ds = Math.sqrt(dx * dx + dy * dy + dz * dz)\n\n\tif (ds === 0) {\n\t\tthrow new Error(\"Can't raycast along a zero vector\")\n\t}\n\n\tdx /= ds\n\tdy /= ds\n\tdz /= ds\n\tif (typeof (max_d) === \"undefined\") {\n\t\tmax_d = 64.0\n\t} else {\n\t\tmax_d = +max_d\n\t}\n\treturn traceRay_impl(getVoxel, px, py, pz, dx, dy, dz, max_d, hit_pos, hit_norm)\n}\n\nmodule.exports = traceRay","module.exports = add;\n\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction add(out, a, b) {\n    out[0] = a[0] + b[0]\n    out[1] = a[1] + b[1]\n    out[2] = a[2] + b[2]\n    return out\n}","module.exports = angle\n\nvar fromValues = require('./fromValues')\nvar normalize = require('./normalize')\nvar dot = require('./dot')\n\n/**\n * Get the angle between two 3D vectors\n * @param {vec3} a The first operand\n * @param {vec3} b The second operand\n * @returns {Number} The angle in radians\n */\nfunction angle(a, b) {\n    var tempA = fromValues(a[0], a[1], a[2])\n    var tempB = fromValues(b[0], b[1], b[2])\n \n    normalize(tempA, tempA)\n    normalize(tempB, tempB)\n \n    var cosine = dot(tempA, tempB)\n\n    if(cosine > 1.0){\n        return 0\n    } else {\n        return Math.acos(cosine)\n    }     \n}\n","module.exports = ceil\n\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to ceil\n * @returns {vec3} out\n */\nfunction ceil(out, a) {\n  out[0] = Math.ceil(a[0])\n  out[1] = Math.ceil(a[1])\n  out[2] = Math.ceil(a[2])\n  return out\n}\n","module.exports = clone;\n\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {vec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\nfunction clone(a) {\n    var out = new Float32Array(3)\n    out[0] = a[0]\n    out[1] = a[1]\n    out[2] = a[2]\n    return out\n}","module.exports = copy;\n\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the source vector\n * @returns {vec3} out\n */\nfunction copy(out, a) {\n    out[0] = a[0]\n    out[1] = a[1]\n    out[2] = a[2]\n    return out\n}","module.exports = create;\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\nfunction create() {\n    var out = new Float32Array(3)\n    out[0] = 0\n    out[1] = 0\n    out[2] = 0\n    return out\n}","module.exports = cross;\n\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction cross(out, a, b) {\n    var ax = a[0], ay = a[1], az = a[2],\n        bx = b[0], by = b[1], bz = b[2]\n\n    out[0] = ay * bz - az * by\n    out[1] = az * bx - ax * bz\n    out[2] = ax * by - ay * bx\n    return out\n}","module.exports = require('./distance')\n","module.exports = distance;\n\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {Number} distance between a and b\n */\nfunction distance(a, b) {\n    var x = b[0] - a[0],\n        y = b[1] - a[1],\n        z = b[2] - a[2]\n    return Math.sqrt(x*x + y*y + z*z)\n}","module.exports = require('./divide')\n","module.exports = divide;\n\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction divide(out, a, b) {\n    out[0] = a[0] / b[0]\n    out[1] = a[1] / b[1]\n    out[2] = a[2] / b[2]\n    return out\n}","module.exports = dot;\n\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {Number} dot product of a and b\n */\nfunction dot(a, b) {\n    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2]\n}","module.exports = 0.000001\n","module.exports = equals\n\nvar EPSILON = require('./epsilon')\n\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {vec3} a The first vector.\n * @param {vec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nfunction equals(a, b) {\n  var a0 = a[0]\n  var a1 = a[1]\n  var a2 = a[2]\n  var b0 = b[0]\n  var b1 = b[1]\n  var b2 = b[2]\n  return (Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\n          Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\n          Math.abs(a2 - b2) <= EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)))\n}\n","module.exports = exactEquals\n\n/**\n * Returns whether or not the vectors exactly have the same elements in the same position (when compared with ===)\n *\n * @param {vec3} a The first vector.\n * @param {vec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nfunction exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2]\n}\n","module.exports = floor\n\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to floor\n * @returns {vec3} out\n */\nfunction floor(out, a) {\n  out[0] = Math.floor(a[0])\n  out[1] = Math.floor(a[1])\n  out[2] = Math.floor(a[2])\n  return out\n}\n","module.exports = forEach;\n\nvar vec = require('./create')()\n\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\nfunction forEach(a, stride, offset, count, fn, arg) {\n        var i, l\n        if(!stride) {\n            stride = 3\n        }\n\n        if(!offset) {\n            offset = 0\n        }\n        \n        if(count) {\n            l = Math.min((count * stride) + offset, a.length)\n        } else {\n            l = a.length\n        }\n\n        for(i = offset; i < l; i += stride) {\n            vec[0] = a[i] \n            vec[1] = a[i+1] \n            vec[2] = a[i+2]\n            fn(vec, vec, arg)\n            a[i] = vec[0] \n            a[i+1] = vec[1] \n            a[i+2] = vec[2]\n        }\n        \n        return a\n}","module.exports = fromValues;\n\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\nfunction fromValues(x, y, z) {\n    var out = new Float32Array(3)\n    out[0] = x\n    out[1] = y\n    out[2] = z\n    return out\n}","module.exports = {\n  EPSILON: require('./epsilon')\n  , create: require('./create')\n  , clone: require('./clone')\n  , angle: require('./angle')\n  , fromValues: require('./fromValues')\n  , copy: require('./copy')\n  , set: require('./set')\n  , equals: require('./equals')\n  , exactEquals: require('./exactEquals')\n  , add: require('./add')\n  , subtract: require('./subtract')\n  , sub: require('./sub')\n  , multiply: require('./multiply')\n  , mul: require('./mul')\n  , divide: require('./divide')\n  , div: require('./div')\n  , min: require('./min')\n  , max: require('./max')\n  , floor: require('./floor')\n  , ceil: require('./ceil')\n  , round: require('./round')\n  , scale: require('./scale')\n  , scaleAndAdd: require('./scaleAndAdd')\n  , distance: require('./distance')\n  , dist: require('./dist')\n  , squaredDistance: require('./squaredDistance')\n  , sqrDist: require('./sqrDist')\n  , length: require('./length')\n  , len: require('./len')\n  , squaredLength: require('./squaredLength')\n  , sqrLen: require('./sqrLen')\n  , negate: require('./negate')\n  , inverse: require('./inverse')\n  , normalize: require('./normalize')\n  , dot: require('./dot')\n  , cross: require('./cross')\n  , lerp: require('./lerp')\n  , random: require('./random')\n  , transformMat4: require('./transformMat4')\n  , transformMat3: require('./transformMat3')\n  , transformQuat: require('./transformQuat')\n  , rotateX: require('./rotateX')\n  , rotateY: require('./rotateY')\n  , rotateZ: require('./rotateZ')\n  , forEach: require('./forEach')\n}\n","module.exports = inverse;\n\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to invert\n * @returns {vec3} out\n */\nfunction inverse(out, a) {\n  out[0] = 1.0 / a[0]\n  out[1] = 1.0 / a[1]\n  out[2] = 1.0 / a[2]\n  return out\n}","module.exports = require('./length')\n","module.exports = length;\n\n/**\n * Calculates the length of a vec3\n *\n * @param {vec3} a vector to calculate length of\n * @returns {Number} length of a\n */\nfunction length(a) {\n    var x = a[0],\n        y = a[1],\n        z = a[2]\n    return Math.sqrt(x*x + y*y + z*z)\n}","module.exports = lerp;\n\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @param {Number} t interpolation amount between the two inputs\n * @returns {vec3} out\n */\nfunction lerp(out, a, b, t) {\n    var ax = a[0],\n        ay = a[1],\n        az = a[2]\n    out[0] = ax + t * (b[0] - ax)\n    out[1] = ay + t * (b[1] - ay)\n    out[2] = az + t * (b[2] - az)\n    return out\n}","module.exports = max;\n\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction max(out, a, b) {\n    out[0] = Math.max(a[0], b[0])\n    out[1] = Math.max(a[1], b[1])\n    out[2] = Math.max(a[2], b[2])\n    return out\n}","module.exports = min;\n\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction min(out, a, b) {\n    out[0] = Math.min(a[0], b[0])\n    out[1] = Math.min(a[1], b[1])\n    out[2] = Math.min(a[2], b[2])\n    return out\n}","module.exports = require('./multiply')\n","module.exports = multiply;\n\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction multiply(out, a, b) {\n    out[0] = a[0] * b[0]\n    out[1] = a[1] * b[1]\n    out[2] = a[2] * b[2]\n    return out\n}","module.exports = negate;\n\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to negate\n * @returns {vec3} out\n */\nfunction negate(out, a) {\n    out[0] = -a[0]\n    out[1] = -a[1]\n    out[2] = -a[2]\n    return out\n}","module.exports = normalize;\n\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to normalize\n * @returns {vec3} out\n */\nfunction normalize(out, a) {\n    var x = a[0],\n        y = a[1],\n        z = a[2]\n    var len = x*x + y*y + z*z\n    if (len > 0) {\n        //TODO: evaluate use of glm_invsqrt here?\n        len = 1 / Math.sqrt(len)\n        out[0] = a[0] * len\n        out[1] = a[1] * len\n        out[2] = a[2] * len\n    }\n    return out\n}","module.exports = random;\n\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\n * @returns {vec3} out\n */\nfunction random(out, scale) {\n    scale = scale || 1.0\n\n    var r = Math.random() * 2.0 * Math.PI\n    var z = (Math.random() * 2.0) - 1.0\n    var zScale = Math.sqrt(1.0-z*z) * scale\n\n    out[0] = Math.cos(r) * zScale\n    out[1] = Math.sin(r) * zScale\n    out[2] = z * scale\n    return out\n}","module.exports = rotateX;\n\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {vec3} a The vec3 point to rotate\n * @param {vec3} b The origin of the rotation\n * @param {Number} c The angle of rotation\n * @returns {vec3} out\n */\nfunction rotateX(out, a, b, c){\n    var by = b[1]\n    var bz = b[2]\n\n    // Translate point to the origin\n    var py = a[1] - by\n    var pz = a[2] - bz\n\n    var sc = Math.sin(c)\n    var cc = Math.cos(c)\n\n    // perform rotation and translate to correct position\n    out[0] = a[0]\n    out[1] = by + py * cc - pz * sc\n    out[2] = bz + py * sc + pz * cc\n\n    return out\n}\n","module.exports = rotateY;\n\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {vec3} a The vec3 point to rotate\n * @param {vec3} b The origin of the rotation\n * @param {Number} c The angle of rotation\n * @returns {vec3} out\n */\nfunction rotateY(out, a, b, c){\n    var bx = b[0]\n    var bz = b[2]\n\n    // translate point to the origin\n    var px = a[0] - bx\n    var pz = a[2] - bz\n    \n    var sc = Math.sin(c)\n    var cc = Math.cos(c)\n  \n    // perform rotation and translate to correct position\n    out[0] = bx + pz * sc + px * cc\n    out[1] = a[1]\n    out[2] = bz + pz * cc - px * sc\n  \n    return out\n}\n","module.exports = rotateZ;\n\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {vec3} a The vec3 point to rotate\n * @param {vec3} b The origin of the rotation\n * @param {Number} c The angle of rotation\n * @returns {vec3} out\n */\nfunction rotateZ(out, a, b, c){\n    var bx = b[0]\n    var by = b[1]\n\n    //Translate point to the origin\n    var px = a[0] - bx\n    var py = a[1] - by\n  \n    var sc = Math.sin(c)\n    var cc = Math.cos(c)\n\n    // perform rotation and translate to correct position\n    out[0] = bx + px * cc - py * sc\n    out[1] = by + px * sc + py * cc\n    out[2] = a[2]\n  \n    return out\n}\n","module.exports = round\n\n/**\n * Math.round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to round\n * @returns {vec3} out\n */\nfunction round(out, a) {\n  out[0] = Math.round(a[0])\n  out[1] = Math.round(a[1])\n  out[2] = Math.round(a[2])\n  return out\n}\n","module.exports = scale;\n\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\nfunction scale(out, a, b) {\n    out[0] = a[0] * b\n    out[1] = a[1] * b\n    out[2] = a[2] * b\n    return out\n}","module.exports = scaleAndAdd;\n\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\nfunction scaleAndAdd(out, a, b, scale) {\n    out[0] = a[0] + (b[0] * scale)\n    out[1] = a[1] + (b[1] * scale)\n    out[2] = a[2] + (b[2] * scale)\n    return out\n}","module.exports = set;\n\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\nfunction set(out, x, y, z) {\n    out[0] = x\n    out[1] = y\n    out[2] = z\n    return out\n}","module.exports = require('./squaredDistance')\n","module.exports = require('./squaredLength')\n","module.exports = squaredDistance;\n\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\nfunction squaredDistance(a, b) {\n    var x = b[0] - a[0],\n        y = b[1] - a[1],\n        z = b[2] - a[2]\n    return x*x + y*y + z*z\n}","module.exports = squaredLength;\n\n/**\n * Calculates the squared length of a vec3\n *\n * @param {vec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\nfunction squaredLength(a) {\n    var x = a[0],\n        y = a[1],\n        z = a[2]\n    return x*x + y*y + z*z\n}","module.exports = require('./subtract')\n","module.exports = subtract;\n\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction subtract(out, a, b) {\n    out[0] = a[0] - b[0]\n    out[1] = a[1] - b[1]\n    out[2] = a[2] - b[2]\n    return out\n}","module.exports = transformMat3;\n\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the vector to transform\n * @param {mat4} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\nfunction transformMat3(out, a, m) {\n    var x = a[0], y = a[1], z = a[2]\n    out[0] = x * m[0] + y * m[3] + z * m[6]\n    out[1] = x * m[1] + y * m[4] + z * m[7]\n    out[2] = x * m[2] + y * m[5] + z * m[8]\n    return out\n}","module.exports = transformMat4;\n\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the vector to transform\n * @param {mat4} m matrix to transform with\n * @returns {vec3} out\n */\nfunction transformMat4(out, a, m) {\n    var x = a[0], y = a[1], z = a[2],\n        w = m[3] * x + m[7] * y + m[11] * z + m[15]\n    w = w || 1.0\n    out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w\n    out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w\n    out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w\n    return out\n}","module.exports = transformQuat;\n\n/**\n * Transforms the vec3 with a quat\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the vector to transform\n * @param {quat} q quaternion to transform with\n * @returns {vec3} out\n */\nfunction transformQuat(out, a, q) {\n    // benchmarks: http://jsperf.com/quaternion-transform-vec3-implementations\n\n    var x = a[0], y = a[1], z = a[2],\n        qx = q[0], qy = q[1], qz = q[2], qw = q[3],\n\n        // calculate quat * vec\n        ix = qw * x + qy * z - qz * y,\n        iy = qw * y + qz * x - qx * z,\n        iz = qw * z + qx * y - qy * x,\n        iw = -qx * x - qy * y - qz * z\n\n    // calculate result * inverse quat\n    out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy\n    out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz\n    out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx\n    return out\n}","\"use strict\"\n\nfunction iota(n) {\n  var result = new Array(n)\n  for(var i=0; i<n; ++i) {\n    result[i] = i\n  }\n  return result\n}\n\nmodule.exports = iota","/*!\n * Determine if an object is a Buffer\n *\n * @author   Feross Aboukhadijeh <https://feross.org>\n * @license  MIT\n */\n\nmodule.exports = function isBuffer (obj) {\n  return obj != null && obj.constructor != null &&\n    typeof obj.constructor.isBuffer === 'function' && obj.constructor.isBuffer(obj)\n}\n","var iota = require(\"iota-array\")\nvar isBuffer = require(\"is-buffer\")\n\nvar hasTypedArrays  = ((typeof Float64Array) !== \"undefined\")\n\nfunction compare1st(a, b) {\n  return a[0] - b[0]\n}\n\nfunction order() {\n  var stride = this.stride\n  var terms = new Array(stride.length)\n  var i\n  for(i=0; i<terms.length; ++i) {\n    terms[i] = [Math.abs(stride[i]), i]\n  }\n  terms.sort(compare1st)\n  var result = new Array(terms.length)\n  for(i=0; i<result.length; ++i) {\n    result[i] = terms[i][1]\n  }\n  return result\n}\n\nfunction compileConstructor(dtype, dimension) {\n  var className = [\"View\", dimension, \"d\", dtype].join(\"\")\n  if(dimension < 0) {\n    className = \"View_Nil\" + dtype\n  }\n  var useGetters = (dtype === \"generic\")\n\n  if(dimension === -1) {\n    //Special case for trivial arrays\n    var code =\n      \"function \"+className+\"(a){this.data=a;};\\\nvar proto=\"+className+\".prototype;\\\nproto.dtype='\"+dtype+\"';\\\nproto.index=function(){return -1};\\\nproto.size=0;\\\nproto.dimension=-1;\\\nproto.shape=proto.stride=proto.order=[];\\\nproto.lo=proto.hi=proto.transpose=proto.step=\\\nfunction(){return new \"+className+\"(this.data);};\\\nproto.get=proto.set=function(){};\\\nproto.pick=function(){return null};\\\nreturn function construct_\"+className+\"(a){return new \"+className+\"(a);}\"\n    var procedure = new Function(code)\n    return procedure()\n  } else if(dimension === 0) {\n    //Special case for 0d arrays\n    var code =\n      \"function \"+className+\"(a,d) {\\\nthis.data = a;\\\nthis.offset = d\\\n};\\\nvar proto=\"+className+\".prototype;\\\nproto.dtype='\"+dtype+\"';\\\nproto.index=function(){return this.offset};\\\nproto.dimension=0;\\\nproto.size=1;\\\nproto.shape=\\\nproto.stride=\\\nproto.order=[];\\\nproto.lo=\\\nproto.hi=\\\nproto.transpose=\\\nproto.step=function \"+className+\"_copy() {\\\nreturn new \"+className+\"(this.data,this.offset)\\\n};\\\nproto.pick=function \"+className+\"_pick(){\\\nreturn TrivialArray(this.data);\\\n};\\\nproto.valueOf=proto.get=function \"+className+\"_get(){\\\nreturn \"+(useGetters ? \"this.data.get(this.offset)\" : \"this.data[this.offset]\")+\n\"};\\\nproto.set=function \"+className+\"_set(v){\\\nreturn \"+(useGetters ? \"this.data.set(this.offset,v)\" : \"this.data[this.offset]=v\")+\"\\\n};\\\nreturn function construct_\"+className+\"(a,b,c,d){return new \"+className+\"(a,d)}\"\n    var procedure = new Function(\"TrivialArray\", code)\n    return procedure(CACHED_CONSTRUCTORS[dtype][0])\n  }\n\n  var code = [\"'use strict'\"]\n\n  //Create constructor for view\n  var indices = iota(dimension)\n  var args = indices.map(function(i) { return \"i\"+i })\n  var index_str = \"this.offset+\" + indices.map(function(i) {\n        return \"this.stride[\" + i + \"]*i\" + i\n      }).join(\"+\")\n  var shapeArg = indices.map(function(i) {\n      return \"b\"+i\n    }).join(\",\")\n  var strideArg = indices.map(function(i) {\n      return \"c\"+i\n    }).join(\",\")\n  code.push(\n    \"function \"+className+\"(a,\" + shapeArg + \",\" + strideArg + \",d){this.data=a\",\n      \"this.shape=[\" + shapeArg + \"]\",\n      \"this.stride=[\" + strideArg + \"]\",\n      \"this.offset=d|0}\",\n    \"var proto=\"+className+\".prototype\",\n    \"proto.dtype='\"+dtype+\"'\",\n    \"proto.dimension=\"+dimension)\n\n  //view.size:\n  code.push(\"Object.defineProperty(proto,'size',{get:function \"+className+\"_size(){\\\nreturn \"+indices.map(function(i) { return \"this.shape[\"+i+\"]\" }).join(\"*\"),\n\"}})\")\n\n  //view.order:\n  if(dimension === 1) {\n    code.push(\"proto.order=[0]\")\n  } else {\n    code.push(\"Object.defineProperty(proto,'order',{get:\")\n    if(dimension < 4) {\n      code.push(\"function \"+className+\"_order(){\")\n      if(dimension === 2) {\n        code.push(\"return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})\")\n      } else if(dimension === 3) {\n        code.push(\n\"var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);\\\nif(s0>s1){\\\nif(s1>s2){\\\nreturn [2,1,0];\\\n}else if(s0>s2){\\\nreturn [1,2,0];\\\n}else{\\\nreturn [1,0,2];\\\n}\\\n}else if(s0>s2){\\\nreturn [2,0,1];\\\n}else if(s2>s1){\\\nreturn [0,1,2];\\\n}else{\\\nreturn [0,2,1];\\\n}}})\")\n      }\n    } else {\n      code.push(\"ORDER})\")\n    }\n  }\n\n  //view.set(i0, ..., v):\n  code.push(\n\"proto.set=function \"+className+\"_set(\"+args.join(\",\")+\",v){\")\n  if(useGetters) {\n    code.push(\"return this.data.set(\"+index_str+\",v)}\")\n  } else {\n    code.push(\"return this.data[\"+index_str+\"]=v}\")\n  }\n\n  //view.get(i0, ...):\n  code.push(\"proto.get=function \"+className+\"_get(\"+args.join(\",\")+\"){\")\n  if(useGetters) {\n    code.push(\"return this.data.get(\"+index_str+\")}\")\n  } else {\n    code.push(\"return this.data[\"+index_str+\"]}\")\n  }\n\n  //view.index:\n  code.push(\n    \"proto.index=function \"+className+\"_index(\", args.join(), \"){return \"+index_str+\"}\")\n\n  //view.hi():\n  code.push(\"proto.hi=function \"+className+\"_hi(\"+args.join(\",\")+\"){return new \"+className+\"(this.data,\"+\n    indices.map(function(i) {\n      return [\"(typeof i\",i,\"!=='number'||i\",i,\"<0)?this.shape[\", i, \"]:i\", i,\"|0\"].join(\"\")\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"this.stride[\"+i + \"]\"\n    }).join(\",\")+\",this.offset)}\")\n\n  //view.lo():\n  var a_vars = indices.map(function(i) { return \"a\"+i+\"=this.shape[\"+i+\"]\" })\n  var c_vars = indices.map(function(i) { return \"c\"+i+\"=this.stride[\"+i+\"]\" })\n  code.push(\"proto.lo=function \"+className+\"_lo(\"+args.join(\",\")+\"){var b=this.offset,d=0,\"+a_vars.join(\",\")+\",\"+c_vars.join(\",\"))\n  for(var i=0; i<dimension; ++i) {\n    code.push(\n\"if(typeof i\"+i+\"==='number'&&i\"+i+\">=0){\\\nd=i\"+i+\"|0;\\\nb+=c\"+i+\"*d;\\\na\"+i+\"-=d}\")\n  }\n  code.push(\"return new \"+className+\"(this.data,\"+\n    indices.map(function(i) {\n      return \"a\"+i\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"c\"+i\n    }).join(\",\")+\",b)}\")\n\n  //view.step():\n  code.push(\"proto.step=function \"+className+\"_step(\"+args.join(\",\")+\"){var \"+\n    indices.map(function(i) {\n      return \"a\"+i+\"=this.shape[\"+i+\"]\"\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"b\"+i+\"=this.stride[\"+i+\"]\"\n    }).join(\",\")+\",c=this.offset,d=0,ceil=Math.ceil\")\n  for(var i=0; i<dimension; ++i) {\n    code.push(\n\"if(typeof i\"+i+\"==='number'){\\\nd=i\"+i+\"|0;\\\nif(d<0){\\\nc+=b\"+i+\"*(a\"+i+\"-1);\\\na\"+i+\"=ceil(-a\"+i+\"/d)\\\n}else{\\\na\"+i+\"=ceil(a\"+i+\"/d)\\\n}\\\nb\"+i+\"*=d\\\n}\")\n  }\n  code.push(\"return new \"+className+\"(this.data,\"+\n    indices.map(function(i) {\n      return \"a\" + i\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"b\" + i\n    }).join(\",\")+\",c)}\")\n\n  //view.transpose():\n  var tShape = new Array(dimension)\n  var tStride = new Array(dimension)\n  for(var i=0; i<dimension; ++i) {\n    tShape[i] = \"a[i\"+i+\"]\"\n    tStride[i] = \"b[i\"+i+\"]\"\n  }\n  code.push(\"proto.transpose=function \"+className+\"_transpose(\"+args+\"){\"+\n    args.map(function(n,idx) { return n + \"=(\" + n + \"===undefined?\" + idx + \":\" + n + \"|0)\"}).join(\";\"),\n    \"var a=this.shape,b=this.stride;return new \"+className+\"(this.data,\"+tShape.join(\",\")+\",\"+tStride.join(\",\")+\",this.offset)}\")\n\n  //view.pick():\n  code.push(\"proto.pick=function \"+className+\"_pick(\"+args+\"){var a=[],b=[],c=this.offset\")\n  for(var i=0; i<dimension; ++i) {\n    code.push(\"if(typeof i\"+i+\"==='number'&&i\"+i+\">=0){c=(c+this.stride[\"+i+\"]*i\"+i+\")|0}else{a.push(this.shape[\"+i+\"]);b.push(this.stride[\"+i+\"])}\")\n  }\n  code.push(\"var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}\")\n\n  //Add return statement\n  code.push(\"return function construct_\"+className+\"(data,shape,stride,offset){return new \"+className+\"(data,\"+\n    indices.map(function(i) {\n      return \"shape[\"+i+\"]\"\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"stride[\"+i+\"]\"\n    }).join(\",\")+\",offset)}\")\n\n  //Compile procedure\n  var procedure = new Function(\"CTOR_LIST\", \"ORDER\", code.join(\"\\n\"))\n  return procedure(CACHED_CONSTRUCTORS[dtype], order)\n}\n\nfunction arrayDType(data) {\n  if(isBuffer(data)) {\n    return \"buffer\"\n  }\n  if(hasTypedArrays) {\n    switch(Object.prototype.toString.call(data)) {\n      case \"[object Float64Array]\":\n        return \"float64\"\n      case \"[object Float32Array]\":\n        return \"float32\"\n      case \"[object Int8Array]\":\n        return \"int8\"\n      case \"[object Int16Array]\":\n        return \"int16\"\n      case \"[object Int32Array]\":\n        return \"int32\"\n      case \"[object Uint8Array]\":\n        return \"uint8\"\n      case \"[object Uint16Array]\":\n        return \"uint16\"\n      case \"[object Uint32Array]\":\n        return \"uint32\"\n      case \"[object Uint8ClampedArray]\":\n        return \"uint8_clamped\"\n      case \"[object BigInt64Array]\":\n        return \"bigint64\"\n      case \"[object BigUint64Array]\":\n        return \"biguint64\"\n    }\n  }\n  if(Array.isArray(data)) {\n    return \"array\"\n  }\n  return \"generic\"\n}\n\nvar CACHED_CONSTRUCTORS = {\n  \"float32\":[],\n  \"float64\":[],\n  \"int8\":[],\n  \"int16\":[],\n  \"int32\":[],\n  \"uint8\":[],\n  \"uint16\":[],\n  \"uint32\":[],\n  \"array\":[],\n  \"uint8_clamped\":[],\n  \"bigint64\": [],\n  \"biguint64\": [],\n  \"buffer\":[],\n  \"generic\":[]\n}\n\n;(function() {\n  for(var id in CACHED_CONSTRUCTORS) {\n    CACHED_CONSTRUCTORS[id].push(compileConstructor(id, -1))\n  }\n});\n\nfunction wrappedNDArrayCtor(data, shape, stride, offset) {\n  if(data === undefined) {\n    var ctor = CACHED_CONSTRUCTORS.array[0]\n    return ctor([])\n  } else if(typeof data === \"number\") {\n    data = [data]\n  }\n  if(shape === undefined) {\n    shape = [ data.length ]\n  }\n  var d = shape.length\n  if(stride === undefined) {\n    stride = new Array(d)\n    for(var i=d-1, sz=1; i>=0; --i) {\n      stride[i] = sz\n      sz *= shape[i]\n    }\n  }\n  if(offset === undefined) {\n    offset = 0\n    for(var i=0; i<d; ++i) {\n      if(stride[i] < 0) {\n        offset -= (shape[i]-1)*stride[i]\n      }\n    }\n  }\n  var dtype = arrayDType(data)\n  var ctor_list = CACHED_CONSTRUCTORS[dtype]\n  while(ctor_list.length <= d+1) {\n    ctor_list.push(compileConstructor(dtype, ctor_list.length-1))\n  }\n  var ctor = ctor_list[d+1]\n  return ctor(data, shape, stride, offset)\n}\n\nmodule.exports = wrappedNDArrayCtor\n","/*!\n * Determine if an object is a Buffer\n *\n * @author   Feross Aboukhadijeh <https://feross.org>\n * @license  MIT\n */\n\n// The _isBuffer check is for Safari 5-7 support, because it's missing\n// Object.prototype.constructor. Remove this eventually\nmodule.exports = function (obj) {\n  return obj != null && (isBuffer(obj) || isSlowBuffer(obj) || !!obj._isBuffer)\n}\n\nfunction isBuffer (obj) {\n  return !!obj.constructor && typeof obj.constructor.isBuffer === 'function' && obj.constructor.isBuffer(obj)\n}\n\n// For Node v0.10 support. Remove this eventually.\nfunction isSlowBuffer (obj) {\n  return typeof obj.readFloatLE === 'function' && typeof obj.slice === 'function' && isBuffer(obj.slice(0, 0))\n}\n","'use strict'\n\n\n// reused array instances\n\nvar tr_arr = []\nvar ldi_arr = []\nvar tri_arr = []\nvar step_arr = []\nvar tDelta_arr = []\nvar tNext_arr = []\nvar vec_arr = []\nvar normed_arr = []\nvar base_arr = []\nvar max_arr = []\nvar left_arr = []\nvar result_arr = []\n\n\n\n// core implementation:\n\nfunction sweep_impl(getVoxel, callback, vec, base, max, epsilon) {\n\n    // consider algo as a raycast along the AABB's leading corner\n    // as raycast enters each new voxel, iterate in 2D over the AABB's \n    // leading face in that axis looking for collisions\n    // \n    // original raycast implementation: https://github.com/andyhall/fast-voxel-raycast\n    // original raycast paper: http://www.cse.chalmers.se/edu/year/2010/course/TDA361/grid.pdf\n\n    var tr = tr_arr\n    var ldi = ldi_arr\n    var tri = tri_arr\n    var step = step_arr\n    var tDelta = tDelta_arr\n    var tNext = tNext_arr\n    var normed = normed_arr\n\n    var floor = Math.floor\n    var cumulative_t = 0.0\n    var t = 0.0\n    var max_t = 0.0\n    var axis = 0\n    var i = 0\n\n\n    // init for the current sweep vector and take first step\n    initSweep()\n    if (max_t === 0) return 0\n\n    axis = stepForward()\n\n    // loop along raycast vector\n    while (t <= max_t) {\n\n        // sweeps over leading face of AABB\n        if (checkCollision(axis)) {\n            // calls the callback and decides whether to continue\n            var done = handleCollision()\n            if (done) return cumulative_t\n        }\n\n        axis = stepForward()\n    }\n\n    // reached the end of the vector unobstructed, finish and exit\n    cumulative_t += max_t\n    for (i = 0; i < 3; i++) {\n        base[i] += vec[i]\n        max[i] += vec[i]\n    }\n    return cumulative_t\n\n\n\n\n\n    // low-level implementations of each step:\n    function initSweep() {\n\n        // parametrization t along raycast\n        t = 0.0\n        max_t = Math.sqrt(vec[0] * vec[0] + vec[1] * vec[1] + vec[2] * vec[2])\n        if (max_t === 0) return\n        for (var i = 0; i < 3; i++) {\n            var dir = (vec[i] >= 0)\n            step[i] = dir ? 1 : -1\n            // trailing / trailing edge coords\n            var lead = dir ? max[i] : base[i]\n            tr[i] = dir ? base[i] : max[i]\n            // int values of lead/trail edges\n            ldi[i] = leadEdgeToInt(lead, step[i])\n            tri[i] = trailEdgeToInt(tr[i], step[i])\n            // normed vector\n            normed[i] = vec[i] / max_t\n            // distance along t required to move one voxel in each axis\n            tDelta[i] = Math.abs(1 / normed[i])\n            // location of nearest voxel boundary, in units of t \n            var dist = dir ? (ldi[i] + 1 - lead) : (lead - ldi[i])\n            tNext[i] = (tDelta[i] < Infinity) ? tDelta[i] * dist : Infinity\n        }\n\n    }\n\n\n    // check for collisions - iterate over the leading face on the advancing axis\n\n    function checkCollision(i_axis) {\n        var stepx = step[0]\n        var x0 = (i_axis === 0) ? ldi[0] : tri[0]\n        var x1 = ldi[0] + stepx\n\n        var stepy = step[1]\n        var y0 = (i_axis === 1) ? ldi[1] : tri[1]\n        var y1 = ldi[1] + stepy\n\n        var stepz = step[2]\n        var z0 = (i_axis === 2) ? ldi[2] : tri[2]\n        var z1 = ldi[2] + stepz\n\n        // var j_axis = (i_axis + 1) % 3\n        // var k_axis = (i_axis + 2) % 3\n        // var s = ['x', 'y', 'z'][i_axis]\n        // var js = ['x', 'y', 'z'][j_axis]\n        // var ks = ['x', 'y', 'z'][k_axis]\n        // var i0 = [x0, y0, z0][i_axis]\n        // var j0 = [x0, y0, z0][j_axis]\n        // var k0 = [x0, y0, z0][k_axis]\n        // var i1 = [x1 - stepx, y1 - stepy, z1 - stepz][i_axis]\n        // var j1 = [x1 - stepx, y1 - stepy, z1 - stepz][j_axis]\n        // var k1 = [x1 - stepx, y1 - stepy, z1 - stepz][k_axis]\n        // console.log('=== step', s, 'to', i0, '   sweep', js, j0 + ',' + j1, '   ', ks, k0 + ',' + k1)\n\n        for (var x = x0; x != x1; x += stepx) {\n            for (var y = y0; y != y1; y += stepy) {\n                for (var z = z0; z != z1; z += stepz) {\n                    if (getVoxel(x, y, z)) return true\n                }\n            }\n        }\n        return false\n    }\n\n\n    // on collision - call the callback and return or set up for the next sweep\n\n    function handleCollision() {\n\n        // set up for callback\n        cumulative_t += t\n        var dir = step[axis]\n\n        // vector moved so far, and left to move\n        var done = t / max_t\n        var left = left_arr\n        for (i = 0; i < 3; i++) {\n            var dv = vec[i] * done\n            base[i] += dv\n            max[i] += dv\n            left[i] = vec[i] - dv\n        }\n\n        // set leading edge of stepped axis exactly to voxel boundary\n        // else we'll sometimes rounding error beyond it\n        if (dir > 0) {\n            max[axis] = Math.round(max[axis])\n        } else {\n            base[axis] = Math.round(base[axis])\n        }\n        \n        // call back to let client update the \"left to go\" vector\n        var res = callback(cumulative_t, axis, dir, left)\n\n        // bail out out on truthy response\n        if (res) return true\n\n        // init for new sweep along vec\n        for (i = 0; i < 3; i++) vec[i] = left[i]\n        initSweep()\n        if (max_t === 0) return true // no vector left\n\n        return false\n    }\n\n\n    // advance to next voxel boundary, and return which axis was stepped\n\n    function stepForward() {\n        var axis = (tNext[0] < tNext[1]) ?\n            ((tNext[0] < tNext[2]) ? 0 : 2) :\n            ((tNext[1] < tNext[2]) ? 1 : 2)\n        var dt = tNext[axis] - t\n        t = tNext[axis]\n        ldi[axis] += step[axis]\n        tNext[axis] += tDelta[axis]\n        for (i = 0; i < 3; i++) {\n            tr[i] += dt * normed[i]\n            tri[i] = trailEdgeToInt(tr[i], step[i])\n        }\n\n        return axis\n    }\n\n\n\n    function leadEdgeToInt(coord, step) {\n        return floor(coord - step * epsilon)\n    }\n    function trailEdgeToInt(coord, step) {\n        return floor(coord + step * epsilon)\n    }\n\n}\n\n\n\n\n\n// conform inputs\n\nfunction sweep(getVoxel, box, dir, callback, noTranslate, epsilon) {\n\n    var vec = vec_arr\n    var base = base_arr\n    var max = max_arr\n    var result = result_arr\n\n    // init parameter float arrays\n    for (var i = 0; i < 3; i++) {\n        vec[i] = +dir[i]\n        max[i] = +box.max[i]\n        base[i] = +box.base[i]\n    }\n\n    if (!epsilon) epsilon = 1e-10\n\n    // run sweep implementation\n    var dist = sweep_impl(getVoxel, callback, vec, base, max, epsilon)\n\n    // translate box by distance needed to updated base value\n    if (!noTranslate) {\n        for (i = 0; i < 3; i++) {\n            result[i] = (dir[i] > 0) ? max[i] - box.max[i] : base[i] - box.base[i]\n        }\n        box.translate(result)\n    }\n\n    // return value is total distance moved (not necessarily magnitude of [end]-[start])\n    return dist\n}\n\nmodule.exports = sweep\n\n","/** \n * @module \n * @internal exclude this file from API docs \n*/\n\n\n// helper to swap item to end and pop(), instead of splice()ing\nexport function removeUnorderedListItem(list, item) {\n    var i = list.indexOf(item)\n    if (i < 0) return\n    if (i === list.length - 1) {\n        list.pop()\n    } else {\n        list[i] = list.pop()\n    }\n}\n\n\n\n// loop over a function for a few ms, or until it returns true\nexport function loopForTime(maxTimeInMS, callback, startTime) {\n    var t0 = startTime || performance.now()\n    var res = callback()\n    if (res) return\n    var t1 = performance.now(), dt = t1 - startTime\n    // tweak time to make the average delay equal to the desired amt\n    var cutoff = t0 + maxTimeInMS - dt / 2\n    if (t1 > cutoff) return\n    var maxIter = 1000 // sanity check\n    for (var i = 0; i < maxIter; i++) {\n        if (callback() || performance.now() > cutoff) return\n    }\n}\n\n\n\n\n\n// ....\nexport function numberOfVoxelsInSphere(rad) {\n    if (rad === prevRad) return prevAnswer\n    var ext = Math.ceil(rad), ct = 0, rsq = rad * rad\n    for (var i = -ext; i <= ext; ++i) {\n        for (var j = -ext; j <= ext; ++j) {\n            for (var k = -ext; k <= ext; ++k) {\n                var dsq = i * i + j * j + k * k\n                if (dsq < rsq) ct++\n            }\n        }\n    }\n    prevRad = rad\n    prevAnswer = ct\n    return ct\n}\nvar prevRad = 0, prevAnswer = 0\n\n\n\n\n\n// partly \"unrolled\" loops to copy contents of ndarrays\n// when there's no source, zeroes out the array instead\nexport function copyNdarrayContents(src, tgt, pos, size, tgtPos) {\n    if (typeof src === 'number') {\n        doNdarrayFill(src, tgt, tgtPos[0], tgtPos[1], tgtPos[2],\n            size[0], size[1], size[2])\n    } else {\n        doNdarrayCopy(src, tgt, pos[0], pos[1], pos[2],\n            size[0], size[1], size[2], tgtPos[0], tgtPos[1], tgtPos[2])\n    }\n}\nfunction doNdarrayCopy(src, tgt, i0, j0, k0, si, sj, sk, ti, tj, tk) {\n    var sdx = src.stride[2]\n    var tdx = tgt.stride[2]\n    for (var i = 0; i < si; i++) {\n        for (var j = 0; j < sj; j++) {\n            var six = src.index(i0 + i, j0 + j, k0)\n            var tix = tgt.index(ti + i, tj + j, tk)\n            for (var k = 0; k < sk; k++) {\n                tgt.data[tix] = src.data[six]\n                six += sdx\n                tix += tdx\n            }\n        }\n    }\n}\n\nfunction doNdarrayFill(value, tgt, i0, j0, k0, si, sj, sk) {\n    var dx = tgt.stride[2]\n    for (var i = 0; i < si; i++) {\n        for (var j = 0; j < sj; j++) {\n            var ix = tgt.index(i0 + i, j0 + j, k0)\n            for (var k = 0; k < sk; k++) {\n                tgt.data[ix] = value\n                ix += dx\n            }\n        }\n    }\n}\n\n\n\n\n// iterates over 3D positions a given manhattan distance from (0,0,0)\n// and exit early if the callback returns true\n// skips locations beyond a horiz or vertical max distance\nexport function iterateOverShellAtDistance(d, xmax, ymax, cb) {\n    if (d === 0) return cb(0, 0, 0)\n    // larger top/bottom planes of current shell\n    var dx = Math.min(d, xmax)\n    var dy = Math.min(d, ymax)\n    if (d <= ymax) {\n        for (var x = -dx; x <= dx; x++) {\n            for (var z = -dx; z <= dx; z++) {\n                if (cb(x, d, z)) return true\n                if (cb(x, -d, z)) return true\n            }\n        }\n    }\n    // smaller side planes of shell\n    if (d <= xmax) {\n        for (var i = -d; i < d; i++) {\n            for (var y = -dy + 1; y < dy; y++) {\n                if (cb(i, y, d)) return true\n                if (cb(-i, y, -d)) return true\n                if (cb(d, y, -i)) return true\n                if (cb(-d, y, i)) return true\n            }\n        }\n    }\n    return false\n}\n\n\n\n\n\n\n// function to hash three indexes (i,j,k) into one integer\n// note that hash wraps around every 1024 indexes.\n//      i.e.:   hash(1, 1, 1) === hash(1025, 1, -1023)\nexport function locationHasher(i, j, k) {\n    return (i & 1023)\n        | ((j & 1023) << 10)\n        | ((k & 1023) << 20)\n}\n\n\n\n/*\n * \n *      chunkStorage - a Map-backed abstraction for storing/\n *      retrieving chunk objects by their location indexes\n * \n*/\n\nexport function ChunkStorage() {\n    var hash = {}\n    // exposed API - getting and setting\n    this.getChunkByIndexes = (i, j, k) => {\n        return hash[locationHasher(i, j, k)] || null\n    }\n    this.storeChunkByIndexes = (i, j, k, chunk) => {\n        hash[locationHasher(i, j, k)] = chunk\n    }\n    this.removeChunkByIndexes = (i, j, k) => {\n        delete hash[locationHasher(i, j, k)]\n    }\n}\n\n\n\n\n\n\n/*\n * \n *      LocationQueue - simple array of [i,j,k] locations, \n *      backed by a hash for O(1) existence checks.\n *      removals by value are O(n).\n * \n*/\n\nexport function LocationQueue() {\n    this.arr = []\n    this.hash = {}\n}\nLocationQueue.prototype.forEach = function (a, b) { this.arr.forEach(a, b) }\nLocationQueue.prototype.includes = function (i, j, k) {\n    var id = locationHasher(i, j, k)\n    return !!this.hash[id]\n}\nLocationQueue.prototype.add = function (i, j, k) {\n    var id = locationHasher(i, j, k)\n    if (this.hash[id]) return\n    this.arr.push([i, j, k, id])\n    this.hash[id] = true\n}\nLocationQueue.prototype.addToFront = function (i, j, k) {\n    var id = locationHasher(i, j, k)\n    if (this.hash[id]) return\n    this.arr.unshift([i, j, k, id])\n    this.hash[id] = true\n}\nLocationQueue.prototype.removeByIndex = function (ix) {\n    var el = this.arr[ix]\n    delete this.hash[el[3]]\n    this.arr.splice(ix, 1)\n}\nLocationQueue.prototype.remove = function (i, j, k) {\n    var id = locationHasher(i, j, k)\n    if (!this.hash[id]) return\n    delete this.hash[id]\n    for (var ix = 0; ix < this.arr.length; ix++) {\n        if (id === this.arr[ix][3]) {\n            this.arr.splice(ix, 1)\n            return\n        }\n    }\n    throw 'internal bug with location queue - hash value overlapped'\n}\nLocationQueue.prototype.count = function () { return this.arr.length }\nLocationQueue.prototype.isEmpty = function () { return (this.arr.length === 0) }\nLocationQueue.prototype.empty = function () {\n    this.arr.length = 0\n    this.hash = {}\n}\nLocationQueue.prototype.pop = function () {\n    var el = this.arr.pop()\n    delete this.hash[el[3]]\n    return el\n}\nLocationQueue.prototype.copyFrom = function (queue) {\n    this.arr = queue.arr.slice()\n    this.hash = {}\n    for (var key in queue.hash) this.hash[key] = true\n}\nLocationQueue.prototype.sortByDistance = function (locToDist) {\n    var hash = {}\n    for (var loc of this.arr) hash[loc] = locToDist(loc[0], loc[1], loc[2])\n    this.arr.sort((a, b) => hash[b] - hash[a]) // DESCENDING!\n    hash = null\n}\n\n\n\n\n\n\n\n\n\n\n\n// simple thing for reporting time split up between several activities\nexport function makeProfileHook(every, title, filter) {\n    if (!(every > 0)) return () => { }\n    title = title || ''\n    var times = []\n    var names = []\n    var started = 0\n    var last = 0\n    var iter = 0\n    var total = 0\n    var clearNext = true\n\n    var start = function () {\n        if (clearNext) {\n            times.length = names.length = 0\n            clearNext = false\n        }\n        started = last = performance.now()\n        iter++\n    }\n    var add = function (name) {\n        var t = performance.now()\n        if (names.indexOf(name) < 0) names.push(name)\n        var i = names.indexOf(name)\n        if (!times[i]) times[i] = 0\n        times[i] += t - last\n        last = t\n    }\n    var report = function () {\n        total += performance.now() - started\n        if (iter === every) {\n            var head = title + ' total ' + (total / every).toFixed(2) + 'ms (avg, ' + every + ' runs)    '\n            console.log(head, names.map(function (name, i) {\n                if (filter && times[i] / total < 0.05) return ''\n                return name + ': ' + (times[i] / every).toFixed(2) + 'ms    '\n            }).join(''))\n            clearNext = true\n            iter = 0\n            total = 0\n        }\n    }\n    return function profile_hook(state) {\n        if (state === 'start') start()\n        else if (state === 'end') report()\n        else add(state)\n    }\n}\n\n\n\n\n// simple thing for reporting time actions/sec\nexport function makeThroughputHook(_every, _title, filter) {\n    var title = _title || ''\n    var every = _every || 1\n    var counts = {}\n    var started = performance.now()\n    var iter = 0\n    return function profile_hook(state) {\n        if (state === 'start') return\n        if (state === 'end') {\n            if (++iter < every) return\n            var t = performance.now()\n            console.log(title + '   ' + Object.keys(counts).map(k => {\n                var through = counts[k] / (t - started) * 1000\n                counts[k] = 0\n                return k + ':' + through.toFixed(2) + '   '\n            }).join(''))\n            started = t\n            iter = 0\n        } else {\n            if (!counts[state]) counts[state] = 0\n            counts[state]++\n        }\n    }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t179: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkIds[i]] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunk\"] = self[\"webpackChunk\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [576], () => (__webpack_require__(2618)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","TypeError","String","__","this","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__decorate","decorators","target","key","desc","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","Symbol","iterator","v","op","pop","push","DefaultOptions","preventDefaults","stopPropagation","allowContextMenu","disabled","zeroAllProperties","obj","initEvents","inputs","window","addEventListener","onKeyEvent","bind","pointerOpts","passive","PointerEvent","element","onPointerEvent","document","onPointerMove","onWheelEvent","onContextMenu","onWindowBlur","nowDown","ev","handleKeyEvent","code","_touches","currID","pointerId","button","dx","movementX","mozMovementX","dy","movementY","mozMovementY","pointerState","scale","deltaMode","clientHeight","innerHeight","scrollx","deltaX","scrolly","deltaY","scrollz","deltaZ","preventDefault","_keyStates","test","note","bindings","_keyBindmap","XOR","forEach","bindingName","filterEvents","pressed","counter","pressCount","releaseCount","ct","_bindPressCount","state","emitter","down","up","emit","handleBindingEvent","defaultPrevented","a","defaultOptions","defaultBindings","Inputs","domElement","options","version","opts","EventEmitter","lastX","lastY","readyState","once","keys","includes","unbind","indexOf","splice","getBindings","res","tick","noa","super","name","isArray","MicroGameShell","pollTime","skipFramesAfter","stickyPointerLock","stickyFullscreen","tickRate","maxRenderRate","pointerLock","fullscreen","onTick","dt","onRender","onInit","onResize","onPointerLockChanged","hasPL","onFullscreenChanged","hasFS","onPointerLockerror","err","domReady","shell","_nowObject","performance","Date","_skipFramesAfter","_renderAccum","now","_lastTick","_lastRender","_frameCB","frameHandler","requestAnimationFrame","_intervalCB","intervalHandler","_interval","setInterval","setupTimers","el","setPL","want","requestPointerLock","prom","catch","exitPointerLock","setFS","requestFullscreen","exitFullscreen","pointerLockElement","fullscreenElement","get","set","resizeHandler","ResizeObserver","observe","setupDomElement","cutoffTime","tickDur","frameDur","Math","min","framePart","fn","handler","removeEventListener","setTimeout","Container","container","canvas","createElement","tabIndex","style","position","left","right","top","bottom","height","overflow","appendChild","id","querySelector","width","insertBefore","firstChild","supportsPointerLock","pointerInGame","isFocused","hasFocus","hasPointerLock","_shell","render","rendering","resize","self","listener","type","detectPointerLock","onFirstMousedown","appendTo","htmlElement","setPointerLock","lock","defaults","inverseX","inverseY","sensitivityX","sensitivityY","initialZoom","zoomSpeed","tempVectors","originVector","Camera","heading","pitch","cameraTarget","ents","createEntity","eyeOffset","getPositionData","playerEntity","addComponent","entity","offset","zoomDistance","currentZoom","_currentZoom","_dirVector","_localGetTargetPosition","pdat","pos","_renderPosition","_localGetPosition","loc","getTargetPosition","globalCamPos","localToGlobal","getPosition","getDirection","applyInputsToCamera","badx","abs","lastx","bady","lasty","bugFix","conv","PI","twopi","maxPitch","max","dir","origin","updateBeforeEntityRenderSystems","updateAfterEntityRenderSystems","maxZoom","_sweepBox","_sweepGetVoxel","world","getBlockSolidity","_sweepVec","_sweepHit","worldOriginOffset","setPosition","dist","cameraObstructionDistance","PositionState","_localPosition","_extents","order","onAdd","eid","Float32Array","globalToLocal","updatePositionExtents","onRemove","system","states","off","hw","lpos","ext","PhysicsState","entID","physics","addBody","setPhysicsFromPosition","__id","hasPosition","setPositionFromPhysics","backtrackRenderPos","removeBody","renderSystem","tickPos","positionInCurrentTick","tickTime","backtrackAmt","timeScale","cameraSmoothed","local","physState","posState","box","aabb","base","vec","smoothed","vel","velocity","boxIntersect","intervals","cylinder","collideBits","collideMask","callback","dat","stateA","stateB","intervalA","intervalB","rada","radb","dz","radsum","cylinderCylinderTest","cylinderBoxTest","cylindricalHitTest","idA","idB","onPairwiseEntityCollision","handleCollision","cyl","cube","rad","cx","cz","clamp","val","lo","hi","entities","hasPhysics","getPhysics","onCollide","impulse","cb","getCollideTerrain","cutoff","_showing","zoom","camera","checkZoom","hasMesh","shouldShow","getMeshData","mesh","visibility","onTargetMissing","updatePosition","updateRenderPosition","other","removeComponent","names","followsEntity","posDat","Error","addMeshToScene","rpos","copyFromFloats","dispose","MovementState","running","jumping","maxSpeed","moveForce","responsiveness","runningFriction","standingFriction","airMoveMult","jumpImpulse","jumpForce","jumpTime","airJumps","_jumpCount","_currjumptime","_isJumping","phys","applyMovementPhysics","tempvec","tempvec2","zeroVec","onGround","atRestY","canjump","jf","applyForce","applyImpulse","m","speed","pushLen","canPush","pushAmt","friction","inputState","camHeading","setMovementState","getMovement","jump","fb","forward","backward","rl","shadowDist","scene","getScene","disc","radius","tessellation","rotation","x","mat","makeStandardMaterial","diffuseColor","ambientColor","alpha","material","setEnabled","freeze","removeMesh","size","_mesh","createInstance","cpos","updateShadowHeight","spos","z","shadowPos","physDat","camPos","localY","resting","_localPick","round","scaling","compName","time","shadowDistance","Entities","componentArgs","compDefs","collideEntities","collideTerrain","fadeOnZoom","movement","receivesInputs","shadow","smoothCamera","bareName","compDef","compFn","undefined","createComponent","getComponentAccessor","getStateAccessor","getPhysicsBody","getCollideEntities","id1","id2","_localSetPosition","setEntitySize","xs","ys","zs","_updateDerivedPositionData","_rebaseOrigin","delta","getStatesList","locPos","nudgePosition","addComponentAgain","hasComponent","isTerrainBlocked","xlocal","floor","ylocal","zlocal","blockExt","list","extentsOverlap","getEntitiesInAABB","withComponent","entStates","testExtents","compState","hits","add","meshOffset","doPhysics","smoothName","onStep","index","dmin","dmax","extA","extB","rootNode","_scene","rebaseOffset","rebuildNextTick","transformObj","managers","getManager","registry","_blockMeshLookup","prev","geometry","InstanceManager","initChunk","chunk","_objectBlocks","setObjectBlock","blockID","j","k","oldID","removeInstance","handlers","_blockHandlerLookup","onCreate","onCustomMeshCreate","setAll","mgr","xform","addInstance","buildObjectMeshes","profile_hook","updateMatrix","count","disposed","disposeChunk","rebased","ix","buffer","dirty","capacity","keyToIndex","locToKey","parent","_objectMesher","isVisible","doNotSyncBoundingInfo","alwaysSelectAsActiveMesh","thinInstanceCount","setCapacity","transform","rebaseVec","maybeExpandBuffer","computeWorldMatrix","copyMatrixData","_localMatrix","_m","matArray","tempMatrixArray","remIndex","remLoc","tailLoc","tailIndex","tailKey","thinInstanceBufferUpdated","newBuff","len","thinInstanceSetBuffer","src","srcOff","dest","destOff","TerrainMatManager","_idCounter","_blockMatIDtoTerrainID","_terrainIDtoMatObject","_texURLtoTerrainID","_renderMatToTerrainID","Map","getTerrainMatId","blockMatID","terrID","matInfo","getMaterialData","renderMat","has","texture","url","decideTerrainMatID","needsAlpha","matName","plainMat","sampling","tex","texHasAlpha","hasAlpha","diffuseTexture","atlasIndex","TerrainMaterialPlugin","createTerrainMat","getMaterial","terrainMatID","_enable","_atlasTextureArray","onLoadObservable","setTextureArrayData","getSize","numLayers","data","_readPixelsSync","format","mode","prepareDefines","defines","getClassName","getSamplers","samplers","getAttributes","attributes","getUniforms","ubo","bindForSubMesh","uniformBuffer","engine","subMesh","setTexture","getCustomCode","shaderType","terrainMatManager","greedyMesher","GreedyMesher","meshBuilder","MeshBuilder","_terrainMeshes","meshChunk","matGetter","colGetter","ignoreMaterials","useAO","aoVals","revAoVal","mats","getBlockFaceMaterial","cols","_getMaterialVertexColor","ao","vals","rev","isNaN","voxels","cs","shape","tgt","cachedPadded","s2","Uint16Array","_vecs","tgtPos","posValues","sizeValues","tgtPosValues","_cachedVecSize","allocateVectors","coord","nab","_neighbors","nsrc","_filledWithVoxel","buildPaddedVoxelArray","edgesOnly","_isFull","_isEmpty","geomDataSet","meshes","build","cullingStrategy","from","GeometryData","terrainID","numQuads","quadMaterials","positions","indices","normals","colors","uvs","atlasIndices","geomData","requestID","vdat","applyToMesh","setVerticesData","maskCache","Int16Array","aomaskCache","solidLookup","_solidityLookup","opacityLookup","_opacityLookup","matIDtoTerrainID","matID","matIDtoAtlasIndex","constructMeshMasks","arrT","doAO","skipRevAO","mask","aomask","materialDir","dbase","istride","stride","jstride","kstride","d0","id0","faceDir","getFaceDir","packAOMask","op0","op1","m0","m1","constructGeometryFromMasks","u","len1","len2","getColor","aoValues","du","dv","norms","maskCompareFcn","maskCompare","maskCompare_noAO","meshColorFcn","pushMeshColors","pushMeshColors_noAO","w","h","maskVal","OUTER","nq","addAtlasIndices","triDir","addPositionValues","addUVs","addNormalValues","addIndexValues","hx","wx","posArr","uvArr","normArr","indArr","baseIndex","indexVals","indexLists","A","B","C","D","skipReverseAO","transpose","len0","aoVal","ao00","unpackAOMask","ao10","ao11","ao01","pushAOColor","ipos","ineg","skipReverse","a00","a01","a10","a11","jpos","kpos","baseCol","mult","texturePath","Registry","_texturePath","matIDs","blockSolidity","blockOpacity","blockIsFluid","blockIsObject","blockProps","blockMeshes","blockHandlers","blockIsPlain","blockMats","matDefs","registerBlock","BlockOptions","fluid","solid","opaque","blockMesh","getMaterialId","fluidDensity","viscosity","hasHandler","onLoad","onUnload","onSet","onUnset","BlockCallbackHolder","isPlain","registerMaterial","MaterialOptions","color","textureURL","renderMaterial","getBlockOpacity","getBlockFluidity","getBlockProps","blockId","getMaterialColor","getMaterialTexture","_fluidityLookup","_objectLookup","_blockIsPlainLookup","white","reg","lazyInit","isFluid","SceneOctreeManager","blockSize","_addComponent","octree","NOP","_selectionOctree","blocks","octBlocksHash","rebase","recurseRebaseBlocks","includesMesh","_noaContainingBlock","_noaIsDynamicContent","addMesh","isStatic","dynamicContent","ci","bs","cj","ck","mapKey","block","gloc","makeOctreeBlock","_noaMapKey","entries","_noaContainingChunk","_chunkSize","child","minPoint","subtractInPlace","maxPoint","_boundingVectors","minPt","glvec3","showFPS","antiAlias","clearColor","lightDiffuse","lightSpecular","groundLightColor","AOmultipliers","reverseAOmultiplier","preserveDrawingBuffer","octreeBlockSize","renderOnResize","Rendering","meshingCutoffTime","_engine","_octreeManager","initScene","div","zIndex","backgroundColor","font","textAlign","minWidth","margin","longest","start","last","fps_hook","nt","fps","innerHTML","setUpFPS","detachControl","_cameraHolder","_camera","minZ","_camScreen","_camScreenMat","_camLocBlock","lightVec","arrToColor","_light","diffuse","specular","groundColor","skipPointerMovePicking","cam","tgtLoc","cloc","cy","getBlock","matId","matData","col","checkCameraEffect","updateCameraForRender","beginFrame","endFrame","postRender","_paused","highlightBlockFace","show","_highlightMesh","hlm","backFaceCulling","emissiveColor","lines","points","getHighlightMesh","hlpos","slop","containingChunk","freezeWorldMatrix","freezeNormals","onDisposeObservable","specularColor","postMaterialCreationHook","prepareChunkForRendering","disposeChunkForRendering","dvec","isWorldMatrixFrozen","debug_SceneCheck","dyns","octs","numOcts","numSubs","materials","allmats","subMaterials","isDisposed","warn","getIndices","empty","missing","subMeshes","unusedMats","used","console","join","avgPerOct","msg","list1","list2","log","debug_MeshCount","replace","substr","vec3","RigidBody","_aabb","mass","restitution","gravMult","autoStep","gravityMultiplier","airDrag","fluidDrag","inFluid","_ratioInFluid","_forces","_impulses","_sleepFrameCount","sanityCheck","subtract","translate","_markActive","clone","atRestX","atRestZ","sweep","gravity","minBounceImpulse","testSolid","testFluid","bodies","impacts","oldResting","noGravity","equals","squaredLength","copy","isResting","gmult","sleepVec","bodyAsleep","y0","y1","ratioInFluid","submerged","displaced","_fluidVec","applyFluidForces","scaleAndAdd","applyFrictionByAxis","drag","cloneAABB","tmpBox","processCollisions","oldBox","xBlocked","zBlocked","ratio","targetPos","getVoxels","axis","ydist","upvec","collided","leftover","tmpResting","tryAutoStepping","mag","iterateBody","dvel","restDir","vNormal","lateralVel","vCurr","dvMax","scaler","Physics","fluidLookup","getBlockID","Chunk","dataArray","fillVoxelID","_terrainDirty","_objectsDirty","_terrainMesher","fill","narr","_neighborCount","_timesMeshed","_blockHandlerLocs","scanVoxelData","callBlockHandler","opaqueLookup","handlerLookup","objectLookup","plainLookup","objMesher","monoID","fullyOpaque","fullyAir","callAllBlockHandlers","arr","_createVoxelArray","_updateVoxelArray","getSolidityAt","newID","hold","hnew","remove","objOld","objNew","solidityChanged","opacityChanged","wasTerrain","nowTerrain","_queueChunkForRemesh","edge","jmin","kmin","imax","jmax","kmax","ni","nj","nk","updateMeshes","chunkSize","chunkAddDistance","chunkRemoveDistance","worldGenWhilePaused","manuallyControlChunkLoading","World","playerChunkLoaded","chunkSortingDistFn","defaultSortDistance","minNeighborsToMesh","maxChunksPendingCreation","maxChunksPendingMeshing","maxProcessingPerTick","maxProcessingPerRender","_chunkAddDistance","_chunkRemoveDistance","_addDistanceFn","_remDistanceFn","_prevWorldName","_prevPlayerChunkHash","_chunkAddSearchFrom","_prevSortingFn","_chunksKnown","_chunksPending","_chunksToRequest","_chunksToRemove","_chunksToMesh","_chunksToMeshFirst","_chunksSortedLocs","setAddRemoveDistance","_storage","_coordsToChunkIndexes","chunkCoordsToIndexesGeneral","_coordsToChunkLocals","chunkCoordsToLocalsGeneral","_coordShiftBits","log2","_coordMask","chunkCoordsToIndexesPowerOfTwo","chunkCoordsToLocalsPowerOfTwo","getChunkByIndexes","getBlockProperties","setBlockID","isBoxUnobstructed","setChunkData","array","userData","reqID","split","parseInt","shift","worldName","storeChunkByIndexes","possiblyQueueChunkForMeshing","updateNeighborsOfChunk","profile_queues_hook","addDist","remDist","addArr","remArr","makeDistanceTestFunction","invalidateVoxelsInAABB","Number","isFinite","invalidateChunksInBox","manuallyLoadChunk","manualErr","manuallyUnloadChunk","getPlayerChunkIndexes","tickStartTime","chunkLocHash","changedChunks","copyFrom","sortQueueByDistanceFrom","markAllChunksForRemoval","processRemoveQueue","distFn","toRemove","findDistantChunksToRemove","toRequest","startIx","locs","checkingState","removals","di","dj","dk","checkReflectedLocations","findNewChunksInRange","ptime","done1","done2","done3","isEmpty","pending","toMesh","dataArr","requestNewChunk","processRequestQueue","processMeshingQueue","numQueued","knownLocs","lookIndex","lookForChunksToMesh","pChunk","mpr","_getChunkByCoords","checkOneLocation","addToFront","removeChunkByIndexes","removeChunk","firstOnly","queue","doChunkRemesh","pi","pj","pk","reverse","sortByDistance","terrainChanged","neighbor","nabRef","xsize","ysize","asq","bsq","dxsq","_report","full","exist","surrounded","remeshes","out","toString","padEnd","sum","reduce","acc","toFixed","report","concat","debug","silent","silentBabylon","playerHeight","playerWidth","playerStart","playerAutoStep","blockTestDistance","dragCameraOutsidePointerLock","skipDefaultHighlighting","originRebaseDistance","Engine","debugstr","_dragOutsideLock","_originRebaseDistance","_consoleLog","blockTargetIdCheck","targetedBlock","defaultBlockHighlightFunction","normal","on","_targetedBlockDat","adjacent","_prevTargetHash","makeTargetHash","norm","_pickPos","_pickResult","ndarray","win","ver","dep","throwFn","deprecateStuff","checkWorldOffset","newhash","blockIdFn","updateBlockTargets","pst","profile_hook_render","fire","setPaused","paused","setBlock","addBlock","global","globalPrecise","floored","pick","blockTestFunction","pickPos","testFn","rnorm","dirtID","grassID","getVoxelID","sin","cos","voxelID","player","scroll","bits","dup","isBuffer","__TYPEDARRAY_POOL","UINT8","UINT16","UINT32","INT8","INT16","INT32","FLOAT","DOUBLE","DATA","UINT8C","BUFFER","hasUint8C","Uint8ClampedArray","POOL","freeArrayBuffer","byteLength","log_n","mallocArrayBuffer","nextPow2","ArrayBuffer","mallocUint8","Uint8Array","mallocUint16","mallocUint32","Uint32Array","mallocInt8","Int8Array","mallocInt16","mallocInt32","Int32Array","mallocFloat","mallocDouble","Float64Array","mallocUint8Clamped","mallocDataView","DataView","exports","free","freeUint8","freeUint16","freeUint32","freeInt8","freeInt16","freeInt32","freeFloat32","freeFloat","freeFloat64","freeDouble","freeUint8Clamped","freeDataView","freeBuffer","malloc","dtype","mallocFloat32","mallocFloat64","clearCache","module","AABB","pos2","proto","depth","x0","z0","x1","z1","by","expand","intersects","touches","intersection","union","base_x","base_y","base_z","countTrailingZeros","INT_BITS","INT_MAX","INT_MIN","sign","isPow2","log10","popCount","prevPow2","parity","REVERSE_TABLE","tab","interleave2","deinterleave2","interleave3","deinterleave3","nextCombination","arg0","arg1","arg2","intersectFullArray","intersectBipartiteArray","RESULT","pool","boxIntersectIter","boxEmpty","convertBoxes","boxes","ids","ptr","red","blue","visit","retval","redList","redIds","init","sweepComplete","blueList","blueIds","sweepBipartite","appendItem","ARGS","bruteForcePlanner","funcName","prefix","fargs","slice","invoke","redMajor","flip","redLoop","blueLoop","generateBruteForce","codeStr","Function","proc","partial","initFull","xSize","xBoxes","xIndex","ySize","yBoxes","yIndex","levels","maxInts","BOX_ISTACK","maxDoubles","BOX_DSTACK","iterInit","elemSize","iterPush","Infinity","iptr","redStart","redEnd","blueStart","blueEnd","dptr","redIndex","blueIndex","partitionStartLessThan","partitionEndLessThanEqual","redCount","blueCount","scanComplete","bruteForcePartial","scanBipartite","red0","partitionInteriorContainsInterval","bruteForceFull","blue0","findMedian","mid","blue1","partitionStartEqual","onePointFull","onePointPartial","red1","partitionContainsPoint","redX","partitionContainsPointProper","bruteForce","genPartition","blueOffset","blueId","bluePtr","blueX","red_loop","redPtr","r0","r1","redId","b0","b1","end","pivot","insertionSort","pivot0","random","value0","pivot1","value1","pivot2","value2","aPtr","bPtr","boxPtr","tmp","predicate","args","reads","jptr","swap","move","rotate","shufflePivot","px","py","compare","comparePivot","quickSort","sixth","index1","index5","index3","index2","index4","el1","el2","el3","el4","el5","less","great","pivot1X","pivot1Y","pivot2X","pivot2Y","ptr0","ptr2","ptr4","ptr5","ptr6","ptr7","i1","n0","rcount","RED_SWEEP_QUEUE","RED_SWEEP_INDEX","BLUE_SWEEP_QUEUE","BLUE_SWEEP_INDEX","COMMON_SWEEP_QUEUE","COMMON_SWEEP_INDEX","eventLength","SWEEP_EVENTS","istart","iend","idx","redOffset","BLUE_FLAG","isort","redActive","blueActive","sqPop","sqPush","commonActive","redShift","blueShift","isRed","oidx","INIT_CAPACITY","item","dupe_array","dupe_number","components","comps","UID","storage","systems","renderSystems","deferrals","timeout","multiComps","def","hash","multi","pingDeferrals","deferralHandler","doDeferredCleanup","statesArr","deferredMultiCompCleanup","flush","deferredComponentCleanup","_systems","_renderSystems","compList","deleteEntity","compDefn","internalDef","DataStore","_pendingMultiCleanup","_multiCleanupIDs","sort","deleteComponent","newState","getState","comp","removeMultiComponent","removeMultiCompElement","removeElement","_map","swapped","prevIndex","swapID","swappedID","_pendingRemovals","stateObject","ReflectOwnKeys","R","ReflectApply","receiver","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","NumberIsNaN","errorListener","removeListener","resolver","eventTargetAgnosticAddListener","flags","addErrorHandlerIfEventEmitter","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","_getMaxListeners","that","_addListener","prepend","events","existing","warning","newListener","unshift","warned","onceWrapper","fired","wrapFn","_onceWrap","wrapped","_listeners","unwrap","evlistener","ret","unwrapListeners","arrayClone","listenerCount","wrapListener","arg","enumerable","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","message","context","listeners","addListener","prependListener","prependOnceListener","originalListener","spliceOne","removeAllListeners","rawListeners","eventNames","getVoxel","direction","max_d","hit_pos","hit_norm","pz","ds","sqrt","iy","iz","stepx","stepy","stepz","txDelta","tyDelta","tzDelta","txMax","tyMax","tzMax","steppedIndex","traceRay_impl","tempA","fromValues","tempB","normalize","cosine","dot","acos","ceil","ax","ay","az","bx","bz","a0","a1","a2","b2","EPSILON","l","angle","exactEquals","sub","multiply","mul","divide","distance","squaredDistance","sqrDist","sqrLen","negate","inverse","cross","lerp","transformMat4","transformMat3","transformQuat","rotateX","rotateY","rotateZ","zScale","sc","cc","q","qx","qy","qz","qw","iw","iota","hasTypedArrays","compare1st","terms","compileConstructor","dimension","className","useGetters","procedure","CACHED_CONSTRUCTORS","map","index_str","shapeArg","strideArg","a_vars","c_vars","tShape","tStride","ctor","sz","arrayDType","ctor_list","readFloatLE","isSlowBuffer","_isBuffer","tr_arr","ldi_arr","tri_arr","step_arr","tDelta_arr","tNext_arr","vec_arr","normed_arr","base_arr","max_arr","left_arr","result_arr","noTranslate","epsilon","tr","ldi","tri","tDelta","tNext","normed","cumulative_t","max_t","initSweep","stepForward","checkCollision","lead","leadEdgeToInt","trailEdgeToInt","i_axis","sweep_impl","removeUnorderedListItem","loopForTime","maxTimeInMS","startTime","t0","t1","copyNdarrayContents","i0","j0","k0","si","sj","sk","doNdarrayFill","ti","tj","tk","sdx","tdx","six","tix","doNdarrayCopy","locationHasher","ChunkStorage","LocationQueue","makeProfileHook","every","title","filter","times","started","iter","total","clearNext","head","removeByIndex","locToDist","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","O","chunkIds","priority","notFulfilled","getter","__esModule","definition","o","globalThis","prop","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","chunkLoadingGlobal","__webpack_exports__"],"sourceRoot":""}